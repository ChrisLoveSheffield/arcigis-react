"use strict";(self.webpackChunkuums_front_end=self.webpackChunkuums_front_end||[]).push([[188],{23819:function(e,t,r){r.d(t,{H:function(){return d},b:function(){return h}});var i,n=r(30168),a=r(74321),s=r(64600),u=r(58406),o=r(98634),l=r(64201),c=r(19253);function h(){var e=new l.kG;return e.include(a.k),e.include(s.f),e.fragment.uniforms.add([new c.A("densityMap",(function(e){return e.densityMap})),new c.A("tex",(function(e){return e.colorRamp})),new u.p("densityNormalizer",(function(e){return 1/(e.maxDensity-e.minDensity)})),new u.p("minDensity",(function(e){return e.minDensity}))]),e.fragment.uniforms.add(new u.p("densityMultiplier",(function(e){return 3/(e.searchRadius*e.searchRadius*Math.PI)}))),e.fragment.code.add((0,o.H)(i||(i=(0,n.Z)(["void main() {\nfloat density = texture2D(densityMap, uv).r * densityMultiplier;\nfloat densityRatio = (density - minDensity) * densityNormalizer;\nvec4 color = texture2D(tex, vec2(clamp(densityRatio, 0.0, 1.0), 0.5));\ndiscardOrAdjustAlpha(color);\ngl_FragColor = color;\n}"])))),e}var d=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}))},65322:function(e,t,r){r.d(t,{H:function(){return p},b:function(){return f}});var i,n,a,s,u=r(30168),o=r(41012),l=r(58406),c=r(98634),h=r(64201),d=r(4760);function f(e){var t=new h.kG;(0,o.S)(t,e);var r=e.isAttributeDriven;return t.attributes.add(d.T.POSITION,"vec3"),t.attributes.add(d.T.UV0,"vec2"),r&&(t.attributes.add(d.T.FEATUREATTRIBUTE,"float"),t.varyings.add("attributeValue","float")),t.varyings.add("unitCirclePos","vec2"),t.vertex.uniforms.add(new l.p("radius",(function(e,t){var r=e.resolutionForScale,i=e.searchRadius,n=t.camera,a=t.screenToWorldRatio;return 2*i*(0===r?1:r/a)*n.pixelRatio/n.fullViewport[2]}))),t.vertex.code.add((0,c.H)(i||(i=(0,u.Z)(["\n    void main() {\n      unitCirclePos = uv0;\n\n      vec4 posProj = proj * (view * vec4(",", 1.0));\n      vec4 quadOffset = vec4(unitCirclePos * radius, 0.0, 0.0);\n\n      ","\n      gl_Position = posProj + quadOffset;\n    }\n  "])),d.T.POSITION,r?(0,c.H)(n||(n=(0,u.Z)(["attributeValue = ",";"])),d.T.FEATUREATTRIBUTE):"")),t.fragment.code.add((0,c.H)(a||(a=(0,u.Z)(["\n    void main() {\n      float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);\n      if (radiusRatioSquared > 1.0) {\n        discard;\n      }\n\n      float oneMinusRadiusRatioSquared = 1.0 - radiusRatioSquared;\n      float density = oneMinusRadiusRatioSquared * oneMinusRadiusRatioSquared ",";\n      gl_FragColor = vec4(density);\n    }\n  "])),r?(0,c.H)(s||(s=(0,u.Z)([" * attributeValue"]))):"")),t}var p=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}))},5845:function(e,t,r){r.d(t,{g:function(){return B}});var i=r(37762),n=r(74165),a=r(15861),s=r(15671),u=r(43144),o=r(60136),l=r(29388),c=r(27366),h=r(85015),d=r(14921),f=r(80987),p=(r(93169),r(10064)),y=r(100),m=r(84652),v=r(32718),_=r(92026),g=r(67426),F=r(66978),b=r(94172),x=r(49861),C=(r(25243),r(69912)),E=r(61826),T=r(25899),k=r(67387),w=r(33997),R=r(32080),S=r(29439),D=r(52639),I=r(80885),Z=r(43977),P=r(62554),M=r(1030),O=r(87037),N=r(62140),V=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]],A=function(){function e(t,r,i){(0,s.Z)(this,e),this.loadingGraphics=new Map,this.loadedGraphics=new Map,this.pendingGraphics=new Map,this._enabled=!0,this.tileFetcher=t,this.view=i,this.tilingScheme=new N.t(r),this.loadedSymbols=V.map((function(e){return new M.Z(new Z.Z({material:{color:[e[0],e[1],e[2],.6]},outline:{color:"black",size:1}}))})),this.loadingSymbols=[new M.Z(new Z.Z({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))],this.pendingSymbols=[new M.Z(new Z.Z({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))],this.dataExtentSymbol=new M.Z(new Z.Z({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}return(0,u.Z)(e,[{key:"destroy",value:function(){this.enabled=!1}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e,this.update()}},{key:"update",value:function(){var e=this;this._enabled?(this._synchronizeMaps(this.loadingGraphics,{filter:function(e){return e.isFetching},symbols:this.loadingSymbols}),this._synchronizeMaps(this.loadedGraphics,{filter:function(e){return!e.isFetching},symbols:this.loadedSymbols}),this._synchronizeMaps(this.pendingGraphics,{filter:function(e){return!e.isFetching},symbols:this.pendingSymbols}),this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.loadingGraphics.clear(),this.loadedGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.loadedGraphics.clear(),this.pendingGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))}},{key:"showDataExtent",value:function(e){if(this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null),e){var t=I.Z.fromExtent(e);this.dataExtentGraphic=new D.Z({geometry:t,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic)}}},{key:"_synchronizeMaps",value:function(e,t){var r=this,i=[];e.forEach((function(e,n){var a=r.tileFetcher.test.getFeatureTileById(n);a&&t.filter(a)||(r.view.graphics.removeMany(e),i.push(n))})),i.forEach((function(t){return e.delete(t)})),this.tileFetcher.test.forEachFeatureTile((function(i){if(t.filter(i)&&!e.has(i.id)){var n=(0,S.Z)(i.descriptor.lij,3),a=n[0],s=n[1],u=n[2];r.tilingScheme.ensureMaxLod(a);var o=r.tilingScheme.getExtentGeometry(a,s,u),l=[new D.Z({geometry:o,symbol:t.symbols[a%t.symbols.length]}),new D.Z({geometry:o.center,symbol:new P.Z({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new O.Z({text:"".concat(a,"/").concat(s,"/").concat(u),halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})})];e.set(i.id,l),r.view.graphics.addMany(l)}}))}}]),e}(),U=r(94463),L=v.Z.getLogger("esri.layers.graphics.controllers.FeatureTileController3D"),B=function(e){(0,o.Z)(r,e);var t=(0,l.Z)(r);function r(e){var i;return(0,s.Z)(this,r),(i=t.call(this,e)).type="feature-tile-3d",i.watchUpdatingTracking=new E.t,i.serviceDataExtent=null,i.serviceDataCount=q.NO_SERVICE_DATA_COUNT,i.vertexLimitExceeded=!1,i.displayFeatureLimit=null,i.suspended=!1,i.tileFetcher=null,i.handles=new y.Z,i.fetchDataInfoPromise=null,i.fetchDataInfoAbortController=null,i.lifeCycleAbortController=new AbortController,i}return(0,u.Z)(r,[{key:"extent",set:function(e){if(!e||e.spatialReference.equals(this.layerView.view.spatialReference)){var t=this._get("extent");if(t!==e&&!(t&&e&&t.equals(e))){var r=e?e.clone():null;this._set("extent",r)}}else L.error("#extent=","extent needs to be in the same spatial reference as the view")}},{key:"updating",get:function(){return!!((0,_.pC)(this.tileFetcher)&&this.tileFetcher.updating||null!=this.fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)}},{key:"updatingTotal",get:function(){return this.updating&&(0,_.pC)(this.tileFetcher)?this.tileFetcher.updatingTotal:0}},{key:"updatingRemaining",get:function(){return this.updating&&(0,_.pC)(this.tileFetcher)?this.tileFetcher.updatingRemaining:0}},{key:"expectedFeatureDiff",get:function(){return this.updating&&(0,_.pC)(this.tileFetcher)?this.tileFetcher.expectedFeatureDiff:0}},{key:"memoryForUnusedFeatures",get:function(){return(0,_.pC)(this.tileFetcher)?this.tileFetcher.memoryForUnusedFeatures:0}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!(!(0,_.pC)(this.tileFetcher)||!this.tileFetcher.maximumNumberOfFeaturesExceeded)}},{key:"maximumNumberOfFeatures",get:function(){return(0,_.pC)(this.displayFeatureLimit)?this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(e){e!==this.maximumNumberOfFeatures&&(null==e?this._clearOverride("maximumNumberOfFeatures"):this._override("maximumNumberOfFeatures",e))}},{key:"hasMaximumNumberOfFeaturesOverride",get:function(){return this._isOverridden("maximumNumberOfFeatures")}},{key:"mode",get:function(){var e,t,r=this.layerView.layer;if("feature"===r.type&&(0,_.pC)(r.infoFor3D))return"snapshot";if(!1===(null===(e=this.layerView.view.qualitySettings)||void 0===e||null===(t=e.graphics3D)||void 0===t?void 0:t.snapshotAvailable)||this.serviceDataCount===q.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";var i=this.layerView.view,n=i&&i.featureTiles,a=n&&n.tilingScheme;if(r&&r.minScale&&this.serviceDataExtent&&a){var s=this._approximateExtentSizeAtScale(r.minScale,a);if((this.serviceDataExtent.width/s+this.serviceDataExtent.height/s)/2>q.MAX_SNAPSHOT_MIN_SCALE_FACTOR)return"tiles"}return!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"}},{key:"maxTotalSnapshotVertices",get:function(){var e=this._get("maxTotalSnapshotVertices")||0,t="snapshot"===this.mode&&(0,_.pC)(this.tileFetcher)&&this.tileFetcher.totalVertices||0;return Math.max(e,t)}},{key:"_approximateExtentSizeAtScale",value:function(e,t){var r=this.layerView.view,i=Math.ceil((r.width/t.pixelSize+r.height/t.pixelSize)/2),n=t.levels[0];return i*((n.tileSize[0]/(n.scale/e)+n.tileSize[1]/(n.scale/e))/2)}},{key:"tileDescriptors",get:function(){return"snapshot"===this.mode?new f.Z([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new f.Z}},{key:"test",get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise,tileFetcher:this.tileFetcher}}},{key:"initialize",value:function(){var e=this;this.watchUpdatingTracking.add((function(){return e.vertexLimitInfo}),(function(){return e.watchUpdatingTracking.addPromise(e._updateVertexLimitExceeded(null,e.lifeCycleAbortController.signal))})),this.watchUpdatingTracking.add((function(){return e.mode}),(function(){return e._modeChanged()}),b.nn),this.addResolvingPromise(Promise.resolve().then((function(){return e._verifyCapabilities()})).then((function(){return e.watchUpdatingTracking.addPromise(e._fetchServiceDataInfo())})).then((function(){return e._initializeTileFetcher()})))}},{key:"_verifyCapabilities",value:function(){var e=this.layerView.layer;if(!e.get("capabilities.operations.supportsQuery")&&"ogc-feature"!==e.type)throw new p.Z("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:e})}},{key:"destroy",value:function(){this._cancelFetchServiceDataInfo(),this.tileFetcher=(0,_.SC)(this.tileFetcher),this.handles=(0,_.SC)(this.handles),this.tilesHandle=(0,_.hw)(this.tilesHandle),this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null),this.watchUpdatingTracking.destroy(),this._set("watchUpdatingTracking",null)}},{key:"suspend",value:function(){this.suspended||(this.suspended=!0,(0,_.pC)(this.tileFetcher)&&this.tileFetcher.suspend())}},{key:"resume",value:function(){this.suspended&&(this.suspended=!1,(0,_.pC)(this.tileFetcher)&&this.tileFetcher.resume())}},{key:"restart",value:function(){var e=this,t=function(){(0,_.pC)(e.tileFetcher)&&e.tileFetcher.restart()};this.watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(t,t))}},{key:"refetch",value:function(){var e=this,t=function(){(0,_.pC)(e.tileFetcher)&&e.tileFetcher.refetch()};this.watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(t,t))}},{key:"_initializeTileFetcher",value:function(){var e=this,t=this.layerView.view;if(t){var r=(0,b.N1)((function(){var e;return null===(e=t.featureTiles)||void 0===e?void 0:e.tilingScheme}),this.lifeCycleAbortController.signal);this.watchUpdatingTracking.addPromise(r),r.then((function(){var r=e.layerView,i=e.tileDescriptors,n=r.layer,a=new R.j({context:e.context,filterExtent:e.extent,tileDescriptors:i,features:e.graphics});e.tileFetcher=a,e.suspended?e.tileFetcher.suspend():e.tileFetcher.resume();var s=e.layerView.view.resourceController;s&&e.handles.add((0,b.YP)((function(){return s.memoryController.memoryFactor}),(function(e){return a.memoryFactor=e}),b.tX));var u="polygon"===e.context.geometryType?"polygonLodFactor":"polyline"===e.context.geometryType?"polylineLodFactor":null;u&&e.handles.add((0,b.YP)((function(){var t,r,i;return null===(t=e.layerView.view)||void 0===t||null===(r=t.qualitySettings)||void 0===r||null===(i=r.graphics3D)||void 0===i?void 0:i[u]}),(function(e){return a.lodFactor=e||1}),b.nn));"ogc-feature"!==n.type&&e.watchUpdatingTracking.add((function(){return n.createQueryVersion}),(function(){return e._dataFilterChanged()})),e.watchUpdatingTracking.add((function(){return r.availableFields}),(function(t,r){return e._availableFieldsChanged(r,t)})),e.watchUpdatingTracking.add((function(){return r.requiredFields}),(function(t,r){return e._requiredFieldsChanged(r,t)})),e.handles.add([n.on("apply-edits",(function(t){return e._applyEdits(t)})),(0,b.YP)((function(){return e.extent}),(function(e){return a.filterExtent=e}),b.Z_),(0,b.YP)((function(){return e.tileDescriptors}),(function(e){return a.tileDescriptors=e}),b.Z_),(0,b.YP)((function(){return e.maximumNumberOfFeatures}),(function(t){a.maximumNumberOfFeatures=t,a.useTileCount=e.serviceDataCount>t}),b.tX),(0,b.YP)((function(){return e.serviceDataCount}),(function(t){return a.useTileCount=t>e.maximumNumberOfFeatures}),b.tX),(0,b.YP)((function(){return U.Z.FEATURE_TILE_FETCH_SHOW_TILES}),(function(r){r&&a&&!a.debugger?(a.debugger=new A(a,t.featureTiles.tilingScheme.toTileInfo(),t),a.debugger.update()):!r&&e.tileFetcher&&a.debugger&&(a.debugger.destroy(),a.debugger=null)}),b.tX)]),e.supportsExceedsLimitQuery||e.watchUpdatingTracking.add((function(){return e.maxTotalSnapshotVertices}),(function(){return e.watchUpdatingTracking.addPromise(e._updateVertexLimitExceeded(null,e.lifeCycleAbortController.signal))}))})).catch((function(){}))}}},{key:"_modeChanged",value:function(){switch(this.mode){case"tiles":this.tilesHandle||(this.tilesHandle=this.layerView.view.featureTiles.addClient());break;default:L.warn("Unhandled feature layer mode "+this.mode);case"snapshot":(0,_.pC)(this.tilesHandle)&&(this.tilesHandle.remove(),this.tilesHandle=null)}}},{key:"_dataFilterChanged",value:function(){this._set("maxTotalSnapshotVertices",0),this.notifyChange("maxTotalSnapshotVertices"),this.refetch()}},{key:"_applyEdits",value:function(e){var t=this;(0,_.Wi)(this.tileFetcher)||this.tileFetcher.applyEdits(e).then((function(e){e&&(e.deletedFeatures.length||e.updatedFeatures.length||e.addedFeatures.length)&&t.watchUpdatingTracking.addPromise(t._updateServiceDataExtent(t.lifeCycleAbortController.signal))})).catch((function(e){if(!(0,F.D_)(e))throw e}))}},{key:"_availableFieldsChanged",value:function(e,t){(0,_.pC)(this.tileFetcher)&&z(this.tileFetcher.availableFields,t)&&this.refetch()}},{key:"_requiredFieldsChanged",value:function(e,t){(0,_.pC)(this.tileFetcher)&&z(this.tileFetcher.availableFields,t)&&this.restart()}},{key:"_createVertexLimitExceededQuery",value:function(e){var t=this.layerView.layer,r=t.createQuery();return r.outStatistics=[new w.Z({statisticType:"exceedslimit",maxVertexCount:e,outStatisticFieldName:"exceedslimit",maxPointCount:1e8,maxRecordCount:1e8})],t.capabilities.query.supportsCacheHint&&(r.cacheHint=!0),r}},{key:"_createDataInfoQuery",value:function(){var e=this.layerView.layer,t=e.createQuery();return t.outSpatialReference=this.layerView.view.spatialReference,e.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t}},{key:"_fullExtentIsAccurate",value:function(){var e=this.layerView.layer;if(e.definitionExpression)return!1;switch(e.type){case"feature":return(0,T.M8)(e.url);case"csv":case"geojson":case"ogc-feature":case"wfs":return!0;default:return}}},{key:"_updateServiceDataExtent",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._tryUpdateServiceDataExtent(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),(0,F.D_)(e.t0)||this._set("serviceDataExtent",(0,m.d9)(this.layerView.fullExtentInLocalViewSpatialReference));case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_tryUpdateServiceDataExtent",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,i,a,s,u,o,l,c,h,d,f;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.layerView,i=r.layer,a=i.capabilities.query.supportsExtent,s=(0,m.d9)(r.fullExtentInLocalViewSpatialReference),u=i.fullExtent,o=this._fullExtentIsAccurate(),l=this.serviceDataCount,!(a&&l<=q.MAX_FEATURE_COUNT_FOR_EXTENT)||s&&o||!("queryExtent"in i)){e.next=9;break}return c=this._createDataInfoQuery(),e.next=5,i.queryExtent(c,{timeout:q.QUERY_EXTENT_TIMEOUT,signal:t});case 5:h=e.sent,this._set("serviceDataExtent",h.extent),e.next=22;break;case 9:if(!s){e.next=13;break}this._set("serviceDataExtent",s),e.next=22;break;case 13:if(!(0,_.pC)(u)){e.next=21;break}return d="portalItem"in i?i.portalItem:null,e.next=17,(0,k.projectGeometry)(u,r.view.spatialReference,d,t);case 17:f=e.sent,this._set("serviceDataExtent",f),e.next=22;break;case 21:this._set("serviceDataExtent",null);case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateServiceDataCount",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("queryFeatureCount"in(r=this.layerView.layer)){e.next=3;break}return e.abrupt("return",void this._set("serviceDataCount",q.NO_SERVICE_DATA_COUNT));case 3:return e.next=5,(0,d.q6)(r.queryFeatureCount(this._createDataInfoQuery(),{timeout:q.QUERY_STATISTICS_TIMEOUT,signal:t}));case 5:if(!0!==(i=e.sent).ok){e.next=10;break}this._set("serviceDataCount",i.value),e.next=13;break;case 10:if(!(0,F.D_)(i.error)){e.next=12;break}throw i.error;case 12:this._set("serviceDataCount",q.NO_SERVICE_DATA_COUNT);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"vertexLimitInfo",get:function(){if((0,_.Wi)(this.displayFeatureLimit)||(0,_.Wi)(this.displayFeatureLimit.averageSymbolComplexity))return null;var e=this.displayFeatureLimit,t=e.averageSymbolComplexity,r=e.maximumTotalNumberOfPrimitives,i=t.primitivesPerCoordinate,n=t.primitivesPerFeature,a=this._get("vertexLimitInfo");return(0,_.Wi)(a)||a.maximumTotalNumberOfPrimitives!==r||a.primitivesPerCoordinate!==i||a.primitivesPerFeature!==n?{primitivesPerCoordinate:i,primitivesPerFeature:n,maximumTotalNumberOfPrimitives:r}:a}},{key:"supportsExceedsLimitQuery",get:function(){var e=this.layerView.layer;return e.capabilities&&e.capabilities.operations&&e.capabilities.operations.supportsExceedsLimitStatistics}},{key:"minimumNumberOfVerticesForGeometry",get:function(){switch(this.layerView.layer.geometryType){case"point":case"multipoint":return 1;case"polygon":return 4;case"polyline":return 2;case"multipatch":case"mesh":return 3;default:return 0}}},{key:"_updateVertexLimitExceeded",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r){var i,a,s,u,o,l,c,h,f,p,y;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.vertexLimitInfo,!(0,_.Wi)(i)){e.next=3;break}return e.abrupt("return",void this._set("vertexLimitExceeded",!1));case 3:if(a=i.primitivesPerFeature<=0,s=this.minimumNumberOfVerticesForGeometry>1,a||s){e.next=6;break}return e.abrupt("return",void this._set("vertexLimitExceeded",!1));case 6:if(u=i.primitivesPerFeature,o=i.primitivesPerCoordinate,l=i.maximumTotalNumberOfPrimitives,e.t0=0!==u&&(0,_.pC)(t),!e.t0){e.next=11;break}return e.next=11,t;case 11:if(h=this.serviceDataCount,f=h!==q.NO_SERVICE_DATA_COUNT,c=f?Math.ceil((l-h*u)/(o||1)):Math.ceil(l/(o||1)),s&&(c=Math.min(c,H)),!(f&&this.minimumNumberOfVerticesForGeometry*h>c)){e.next=14;break}return e.abrupt("return",void this._set("vertexLimitExceeded",!0));case 14:if(this.supportsExceedsLimitQuery){e.next=16;break}return e.abrupt("return",void this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>c));case 16:return e.next=18,(0,d.q6)(this.layerView.layer.queryFeatures(this._createVertexLimitExceededQuery(c),{timeout:q.QUERY_STATISTICS_TIMEOUT,signal:r}));case 18:if(!1!==(p=e.sent).ok){e.next=23;break}if(!(0,F.D_)(p.error)){e.next=22;break}throw p.error;case 22:return e.abrupt("return",void this._set("vertexLimitExceeded",!1));case 23:(y=p.value.features[0])&&y.attributes?this._set("vertexLimitExceeded",!!y.attributes.exceedslimit):this._set("vertexLimitExceeded",!1);case 25:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_fetchServiceDataInfo",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){var t,r,i,a,s,u=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._cancelFetchServiceDataInfo(),t=new AbortController,r=t.signal,i=this._updateServiceDataCount(r),a=(0,F.as)([i,this._updateVertexLimitExceeded(i,r)]),s=a.then((function(){return u._updateServiceDataExtent(r)})).catch((function(e){(0,F.D_)(e)||L.error("#fetchServiceDataInfo()",e)})).then((function(){s===u.fetchDataInfoPromise&&(u.fetchDataInfoPromise=null,u.fetchDataInfoAbortController=null),t=null})),e.abrupt("return",(t&&(this.fetchDataInfoPromise=s),this.fetchDataInfoAbortController=t,a.then((function(){}),(function(){}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_cancelFetchServiceDataInfo",value:function(){var e=this.fetchDataInfoAbortController;e&&(this.fetchDataInfoAbortController=null,this.fetchDataInfoPromise=null,e.abort())}},{key:"debug",get:function(){return{storedFeatures:(0,_.pC)(this.tileFetcher)?this.tileFetcher.storedFeatures:0,totalFeatures:(0,_.pC)(this.tileFetcher)?this.tileFetcher.totalFeatures:0,totalVertices:(0,_.pC)(this.tileFetcher)?this.tileFetcher.totalVertices:0}}}]),r}((0,g.v)(h.Z));(0,c._)([(0,x.Cb)({readOnly:!0})],B.prototype,"type",void 0),(0,c._)([(0,x.Cb)({constructOnly:!0})],B.prototype,"graphics",void 0),(0,c._)([(0,x.Cb)({constructOnly:!0})],B.prototype,"layerView",void 0),(0,c._)([(0,x.Cb)({constructOnly:!0})],B.prototype,"context",void 0),(0,c._)([(0,x.Cb)()],B.prototype,"extent",null),(0,c._)([(0,x.Cb)()],B.prototype,"updating",null),(0,c._)([(0,x.Cb)({readOnly:!0})],B.prototype,"watchUpdatingTracking",void 0),(0,c._)([(0,x.Cb)()],B.prototype,"updatingTotal",null),(0,c._)([(0,x.Cb)()],B.prototype,"updatingRemaining",null),(0,c._)([(0,x.Cb)()],B.prototype,"expectedFeatureDiff",null),(0,c._)([(0,x.Cb)()],B.prototype,"memoryForUnusedFeatures",null),(0,c._)([(0,x.Cb)()],B.prototype,"maximumNumberOfFeaturesExceeded",null),(0,c._)([(0,x.Cb)({readOnly:!0})],B.prototype,"serviceDataExtent",void 0),(0,c._)([(0,x.Cb)({readOnly:!0})],B.prototype,"serviceDataCount",void 0),(0,c._)([(0,x.Cb)({readOnly:!0})],B.prototype,"vertexLimitExceeded",void 0),(0,c._)([(0,x.Cb)()],B.prototype,"displayFeatureLimit",void 0),(0,c._)([(0,x.Cb)({type:Number})],B.prototype,"maximumNumberOfFeatures",null),(0,c._)([(0,x.Cb)({readOnly:!0})],B.prototype,"mode",null),(0,c._)([(0,x.Cb)({readOnly:!0})],B.prototype,"maxTotalSnapshotVertices",null),(0,c._)([(0,x.Cb)({readOnly:!0,dependsOn:["mode"]})],B.prototype,"tileDescriptors",null),(0,c._)([(0,x.Cb)()],B.prototype,"tileFetcher",void 0),(0,c._)([(0,x.Cb)()],B.prototype,"fetchDataInfoPromise",void 0),(0,c._)([(0,x.Cb)({readOnly:!0})],B.prototype,"vertexLimitInfo",null),B=(0,c._)([(0,C.j)("esri.layers.graphics.controllers.FeatureTileController3D")],B);var q,G,H=5e6;function z(e,t){if(!t)return!1;var r,n=(0,i.Z)(t);try{for(n.s();!(r=n.n()).done;){var a=r.value;if(!e.has(a))return!0}}catch(s){n.e(s)}finally{n.f()}return!1}(G=q||(q={})).NO_SERVICE_DATA_COUNT=1/0,G.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5,G.reset=function(){G.MAX_FEATURE_COUNT_FOR_EXTENT=1e4,G.QUERY_STATISTICS_TIMEOUT=12e3,G.QUERY_EXTENT_TIMEOUT=1e4},q.reset()},66020:function(e,t,r){r.d(t,{H:function(){return h}});var i=r(37762),n=r(15671),a=r(43144),s=r(93169),u=r(13491),o=r(65156),l={minX:0,minY:0,maxX:0,maxY:0};function c(e,t,r){(function(e){l.minX=e[0],l.minY=e[1],l.maxX=e[2],l.maxY=e[3]})(t),e.search(l,r)}var h=function(){function e(){var t=this;(0,n.Z)(this,e),this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new u.Q(9,(0,s.Z)("esri-csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this._loadIndex=function(){if(t._indexInvalid){var e=new Array(t._idByBounds.size),r=0;t._idByBounds.forEach((function(t,i){e[r++]=i})),t._indexInvalid=!1,t._index.clear(),t._index.load(e)}else t._boundsToLoad.length&&(t._index.load(t._boundsToLoad.filter((function(e){return t._idByBounds.has(e)}))),t._boundsToLoad.length=0)}}return(0,a.Z)(e,[{key:"fullBounds",get:function(){if(!this._boundsById.size)return null;var e,t=(0,o.cS)(),r=(0,i.Z)(this._boundsById.values());try{for(r.s();!(e=r.n()).done;){var n=e.value;n&&(t[0]=Math.min(n[0],t[0]),t[1]=Math.min(n[1],t[1]),t[2]=Math.max(n[2],t[2]),t[3]=Math.max(n[3],t[3]))}}catch(a){r.e(a)}finally{r.f()}return t}},{key:"valid",get:function(){return!this._indexInvalid}},{key:"clear",value:function(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}},{key:"delete",value:function(e){var t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}},{key:"forEachInBounds",value:function(e,t){var r=this;this._loadIndex(),c(this._index,e,(function(e){return t(r._idByBounds.get(e))}))}},{key:"get",value:function(e){return this._boundsById.get(e)}},{key:"has",value:function(e){return this._boundsById.has(e)}},{key:"invalidateIndex",value:function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}},{key:"set",value:function(e,t){if(!this._indexInvalid){var r=this._boundsById.get(e);r&&(this._index.remove(r),this._idByBounds.delete(r))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}]),e}()},68928:function(e,t,r){r.d(t,{Z:function(){return y}});var i=r(37762),n=r(15671),a=r(43144),s=r(10064),u=r(91505),o=r(32718),l=r(92026),c=r(41414),h=r(65156),d=r(83406),f=r(66020),p=r(77835),y=function(){function e(t){(0,n.Z)(this,e),this.geometryInfo=t,this._boundsStore=new f.H,this._featuresById=new Map,this._markedIds=new Set,this.events=new u.Z,this.featureAdapter=p.n}return(0,a.Z)(e,[{key:"geometryType",get:function(){return this.geometryInfo.geometryType}},{key:"hasM",get:function(){return this.geometryInfo.hasM}},{key:"hasZ",get:function(){return this.geometryInfo.hasZ}},{key:"numFeatures",get:function(){return this._featuresById.size}},{key:"fullBounds",get:function(){return this._boundsStore.fullBounds}},{key:"storeStatistics",get:function(){var e=0;return this._featuresById.forEach((function(t){(0,l.pC)(t.geometry)&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}},{key:"add",value:function(e){this._add(e),this._emitChanged()}},{key:"addMany",value:function(e){var t,r=(0,i.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this._add(n)}}catch(a){r.e(a)}finally{r.f()}this._emitChanged()}},{key:"clear",value:function(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}},{key:"removeById",value:function(e){var t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}},{key:"removeManyById",value:function(e){this._boundsStore.invalidateIndex();var t,r=(0,i.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value,a=this._featuresById.get(n);a&&this._remove(a)}}catch(s){r.e(s)}finally{r.f()}this._emitChanged()}},{key:"forEachBounds",value:function(e,t,r){var n,a=(0,i.Z)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value,u=this._boundsStore.get(s.objectId);u&&t((0,c.JR)(r,u))}}catch(o){a.e(o)}finally{a.f()}}},{key:"getFeature",value:function(e){return this._featuresById.get(e)}},{key:"has",value:function(e){return this._featuresById.has(e)}},{key:"toArray",value:function(){return Array.from(this._featuresById.values())}},{key:"forEach",value:function(e){this._featuresById.forEach((function(t){return e(t)}))}},{key:"forEachInBounds",value:function(e,t){var r=this;this._boundsStore.forEachInBounds(e,(function(e){t(r._featuresById.get(e))}))}},{key:"startMarkingUsedFeatures",value:function(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}},{key:"sweep",value:function(){var e=this,t=!1;this._featuresById.forEach((function(r,i){e._markedIds.has(i)||(t=!0,e._remove(r))})),this._markedIds.clear(),t&&this._emitChanged()}},{key:"_emitChanged",value:function(){this.events.emit("changed",void 0)}},{key:"_add",value:function(e){if(e){var t=e.objectId;if(null!=t){var r,i=this._featuresById.get(t);if(this._markedIds.add(t),i?(e.displayId=i.displayId,r=this._boundsStore.get(t),this._boundsStore.delete(t)):(0,l.pC)(this.onFeatureAdd)&&this.onFeatureAdd(e),(0,l.Wi)(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);r=(0,d.$)((0,l.pC)(r)?r:(0,h.Ue)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),(0,l.pC)(r)&&this._boundsStore.set(t,r),this._featuresById.set(t,e)}else o.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new s.Z("featurestore:invalid-feature","feature id is missing",{feature:e}))}}},{key:"_remove",value:function(e){return(0,l.pC)(this.onFeatureRemove)&&this.onFeatureRemove(e),this._markedIds.delete(e.objectId),this._boundsStore.delete(e.objectId),this._featuresById.delete(e.objectId),e}}]),e}()},43682:function(e,t,r){r.d(t,{R:function(){return Be}});var i=r(1413),n=r(74165),a=r(15861),s=r(15671),u=r(43144),o=r(11752),l=r(61120),c=r(60136),h=r(29388),d=r(27366),f=r(10064),p=r(92026),y=r(94172),m=r(49861),v=(r(63780),r(93169),r(25243),r(69912)),_=r(37818),g=r(5845),F=r(21149),b=r(12173),x=r(82607),C=r(59896),E=r(41691),T=r(42537),k=r(32718),w=r(17842),R=r(11186),S=r(71353),D=r(79803),I=r(82582),Z=r(65618),P=r(83406),M=r(3182),O=r(80457),N=r(68928),V=r(80031),A=r(27811),U=r(26279),L=r(19384),B=r(68401),q=r(50951),G=r(33559),H=r(20684),z=r(81341),j=r(98634),W=r(82144),Q=r(31132),X=r(7566),Y=r(78041),J=r(27627),$=r(23819),K=r(8548),ee=r(36207),te=function(e){(0,c.Z)(r,e);var t=(0,h.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).colorRamp=null,e.densityMap=null,e.searchRadius=1,e.fieldTotal=0,e.minDensity=0,e.maxDensity=100,e}return(0,u.Z)(r)}(j.K),re=function(e){(0,c.Z)(r,e);var t=(0,h.Z)(r);function r(e,i){var n;return(0,s.Z)(this,r),n=t.call(this,e,i,(function(){return n.destroy()}))}return(0,u.Z)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get().build();return new J.$(e.rctx,t,X.i)}},{key:"initializePipeline",value:function(){return(0,ee.sm)({blending:Y.wu,colorWrite:ee.BK,depthTest:null,depthWrite:null})}},{key:"primitiveType",get:function(){return K.MX.TRIANGLE_STRIP}}]),r}(Q.A);re.shader=new W.J($.H,(function(){return r.e(8259).then(r.bind(r,28259))}));var ie=r(53634),ne=r(371),ae=r(3384),se=function(e){(0,c.Z)(r,e);var t=(0,h.Z)(r);function r(e){var i;return(0,s.Z)(this,r),(i=t.call(this,e)).pixelRatio=1,i._colorRampData=new Uint8ClampedArray(4),i.type="draped-heatmap",i._heatmapParameters=new te,i}return(0,u.Z)(r,[{key:"initialize",value:function(){var e=this,t={colorTarget:K.Lm.TEXTURE,depthStencilTarget:K.OU.NONE,width:0,height:0},r=this.rctx.capabilities,i=r.colorBufferFloat.R32F,n=r.textureFloat.textureFloatLinear,a=null!=i,s={target:K.No.TEXTURE_2D,pixelFormat:a?K.VI.RED:K.VI.RGBA,internalFormat:a?K.lP.R32F:K.VI.RGBA,dataType:K.Br.FLOAT,samplingMode:n?K.cw.LINEAR:K.cw.NEAREST,wrapMode:K.e8.CLAMP_TO_EDGE,width:0,height:0};this._densityMap=new ie.X(this.rctx,t,s),this._quad=(0,H.ow)(this.rctx);var u=this._colorRampData,o={target:K.No.TEXTURE_2D,pixelFormat:K.VI.RGBA,dataType:K.Br.UNSIGNED_BYTE,samplingMode:K.cw.LINEAR,wrapMode:K.e8.CLAMP_TO_EDGE,width:u.length/4,height:1};this._colorRamp=new ne.x(this.rctx,o,u),this._technique=new re({rctx:this.rctx,viewingMode:q.JY.Local},new G.m),this._heatmapParameters.densityMap=this._densityMap.colorTexture,this.own((0,y.YP)((function(){return[e.colorRampData,e.minDensity,e.maxDensity,e.fieldTotal,e.pixelRatio,e.searchRadius]}),(function(){return e.rendererContext.notifyContentChanged()})))}},{key:"destroy",value:function(){this._technique=(0,p.RY)(this._technique),this._densityMap=(0,p.O3)(this._densityMap),this._quad=(0,p.O3)(this._quad),this._colorRamp=(0,p.O3)(this._colorRamp)}},{key:"searchRadius",get:function(){return this._heatmapParameters.searchRadius},set:function(e){e!==this._heatmapParameters.searchRadius&&(this._heatmapParameters.searchRadius=e,this.notifyChange("searchRadius"))}},{key:"minDensity",get:function(){return this._heatmapParameters.minDensity},set:function(e){e!==this._heatmapParameters.minDensity&&(this._heatmapParameters.minDensity=e,this.notifyChange("minDensity"))}},{key:"maxDensity",get:function(){return this._heatmapParameters.maxDensity},set:function(e){e!==this._heatmapParameters.maxDensity&&(this._heatmapParameters.maxDensity=e,this.notifyChange("maxDensity"))}},{key:"fieldTotal",get:function(){return this._heatmapParameters.fieldTotal},set:function(e){this._heatmapParameters.fieldTotal=e,this.notifyChange("fieldTotal")}},{key:"colorRampData",get:function(){return this._colorRampData},set:function(e){var t=this._heatmapParameters.colorRamp;if((0,p.pC)(t)&&e!==this._colorRampData){var r=t.descriptor.width,i=e.length/4;i!==r&&t.resize(i,1),t.setData(e)}this._colorRampData=e}},{key:"_colorRamp",get:function(){return this._heatmapParameters.colorRamp},set:function(e){this._heatmapParameters.colorRamp=e}},{key:"hasHighlights",get:function(){return!1}},{key:"hasWater",get:function(){return!1}},{key:"rendersOccluded",get:function(){return!1}},{key:"render",value:function(e,t){var r=this._sortedMaterialRenderers,i=r.length;if(!(i<1)){var n=this.rctx.getBoundFramebufferObject(),a=this.rctx.getViewport(),s=this.pixelRatio,u=Math.ceil(a.width*s),o=Math.ceil(a.height*s);this._densityMap.resize(u,o),this.rctx.bindFramebuffer(this._densityMap),this.rctx.setViewport(0,0,u,o),this.rctx.clear(K.lk.COLOR_BUFFER_BIT);for(var l=!1,c=0;c<i;c++){var h=r.getItemAt(c);h.material.shouldRender(e)&&(l=l||h.materialRenderer.render(e.pass,t))}this.rctx.bindFramebuffer(n),this.rctx.setViewport(a.x,a.y,a.width,a.height),l&&(this.rctx.bindVAO(this._quad),this.rctx.useProgram(this._technique.program),this._technique.bindPipelineState(this.rctx),this._technique.bindPass(this._heatmapParameters,e.bindParameters),this.rctx.drawArrays(this._technique.primitiveType,0,(0,ae._V)(this._quad,"geometry")))}}}]),r}(z.S);(0,d._)([(0,m.Cb)()],se.prototype,"searchRadius",null),(0,d._)([(0,m.Cb)()],se.prototype,"minDensity",null),(0,d._)([(0,m.Cb)()],se.prototype,"maxDensity",null),(0,d._)([(0,m.Cb)()],se.prototype,"fieldTotal",null),(0,d._)([(0,m.Cb)()],se.prototype,"pixelRatio",void 0),(0,d._)([(0,m.Cb)()],se.prototype,"colorRampData",null),(0,d._)([(0,m.Cb)()],se.prototype,"_colorRampData",void 0),se=(0,d._)([(0,v.j)("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],se);var ue,oe,le=r(81782),ce=r(78289),he=r(69831),de=r(4760),fe=r(88396),pe=r(6394),ye=r(44393),me=r(55158),ve=r(23620),_e=r(56529),ge=r(68198),Fe=r(93822),be=r(33236),xe=r(8883),Ce=r(65322);(oe=ue||(ue={}))[oe.Screen=0]="Screen",oe[oe.World=1]="World";var Ee=function(e){(0,c.Z)(r,e);var t=(0,h.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).searchRadius=128,e.resolutionForScale=0,e}return(0,u.Z)(r)}(_e.Mt),Te=function(e){(0,c.Z)(r,e);var t=(0,h.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get().build(this.configuration);return new J.$(e.rctx,t,X.i)}},{key:"initializePipeline",value:function(){return(0,ee.sm)({blending:(0,ee.if)(K.zi.ONE,K.zi.ONE,K.db.ADD),colorWrite:ee.BK,depthTest:null,depthWrite:null})}},{key:"destroy",value:function(){(0,o.Z)((0,l.Z)(r.prototype),"destroy",this).call(this)}}]),r}(Q.A);Te.shader=new W.J(Ce.H,(function(){return r.e(7682).then(r.bind(r,7682))}));var ke=function(e){(0,c.Z)(r,e);var t=(0,h.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).isAttributeDriven=!1,e}return(0,u.Z)(r)}(xe.W);(0,d._)([(0,G.o)()],ke.prototype,"isAttributeDriven",void 0);var we=function(e){(0,c.Z)(r,e);var t=(0,h.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).isAttributeDriven=!1,e}return(0,u.Z)(r)}(Ee),Re=function(e){(0,c.Z)(r,e);var t=(0,h.Z)(r);function r(e){var i;return(0,s.Z)(this,r),(i=t.call(this,e,new we))._techniqueConfig=new ke,i}return(0,u.Z)(r,[{key:"requiresSlot",value:function(e,t){return e===Fe.r.DRAPED_MATERIAL&&t===ge.C.MATERIAL}},{key:"getConfiguration",value:function(){return this._techniqueConfig.isAttributeDriven=this.parameters.isAttributeDriven,this._techniqueConfig}},{key:"createGLMaterial",value:function(e){return new Se(e)}},{key:"intersect",value:function(e,t,r,i,n,a,s,u,o){if(!(0,p.Wi)(o)&&(0,ye.lM)(a))for(var l=e.vertexAttributes.get(de.T.POSITION),c=this.parameters.searchRadius,h=e.screenToWorldRatio,d=c*h+2*h,f=d*d,y=l.data.length/l.size,m=0;m<y;m++){var v=m*l.size,_=(0,fe.a)(Me,l.data[v],l.data[v+1]);(0,fe.s)(_,a)<f&&s(o.dist,o.normal,-1,!1)}}},{key:"createBufferWriter",value:function(){return new De(this.parameters.isAttributeDriven?Ze:Ie)}}]),r}(_e.F5),Se=function(e){(0,c.Z)(r,e);var t=(0,h.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"beginSlot",value:function(e){return this.ensureTechnique(Te,e)}}]),r}(ve.Z),De=function(){function e(t){(0,s.Z)(this,e),this.vertexBufferLayout=t}return(0,u.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get(de.T.POSITION).length*Pe}},{key:"write",value:function(e,t,r,i){(0,be.ho)(t.indices.get(de.T.POSITION),t.vertexAttributes.get(de.T.POSITION).data,e.transformation,r.position,i,Pe);for(var n=t.indices.get(de.T.POSITION).length,a=r.uv0,s=i,u=0;u<n;++u)a.setValues(s++,-1,-1),a.setValues(s++,1,-1),a.setValues(s++,1,1),a.setValues(s++,1,1),a.setValues(s++,-1,1),a.setValues(s++,-1,-1);var o="featureAttribute"in r?r.featureAttribute:null;o&&(0,be.XW)(t.indices.get(de.T.FEATUREATTRIBUTE),t.vertexAttributes.get(de.T.FEATUREATTRIBUTE).data,o,i,Pe)}}]),e}(),Ie=(0,me.U$)().vec3f(de.T.POSITION).vec2f(de.T.UV0),Ze=Ie.clone().f32(de.T.FEATUREATTRIBUTE),Pe=6;var Me=(0,pe.a)(),Oe=k.Z.getLogger("esri.views.3d.layers.support.HeatmapFeatureProcessor"),Ne=112,Ve=function(e){(0,c.Z)(r,e);var t=(0,h.Z)(r);function r(e){var i;return(0,s.Z)(this,r),(i=t.call(this,e)).type="heatmap",i.filterVisibility={filterChanged:function(){},dirty:!1},i.preferredUpdatePolicy=B.jq.ASYNC,i.dataExtent=null,i.drapeSourceType=U.L.Features,i._renderGeometries=new Map,i._material=new Re({}),i._materialWithField=new Re({isAttributeDriven:!0}),i._fieldTotal=0,i._drapeSourceRenderer=null,i}return(0,u.Z)(r,[{key:"initialize",value:function(){var e=this;this._featureStore=new N.Z({geometryType:"esriGeometryPoint",hasZ:this.hasZ,hasM:this.hasM});var t=this._renderView.capabilities,r=t.colorBufferFloat,i=t.textureFloat,n=this._renderView.renderingContext.driverTest.floatBufferBlendWorking;if(null===i||void 0===i||!i.textureFloat)throw new f.Z("heatmap:missing-texture-float","HeatmapRenderer requires WebGL2 or the WebGL1 extension OES_texture_float.");if(null===r||void 0===r||!r.textureFloat)throw new f.Z("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL2 extension EXT_color_buffer_float or the WebGL1 extension WEBGL_color_buffer_float.");if(null===r||void 0===r||!r.floatBlend)throw new f.Z("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend.");if(!n)throw new f.Z("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend. This device claims support for it, but does not actually support it.");this._drapeSourceRenderer=this.view.basemapTerrain.overlayManager.registerDrapeSource(this,se,this._rendererParameters),this.updatingHandles.addOnCollectionChange((function(){return e._loadedPointGraphics}),(function(t){return e._onLoadedFeaturesChange(t)}),y.nn),this.updatingHandles.addWhen((function(){return e._materialParameters}),(function(t){return e._forEachMaterial((function(e){return e.setParameters(t)}))}),y.nn),this.updatingHandles.add((function(){return e._rendererParameters}),(function(t){return e._drapeSourceRenderer.set(t)})),this.updatingHandles.add((function(){return e._heatmapRendererField}),(function(){e._recreate()}),y.Z_),this.updatingHandles.add((function(){return{fieldName:e._heatmapRendererFieldName,numeric:e._heatmapRendererFieldIsNumeric}}),(function(t){var r=t.fieldName,i=t.numeric;if((0,p.pC)(r)&&i){var n=0;e._featureStore.forEach((function(e){var t;return n+=null!==(t=e.attributes[r])&&void 0!==t?t:0})),e._fieldTotal=n}else e._fieldTotal=e._featureStore.numFeatures}),y.nn),this.handles.add([(0,y.YP)((function(){return{fieldName:e._heatmapRendererFieldName,field:e._heatmapRendererField}}),(function(t){var r,i=t.fieldName,n=t.field;i&&!n&&Oe.warn("Heatmap renderer field '".concat(i,"' for layer '").concat(null!==(r=e.layer.title)&&void 0!==r?r:e.layer.id,"' not found"))})),(0,y.YP)((function(){return{field:e._heatmapRendererField,numeric:e._heatmapRendererFieldIsNumeric}}),(function(t){var r,i=t.field,n=t.numeric;(0,p.pC)(i)&&!n&&Oe.warn("Heatmap renderer field '".concat(i.name,"' for layer '").concat(null!==(r=e.layer.title)&&void 0!==r?r:e.layer.id,"' does not contain numeric values and cannot be used to drive the heatmap density"))})),(0,T.kB)((function(){return e.view.basemapTerrain.overlayManager.unregisterDrapeSource(e)}))])}},{key:"destroy",value:function(){this._renderGeometries.clear(),this._material=(0,p.O3)(this._material),this._materialWithField=(0,p.O3)(this._materialWithField),this._featureStore.clear(),this._featureStore=null}},{key:"layer",get:function(){return this.owner.layer}},{key:"featureStore",get:function(){return this._featureStore}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"updatingRemaining",get:function(){return 0}},{key:"suspendInfo",get:function(){return{}}},{key:"legendEnabled",get:function(){return!0}},{key:"displayFeatureLimit",get:function(){var e,t,r,i,n,a,s,u=null!==(e=null===(t=this.owner)||void 0===t||null===(r=t.view)||void 0===r||null===(i=r.resourceController)||void 0===i||null===(n=i.memoryController)||void 0===n?void 0:n.memoryFactor)&&void 0!==e?e:1,o=null===(a=this.owner)||void 0===a||null===(s=a.view)||void 0===s?void 0:s.qualitySettings,l=o?Math.ceil(o.heatmap.maxTotalNumberOfFeatures*u):0;return{minimumTotalNumberOfFeatures:0,maximumTotalNumberOfFeatures:l,maximumTotalNumberOfPrimitives:2*l,maximumNumberOfFeatures:l}}},{key:"hasZ",get:function(){return"hasZ"in this.layer&&this.layer.hasZ}},{key:"hasM",get:function(){return"hasM"in this.layer&&this.layer.hasM}},{key:"view",get:function(){return this.owner.view}},{key:"fullOpacity",get:function(){return this.owner.fullOpacity}},{key:"updatePolicy",get:function(){return this.owner.updatePolicy}},{key:"scaleVisibilitySuspended",get:function(){return!1}},{key:"usedMemory",get:function(){var e,t,r,i,n,a=this.usedMemoryPerFeature*this._featureStore.numFeatures,s=null!=(null===(e=this._renderView)||void 0===e||null===(t=e.capabilities)||void 0===t?void 0:t.colorBufferFloat).R32F?1:4,u=null!==(r=Math.ceil((null===(i=this._overlayRenderer)||void 0===i||null===(n=i.overlays[0])||void 0===n?void 0:n.resolution)*this._densityMapPixelRatio))&&void 0!==r?r:0;return u*u*s*4+a+((0,p.pC)(this._heatmapRenderer)?(0,w.F2)(Math.min(this._heatmapRenderer.radius,Ne)):0)*s*4}},{key:"usedMemoryPerFeature",get:function(){if(0===this._featureStore.numFeatures)return 0;var e=0;this._featureStore.forEach((function(t){return e+=(0,C.f2)(t.attributes)})),e/=this._featureStore.numFeatures;var t=(0,C.G3)();return 6*(0,C.do)([0,0,0],t)+6*(0,C.do)([0,0],t)+(this._heatmapRendererFieldIsNumeric?6*t:0)+e}},{key:"unprocessedMemoryEstimate",get:function(){return 0}},{key:"performanceInfo",get:function(){return{core:{visible:this._featureStore.numFeatures,missing:0,pending:0},elevationUpdating:!1,visibilityFrustum:!0,visibilityScale:!0}}},{key:"_overlayRenderer",get:function(){return this.view.basemapTerrain.overlayManager.renderer}},{key:"_overlaySpatialReference",get:function(){return(0,p.Wg)(this._overlayRenderer.spatialReference)}},{key:"_rendererParameters",get:function(){return(0,i.Z)((0,i.Z)((0,i.Z)((0,i.Z)({},this._radiusParameter),this._densityParameters),this._colorRampParameter),this._pixelRatioParameter)}},{key:"_materialParameters",get:function(){return(0,i.Z)((0,i.Z)({},this._radiusParameter),this._resolutionForScaleParameter)}},{key:"_densityParameters",get:function(){var e=this._heatmapRenderer;return(0,p.Wi)(e)?null:{minDensity:e.minDensity,maxDensity:e.maxDensity,fieldTotal:this._fieldTotal}}},{key:"_radiusParameter",get:function(){var e=this;return(0,p.yw)(this._heatmapRenderer,(function(t){var r=t.radius;return{searchRadius:(0,w.F2)(e._clampSearchRadius(r))}}))}},{key:"_resolutionForScaleParameter",get:function(){var e=this;return(0,p.yw)(this._heatmapRenderer,(function(t){var r=t.referenceScale;return{resolutionForScale:0===r?0:(0,I.dp)(r,e.view.spatialReference)}}))}},{key:"_colorRampParameter",get:function(){return(0,p.yw)(this._heatmapRenderer,(function(e){return{colorRampData:(0,A.uI)(e.colorStops)}}))}},{key:"_pixelRatioParameter",get:function(){return{pixelRatio:this._densityMapPixelRatio}}},{key:"_densityMapPixelRatio",get:function(){var e,t,r,i,n,a,s,u,o=null!==(e=null===(t=this.owner)||void 0===t||null===(r=t.view)||void 0===r||null===(i=r.resourceController)||void 0===i||null===(n=i.memoryController)||void 0===n?void 0:n.memoryFactor)&&void 0!==e?e:1;return(null!==(a=null===(s=this.owner)||void 0===s||null===(u=s.view)||void 0===u?void 0:u.qualitySettings.heatmap.pixelRatio)&&void 0!==a?a:1)*Math.sqrt(o)}},{key:"_renderView",get:function(){return this.view._stage.renderView}},{key:"_featuresArePoints",get:function(){return"point"===this.layer.geometryType}},{key:"_loadedPointGraphics",get:function(){return this.owner.loadedGraphics}},{key:"_heatmapRenderer",get:function(){var e=this.layer.renderer;return"heatmap"===(null===e||void 0===e?void 0:e.type)?e:null}},{key:"_heatmapRendererFieldName",get:function(){return(0,p.yw)(this._heatmapRenderer,(function(e){return e.field}))}},{key:"_heatmapRendererField",get:function(){var e=this;return(0,p.yw)(this._heatmapRendererFieldName,(function(t){return e.layer.fieldsIndex.get(t)}))}},{key:"_heatmapRendererFieldIsNumeric",get:function(){var e=this._heatmapRendererField;return!(0,p.Wi)(e)&&(0,V.H7)(e)}},{key:"whenGraphicBounds",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"computeAttachmentOrigin",value:function(){return null}},{key:"highlight",value:function(){return Ae}},{key:"maskOccludee",value:function(){return Ae}},{key:"setObjectIdVisibility",value:function(){}},{key:"setup",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_onLoadedFeaturesChange",value:function(e){var t=this;if(this._featuresArePoints){var r=this.layer.objectIdField;this._featureStore.removeManyById(e.removed.map((function(e){return(0,Z.MS)(e,r)}))),this._featureStore.addMany(e.added.map((function(e){return new M.u_((0,P.dd)(new O.Z,e.geometry),e.attributes,(0,p.yw)(e.centroid,(function(e){return(0,P.dd)(new O.Z,e)})),(0,Z.MS)(e,r))})));var i=e.added,n=e.removed;this._fieldTotal+=this._computeFieldTotalChange(i,n);var a=(0,p.e8)(n,(function(e){var r=e.uid,i=t._renderGeometries.get(r);return t._renderGeometries.delete(r),i})),s=i.map((function(e){var r=t._pointGraphicToRenderGeometry(e);return t._renderGeometries.set(e.uid,r),r}));a.length>0&&this._drapeSourceRenderer.removeGeometries(a,ce.$.Geometry.REMOVE),s.length>0&&this._drapeSourceRenderer.addGeometries(s,ce.$.Geometry.ADD),(s.length>0||a.length>0)&&this._renderView.requestRender()}}},{key:"_recreate",value:function(){if(this._loadedPointGraphics){var e=this._loadedPointGraphics.toArray();this._onLoadedFeaturesChange({added:e,removed:e})}}},{key:"_pointGraphicToRenderGeometry",value:function(e){var t,r=this._heatmapRendererFieldName,i=(0,p.pC)(r)?this._materialWithField:this._material,n=(0,S.c)();(0,D.KC)(e.geometry,n,this._overlaySpatialReference),n[2]=L.Rn;var a=[[de.T.POSITION,{data:n,size:n.length}]],s=this._heatmapRendererFieldIsNumeric;(0,p.pC)(r)&&a.push([de.T.FEATUREATTRIBUTE,{data:[s&&null!==(t=e.attributes[r])&&void 0!==t?t:0],size:1}]);var u=new he.z(new le.Z(a,null,B.MX.Point),i,{layerUid:this.layer.uid,graphicUid:e.uid});return(0,R.c)(u.boundingSphere,n),u}},{key:"_forEachMaterial",value:function(e){e(this._material),e(this._materialWithField)}},{key:"_computeFieldTotalChange",value:function(e,t){if((0,p.Wi)(this._heatmapRendererFieldName)||!this._heatmapRendererFieldIsNumeric)return e.length-t.length;var r=this._heatmapRendererFieldName,i=function(e,t){var i;return e+(null!==(i=t.attributes[r])&&void 0!==i?i:0)};return e.reduce(i,0)-t.reduce(i,0)}},{key:"_clampSearchRadius",value:function(e){return e>Ne&&Oe.warnOnce("SceneView supports a maximum radius of ".concat(Ne," pt for HeatmapRenderer.")),Math.min(e,Ne)}}]),r}(E.r);(0,d._)([(0,m.Cb)()],Ve.prototype,"type",void 0),(0,d._)([(0,m.Cb)({constructOnly:!0})],Ve.prototype,"owner",void 0),(0,d._)([(0,m.Cb)()],Ve.prototype,"layer",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"featureStore",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"updating",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"updatingRemaining",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"suspendInfo",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"legendEnabled",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"filterVisibility",void 0),(0,d._)([(0,m.Cb)()],Ve.prototype,"displayFeatureLimit",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"preferredUpdatePolicy",void 0),(0,d._)([(0,m.Cb)()],Ve.prototype,"hasZ",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"hasM",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"dataExtent",void 0),(0,d._)([(0,m.Cb)()],Ve.prototype,"view",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"fullOpacity",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"updatePolicy",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"drapeSourceType",void 0),(0,d._)([(0,m.Cb)()],Ve.prototype,"_featureStore",void 0),(0,d._)([(0,m.Cb)()],Ve.prototype,"_overlayRenderer",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"_overlaySpatialReference",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"_rendererParameters",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"_materialParameters",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"_densityParameters",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"_radiusParameter",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"_resolutionForScaleParameter",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"_colorRampParameter",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"_pixelRatioParameter",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"_densityMapPixelRatio",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"_renderGeometries",void 0),(0,d._)([(0,m.Cb)()],Ve.prototype,"_material",void 0),(0,d._)([(0,m.Cb)()],Ve.prototype,"_materialWithField",void 0),(0,d._)([(0,m.Cb)()],Ve.prototype,"_renderView",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"_featuresArePoints",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"_loadedPointGraphics",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"_heatmapRenderer",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"_heatmapRendererFieldName",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"_heatmapRendererField",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"_heatmapRendererFieldIsNumeric",null),(0,d._)([(0,m.Cb)()],Ve.prototype,"_fieldTotal",void 0),(0,d._)([(0,m.Cb)()],Ve.prototype,"_drapeSourceRenderer",void 0),Ve=(0,d._)([(0,v.j)("esri.views.3d.layers.support.HeatmapFeatureProcessor")],Ve);var Ae=(0,T.kB)(),Ue=r(61712),Le=r(93463),Be=function(e){var t=function(e){(0,c.Z)(r,e);var t=(0,h.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).controller=null,e.updatePolicy=B.jq.SYNC,e.suspendResumeExtentMode="computed",e.slicePlaneEnabled=!1,e.fullExtentInLocalViewSpatialReference=null,e.suspendResumeExtent=null,e._controllerCreated=!1,e.clippingExtent=null,e.supportsHeightUnitConversion=!0,e.pendingController=null,e.queryEngine=null,e}return(0,u.Z)(r,[{key:"initialize",value:function(){var e=this,t=this.layer;"isTable"in t&&t.isTable?this.addResolvingPromise(Promise.reject(new f.Z("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:t}))):(this.addResolvingPromise(this._validateGeometryType()),this.updatingHandles.add((function(){return e.layer.renderer}),(function(t){return e._recreateProcessor(t)}),y.nn),this.addResolvingPromise((0,a.Z)((0,n.Z)().mark((function t(){var r;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,Ue.E)(e);case 2:return r=t.sent,e.fullExtentInLocalViewSpatialReference=r,t.next=6,e._initializeController();case 6:case"end":return t.stop()}}),t)})))()),this.updatingHandles.add((function(){return e.updatePolicy}),(function(t){return e.processor.preferredUpdatePolicy=t})),this.queryEngine=new x.q({layerView:this,priority:Le.T8.FEATURE_QUERY_ENGINE}),this.notifyChange("updating"))}},{key:"destroy",value:function(){this._destroyPendingController(),this.controller=(0,p.SC)(this.controller),this._set("processor",(0,p.SC)(this.processor)),this.queryEngine=(0,p.SC)(this.queryEngine),this.loadedGraphics=null}},{key:"_destroyPendingController",value:function(){this.pendingController=(0,p.SC)(this.pendingController)}},{key:"legendEnabled",get:function(){var e;return this.canResume()&&(null===(e=this.processor)||void 0===e?void 0:e.legendEnabled)}},{key:"graphics3DProcessor",get:function(){var e;return"graphics-3d"===(null===(e=this.processor)||void 0===e?void 0:e.type)?this.processor:null}},{key:"heatmapProcessor",get:function(){var e;return"heatmap"===(null===(e=this.processor)||void 0===e?void 0:e.type)?this.processor:null}},{key:"getHit",value:function(e){var t,r=this,i=null;return null!==(t=this.loadedGraphics)&&void 0!==t&&t.forEach((function(t){t.uid===e&&(i=(0,_.mW)(t,r.layer))})),i?{type:"graphic",graphic:i,layer:i.layer}:null}},{key:"whenGraphicBounds",value:function(e,t){var r;return null===(r=this.processor)||void 0===r?void 0:r.whenGraphicBounds(e,t)}},{key:"computeAttachmentOrigin",value:function(e,t){var r;return null===(r=this.processor)||void 0===r?void 0:r.computeAttachmentOrigin(e,t)}},{key:"queryFeatures",value:function(e,t){return this.queryEngine.executeQuery(this._ensureQuery(e),(0,p.U2)(t,"signal"))}},{key:"queryObjectIds",value:function(e,t){return this.queryEngine.executeQueryForIds(this._ensureQuery(e),(0,p.U2)(t,"signal"))}},{key:"queryFeatureCount",value:function(e,t){return this.queryEngine.executeQueryForCount(this._ensureQuery(e),(0,p.U2)(t,"signal"))}},{key:"queryExtent",value:function(e,t){return this.queryEngine.executeQueryForExtent(this._ensureQuery(e),(0,p.U2)(t,"signal"))}},{key:"_ensureQuery",value:function(e){return(0,p.Wi)(e)?this.createQuery():F.Z.from(e)}},{key:"highlight",value:function(e){return this.processor.highlight(e,this.layer.objectIdField)}},{key:"maskOccludee",value:function(e){return this.processor.maskOccludee(e)}},{key:"canResume",value:function(){var e;return(0,o.Z)((0,l.Z)(r.prototype),"canResume",this).call(this)&&!(null!==(e=this.processor)&&void 0!==e&&e.scaleVisibilitySuspended)}},{key:"getSuspendInfo",value:function(){var e=(0,o.Z)((0,l.Z)(r.prototype),"getSuspendInfo",this).call(this);return this.processor?(0,i.Z)((0,i.Z)({},e),this.processor.suspendInfo):e}},{key:"isUpdating",value:function(){var e,t,r;return!(!this.processor||this.processor.destroyed)&&!(this._controllerCreated&&(null===(e=this.controller)||void 0===e||!e.updating)&&null!==(t=this.view)&&void 0!==t&&null!==(r=t.basemapTerrain)&&void 0!==r&&r.ready&&!this.processor.updating)}},{key:"_initializeController",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){var t;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.createController(),this.pendingController=t,e.next=4,t.when();case 4:this._setControllerWhenInitialized(t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_setControllerWhenInitialized",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.when();case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:if(this._controllerCreated=!0,this.notifyChange("updating"),!this.isResolved()||this.destroyed){e.next=19;break}return e.next=12,(0,y.N1)((function(){var e,t;return null===(e=r.view)||void 0===e||null===(t=e.basemapTerrain)||void 0===t?void 0:t.ready}));case 12:this.beforeSetController(t),this.pendingController=null,this.controller=t,this.loadedGraphics=t.graphics,this.notifyChange("updating"),e.next=20;break;case 19:this._destroyPendingController();case 20:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateClippingExtent",value:function(e){if(this.clippingExtent=e,!this.controller)return!1;switch(this.controller.type){case"stream":return!1;case"feature-tile-3d":return this.controller.extent=e,!0}}},{key:"_validateGeometryType",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=this.layer.geometryType,e.next="multipatch"===e.t0||"multipoint"===e.t0?3:4;break;case 3:throw new f.Z("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_recreateProcessor",value:function(e){var t,r,i=this,n="heatmap"===(null===e||void 0===e?void 0:e.type),a="heatmap"===(null===(t=this.processor)||void 0===t?void 0:t.type),s=this.processor;if(!s||n!==a){var u=n?new Ve({owner:this}):new b.Z({owner:this,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,updateClippingExtent:function(e){return i._updateClippingExtent(e)}});this._set("processor",u),null!==s&&void 0!==s&&s.destroy(),null!==(r=this.queryEngine)&&void 0!==r&&r.clear(),this.addResolvingPromise(u.setup())}}},{key:"_getResourceInfo",value:function(){var e,t,r=this.controller instanceof g.g?this.controller:null;return(0,i.Z)({displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:null!==(e=null===r||void 0===r?void 0:r.maximumNumberOfFeatures)&&void 0!==e?e:-1,totalNumberOfFeatures:null!==(t=null===r||void 0===r?void 0:r.serviceDataCount)&&void 0!==t?t:-1,nodes:0},this.processor.performanceInfo)}},{key:"performanceInfo",get:function(){return this._getResourceInfo()}}]),r}(e);return(0,d._)([(0,m.Cb)()],t.prototype,"loadedGraphics",void 0),(0,d._)([(0,m.Cb)()],t.prototype,"suspended",void 0),(0,d._)([(0,m.Cb)({readOnly:!0})],t.prototype,"legendEnabled",null),(0,d._)([(0,m.Cb)()],t.prototype,"updating",void 0),(0,d._)([(0,m.Cb)()],t.prototype,"controller",void 0),(0,d._)([(0,m.Cb)()],t.prototype,"processor",void 0),(0,d._)([(0,m.Cb)({readOnly:!0})],t.prototype,"updatePolicy",void 0),(0,d._)([(0,m.Cb)({readOnly:!0})],t.prototype,"suspendResumeExtentMode",void 0),(0,d._)([(0,m.Cb)({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0),(0,d._)([(0,m.Cb)({readOnly:!0})],t.prototype,"suspendInfo",void 0),(0,d._)([(0,m.Cb)()],t.prototype,"graphics3DProcessor",null),(0,d._)([(0,m.Cb)()],t.prototype,"heatmapProcessor",null),t=(0,d._)([(0,v.j)("esri.views.3d.layers.FeatureLikeLayerView3D")],t)}},32080:function(e,t,r){r.d(t,{j:function(){return U},A:function(){return B}});var i,n=r(37762),a=r(74165),s=r(15861),u=r(15671),o=r(43144),l=r(60136),c=r(29388),h=r(27366),d=r(85015),f=r(100),p=r(32718),y=r(77427),m=r(92026),v=r(66978),_=r(94172),g=r(99346),F=r(49861),b=r(63780),x=(r(93169),r(25243),r(69912)),C=r(65156),E=r(65618),T=r(94618),k=r(21149),w=r(50951),R=r(70178),S=function(){function e(t,r){(0,u.Z)(this,e),this.highestResolutionVersion=null,this.versions=[],this.ref(t,r)}return(0,o.Z)(e,[{key:"isReferenced",get:function(){return 0!==this.versions.length}},{key:"isSingle",get:function(){return 1===this.versions.length&&1===this.versions[0].refCount}},{key:"ref",value:function(e,t){var r=this.feature;I.oldVersion=r,this.feature&&Object.defineProperty(e,"uid",{value:this.feature.uid,configurable:!0});var i,a=(0,n.Z)(this.versions);try{for(a.s();!(i=a.n()).done;){var s=i.value;if(s.resolution===t){s.refCount++;var u=this.highestResolutionVersion===s&&!(0,R.f)(e,s.feature);return(u||this.highestResolutionVersion!==s)&&(s.feature=e),I.newVersion=u?e:r,I}}}catch(l){a.e(l)}finally{a.f()}var o={feature:e,resolution:t,refCount:1};return this.versions.push(o),!this.highestResolutionVersion||t<this.highestResolutionVersion.resolution?(I.newVersion=e,this.highestResolutionVersion=o):I.newVersion=r,I}},{key:"unref",value:function(e){for(var t=0;t<this.versions.length;t++){var r=this.versions[t];if(r.resolution===e)return r.refCount--,I.oldVersion=this.feature,0===r.refCount&&(this.versions[t]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===r&&(this._recalculateHighestResolutionVersion(),I.oldVersion=r.feature)),I.newVersion=this.feature,I}return null}},{key:"feature",get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null}},{key:"_recalculateHighestResolutionVersion",value:function(){if(0!==this.versions.length){for(var e=this.versions[0],t=1;t<this.versions.length;t++){var r=this.versions[t];r.resolution<e.resolution&&(e=r)}this.highestResolutionVersion=e}else this.highestResolutionVersion=null}}]),e}(),D=function(){function e(t){(0,u.Z)(this,e),this._feature=t,this.refCount=1}return(0,o.Z)(e,[{key:"isReferenced",get:function(){return 0!==this.refCount}},{key:"isSingle",get:function(){return 1===this.refCount}},{key:"ref",value:function(e){return++this.refCount,I.oldVersion=this._feature,this.feature&&Object.defineProperty(e,"uid",{value:this.feature.uid,configurable:!0}),(0,R.f)(this._feature,e)||(this._feature=e),I.newVersion=this._feature,I}},{key:"unref",value:function(){return I.oldVersion=this._feature,this.refCount>0&&(this.refCount--,!this.isReferenced)?(I.newVersion=null,I):(I.newVersion=this._feature,I)}},{key:"feature",get:function(){return this._feature}}]),e}(),I={oldVersion:null,newVersion:null},Z=new Set,P=function(){function e(t){(0,u.Z)(this,e),this.descriptor=t,this.fetchStatus=i.FETCH_NEEDED,this._features=null,this._numVertices=0,this._featureLimit=0,this.featuresMissing=!0,this._shuffled=!1,this._numFeatures=M,this._emptyFeatureRatio=0,this._estimatedSize=-1,this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._availableFields=Z,this._displayingFeatures=null,this.alive=!0,this.filtered=!1}return(0,o.Z)(e,[{key:"displayingFeatures",get:function(){return this._displayingFeatures},set:function(e){this._displayingFeatures=e,this.extentIncludingBorrowedFeatures=null}},{key:"perTileMaximumNumberOfFeaturesExceeded",get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)}},{key:"features",get:function(){return this._features}},{key:"featureLimit",get:function(){return this._featureLimit},set:function(e){this._featureLimit!==e&&(this._featureLimit=e,this._estimatedUnusedSizeDirty=!0)}},{key:"availableFields",get:function(){return this._availableFields}},{key:"setFeatures",value:function(e,t,r){this._availableFields=(0,m.Pt)(r,Z),this._features=e,this._shuffled=!1,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0,e&&e.length>0?(this._emptyFeatureRatio=t/(e.length+t),this._numVertices=e.reduce((function(e,t){return e+(0,E.R3)(t.geometry)}),0)):(this._emptyFeatureRatio=0,this._numVertices=0)}},{key:"emptyFeatureRatio",get:function(){return this._emptyFeatureRatio}},{key:"numFeatures",get:function(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0},set:function(e){this._numFeatures=e}},{key:"hasPreciseFeatureCount",get:function(){return this._numFeatures>M}},{key:"needsFeatureCount",get:function(){return this._numFeatures===M}},{key:"numVertices",get:function(){return this._numVertices}},{key:"id",get:function(){return this.descriptor.id}},{key:"estimatedSize",get:function(){return this.updateMemoryEstimates(),this._estimatedSize}},{key:"estimatedUnusedSize",get:function(){return this._estimatedUnusedSize}},{key:"updateMemoryEstimates",value:function(){if(this._estimatedSize<0){if(this._estimatedSize=0,this._estimatedUnusedSize=0,this._features)for(var e=0;e<this._features.length;++e){var t=(0,E.Xw)(this._features[e]);this._estimatedSize+=t,e>=this.featureLimit&&(this._estimatedUnusedSize+=t)}return!0}if(this._estimatedUnusedSizeDirty){if(this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._features)for(var r=this.featureLimit;r<this._features.length;++r)this._estimatedUnusedSize+=(0,E.Xw)(this._features[r]);return!0}return!1}},{key:"isFetching",get:function(){return this.fetchStatus===i.FETCHING||this.fetchStatus===i.REFETCHING}},{key:"isRefetching",get:function(){return this.fetchStatus===i.REFETCHING}},{key:"needsFetching",get:function(){return this.fetchStatus===i.FETCH_NEEDED||this.fetchStatus===i.REFETCH_NEEDED}},{key:"needsRefetching",get:function(){return this.fetchStatus===i.REFETCH_NEEDED}},{key:"isFetched",get:function(){return this.fetchStatus===i.DONE||this.fetchStatus===i.FULL}},{key:"resetFetching",value:function(){this.fetchStatus=this.fetchStatus===i.REFETCHING?i.REFETCH_NEEDED:i.FETCH_NEEDED}},{key:"needsDisplayUpdate",get:function(){return!!this._features&&!function(e,t,r){if((0,m.Wi)(t)||(0,m.Wi)(e)||r!==t.length||r>e.length)return!1;for(var i=0;i<r;++i)if(e[i]!==t[i])return!1;return!0}(this._features,this.displayingFeatures,this.featureLimit)}},{key:"intersects",value:function(e){return!e||!this.descriptor.extent||((0,C.oJ)(e,O),(0,C.kK)(this.descriptor.extent,O))}},{key:"intersectionIncludingBorrowed",value:function(e,t){var r=(0,m.pC)(this.extentIncludingBorrowedFeatures)?this.extentIncludingBorrowedFeatures:this.descriptor.extent;return e||r?(e?((0,C.oJ)(e,t),(0,C.jV)(t,r,t)):(0,C.JG)(t,r),t):((0,C.JG)(t,C.bd),t)}},{key:"_shuffle",value:function(e){this._features.sort((function(t,r){return(0,E.MS)(t,e)-(0,E.MS)(r,e)})),(0,b.TV)(this._features,16438),this._shuffled=!0,this._estimatedUnusedSizeDirty=!0}},{key:"reduceFeatures",value:function(e,t,r){if(e<=0)return!1;if(!this._features)return this.featureLimit=0,!1;var n=!1;this.featureLimit=Math.ceil(this.numFeatures*e),this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,this.fetchStatus===i.DONE&&this._features.length>0&&(this.fetchStatus=i.REFETCH_NEEDED,n=!0)),!this._shuffled&&e<1&&this._shuffle(r);var a=Math.max(this.featureLimit,Math.ceil(t*this.numFeatures));return this._features.length>a&&(this._features.length=a,this.featuresMissing=!0,this.fetchStatus===i.FULL&&(this.fetchStatus=i.DONE)),n}},{key:"cache",get:function(){return{availableFields:this._availableFields,features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},set:function(e){this.requestController=null,this._availableFields=e.availableFields,this._features=e.features,this._numFeatures=e.numFeatures,this._emptyFeatureRatio=e.emptyFeatureRatio,this.fetchStatus=e.fetchStatus,this.featuresMissing=e.featuresMissing,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0}}]),e}(),M=-1;!function(e){e[e.FETCH_NEEDED=0]="FETCH_NEEDED",e[e.REFETCH_NEEDED=1]="REFETCH_NEEDED",e[e.FETCHING=2]="FETCHING",e[e.REFETCHING=3]="REFETCHING",e[e.DONE=4]="DONE",e[e.FULL=5]="FULL"}(i||(i={}));var O=(0,C.Ue)(),N=r(36734),V=r(93463),A=p.Z.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D"),U=function(e){(0,l.Z)(r,e);var t=(0,c.Z)(r);function r(e){var i;return(0,u.Z)(this,r),(i=t.call(this,e))._useTileCount=!1,i.updating=!1,i.updatingTotal=0,i.updatingRemaining=0,i.expectedFeatureDiff=0,i.maximumNumberOfFeaturesExceeded=!1,i.maximumNumberOfFeaturesExceededThrottle=1e3,i._fullRatio=1,i._farRatio=1,i.changes={updates:{adds:new Array,removes:new Array},adds:new Array,removes:new Array},i.handles=new f.Z,i._frameTask=V.sq,i._dirty=!1,i.featureTiles=new Map,i.displayingFeatureReferences=new Map,i.numDisplayingFeatureReferences=0,i.suspended=!0,i.pendingEdits=null,i}return(0,o.Z)(r,[{key:"maximumNumberOfFeatures",set:function(e){e=e||1/0;var t=this._get("maximumNumberOfFeatures");e===t||e<1||(this._set("maximumNumberOfFeatures",e),this._maximumFeaturesUpdated(t,e))}},{key:"memoryFactor",set:function(e){this.memoryFactor!==e&&(this._set("memoryFactor",e),this._setDirty())}},{key:"lodFactor",set:function(e){this.lodFactor!==e&&(this._set("lodFactor",e),this.supportsResolution&&this.refetch())}},{key:"useTileCount",get:function(){return this._useTileCount&&(0,m.pC)(this.context.query.queryFeatureCount)},set:function(e){this._useTileCount=e,this.notifyChange("useTileCount")}},{key:"memoryForUnusedFeatures",get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.estimatedUnusedSize})),e}},{key:"totalVertices",get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.numVertices})),e}},{key:"totalFeatures",get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.numFeatures})),e}},{key:"filterExtent",set:function(e){if(e&&this.context.tilingScheme&&!e.spatialReference.equals(this.context.tilingScheme.spatialReference))A.error("#filterExtent=","extent needs to be in the same spatial reference as the tiling scheme");else{var t=this._get("filterExtent");if(!(t===e||t&&e&&t.equals(e))){var r=e?e.clone():null;this._set("filterExtent",r),this._reclip(r,t)}}}},{key:"initialize",value:function(){var e=this;this.handles.add((0,_.on)((function(){return e.tileDescriptors}),"change",(function(){return e._setDirty()}),{onListenerAdd:function(){return e._setDirty()}})),this.objectIdField=this.context.objectIdField,this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?S:D;var t=this.context.scheduler;(0,m.pC)(t)&&(this._frameTask=t.registerTask(V.T8.FEATURE_TILE_FETCHER,this)),this._setDirty()}},{key:"destroy",value:function(){var e=this;this._frameTask.remove(),this.handles=(0,m.SC)(this.handles),this.featureTiles.forEach((function(t){e._cancelFetchTile(t),e._removeTile(t)})),this.featureTiles.clear(),this.displayingFeatureReferences.clear(),this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)}},{key:"paused",get:function(){return this.suspended||!!this.pendingEdits}},{key:"restart",value:function(){var e=this;this.featureTiles.forEach((function(t){e._cancelFetchTile(t),e._clearTile(t),e._resetFetchTile(t)})),(0,m.pC)(this.context.memoryCache)&&this.context.memoryCache.clear(),this._setDirty()}},{key:"refetch",value:function(){var e=this;this.featureTiles.forEach((function(t){e._cancelFetchTile(t),e._resetFetchTile(t)})),(0,m.pC)(this.context.memoryCache)&&this.context.memoryCache.clear(),this._setDirty()}},{key:"suspend",value:function(){this.suspended||(this.suspended=!0,this._pause(),this._setDirty())}},{key:"resume",value:function(){this.suspended&&(this.suspended=!1,this._unpause())}},{key:"_pause",value:function(){var e=this;this.paused&&(this.featureTiles.forEach((function(t){return e._cancelFetchTile(t)})),this._updated())}},{key:"_unpause",value:function(){this.paused||(this._setDirty(),this._updated())}},{key:"availableFields",get:function(){var e=null;return this.featureTiles.forEach((function(t){(0,m.Wi)(t.displayingFeatures)||0===t.displayingFeatures.length||((0,m.Wi)(e)?e=new Set(t.availableFields):e.forEach((function(r){t.availableFields.has(r)||(0,m.Wg)(e).delete(r)})))})),(0,m.pC)(e)?e:new Set}},{key:"applyEdits",value:function(e){var t=this;this.pendingEdits||(this.pendingEdits={edits:Promise.resolve(),count:0,controller:new AbortController},this._pause());var r=this.pendingEdits;r.count++;var i=r.edits.then((function(){return e.result.catch((function(e){if((0,v.D_)(e))throw e;return null})).then((function(e){return e?(t._applyEditsDeleteFeatures(e.deletedFeatures),t._applyEditsAddUpdateFeatures(e.addedFeatures,e.updatedFeatures,r.controller.signal).then((function(){return e}))):e})).then((function(e){return 0==--r.count&&(t.pendingEdits===r&&(t.pendingEdits=null),(0,m.pC)(t.context.memoryCache)&&t.context.memoryCache.clear(),t._unpause(),t._updated()),e}))}));return r.edits=i,this._updated(),i}},{key:"_applyEditsDeleteFeatures",value:function(e){var t=this;if(0!==e.length){var r=this.context.globalIdField,i=r&&this.availableFields.has(r),n=new Set,a=this.objectIdField;e.forEach((function(e){var s=e.objectId,u=e.globalId;if((!s||s<0)&&r){i||A.errorOncePerTick("Editing the specified service requires the layer's globalIdField, ".concat(r," to be included the layer's outFields for updates to be reflected in the view"));var o=t.features.find((function(e){return e.attributes&&e.attributes[r]===u}));o&&n.add((0,E.MS)(o,a))}else n.add(s)})),this.featureTiles.forEach((function(e){if(e.features){var r=e.features.filter((function(e){return!n.has((0,E.MS)(e,t.objectIdField))}));r.length!==e.features.length&&(e.setFeatures(r,0,e.availableFields),t._invalidateCounts())}}))}}},{key:"_applyEditsAddUpdateFeatures",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r,i){var n,s,u,o=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],s=new Set,t.forEach((function(e){return n.push(e.objectId)})),r.forEach((function(e){n.push(e.objectId),s.add(e.objectId)})),0!==n.length){e.next=3;break}return e.abrupt("return");case 3:return u=[],this.featureTiles.forEach((function(e){var t=o._applyEditsAddUpdateTile(e,n,s,i);t&&u.push(t)})),e.next=7,(0,v.as)(u);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_applyEditsAddUpdateTile",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r,i,s){var u,o,l,c,h,d,f,p=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.features){e.next=2;break}return e.abrupt("return");case 2:return(u=this._createQuery(t)).resultType=void 0,u.cacheHint=!1,u.objectIds=r,e.next=6,this._queryFeatures(u,s);case 6:if(o=e.sent,l=null,i.size>0&&(c=t.features.filter((function(e){return!i.has((0,E.MS)(e,p.objectIdField))}))).length!==t.features.length&&(l=c),o.features.length>0){l||(l=t.features.slice()),h=(0,n.Z)(o.features);try{for(h.s();!(d=h.n()).done;)f=d.value,l.push(f)}catch(a){h.e(a)}finally{h.f()}}l&&(t.hasPreciseFeatureCount&&(t.numFeatures=Math.max(t.numFeatures,l.length)),t.setFeatures(l,0,z(t.availableFields,o.fields)),this._invalidateCounts());case 11:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n){return e.apply(this,arguments)}}()},{key:"_queryFeatures",value:function(e,t){return this.context.query.queryFeaturesDehydrated(e,{signal:t,timeout:X})}},{key:"_setDirty",value:function(){this._dirty=!0,this._updated()}},{key:"running",get:function(){return this.updating}},{key:"runTask",value:function(e){var t=this;if(this._frameTask.processQueue(e),this._dirty&&this.constructed){this._dirty=!1;var r=this._getListOfTiles();if(this._markTilesNotAlive(r),e.run((function(){return t._addTiles(r,e)}))&&e.run((function(){return t._filterExtentTiles(r,e)}))&&e.run((function(){return t._removeTiles(r,e)}))&&!e.done){var i=this._sortTiles(r);e.run((function(){return t._displayTiles(i,e)}))&&e.run((function(){return t._fetchTiles(i,e)}))&&e.run((function(){return t._updateMemoryEstimates(i,e)}))||this._setDirty(),this._updated(),this.updating||this._updateMaximumNumberOfFeaturesExceeded()}else this._setDirty()}}},{key:"_markTilesNotAlive",value:function(e){var t,r=(0,n.Z)(e);try{for(r.s();!(t=r.n()).done;){t.value.alive=!1}}catch(i){r.e(i)}finally{r.f()}}},{key:"_addTiles",value:function(e,t){var r=this;return!this.suspended&&(this.tileDescriptors.forEach((function(i){var n=r.featureTiles.get(i.id);n?n.alive=!0:t.done||(e.push(r._addTile(i)),t.madeProgress())})),t.hasProgressed)}},{key:"_filterExtentTiles",value:function(e,t){var r,i=(0,n.Z)(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(t.done)break;a.alive&&(a.filtered=!a.intersects(this.filterExtent),a.filtered&&(this._clearTile(a),t.madeProgress()))}}catch(s){i.e(s)}finally{i.f()}return t.hasProgressed}},{key:"_removeTiles",value:function(e,t){for(var r=e.length-1;r>=0&&!t.done;r--){var i=e[r];i.alive||(this._removeTile(i),r!==e.length-1&&(e[r]=e[e.length-1]),e.pop(),t.madeProgress())}return t.hasProgressed}},{key:"_sortTiles",value:function(e){return e.sort((function(e,t){return e.descriptor.loadPriority-t.descriptor.loadPriority})),e}},{key:"_displayTiles",value:function(e,t){var r,i=this,a=this._updateRatio(e),s=(0,n.Z)(e);try{var u=function(){var e=r.value;if(!t.run((function(){return function(e){var t=i._fullRatio<1?a(e)*i._farRatio:1;return e.reduceFeatures(t,i.memoryFactor,i.objectIdField)&&i._setDirty(),i._showTile(e)}(e)})))return i._setDirty(),"break"};for(s.s();!(r=s.n()).done;){if("break"===u())break}}catch(o){s.e(o)}finally{s.f()}return t.hasProgressed}},{key:"_fetchTiles",value:function(e,t){var r=this;if(this.paused)return!1;var i,a=!1,s=(0,n.Z)(e);try{var u=function(){var e=i.value;if(!e.needsFetching)return"continue";var n=(0,m.pC)(r.context.memoryCache)?r.context.memoryCache.pop(e.id):null;if((0,m.pC)(n))e.cache=n,r._setDirty(),r._scheduleUpdated(),t.madeProgress();else{if(r._needsNumFeatures(e)){var s=new AbortController,u=r._fetchTileCount(e,s.signal);r._handleRequest(e,u,s,(function(){return e.numFeatures=-2})),a=!0,t.madeProgress()}if(t.done)return{v:!0}}};for(s.s();!(i=s.n()).done;){var o=u();if("continue"!==o&&"object"===typeof o)return o.v}}catch(f){s.e(f)}finally{s.f()}if(a)return t.hasProgressed;var l,c=(0,n.Z)(e);try{var h=function(){var e=l.value;if(e.needsFetching){var i=new AbortController,n=r._fetchTile(e,i.signal);if(r._handleRequest(e,n,i,(function(t){e.setFeatures([],0,null),r._invalidateCounts(),e.featuresMissing=!1,r.context.logFetchError(A,t)})),t.madeProgress(),t.done)return{v:!0}}};for(c.s();!(l=c.n()).done;){var d=h();if("object"===typeof d)return d.v}}catch(f){c.e(f)}finally{c.f()}return t.hasProgressed}},{key:"_updateMemoryEstimates",value:function(e,t){var r=this;return e.some((function(e){return!t.run((function(){return e.updateMemoryEstimates()}))&&(r._setDirty(),!0)})),t.hasProgressed}},{key:"_reclip",value:function(e,t){if(this.constructed){var r=new Array;this.featureTiles.forEach((function(i){(0,m.Wi)(i.displayingFeatures)||0===i.displayingFeatures.length||(i.intersectionIncludingBorrowed(t,W),i.intersectionIncludingBorrowed(e,Q),(0,C.fS)(W,Q)||r.push(i))})),this._refreshDisplayingFeatures(r),this._updated()}}},{key:"_refreshDisplayingFeatures",value:function(e){var t,r=new Set,i=this.changes.updates,a=(0,n.Z)(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;if(!(0,m.Wi)(s.displayingFeatures)){var u,o=(0,n.Z)(s.displayingFeatures);try{for(o.s();!(u=o.n()).done;){var l=u.value,c=(0,E.MS)(l,this.objectIdField);if(!r.has(c)){r.add(c);var h=this.displayingFeatureReferences.get(c).feature;i.removes.push(h),i.adds.push(h)}}}catch(d){o.e(d)}finally{o.f()}}}}catch(d){a.e(d)}finally{a.f()}this._applyChanges()}},{key:"_updated",value:function(){var e=this,t=0;this.paused||this.featureTiles.forEach((function(e){return e.isFetching?++t:0}));var r=this._dirty||t>0||!!this.pendingEdits;if(this._set("updating",r),r){var i=0,n=0,a=0,s=0,u=0,o=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.featureTiles.forEach((function(t){if(++n,t.isFetching&&t.hasPreciseFeatureCount){var r=e._maximumFeaturesForTile(t)*(1-t.emptyFeatureRatio),l=(0,m.pC)(t.displayingFeatures)?t.displayingFeatures.length*o:0;u+=r-l}t.needsFetching?++s:t.numFeatures>0&&(++a,i+=t.numFeatures)})),s+=t;var l=0,c=0;i?(c=i,l=Math.min(s*i/a,i)):(c=n,l=s),u=Math.min(this.maximumNumberOfFeatures-this.features.length,u),this._set("updatingTotal",c),this._set("updatingRemaining",l),this._set("expectedFeatureDiff",u)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()}},{key:"_updateMaximumNumberOfFeaturesExceeded",value:function(){var e=(0,y.oE)(this.featureTiles,(function(e){return e.perTileMaximumNumberOfFeaturesExceeded}));this._set("maximumNumberOfFeaturesExceeded",e)}},{key:"_updateRatio",value:function(e){var t,r=function(e){var t,r=0,i=(0,n.Z)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;a.features&&a.features.length>0&&a.alive&&(r=Math.max(r,a.descriptor.lij[0]))}}catch(s){i.e(s)}finally{i.f()}return r}(e),i=function(e){return 1/(1<<Math.max(0,r-e.descriptor.lij[0]))},a=0,s=0,u=(0,n.Z)(e);try{for(u.s();!(t=u.n()).done;){var o=t.value,l=o.numFeatures;a+=l,s+=l*i(o)}}catch(c){u.e(c)}finally{u.f()}return this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/a),this._farRatio=this.maximumNumberOfFeatures/s,this._scheduleUpdated(),i}},{key:"_maximumFeaturesUpdated",value:function(e,t){var r=this;e!==t&&(t>e&&this.featureTiles.forEach((function(e){if(e.featuresMissing){var t=r._maximumFeaturesForTile(e);e.features&&(e.features.length>=t||e.fetchStatus===i.FULL)||(r._cancelFetchTile(e),r._resetFetchTile(e))}})),this._setDirty())}},{key:"_addTile",value:function(e){var t=new P(e);return this.featureTiles.set(t.id,t),this._resetFetchTile(t),this._referenceDisplayingFeaturesFromRelatedTiles(t),t}},{key:"_referenceDisplayingFeaturesFromRelatedTiles",value:function(e){var t=this,r=e.descriptor.resolution;this.featureTiles.forEach((function(i){if(!((0,m.Wi)(i.displayingFeatures)||e===i||e.descriptor.lij&&i.descriptor.lij&&!(0,N.E9)(e.descriptor.lij,i.descriptor.lij))){(0,m.Wi)(e.displayingFeatures)&&(e.displayingFeatures=[]),e.descriptor.extent&&i.descriptor.extent&&((0,m.Wi)(e.extentIncludingBorrowedFeatures)&&(e.extentIncludingBorrowedFeatures=(0,C.d9)(e.descriptor.extent)),(0,C.jn)(e.extentIncludingBorrowedFeatures,i.descriptor.extent,e.extentIncludingBorrowedFeatures));var a,s=(0,n.Z)(i.displayingFeatures);try{for(s.s();!(a=s.n()).done;){var u=a.value;e.displayingFeatures.push(u);var o=t.displayingFeatureReferences.get((0,E.MS)(u,t.objectIdField));o.ref(o.feature,r),t.numDisplayingFeatureReferences++}}catch(l){s.e(l)}finally{s.f()}}})),e.featureLimit=(0,m.pC)(e.displayingFeatures)?e.displayingFeatures.length:0}},{key:"_removeTile",value:function(e){this._clearTile(e),this.featureTiles.delete(e.id)}},{key:"_resetFetchTile",value:function(e){e.filtered=!e.intersects(this.filterExtent),e.filtered?e.needsFetching&&(e.fetchStatus=i.DONE):e.fetchStatus=i.FETCH_NEEDED}},{key:"_cancelFetchTile",value:function(e){var t=e.requestController;(0,m.pC)(t)&&(e.requestController=null,e.resetFetching(),t.abort())}},{key:"_fetchTileCount",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._fetchCount(t,r);case 2:return t.numFeatures=e.sent,this._updateRatio(this._getListOfTiles()),e.abrupt("return",t.fetchStatus===i.REFETCHING?i.REFETCH_NEEDED:i.FETCH_NEEDED);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_fetchTile",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r){var n,s,u,o,l,c,h,d,f,p,y=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=this._maximumFeaturesForTile(t))<=0)){e.next=3;break}return e.abrupt("return",G(t));case 3:if(s=this._getMaxRecordCount(t),u=Math.ceil(n/s),!(L(t)||!this.context.capabilities.supportsMaxRecordCountFactor||t.numFeatures<=n&&u>k.Z.MAX_MAX_RECORD_COUNT_FACTOR)){e.next=6;break}return e.abrupt("return",this._fetchPagedTile(t,r));case 6:return(o=this._createQuery(t)).maxRecordCountFactor=Math.ceil(n/s),t.isRefetching&&t.features&&t.features.length>0&&(l=Math.ceil(t.features.length/(1-t.emptyFeatureRatio)/s),o.maxRecordCountFactor=Math.max(l+1,o.maxRecordCountFactor)),e.next=10,this._queryFeatures(o,r);case 10:return c=e.sent,h=c.features,d=c.exceededTransferLimit,f=c.fields,p=d?o.maxRecordCountFactor>=k.Z.MAX_MAX_RECORD_COUNT_FACTOR?i.FULL:i.DONE:i.FULL,e.next=17,this._frameTask.schedule((function(){t.featuresMissing=h.length<t.numFeatures||d;var e=y._removeEmptyFeatures(h);t.setFeatures(h,e,H(f))}),r);case 17:return(0,v.k_)(r),this._invalidateCounts(),e.abrupt("return",p);case 20:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_fetchCount",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.context.query.queryFeatureCount(this._createFeatureCountQuery(t),{signal:r}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_fetchPagedTile",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r){var n,s,u,o,l,c,h,d,f,p=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=0,u=0,o=0,l=this._maximumFeaturesForTile(t)-o,c=this._getMaxRecordCount(t),h=null,d=(0,a.Z)().mark((function e(){var d,f,y,_,g,F;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=p._createQuery(t),f=p._setPagingParameters(d,s,l,c),e.next=4,p._queryFeatures(d,r);case 4:return y=e.sent,_=y.features,g=y.exceededTransferLimit,F=y.fields,e.next=10,p._frameTask.schedule((function(){f&&(s+=(0,m.Wg)(d.num)),o+=_.length,u+=p._removeEmptyFeatures(_),t.featuresMissing=s<t.numFeatures||g,n=n?n.concat(_):_,h=z(h,F),t.setFeatures(n,u,h)}),r);case 10:if((0,v.k_)(r),p._invalidateCounts(),p._setDirty(),l=p._maximumFeaturesForTile(t)-o,f&&g&&!(l<=0)){e.next=16;break}return e.abrupt("return",{v:g?i.DONE:i.FULL});case 16:case"end":return e.stop()}}),e)}));case 4:return e.delegateYield(d(),"t0",5);case 5:if("object"!==typeof(f=e.t0)){e.next=8;break}return e.abrupt("return",f.v);case 8:e.next=4;break;case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createFeatureCountQuery",value:function(e){var t=this._createQuery(e);return this.context.capabilities.supportsCacheHint&&(t.resultType=void 0,t.cacheHint=!0),t}},{key:"_createQuery",value:function(e){var t=this.context.createQuery(),r=e.descriptor.extent;if(r){var i=this.context.tilingScheme.spatialReference;t.geometry=(0,C.HH)(r,i)}return this._setResolutionParams(t,e),this._useTileQuery(e)?t.resultType="tile":this.context.capabilities.supportsCacheHint&&(t.cacheHint=!0),t}},{key:"_setPagingParameters",value:function(e,t,r,i){return!!this.context.capabilities.supportsPagination&&(e.start=t,r>0&&this.context.capabilities.supportsMaxRecordCountFactor?(e.maxRecordCountFactor=Math.ceil(r/i),e.num=Math.min(e.maxRecordCountFactor*i,r)):e.num=Math.min(i),!0)}},{key:"_getEffectiveTileResolution",value:function(e){if(null==e.descriptor.resolution)return null;var t=this.context.viewingMode===w.JY.Global?this.context.tilingScheme.resolutionAtLevel(3):1/0;return Math.min(e.descriptor.resolution,t)/this.lodFactor}},{key:"supportsResolution",get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType}},{key:"_setResolutionParams",value:function(e,t){if(this.supportsResolution){var r=this._getEffectiveTileResolution(t);null!=r&&(this.context.capabilities.supportsQuantization?e.quantizationParameters=new T.Z({mode:"view",originPosition:"upper-left",tolerance:r,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(e.maxAllowableOffset=r))}}},{key:"_removeEmptyFeatures",value:function(e){for(var t=e.length,r=0;r<e.length;){var i=e[r];(0,E.dF)(i.geometry)?++r:(e[r]=e[e.length-1],--e.length)}return t-e.length}},{key:"_needsNumFeatures",value:function(e){return this.useTileCount&&e.needsFeatureCount&&!L(e)}},{key:"_getMaxRecordCount",value:function(e){var t=this.context,r=t.tileMaxRecordCount,i=t.maxRecordCount;return this._useTileQuery(e)&&(0,m.pC)(r)&&r>0&&this.context.capabilities.supportsResultType?r:(0,m.pC)(i)&&i>0?i:j}},{key:"_useTileQuery",value:function(e){return(!L(e)||!this.context.capabilities.supportsCacheHint)&&this.context.capabilities.supportsResultType}},{key:"_handleRequest",value:function(e,t,r,n){var a=this;e.fetchStatus=e.needsRefetching?i.REFETCHING:i.FETCHING,e.requestController=r;var s=!1;t.then((function(t){e.requestController=null,e.fetchStatus=t})).catch((function(t){e.requestController===r&&(e.requestController=null,e.fetchStatus=i.DONE),(0,v.D_)(t)?s=!0:n(t)})).then((function(){s||a._setDirty(),a._scheduleUpdated()}))}},{key:"_scheduleUpdated",value:function(){var e=this;this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add((0,g.Os)((function(){e.handles.remove("scheduleUpdated"),e._updated()})),"scheduleUpdated")}},{key:"_showTile",value:function(e){if((0,m.pC)(e.displayingFeatures)&&!e.needsDisplayUpdate)return!1;var t=e.features;if(0===e.featureLimit||!t){var r=(0,m.pC)(e.displayingFeatures)&&e.displayingFeatures.length>0;return this._hideTileFeatures(e),e.displayingFeatures=[],r}var i=e.descriptor.resolution,n=this.changes.updates,a=this.changes.adds,s=Math.min(e.featureLimit,t.length);e.featureLimit=s;for(var u=0;u<s;++u){var o=t[u],l=(0,E.MS)(o,this.objectIdField),c=this.displayingFeatureReferences.get(l);if(c){var h=c.ref(o,i);h.oldVersion!==h.newVersion&&(n.removes.push(h.oldVersion),n.adds.push(h.newVersion))}else this.displayingFeatureReferences.set(l,new this.FeatureReferenceClass(o,i)),a.push(o);this.numDisplayingFeatureReferences++}return this._hideTileFeatures(e),this._applyChanges(),e.displayingFeatures=t.slice(0,s),!0}},{key:"_hideTile",value:function(e){this._cancelFetchTile(e),this._hideTileFeatures(e)}},{key:"_hideTileFeatures",value:function(e){if(!(0,m.Wi)(e.displayingFeatures)){var t,r=this.changes.updates,i=this.changes.removes,a=(0,n.Z)(e.displayingFeatures);try{for(a.s();!(t=a.n()).done;){var s=t.value,u=(0,E.MS)(s,this.objectIdField),o=this.displayingFeatureReferences.get(u);if(o){var l=o.unref(e.descriptor.resolution);this.numDisplayingFeatureReferences--,l?l.oldVersion!==l.newVersion&&(null==l.newVersion?(this.displayingFeatureReferences.delete(u),i.push(l.oldVersion)):(r.adds.push(l.newVersion),r.removes.push(l.oldVersion))):console.error("Hiding unreferenced feature")}}}catch(c){a.e(c)}finally{a.f()}this._applyChanges(),e.displayingFeatures=null}}},{key:"_applyChanges",value:function(){var e=this.changes.updates;e.removes.length>0&&(this.features.removeMany(e.removes),e.removes.length=0),e.adds.length>0&&(this.features.addMany(e.adds),e.adds.length=0);for(var t=this.changes.adds,r=this.changes.removes,i=Math.min(t.length,r.length),n=0;n<i;){var a=Math.min(n+Y,i);this.features.addMany(t.slice(n,a)),this.features.removeMany(r.slice(n,a)),n=a}t.length>i&&this.features.addMany(0===n?t:t.slice(n)),r.length>i&&this.features.removeMany(0===n?r:r.slice(n)),t.length=0,r.length=0}},{key:"_clearTile",value:function(e){if(this._hideTile(e),e.features&&(0,m.pC)(this.context.memoryCache)){var t=16+e.estimatedSize;this.context.memoryCache.put(e.id,e.cache,t)}e.setFeatures(null,0,null),this._invalidateCounts()}},{key:"_invalidateCounts",value:function(){this.notifyChange("totalVertices"),this.notifyChange("totalFeatures"),this.notifyChange("memoryForUnusedFeatures")}},{key:"_getListOfTiles",value:function(){return Array.from(this.featureTiles.values())}},{key:"storedFeatures",get:function(){return this._getListOfTiles().reduce((function(e,t){return e+(t.features?t.features.length:0)}),0)}},{key:"_maximumFeaturesForTile",value:function(e){var t=e.hasPreciseFeatureCount?e.numFeatures:1/0,r=e.hasPreciseFeatureCount?t:this.maximumNumberOfFeatures,i=this._fullRatio<1?this._farRatio:1;return Math.min(Math.ceil(r*i/(1-e.emptyFeatureRatio)),t)}},{key:"test",get:function(){var e=this;return{process:function(t){return e.runTask(t)},getFeatureTileById:function(t){return e.featureTiles.get(t)},forEachFeatureTile:function(t){return e.featureTiles.forEach(t)}}}}]),r}(d.Z);function L(e){return"dummy-tile-full-extent"===e.id}function B(e){var t=e.capabilities.query;return{supportsMultipleResolutions:q(e),supportsPagination:!(!t||!t.supportsPagination),supportsResultType:!(!t||!t.supportsResultType),supportsCacheHint:!(!t||!t.supportsCacheHint),supportsQuantization:!(!t||!t.supportsQuantization),supportsQuantizationEditMode:!(!t||!t.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!t||!t.supportsMaxRecordCountFactor),supportsFormatPBF:!(!t||!t.supportsFormatPBF)}}function q(e){switch(e.geometryType){case"polyline":return!0;case"polygon":return e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantization;default:return!1}}function G(e){return e.setFeatures([],0,null),e.featuresMissing=!1,i.DONE}function H(e){return(0,m.Wi)(e)?new Set:new Set(e.map((function(e){return e.name})))}function z(e,t){if((0,m.Wi)(e)||(0,m.Wi)(t))return H(t);var r,i=new Set,a=(0,n.Z)(t);try{for(a.s();!(r=a.n()).done;){var s=r.value.name;e.has(s)&&i.add(s)}}catch(u){a.e(u)}finally{a.f()}return i}(0,h._)([(0,F.Cb)({constructOnly:!0})],U.prototype,"features",void 0),(0,h._)([(0,F.Cb)()],U.prototype,"tileDescriptors",void 0),(0,h._)([(0,F.Cb)({value:1/0})],U.prototype,"maximumNumberOfFeatures",null),(0,h._)([(0,F.Cb)({value:1})],U.prototype,"memoryFactor",null),(0,h._)([(0,F.Cb)({value:1})],U.prototype,"lodFactor",null),(0,h._)([(0,F.Cb)()],U.prototype,"useTileCount",null),(0,h._)([(0,F.Cb)({readOnly:!0})],U.prototype,"updating",void 0),(0,h._)([(0,F.Cb)({readOnly:!0})],U.prototype,"updatingTotal",void 0),(0,h._)([(0,F.Cb)({readOnly:!0})],U.prototype,"updatingRemaining",void 0),(0,h._)([(0,F.Cb)({readOnly:!0})],U.prototype,"expectedFeatureDiff",void 0),(0,h._)([(0,F.Cb)({readOnly:!0})],U.prototype,"memoryForUnusedFeatures",null),(0,h._)([(0,F.Cb)({readOnly:!0})],U.prototype,"maximumNumberOfFeaturesExceeded",void 0),(0,h._)([(0,F.Cb)({constructOnly:!0})],U.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0),(0,h._)([(0,F.Cb)({readOnly:!0})],U.prototype,"totalVertices",null),(0,h._)([(0,F.Cb)({readOnly:!0})],U.prototype,"totalFeatures",null),(0,h._)([(0,F.Cb)()],U.prototype,"filterExtent",null),(0,h._)([(0,F.Cb)({constructOnly:!0})],U.prototype,"context",void 0),U=(0,h._)([(0,x.j)("esri.views.3d.layers.support.FeatureTileFetcher3D")],U);var j=2e3,W=(0,C.Ue)(),Q=(0,C.Ue)(),X=6e5,Y=200},61712:function(e,t,r){r.d(t,{E:function(){return s}});var i=r(92026),n=r(81753),a=r(67387);function s(e){var t=e.view.spatialReference,r=e.layer.fullExtent,s=(0,i.pC)(r)&&r.spatialReference;if((0,i.Wi)(r)||!s)return Promise.resolve(null);if(s.equals(t))return Promise.resolve(r.clone());var u=(0,n.iV)(r,t);return(0,i.pC)(u)?Promise.resolve(u):e.view.state.isLocal?(0,a.projectGeometry)(r,t,e.layer.portalItem).then((function(t){return!e.destroyed&&t?t:void 0})).catch((function(){return null})):Promise.resolve(null)}},5198:function(e,t,r){r.d(t,{g:function(){return d}});var i=r(93433),n=r(37762),a=r(15671),s=r(43144),u=r(60136),o=r(29388),l=r(91505),c=r(62314),h=r(92377),d=function(e){(0,u.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments))._set=new Set,e}return(0,s.Z)(r,[{key:"clear",value:function(){if(this._set.size>0){var e=this.toArray();this._set.clear(),this.emit("after-changes",{type:c.y.REMOVE}),this.emit("change",{added:[],removed:e})}}},{key:"length",get:function(){return this._set.size}},{key:"addMany",value:function(e){if(0!==e.length){var t,r=(0,n.Z)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;this._set.add(i)}}catch(a){r.e(a)}finally{r.f()}this.emit("after-changes",{type:c.y.ADD}),this.emit("change",{added:e,removed:[]})}}},{key:"remove",value:function(e){this._set.delete(e)&&(this.emit("after-changes",{type:c.y.REMOVE}),this.emit("change",{added:[],removed:[e]}))}},{key:"removeMany",value:function(e){var t,r=[],i=(0,n.Z)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;this._set.delete(a)&&r.push(a)}}catch(s){i.e(s)}finally{i.f()}r.length>0&&(this.emit("after-changes",{type:c.y.REMOVE}),this.emit("change",{added:[],removed:r}))}},{key:"toArray",value:function(){return(0,i.Z)(this._set)}},{key:"find",value:function(e){var t;return(0,h.f)(this._set,(function(r){return!!e(r)&&(t=r,!0)})),t}},{key:"forEach",value:function(e){this._set.forEach((function(t){return e(t)}))}}]),r}(l.Z)}}]);
//# sourceMappingURL=188.4228dd81.chunk.js.map