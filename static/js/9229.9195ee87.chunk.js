"use strict";(self.webpackChunkuums_front_end=self.webpackChunkuums_front_end||[]).push([[9229],{69229:function(e,t,r){r.d(t,{Z:function(){return W}});var n=r(1413),i=r(37762),a=r(74165),s=r(15861),o=r(15671),u=r(43144),l=r(11752),c=r(61120),h=r(60136),d=r(29388),f=r(27366),p=r(14921),v=r(42537),y=r(32718),g=r(92026),m=r(66978),x=r(94172),w=r(49861),_=(r(63780),r(93169),r(25243),r(69912)),b=r(53866),Z=r(65156),k=r(26279),R=r(42069),S=r(81782),C=r(70619),E=r(4760);function I(e){return C.Z.createSquareGeometry([[e[0],e[1],-1],[e[2],e[1],-1],[e[2],e[3],-1],[e[0],e[3],-1]])}function A(e,t){if(!(0,Z.kK)(e,t))return I(t);for(var r=[e[1]-t[1],Math.min(e[3],t[3])-Math.max(e[1],t[1]),t[3]-e[3],123456],n=[e[0]-t[0],Math.min(e[2],t[2])-Math.max(e[0],t[0]),t[2]-e[2],123456],i=t[2]-t[0],a=t[3]-t[1],s=n[0]>0&&n[2]>0?3:2,o=r[0]>0&&r[2]>0?3:2,u=(o+1)*(s+1),l=new Float64Array(3*u),c=new Float32Array(2*u),h=new Uint32Array(6*(o*s-1)),d=0,f=0,p=0,v=0,y=0,g=0;g<4;g++){var m=r[g];if(!(m<=0)){for(var x=0,w=0;w<4;w++){var _=n[w];_<=0||(l[f++]=t[0]+x,l[f++]=t[1]+d,l[f++]=-1,c[p++]=x/i,c[p++]=d/a,w<3&&g<3&&(1!==w||1!==g)&&(h[y++]=v,h[y++]=v+1,h[y++]=v+s+1,h[y++]=v+1,h[y++]=v+s+2,h[y++]=v+s+1),v++,x+=_)}d+=m}}var b=new Uint32Array(h.length);return new S.Z([[E.T.POSITION,{size:3,data:l,exclusive:!0}],[E.T.NORMAL,{size:3,data:M,exclusive:!0}],[E.T.UV0,{size:2,data:c,exclusive:!0}]],[[E.T.POSITION,h],[E.T.NORMAL,b],[E.T.UV0,h]])}var M=[0,0,1],P=r(61712),O=r(94463),D=r(54134),L=r(68401),G=r(78289),T=r(69831),N=r(1487),U=r(66156),z=r(67581),H=r(13107),V=r(69787),j=r(8548),q=y.Z.getLogger("esri.views.3d.layers.DynamicLayerView3D"),F=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.apply(this,arguments)).drapeSourceType=k.L.RasterImage,e.updatePolicy=L.jq.SYNC,e.fullExtentInLocalViewSpatialReference=null,e.maximumDataResolution=null,e._images=new Array,e._extents=new Array,e._overlays=new Array,e.updateWhenStationary=!0,e._drapeSourceRenderer=null,e.refreshDebounced=(0,m.Ds)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=e.destroyed,t.t0){t.next=4;break}return t.next=4,e._doRefresh(r).catch((function(t){(0,m.D_)(t)||y.Z.getLogger(e.declaredClass).error(t)}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),2e3),e}return(0,u.Z)(r,[{key:"initialize",value:function(){var e=this;this._drapeSourceRenderer=this.view.basemapTerrain.overlayManager.registerGeometryDrapeSource(this),this.handles.add((0,v.kB)((function(){return e.view.basemapTerrain.overlayManager.unregisterDrapeSource(e)}))),this.addResolvingPromise((0,P.E)(this).then((function(t){return e._set("fullExtentInLocalViewSpatialReference",t)}))),this.updatingHandles.add((function(){return e.suspended}),(function(){return e._suspendedChangeHandler()})),this.handles.add(this.view.resourceController.scheduler.registerIdleStateCallbacks((function(){e._isScaleRangeActive()&&e.notifyChange("suspended")}),(function(){}))),this._isScaleRangeLayer()&&this.updatingHandles.add((function(){return e.layer.effectiveScaleRange}),(function(){return e.notifyChange("suspended")}))}},{key:"destroy",value:function(){this.clear()}},{key:"setDrapingExtent",value:function(e,t){var r=this;this._spatialReference=t,e.forEach((function(e){r._overlays[e.index]=e,r._updateImageExtent(e)}))}},{key:"_updateImageExtent",value:function(e){var t=this._clippedExtent(e.extent,B);if(!(0,g.Wi)(t)){var r=function(e,t,r){var n=(0,Z.bf)(e)/(0,Z.Cb)(e),i={width:r,height:r};return n>1.0001?i.height=r/n:n<.9999&&(i.width=r*n),i.width=Math.round(i.width/((0,Z.bf)(e)/(0,Z.bf)(t))),i.height=Math.round(i.height/((0,Z.Cb)(e)/(0,Z.Cb)(t))),i}(e.extent,t,e.resolution),n=e.pixelRatio*this.view.state.pixelRatio;if("imageMaxWidth"in this.layer||"imageMaxHeight"in this.layer){var i=this.layer.imageMaxWidth,a=this.layer.imageMaxHeight;if(r.width>i){var s=i/r.width;r.height=Math.floor(r.height*s),r.width=i,n*=s}if(r.height>a){var o=a/r.height;r.width=Math.floor(r.width*o),r.height=a,n*=o}}var u=this._extents[e.index];u&&(0,Z.fS)(u.extent,t)&&this._imageSizeEquals(t,u.imageSize,r)||(this._extents[e.index]={extent:(0,Z.Ue)(t),imageSize:r,pixelRatio:n},this.suspended||this._fetch(e.index).catch((function(e){(0,m.D_)(e)||q.error(e)})))}}},{key:"clear",value:function(){for(var e=0;e<this._images.length;e++)this._clearImage(e)}},{key:"doRefresh",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._doRefresh());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_doRefresh",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.suspended){e.next=2;break}return e.abrupt("return");case 2:for(r=[],n=0;n<this._extents.length;n++)this._extents[n]&&r.push(this._fetch(n,t));return e.next=6,(0,m.as)(r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){if(!(0,l.Z)((0,c.Z)(r.prototype),"canResume",this).call(this))return!1;var e=this.layer;if(this._isScaleRangeActive()){var t=e.effectiveScaleRange,n=t.minScale,i=t.maxScale,a=this.view.scale;if(a<i||n>0&&a>n)return!1}return!0}},{key:"isUpdating",value:function(){return this._images.some((function(e){return!!e.loadingPromise}))}},{key:"processResult",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(r instanceof HTMLImageElement||r instanceof HTMLCanvasElement)&&(t.image=r);case 1:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"findExtentInfoAt",value:function(e){var t,r=(0,i.Z)(this._extents);try{for(r.s();!(t=r.n()).done;){var n=t.value,a=n.extent;if(new b.Z(a[0],a[1],a[2],a[3],this._spatialReference).contains(e))return n}}catch(s){r.e(s)}finally{r.f()}return null}},{key:"getFetchOptions",value:function(){}},{key:"redraw",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r){var n=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.Ed)(this._images,function(){var e=(0,s.Z)((0,a.Z)().mark((function e(i,s){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i,!e.t0){e.next=6;break}return e.next=4,t(i,r);case 4:return e.next=6,n._createStageObjects(s,i.image,r);case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_imageSizeEquals",value:function(e,t,r){if(!this.maximumDataResolution)return!1;var n=(0,Z.bf)(e)/this.maximumDataResolution.x,i=(0,Z.Cb)(e)/this.maximumDataResolution.y,a=n/t.width,s=i/t.height,o=n/r.width,u=i/r.height,l=Math.abs(a-o),c=Math.abs(s-u),h=O.Z.TESTS_DISABLE_OPTIMIZATIONS?0:1.5;return l<=h&&c<=h}},{key:"_fetch",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r){var i,o,u,l,c,h,d,f=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.suspended){e.next=2;break}return e.abrupt("return");case 2:if(i=this._extents[t],o=i.extent,this._images[t]||(this._images[t]={texture:null,material:null,renderGeometry:null,loadingPromise:null,loadingAbortController:null,image:null,pixelData:null,renderExtent:(0,Z.Ue)(o)}),(u=this._images[t]).loadingAbortController&&(u.loadingAbortController.abort(),u.loadingAbortController=null),0!==(l=new b.Z(o[0],o[1],o[2],o[3],this._spatialReference)).width&&0!==l.height){e.next=9;break}return e.abrupt("return",void this._clearImage(t));case 9:return c=new AbortController,u.loadingAbortController=c,(0,m.fu)(r,(function(){return c.abort()})),h=c.signal,d=this._waitFetchReady(h).then((0,s.Z)((0,a.Z)().mark((function e(){var r,s,o,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,n.Z)((0,n.Z)({requestAsImageElement:!0,pixelRatio:f._overlays[t].pixelRatio},f.getFetchOptions()),{},{signal:h}),s=i.imageSize,o=s.height,u=s.width,e.abrupt("return",f.layer.fetchImage(l,u,o,r));case 2:case"end":return e.stop()}}),e)})))).then((function(e){if((0,m.Hc)(h))throw q.warnOnce("A call to fetchImage resolved even though the request was aborted. fetchImage should not resolve if options.signal.aborted is true."),(0,m.zE)();return f.processResult(u,e)})).then((function(){(0,Z.JG)(u.renderExtent,o)})).finally((function(){d===u.loadingPromise&&(u.loadingPromise=null,u.loadingAbortController=null)})),u.loadingPromise=d,this.notifyChange("updating"),e.next=16,d.then((0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!h.aborted){e.next=2;break}throw(0,m.zE)();case 2:return e.next=4,f._createStageObjects(t,u.image,h);case 4:f.notifyChange("updating");case 5:case"end":return e.stop()}}),e)})))).catch((function(e){throw e&&!(0,m.D_)(e)&&q.error(e),f.notifyChange("updating"),e}));case 16:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_clearImage",value:function(e){var t=this._images[e];if(t){(0,g.pC)(t.renderGeometry)&&(this._drapeSourceRenderer.removeGeometries([t.renderGeometry],G.$.Geometry.UPDATE),t.renderGeometry=null);var r=this.view._stage;r.remove(t.texture),t.texture=null,r.remove(t.material),t.material=null,t.loadingAbortController&&(t.loadingAbortController.abort(),t.loadingAbortController=null),t.loadingPromise=null,t.image=null,t.pixelData=null}}},{key:"_createStageObjects",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r,n){var i,s,o,u,l,c,h=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.view._stage,s=this._images[t],o=function(){i.remove(s.texture),s.texture=null,(0,g.pC)(s.renderGeometry)&&(h._drapeSourceRenderer.removeGeometries([s.renderGeometry],G.$.Geometry.UPDATE),s.renderGeometry=null)},!r){e.next=25;break}return u=new N.x(r,{width:r.width,height:r.height,preMultiplyAlpha:!0,wrap:{s:j.e8.CLAMP_TO_EDGE,t:j.e8.CLAMP_TO_EDGE}}),e.next=5,(0,p.q6)(this._images[t===D.fu.INNER?D.fu.OUTER:D.fu.INNER].loadingPromise);case 5:if((0,m.k_)(n),t!==D.fu.INNER){e.next=10;break}l=I(s.renderExtent),e.next=14;break;case 10:if(c=this._images[0].renderExtent){e.next=13;break}return e.abrupt("return",void o());case 13:l=A(c,s.renderExtent);case 14:return o(),i.add(u),e.next=18,i.loadImmediate(u);case 18:s.texture=u,(0,g.Wi)(s.material)?(s.material=new U.j({transparent:!0,textureId:u.id}),i.add(s.material)):s.material.setParameters({textureId:u.id}),s.renderGeometry=new T.z(l,s.material),s.renderGeometry.origin=this._overlays[t].renderLocalOrigin,this._drapeSourceRenderer.addGeometries([s.renderGeometry],G.$.Geometry.UPDATE),e.next=26;break;case 25:o(),i.remove(s.material),s.material=null;case 26:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_isScaleRangeLayer",value:function(){return"effectiveScaleRange"in this.layer}},{key:"_isScaleRangeActive",value:function(){var e=this.layer;if(!this._isScaleRangeLayer())return!1;var t=e.effectiveScaleRange,r=t.minScale,n=t.maxScale;return(0,V.Av)(r,n)}},{key:"_clippedExtent",value:function(e,t){if("local"!==this.view.viewingMode)return(0,Z.JG)(t,e);var r=this.view.basemapTerrain;return r.ready?(0,Z.jV)(e,r.extent,t):(0,Z.JG)(t,e)}},{key:"_suspendedChangeHandler",value:function(){this.suspended?this.clear():this.refreshDebounced()}},{key:"_waitFetchReady",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var r=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,x.N1)((function(){return r.view.stationary}),t);case 2:(0,m.k_)(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),r}((0,H.Z)((0,R.A)(z.Z)));(0,f._)([(0,w.Cb)()],F.prototype,"layer",void 0),(0,f._)([(0,w.Cb)()],F.prototype,"suspended",void 0),(0,f._)([(0,w.Cb)({readOnly:!0})],F.prototype,"fullExtentInLocalViewSpatialReference",void 0),(0,f._)([(0,w.Cb)()],F.prototype,"updating",void 0);var W=F=(0,f._)([(0,_.j)("esri.views.3d.layers.DynamicLayerView3D")],F),B=(0,Z.Ue)()},42069:function(e,t,r){r.d(t,{A:function(){return m}});var n=r(74165),i=r(15861),a=r(15671),s=r(43144),o=r(11752),u=r(61120),l=r(60136),c=r(29388),h=r(27366),d=r(42537),f=r(66978),p=r(94172),v=r(49861),y=(r(63780),r(93169),r(25243),r(69912)),g=r(5354),m=function(e){var t=function(e){(0,l.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).slicePlaneEnabled=!1,e.supportsHeightUnitConversion=!1,e}return(0,s.Z)(r,[{key:"postscript",value:function(e){(0,o.Z)((0,u.Z)(r.prototype),"postscript",this).call(this,e),(0,g.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}},{key:"_validateHeightModelInfo",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(){var t,r,i,a=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new AbortController,r=t.signal,this.handles.add((0,d.kB)((function(){return t.abort()}))),e.next=4,(0,p.N1)((function(){var e;return null===(e=a.view.defaultsFromMap)||void 0===e?void 0:e.heightModelInfoReady}),r);case 4:if((0,f.k_)(r),!(i=(0,g.Wt)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))){e.next=8;break}throw i;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){var e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,o.Z)((0,u.Z)(r.prototype),"canResume",this).call(this)&&(!e||!e.minScale||!e.maxScale||e.minScale>=e.maxScale)}},{key:"getSuspendInfo",value:function(){var e=(0,o.Z)((0,u.Z)(r.prototype),"getSuspendInfo",this).call(this),t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return t&&t.minScale&&t.maxScale&&t.minScale<t.maxScale&&(e.outsideScaleRange=!0),e}}]),r}(e);return(0,h._)([(0,v.Cb)()],t.prototype,"view",void 0),(0,h._)([(0,v.Cb)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,h._)([(0,y.j)("esri.views.3d.layers.LayerView3D")],t)}},61712:function(e,t,r){r.d(t,{E:function(){return s}});var n=r(92026),i=r(81753),a=r(67387);function s(e){var t=e.view.spatialReference,r=e.layer.fullExtent,s=(0,n.pC)(r)&&r.spatialReference;if((0,n.Wi)(r)||!s)return Promise.resolve(null);if(s.equals(t))return Promise.resolve(r.clone());var o=(0,i.iV)(r,t);return(0,n.pC)(o)?Promise.resolve(o):e.view.state.isLocal?(0,a.projectGeometry)(r,t,e.layer.portalItem).then((function(t){return!e.destroyed&&t?t:void 0})).catch((function(){return null})):Promise.resolve(null)}},67581:function(e,t,r){r.d(t,{Z:function(){return m}});var n=r(15671),i=r(43144),a=r(60136),s=r(29388),o=r(27366),u=r(85015),l=r(91505),c=r(41691),h=r(79056),d=r(32718),f=r(92026),p=r(67426),v=r(49861),y=(r(63780),r(93169),r(25243),r(69912)),g=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e)).layer=null,i.parent=null,i}return(0,i.Z)(r,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",n=e.layer&&e.layer.title||"no title";d.Z.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(n,"', id: '").concat(r,"')"),t)}}))}},{key:"fullOpacity",get:function(){return(0,f.Pt)(this.get("layer.opacity"),1)*(0,f.Pt)(this.get("parent.fullOpacity"),1)}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){var e;return!this.suspended&&!0===(null===(e=this.layer)||void 0===e?void 0:e.legendEnabled)}},{key:"updating",get:function(){var e;return!((null===(e=this.updatingHandles)||void 0===e||!e.updating)&&!this.isUpdating())}},{key:"updatingProgress",get:function(){return this.updating?0:1}},{key:"visible",get:function(){var e;return!0===(null===(e=this.layer)||void 0===e?void 0:e.visible)},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}},{key:"canResume",value:function(){var e,t,r;return this.visible&&(null===(e=this.layer)||void 0===e?void 0:e.loaded)&&!(null!==(t=this.parent)&&void 0!==t&&t.suspended)&&(null===(r=this.view)||void 0===r?void 0:r.ready)||!1}},{key:"getSuspendInfo",value:function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}},{key:"isUpdating",value:function(){return!1}}]),r}((0,c.p)((0,h.IG)((0,p.v)(l.Z.EventedMixin(u.Z)))));(0,o._)([(0,v.Cb)()],g.prototype,"fullOpacity",null),(0,o._)([(0,v.Cb)()],g.prototype,"layer",void 0),(0,o._)([(0,v.Cb)()],g.prototype,"parent",void 0),(0,o._)([(0,v.Cb)({readOnly:!0})],g.prototype,"suspended",null),(0,o._)([(0,v.Cb)({readOnly:!0})],g.prototype,"suspendInfo",null),(0,o._)([(0,v.Cb)({readOnly:!0})],g.prototype,"legendEnabled",null),(0,o._)([(0,v.Cb)({type:Boolean,readOnly:!0})],g.prototype,"updating",null),(0,o._)([(0,v.Cb)({readOnly:!0})],g.prototype,"updatingProgress",null),(0,o._)([(0,v.Cb)()],g.prototype,"visible",null),(0,o._)([(0,v.Cb)()],g.prototype,"view",void 0);var m=g=(0,o._)([(0,y.j)("esri.views.layers.LayerView")],g)},13107:function(e,t,r){r.d(t,{Z:function(){return f}});var n=r(15671),i=r(43144),a=r(60136),s=r(29388),o=r(27366),u=r(32718),l=r(66978),c=r(94172),h=r(49861),d=(r(63780),r(93169),r(25243),r(69912)),f=function(e){var t=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"initialize",value:function(){var e=this;this.handles.add((0,c.on)((function(){return e.layer}),"refresh",(function(t){e.doRefresh(t.dataChanged).catch((function(t){(0,l.D_)(t)||u.Z.getLogger(e.declaredClass).error(t)}))})),"RefreshableLayerView")}}]),r}(e);return(0,o._)([(0,h.Cb)()],t.prototype,"layer",void 0),t=(0,o._)([(0,d.j)("esri.layers.mixins.RefreshableLayerView")],t)}}}]);
//# sourceMappingURL=9229.9195ee87.chunk.js.map