"use strict";(self.webpackChunkuums_front_end=self.webpackChunkuums_front_end||[]).push([[961],{43244:function(e,t,r){r.d(t,{Z:function(){return o}});var i=r(37762),n=r(15671),a=r(43144),s=r(92026),o=function(){function e(t){(0,n.Z)(this,e),this.size=0,this._start=0,this.maxSize=t,this._buffer=new Array(t)}return(0,a.Z)(e,[{key:"entries",get:function(){return this._buffer}},{key:"enqueue",value:function(e){if(this.size===this.maxSize){var t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return this._buffer[(this._start+this.size++)%this.maxSize]=e,null}},{key:"dequeue",value:function(){if(0===this.size)return null;var e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}},{key:"peek",value:function(){return 0===this.size?null:this._buffer[this._start]}},{key:"find",value:function(e){if(0===this.size)return null;var t,r=(0,i.Z)(this._buffer);try{for(r.s();!(t=r.n()).done;){var n=t.value;if((0,s.pC)(n)&&e(n))return n}}catch(a){r.e(a)}finally{r.f()}return null}},{key:"clear",value:function(e){for(var t=this.dequeue();(0,s.pC)(t);)e&&e(t),t=this.dequeue()}}]),e}()},91958:function(e,t,r){r.d(t,{$7:function(){return _},$e:function(){return u},E0:function(){return f},N5:function(){return p},lW:function(){return h}});var i=r(74165),n=r(15861),a=(r(93169),r(10064)),s=r(92026),o=r(35995);function u(e){var t=f(e);return(0,s.pC)(t)?t.toDataURL():""}function h(e){return l.apply(this,arguments)}function l(){return l=(0,n.Z)((0,i.Z)().mark((function e(t){var r,n,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=f(t),!(0,s.Wi)(r)){e.next=3;break}throw new a.Z("imageToArrayBuffer","Unsupported image type");case 3:return e.next=5,c(t);case 5:return n=e.sent,e.next=8,new Promise((function(e){return r.toBlob(e,n)}));case 8:if(o=e.sent){e.next=11;break}throw new a.Z("imageToArrayBuffer","Failed to encode image");case 11:return e.next=13,o.arrayBuffer();case 13:return e.t0=e.sent,e.t1=n,e.abrupt("return",{data:e.t0,type:e.t1});case 16:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}function c(e){return d.apply(this,arguments)}function d(){return(d=(0,n.Z)((0,i.Z)().mark((function e(t){var r,n,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof HTMLImageElement){e.next=2;break}return e.abrupt("return","image/png");case 2:if(r=t.src,!(0,o.HK)(r)){e.next=6;break}return n=(0,o.sJ)(r),a=n.mediaType,e.abrupt("return","image/jpeg"===a?a:"image/png");case 6:return e.abrupt("return",/\.png$/i.test(r)?"image/png":/\.(jpg|jpeg)$/i.test(r)?"image/jpeg":"image/png");case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){if(e instanceof HTMLCanvasElement)return e;if(e instanceof HTMLVideoElement)return null;var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var r=t.getContext("2d");return e instanceof HTMLImageElement?r.drawImage(e,0,0,e.width,e.height):e instanceof ImageData&&r.putImageData(e,0,0),t}function p(e){for(var t=[],r=new Uint8Array(e),i=0;i<r.length;i++)t.push(String.fromCharCode(r[i]));return"data:application/octet-stream;base64,"+btoa(t.join(""))}function _(e){if(e.byteLength<8)return!1;var t=new Uint8Array(e);return 137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7]}},16285:function(e,t,r){r.d(t,{Z:function(){return c}});var i=r(37762),n=r(29439),a=r(15671),s=r(43144),o=r(78915),u=r(691),h=r(6388),l=r(31027),c=function(){function e(t){(0,a.Z)(this,e),this._resourceManager=t}return(0,s.Z)(e,[{key:"dispose",value:function(){this._rasterizationCanvas=null}},{key:"rasterizeJSONResource",value:function(e,t,r){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),"simple-fill"===e.type||"esriSFS"===e.type){var i=o.fN.rasterizeSimpleFill(this._rasterizationCanvas,e.style,t),a=(0,n.Z)(i,3),s=a[0];return{size:[a[1],a[2]],image:new Uint32Array(s.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0}}if("simple-line"===e.type||"esriSLS"===e.type||"line"===e.type&&e.dashTemplate){var l,c;if("simple-line"===e.type||"esriSLS"===e.type)switch(l=(0,o.U1)(e.style,e.cap),e.cap){case"butt":c="Butt";break;case"square":c="Square";break;default:c="Round"}else l=e.dashTemplate,c=e.cim.capStyle;var d=o.fN.rasterizeSimpleLine(l,c),f=(0,n.Z)(d,3),p=f[0];return{size:[f[1],f[2]],image:new Uint32Array(p.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}var _,m,v;if("simple-marker"===e.type||"esriSMS"===e.type||"line-marker"===e.type?(_=o.B$.fromSimpleMarker(e),v=(0,h.Fp)(_)):e.cim&&"CIMHatchFill"===e.cim.type?(_=o.B$.fromCIMHatchFill(e.cim),m=new u.Z(_.frame.xmin,-_.frame.ymax,_.frame.xmax-_.frame.xmin,_.frame.ymax-_.frame.ymin)):e.cim.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===e.cim.markerPlacement.type?(_=o.B$.fromCIMInsidePolygon(e.cim),m=new u.Z(_.frame.xmin,-_.frame.ymax,_.frame.xmax-_.frame.xmin,_.frame.ymax-_.frame.ymin)):(_=e.cim,v=(0,h.Fp)(_)),v&&!r){var g=(0,h.RL)(v),y=(0,n.Z)(g,3),b=y[0],w=y[1],x=y[2];return b?{size:[w,x],image:new Uint32Array(b.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}var T=o.B$.rasterize(this._rasterizationCanvas,_,m,this._resourceManager,!r),k=(0,n.Z)(T,5),E=k[0],M=k[1],B=k[2],R=k[3],Z=k[4];return E?{size:[M,B],image:new Uint32Array(E.buffer),sdf:!1,simplePattern:!1,anchorX:R,anchorY:Z}:null}},{key:"rasterizeImageResource",value:function(e,t,r,a){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),this._rasterizationCanvas.width=e,this._rasterizationCanvas.height=t;var s=this._rasterizationCanvas.getContext("2d");r instanceof ImageData?s.putImageData(r,0,0):(r.setAttribute("width","".concat(e,"px")),r.setAttribute("height","".concat(t,"px")),s.drawImage(r,0,0,e,t));var o,u=s.getImageData(0,0,e,t),h=new Uint8Array(u.data);if(a){var c,d=(0,i.Z)(a);try{for(d.s();!(c=d.n()).done;){var f=c.value;if(f&&f.oldColor&&4===f.oldColor.length&&f.newColor&&4===f.newColor.length){var p=(0,n.Z)(f.oldColor,4),_=p[0],m=p[1],v=p[2],g=p[3],y=(0,n.Z)(f.newColor,4),b=y[0],w=y[1],x=y[2],T=y[3];if(_===b&&m===w&&v===x&&g===T)continue;for(var k=0;k<h.length;k+=4)_===h[k]&&m===h[k+1]&&v===h[k+2]&&g===h[k+3]&&(h[k]=b,h[k+1]=w,h[k+2]=x,h[k+3]=T)}}}catch(O){d.e(O)}finally{d.f()}}for(var E=0;E<h.length;E+=4)o=h[E+3]/255,h[E]=h[E]*o,h[E+1]=h[E+1]*o,h[E+2]=h[E+2]*o;var M=h,B=e,R=t,Z=512;if(B>=Z||R>=Z){var C=B/R;C>1?(B=Z,R=Math.round(Z/C)):(R=Z,B=Math.round(Z*C)),M=new Uint8Array(4*B*R);var F=new Uint8ClampedArray(M.buffer);(0,l.TT)(h,e,t,F,B,R,!1)}return{size:[B,R],image:new Uint32Array(M.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}]),e}()},33624:function(e,t,r){r.d(t,{W:function(){return f}});var i=r(1413),n=r(37762),a=r(15671),s=r(43144),o=r(11752),u=r(61120),h=r(60136),l=r(29388),c=r(23588),d=r(41978),f=function(e){(0,h.Z)(r,e);var t=(0,l.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments))._childrenSet=new Set,e._needsSort=!1,e.children=[],e._effectView=null,e}return(0,s.Z)(r,[{key:"blendMode",get:function(){return this._blendMode},set:function(e){this._blendMode=e,this.requestRender()}},{key:"clips",get:function(){return this._clips},set:function(e){this._clips=e,this.children.forEach((function(t){return t.clips=e}))}},{key:"computedEffects",get:function(){var e,t;return null!==(e=null===(t=this._effectView)||void 0===t?void 0:t.effects)&&void 0!==e?e:null}},{key:"effect",get:function(){var e,t;return null!==(e=null===(t=this._effectView)||void 0===t?void 0:t.effect)&&void 0!==e?e:""},set:function(e){(this._effectView||e)&&(this._effectView||(this._effectView=new d.AM),this._effectView.effect=e,this.requestRender())}},{key:"updateTransitionProperties",value:function(e,t){(0,o.Z)((0,u.Z)(r.prototype),"updateTransitionProperties",this).call(this,e,t),this._effectView&&(this._effectView.transitionStep(e,t),this._effectView.transitioning&&this.requestRender())}},{key:"doRender",value:function(e){var t=this.createRenderParams(e);this.renderChildren(t)}},{key:"addChild",value:function(e){return this.addChildAt(e,this.children.length)}},{key:"addChildAt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.children.length;if(!e)return e;if(this.contains(e))return e;this._needsSort=!0;var r=e.parent;return r&&r!==this&&r.removeChild(e),t>=this.children.length?this.children.push(e):this.children.splice(t,0,e),this._childrenSet.add(e),e.parent=this,e.stage=this.stage,this!==this.stage&&(e.clips=this.clips),this.requestRender(),e}},{key:"contains",value:function(e){return this._childrenSet.has(e)}},{key:"removeAllChildren",value:function(){this._childrenSet.clear(),this._needsSort=!0;var e,t=(0,n.Z)(this.children);try{for(t.s();!(e=t.n()).done;){var r=e.value;this!==this.stage&&(r.clips=null),r.stage=null,r.parent=null}}catch(i){t.e(i)}finally{t.f()}this.children.length=0}},{key:"removeChild",value:function(e){return this.contains(e)?this.removeChildAt(this.children.indexOf(e)):e}},{key:"removeChildAt",value:function(e){if(e<0||e>=this.children.length)return null;this._needsSort=!0;var t=this.children.splice(e,1)[0];return this._childrenSet.delete(t),this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null,t}},{key:"sortChildren",value:function(e){this._needsSort&&(this.children.sort(e),this._needsSort=!1)}},{key:"_createTransforms",value:function(){return{dvs:(0,c.c)()}}},{key:"onAttach",value:function(){(0,o.Z)((0,u.Z)(r.prototype),"onAttach",this).call(this);var e,t=this.stage,i=(0,n.Z)(this.children);try{for(i.s();!(e=i.n()).done;){e.value.stage=t}}catch(a){i.e(a)}finally{i.f()}}},{key:"onDetach",value:function(){(0,o.Z)((0,u.Z)(r.prototype),"onDetach",this).call(this);var e,t=(0,n.Z)(this.children);try{for(t.s();!(e=t.n()).done;){e.value.stage=null}}catch(i){t.e(i)}finally{t.f()}}},{key:"renderChildren",value:function(e){var t,r=(0,n.Z)(this.children);try{for(r.s();!(t=r.n()).done;){t.value.beforeRender(e)}}catch(u){r.e(u)}finally{r.f()}var i,a=(0,n.Z)(this.children);try{for(a.s();!(i=a.n()).done;){i.value.processRender(e)}}catch(u){a.e(u)}finally{a.f()}var s,o=(0,n.Z)(this.children);try{for(o.s();!(s=o.n()).done;){s.value.afterRender(e)}}catch(u){o.e(u)}finally{o.f()}}},{key:"createRenderParams",value:function(e){return(0,i.Z)((0,i.Z)({},e),{},{blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:e.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition})}}]),r}(r(87422).s)},75391:function(e,t,r){r.d(t,{Z:function(){return l}});var i=r(15671),n=r(43144),a=r(11752),s=r(61120),o=r(60136),u=r(29388),h=r(80613),l=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,n.Z)(r,[{key:"renderChildren",value:function(e){this.attributeView.bindTextures(e.context,!1),this.children.some((function(e){return e.hasData}))&&((0,a.Z)((0,s.Z)(r.prototype),"renderChildren",this).call(this,e),e.drawPhase===h.jx.MAP&&this._renderChildren(e),this.hasHighlight()&&e.drawPhase===h.jx.HIGHLIGHT&&this._renderHighlight(e),this._boundsRenderer&&this._boundsRenderer.doRender(e))}},{key:"_renderHighlight",value:function(e){var t=e.painter.effects.highlight;t.bind(e),this._renderChildren(e,t.defines),t.draw(e),t.unbind()}}]),r}(r(82022).Z)},20961:function(e,t,r){r.r(t),r.d(t,{GraphicContainer:function(){return ri.Z},GraphicsView2D:function(){return ti.Z},LabelManager:function(){return ei},MagnifierView2D:function(){return Ai},MapViewNavigation:function(){return Zi},Stage:function(){return Or}});var i=r(74165),n=r(1413),a=r(15861),s=r(37762),o=r(15671),u=r(43144),h=r(97326),l=r(11752),c=r(61120),d=r(60136),f=r(29388),p=r(10064),_=r(98928),m=r(93169),v=r(92026),g=r(94172),y=r(99346),b=r(23588),w=r(59001),x=r(33624),T=r(80613),k=r(53628),E=r(56130),M=r(61441),B=r(54711),R={shaders:{vertexShader:(0,B.w)("bitBlit/bitBlit.vert"),fragmentShader:(0,B.w)("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])},Z=r(44070),C=r(8548),F=r(96721),O=r(45412),S=function(){function e(){(0,o.Z)(this,e),this._initialized=!1}return(0,u.Z)(e,[{key:"dispose",value:function(){this._program=(0,v.O3)(this._program),this._vertexArrayObject=(0,v.O3)(this._vertexArrayObject)}},{key:"render",value:function(e,t,r,i){e&&(this._initialized||this._initialize(e),e.setBlendFunctionSeparate(C.zi.ONE,C.zi.ONE_MINUS_SRC_ALPHA,C.zi.ONE,C.zi.ONE_MINUS_SRC_ALPHA),e.bindVAO(this._vertexArrayObject),e.useProgram(this._program),t.setSamplingMode(r),e.bindTexture(t,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",i),e.drawArrays(C.MX.TRIANGLE_STRIP,0,4),e.bindTexture(null,0),e.bindVAO())}},{key:"_initialize",value:function(e){if(this._initialized)return!0;var t=(0,F.H)(e,R);if(!t)return!1;var r=new Int8Array(16);r[0]=-1,r[1]=-1,r[2]=0,r[3]=0,r[4]=1,r[5]=-1,r[6]=1,r[7]=0,r[8]=-1,r[9]=1,r[10]=0,r[11]=1,r[12]=1,r[13]=1,r[14]=1,r[15]=1;var i=R.attributes,n=new O.U(e,i,M.As,{geometry:Z.f.createVertex(e,C.l1.STATIC_DRAW,r)});return this._program=t,this._vertexArrayObject=n,this._initialized=!0,!0}}]),e}(),P=r(4942),A=r(65706),z=function(e){var t="";t+=e[0].toUpperCase();for(var r=1;r<e.length;r++){var i=e[r];i===i.toUpperCase()?(t+="_",t+=i):t+=i.toUpperCase()}return t},U=function(e,t,r,i){var n=e+e.substring(e.lastIndexOf("/")),a=t+t.substring(t.lastIndexOf("/")),s=function(e){var t={};for(var r in e)t[z(r)]=e[r];return(0,A.K)(t)}(i);return{attributes:r,shaders:{vertexShader:s+(0,B.w)("".concat(n,".vert")),fragmentShader:s+(0,B.w)("".concat(a,".frag"))}}},I=function(e){return e===T.jx.HITTEST||e===T.jx.LABEL_ALPHA},D=function(e){return(I(e)?1:0)|(e===T.jx.HIGHLIGHT?2:0)},L=function(e,t,r,i){var n=e.rendererInfo,a=e.drawPhase;return"".concat(t.getVariationHash(),"-").concat(i.join("."),"-").concat(D(a),"-").concat(n.getVariationHash(),"-").concat((0,v.pC)(r)&&r.join("."))},N=function(e,t,r,i){var a=i.reduce((function(t,r){return(0,n.Z)((0,n.Z)({},t),{},(0,P.Z)({},r,e.context.driverTest[r]))}),{}),o=(0,n.Z)((0,n.Z)((0,n.Z)({},t.getVariation()),e.rendererInfo.getVariation()),{},{highlight:e.drawPhase===T.jx.HIGHLIGHT,id:I(e.drawPhase)},a);if((0,v.pC)(r)){var u,h=(0,s.Z)(r);try{for(h.s();!(u=h.n()).done;){o[u.value]=!0}}catch(l){h.e(l)}finally{h.f()}}return o},G=function(){function e(t){(0,o.Z)(this,e),this._rctx=t,this._programByKey=new Map}return(0,u.Z)(e,[{key:"dispose",value:function(){this._programByKey.forEach((function(e){return e.dispose()})),this._programByKey.clear()}},{key:"getProgram",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=e.vsPath+"."+e.fsPath+JSON.stringify(r)+i.join(".");if(this._programByKey.has(a))return this._programByKey.get(a);var s=i.reduce((function(e,r){return(0,n.Z)((0,n.Z)({},e),{},(0,P.Z)({},r,t._rctx.driverTest[r]))}),{}),o=(0,n.Z)((0,n.Z)({},r.map((function(e){return"string"==typeof e?{name:e,value:!0}:e})).reduce((function(e,t){return(0,n.Z)((0,n.Z)({},e),{},(0,P.Z)({},t.name,t.value))}),{})),s),u=e.vsPath,h=e.fsPath,l=e.attributes,c=U(u,h,l,o),d=this._rctx.programCache.acquire(c.shaders.vertexShader,c.shaders.fragmentShader,c.attributes);if(!d)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(a,d),d}},{key:"getMaterialProgram",value:function(e,t,r,i,n){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:["ignoresSamplerPrecision"],s=L(e,t,n,a);if(this._programByKey.has(s))return this._programByKey.get(s);var o=N(e,t,n,a),u=U(r,r,i,o),h=this._rctx.programCache.acquire(u.shaders.vertexShader,u.shaders.fragmentShader,u.attributes);if(!h)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(s,h),h}}]),e}(),V=r(42265),H=r(76200),q=r(75746),j=r(32718),W=r(66978),X=r(17842),Y=r(88396),Q=r(15245),K=r(16285),$=r(94109),J=r(88750),ee=r(12233),te=function(){function e(t,r){(0,o.Z)(this,e),this._width=0,this._height=0,this._free=[],this._width=t,this._height=r,this._free.push(new ee.Z(0,0,t,r))}return(0,u.Z)(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"allocate",value:function(e,t){if(e>this._width||t>this._height)return new ee.Z;for(var r=null,i=-1,n=0;n<this._free.length;++n){var a=this._free[n];e<=a.width&&t<=a.height&&(null===r||a.y<=r.y&&a.x<=r.x)&&(r=a,i=n)}return null===r?new ee.Z:(this._free.splice(i,1),r.width<r.height?(r.width>e&&this._free.push(new ee.Z(r.x+e,r.y,r.width-e,t)),r.height>t&&this._free.push(new ee.Z(r.x,r.y+t,r.width,r.height-t))):(r.width>e&&this._free.push(new ee.Z(r.x+e,r.y,r.width-e,r.height)),r.height>t&&this._free.push(new ee.Z(r.x,r.y+t,e,r.height-t))),new ee.Z(r.x,r.y,e,t))}},{key:"release",value:function(e){for(var t=0;t<this._free.length;++t){var r=this._free[t];if(r.y===e.y&&r.height===e.height&&r.x+r.width===e.x)r.width+=e.width;else if(r.x===e.x&&r.width===e.width&&r.y+r.height===e.y)r.height+=e.height;else if(e.y===r.y&&e.height===r.height&&e.x+e.width===r.x)r.x=e.x,r.width+=e.width;else{if(e.x!==r.x||e.width!==r.width||e.y+e.height!==r.y)continue;r.y=e.y,r.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}]),e}(),re=r(371),ie=function(e){return Math.floor(e/256)};function ne(e){var t,r=new Set,i=(0,s.Z)(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;r.add(ie(n))}}catch(a){i.e(a)}finally{i.f()}return r}function ae(e,t,r){return e.has(t)||e.set(t,r().then((function(){e.delete(t)})).catch((function(r){e.delete(t),(0,W.H9)(r)}))),e.get(t)}var se=function(){function e(t,r,i){(0,o.Z)(this,e),this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphCache={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=r,this._glyphSource=i,this._binPack=new te(t-4,r-4),this._glyphData.push(new Uint8Array(t*r)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph()}return(0,u.Z)(e,[{key:"dispose",value:function(){this._binPack=null;var e,t=(0,s.Z)(this._textures);try{for(t.s();!(e=t.n()).done;){var r=e.value;r&&r.dispose()}}catch(i){t.e(i)}finally{t.f()}this._textures.length=0,this._glyphData.length=0}},{key:"_initDecorationGlyph",value:function(){for(var e=[117,149,181,207,207,181,149,117],t=[],r=0;r<e.length;r++)for(var i=e[r],n=0;n<11;n++)t.push(i);var a={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(t)};this._recordGlyph(a)}},{key:"getGlyphItems",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){var a,s=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this._getGlyphCache(t),e.next=3,this._fetchRanges(t,r,n);case 3:return e.abrupt("return",r.map((function(e){return s._getMosaicItem(a,t,e)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"bind",value:function(e,t,r,i){var n=this._getTexture(e,r);n.setSamplingMode(t),this._dirties[r]&&(n.setData(this._glyphData[r]),this._dirties[r]=!1),e.bindTexture(n,i)}},{key:"_getGlyphCache",value:function(e){return this._glyphCache[e]||(this._glyphCache[e]={}),this._glyphCache[e]}},{key:"_getTexture",value:function(e,t){return this._textures[t]||(this._textures[t]=new re.x(e,{pixelFormat:C.VI.ALPHA,dataType:C.Br.UNSIGNED_BYTE,width:this.width,height:this.height},new Uint8Array(this.width*this.height))),this._textures[t]}},{key:"_invalidate",value:function(){this._dirties[this._currentPage]=!0}},{key:"_fetchRanges",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){var a,s,o=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=ne(r),s=[],a.forEach((function(e){s.push(o._fetchRange(t,e,n))})),e.next=4,Promise.all(s);case 4:case"end":return e.stop()}}),e)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_fetchRange",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){var a,s=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r>256)){e.next=2;break}return e.abrupt("return",null);case 2:return a=t+r,e.abrupt("return",ae(this._rangePromises,a,(function(){return s._glyphSource.getRange(t,r,n)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_getMosaicItem",value:function(e,t,r){if(!e[r]){var i=this._glyphSource.getGlyph(t,r);if(!i||!i.metrics)return function(e){return{rect:new ee.Z(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:e,sdf:!0}}(r);var n=this._recordGlyph(i),a=this._currentPage,s=i.metrics;e[r]={rect:n,page:a,metrics:s,code:r,sdf:!0},this._invalidate()}return e[r]}},{key:"_recordGlyph",value:function(e){var t,r=e.metrics;if(0===r.width)t=new ee.Z(0,0,0,0);else{var i=r.width+6,n=r.height+6;(t=this._binPack.allocate(i,n)).isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph(),this._binPack=new te(this.width-4,this.height-4),t=this._binPack.allocate(i,n));var a,s,o=this._glyphData[this._currentPage],u=e.bitmap;if(u)for(var h=0;h<n;h++){a=i*h,s=this.width*(t.y+h)+t.x;for(var l=0;l<i;l++)o[s+l]=u[a+l]}(0,m.Z)("esri-glyph-debug")&&this._showDebugPage(o)}return t}},{key:"_showDebugPage",value:function(e){var t=document.createElement("canvas"),r=t.getContext("2d"),i=new ImageData(this.width,this.height),n=i.data;t.width=this.width,t.height=this.height,t.style.border="1px solid black";for(var a=0;a<e.length;++a)n[4*a+0]=e[a],n[4*a+1]=0,n[4*a+2]=0,n[4*a+3]=255;r.putImageData(i,0,0),document.body.appendChild(t)}}]),e}(),oe=r(78084),ue=function(){function e(t){for((0,o.Z)(this,e),this._metrics=[],this._bitmaps=[];t.next();)if(1===t.tag()){for(var r=t.getMessage();r.next();)if(3===r.tag()){for(var i=r.getMessage(),n=void 0,a=void 0,s=void 0,u=void 0,h=void 0,l=void 0,c=void 0;i.next();)switch(i.tag()){case 1:n=i.getUInt32();break;case 2:a=i.getBytes();break;case 3:s=i.getUInt32();break;case 4:u=i.getUInt32();break;case 5:h=i.getSInt32();break;case 6:l=i.getSInt32();break;case 7:c=i.getUInt32();break;default:i.skip()}i.release(),n&&(this._metrics[n]={width:s,height:u,left:h,top:l,advance:c},this._bitmaps[n]=a)}else r.skip();r.release()}else t.skip()}return(0,u.Z)(e,[{key:"getMetrics",value:function(e){return this._metrics[e]}},{key:"getBitmap",value:function(e){return this._bitmaps[e]}}]),e}(),he=function(){function e(){(0,o.Z)(this,e),this._ranges=[]}return(0,u.Z)(e,[{key:"getRange",value:function(e){return this._ranges[e]}},{key:"addRange",value:function(e,t){this._ranges[e]=t}}]),e}(),le=function(){function e(t){(0,o.Z)(this,e),this._glyphInfo={},this._baseURL=t}return(0,u.Z)(e,[{key:"getRange",value:function(e,t,r){var i=this._getFontStack(e);if(i.getRange(t))return Promise.resolve();var a=256*t,s=a+255,o=this._baseURL.replace("{fontstack}",e).replace("{range}",a+"-"+s);return(0,H.default)(o,(0,n.Z)({responseType:"array-buffer"},r)).then((function(e){i.addRange(t,new ue(new oe.Z(new Uint8Array(e.data),new DataView(e.data))))}))}},{key:"getGlyph",value:function(e,t){var r=this._getFontStack(e);if(r){var i=Math.floor(t/256);if(!(i>256)){var n=r.getRange(i);return n?{metrics:n.getMetrics(t),bitmap:n.getBitmap(t)}:void 0}}}},{key:"_getFontStack",value:function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new he),t}}]),e}(),ce=r(46228),de=1e20,fe=function(){function e(t){(0,o.Z)(this,e),this.size=t;var r=document.createElement("canvas");r.width=r.height=t,this._context=r.getContext("2d"),this._gridOuter=new Float64Array(t*t),this._gridInner=new Float64Array(t*t),this._f=new Float64Array(t),this._d=new Float64Array(t),this._z=new Float64Array(t+1),this._v=new Int16Array(t)}return(0,u.Z)(e,[{key:"dispose",value:function(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null,this._svg&&(document.body.removeChild(this._svg),this._svg=null)}},{key:"draw",value:function(e,t){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:31;this._initSVG();var n=this.createSVGString(e);return new Promise((function(e,a){var s=new Image;s.src="data:image/svg+xml; charset=utf8, "+encodeURIComponent(n),s.onload=function(){s.onload=null,r._context.clearRect(0,0,r.size,r.size),r._context.drawImage(s,0,0,r.size,r.size);for(var t=r._context.getImageData(0,0,r.size,r.size),n=new Uint8Array(r.size*r.size*4),a=0;a<r.size*r.size;a++){var o=t.data[4*a+3]/255;r._gridOuter[a]=1===o?0:0===o?de:Math.pow(Math.max(0,.5-o),2),r._gridInner[a]=1===o?de:0===o?0:Math.pow(Math.max(0,o-.5),2)}r._edt(r._gridOuter,r.size,r.size),r._edt(r._gridInner,r.size,r.size);for(var u=0;u<r.size*r.size;u++){var h=r._gridOuter[u]-r._gridInner[u];(0,ce.I)(.5-h/(2*i),n,4*u)}e(n)};var o=t&&t.signal;o&&(0,W.fu)(o,(function(){return a((0,W.zE)())}))}))}},{key:"_initSVG",value:function(){if(!this._svg){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("style","position: absolute;"),e.setAttribute("width","0"),e.setAttribute("height","0"),e.setAttribute("aria-hidden","true"),e.setAttribute("role","presentation"),document.body.appendChild(e),this._svg=e}}},{key:"createSVGString",value:function(e){this._initSVG();var t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",e),this._svg.appendChild(t);var r,i,n,a,s=t.getBBox(),o=s.width/s.height,u=this.size/2;if(o>1){i=r=u/s.width;var h=u*(1/o);n=this.size/4,a=u-h/2}else r=i=u/s.height,n=u-u*o/2,a=this.size/4;var l=-s.x*r+n,c=-s.y*i+a;t.setAttribute("style","transform: matrix(".concat(r,", 0, 0, ").concat(i,", ").concat(l,", ").concat(c,")"));var d='<svg style="fill:red;" height="'.concat(this.size,'" width="').concat(this.size,'" xmlns="http://www.w3.org/2000/svg">').concat(this._svg.innerHTML,"</svg>");return this._svg.removeChild(t),d}},{key:"_edt",value:function(e,t,r){for(var i=this._f,n=this._d,a=this._v,s=this._z,o=0;o<t;o++){for(var u=0;u<r;u++)i[u]=e[u*t+o];this._edt1d(i,n,a,s,r);for(var h=0;h<r;h++)e[h*t+o]=n[h]}for(var l=0;l<r;l++){for(var c=0;c<t;c++)i[c]=e[l*t+c];this._edt1d(i,n,a,s,t);for(var d=0;d<t;d++)e[l*t+d]=Math.sqrt(n[d])}}},{key:"_edt1d",value:function(e,t,r,i,n){r[0]=0,i[0]=-de,i[1]=+de;for(var a=1,s=0;a<n;a++){for(var o=(e[a]+a*a-(e[r[s]]+r[s]*r[s]))/(2*a-2*r[s]);o<=i[s];)s--,o=(e[a]+a*a-(e[r[s]]+r[s]*r[s]))/(2*a-2*r[s]);r[++s]=a,i[s]=o,i[s+1]=+de}for(var u=0,h=0;u<n;u++){for(;i[h+1]<u;)h++;t[u]=(u-r[h])*(u-r[h])+e[r[h]]}}}]),e}(),pe=r(29439),_e=r(13200);function me(e){return e&&"static"===e.type}var ve=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,o.Z)(this,e),this._mosaicPages=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects=new Map,this._spriteCopyQueue=[],this.pixelRatio=1,(t<=0||r<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=r,i>0&&(this._maxItemSize=i),this.pixelRatio=window.devicePixelRatio||1,this._binPack=new te(this._pageWidth,this._pageHeight);var n=Math.floor(this._pageWidth),a=Math.floor(this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(n*a)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}return(0,u.Z)(e,[{key:"getWidth",value:function(e){return e>=this._mosaicPages.length?-1:this._mosaicPages[e].size[0]}},{key:"getHeight",value:function(e){return e>=this._mosaicPages.length?-1:this._mosaicPages[e].size[1]}},{key:"getPageTexture",value:function(e){return e<this._mosaicPages.length?this._mosaicPages[e].texture:null}},{key:"has",value:function(e){return this._mosaicRects.has(e)}},{key:"itemCount",get:function(){return this._mosaicRects.size}},{key:"getSpriteItem",value:function(e){return this._mosaicRects.get(e)}},{key:"addSpriteItem",value:function(e,t,r,i,n,a){if(this._mosaicRects.has(e))return this._mosaicRects.get(e);var s,o,u;if(me(r)){var h=this._allocateImage(t[0],t[1]),l=(0,pe.Z)(h,3);s=l[0],o=l[1],u=l[2]}else{s=new ee.Z(0,0,t[0],t[1]),o=this._mosaicPages.length;this._mosaicPages.push({mosaicsData:r,size:[t[0]+2*$.fL,t[1]+2*$.fL],dirty:!0,texture:void 0})}if(s.width<=0||s.height<=0)return null;var c={rect:s,width:t[0],height:t[1],sdf:n,simplePattern:a,pixelRatio:1,page:o};return this._mosaicRects.set(e,c),me(r)&&this._copy({rect:s,spriteSize:t,spriteData:r.data,page:o,pageSize:u,repeat:i,sdf:n}),c}},{key:"hasItemsToProcess",value:function(){return 0!==this._spriteCopyQueue.length}},{key:"processNextItem",value:function(){var e=this._spriteCopyQueue.pop();e&&this._copy(e)}},{key:"getSpriteItems",value:function(e){var t,r={},i=(0,s.Z)(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;r[n]=this.getSpriteItem(n)}}catch(a){i.e(a)}finally{i.f()}return r}},{key:"getMosaicItemPosition",value:function(e){var t=this.getSpriteItem(e),r=t&&t.rect;if(!r)return null;r.width=t.width,r.height=t.height;var i=t.width,n=t.height,a=$.fL,s=this._mosaicPages[t.page];return{size:[t.width,t.height],tl:[(r.x+a)/s[0],(r.y+a)/s[1]],br:[(r.x+a+i)/s[0],(r.y+a+n)/s[1]],page:t.page}}},{key:"bind",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=this._mosaicPages[r],a=n.mosaicsData,s=n.texture;s||(s=ge(e,a,n.size),n.texture=s),s.setSamplingMode(t),me(a)?(e.bindTexture(s,i),n.dirty&&(s.setData(new Uint8Array(a.data.buffer)),s.generateMipmap())):a.data.bindFrame(e,s,i),n.dirty=!1}},{key:"_copy",value:function(t){if(!(t.page>=this._mosaicPages.length)){var r=this._mosaicPages[t.page],i=r.mosaicsData;if(!me(r.mosaicsData))throw new p.Z("mapview-invalid-resource","unsuitable data type!");var n=t.spriteData,a=i.data;a&&n||console.error("Source or target images are uninitialized!"),e._copyBits(n,t.spriteSize[0],0,0,a,t.pageSize[0],t.rect.x+$.fL,t.rect.y+$.fL,t.spriteSize[0],t.spriteSize[1],t.repeat),r.dirty=!0}}},{key:"_allocateImage",value:function(e,t){e+=2*$.fL,t+=2*$.fL;var r=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<r){var i=Math.pow(2,Math.ceil((0,_e.k3)(e))),n=Math.pow(2,Math.ceil((0,_e.k3)(t))),a=new ee.Z(0,0,e,t);return this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(i*n)},size:[i,n],dirty:!0,texture:void 0}),[a,this._mosaicPages.length-1,[i,n]]}var s=this._binPack.allocate(e,t);if(s.width<=0){var o=this._mosaicPages[this._currentPage];return!o.dirty&&me(o.mosaicsData)&&(o.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new te(this._pageWidth,this._pageHeight),this._allocateImage(e,t)}return[s,this._currentPage,[this._pageWidth,this._pageHeight]]}},{key:"dispose",value:function(){this._binPack=null;var e,t=(0,s.Z)(this._mosaicPages);try{for(t.s();!(e=t.n()).done;){var r=e.value,i=r.texture;i&&i.dispose();var n=r.mosaicsData;me(n)||n.data.destroy()}}catch(a){t.e(a)}finally{t.f()}this._mosaicPages=null,this._mosaicRects.clear()}}],[{key:"_copyBits",value:function(e,t,r,i,n,a,s,o,u,h,l){var c=i*t+r,d=o*a+s;if(l){d-=a;for(var f=-1;f<=h;c=((++f+h)%h+i)*t+r,d+=a)for(var p=-1;p<=u;p++)n[d+p]=e[c+(p+u)%u]}else for(var _=0;_<h;_++){for(var m=0;m<u;m++)n[d+m]=e[c+m];c+=t,d+=a}}}]),e}();function ge(e,t,r){return me(t)?new re.x(e,{pixelFormat:C.VI.RGBA,dataType:C.Br.UNSIGNED_BYTE,width:r[0],height:r[1]},new Uint8Array(t.data.buffer)):new re.x(e,{pixelFormat:C.VI.RGBA,dataType:C.Br.UNSIGNED_BYTE,samplingMode:C.cw.LINEAR,wrapMode:C.e8.CLAMP_TO_EDGE,width:r[0],height:r[1]},null)}var ye=r(46640),be=r(84397),we=r(38499),xe=r(48202),Te=r(93592);function ke(e){return(0,we.HA)(e.frameDurations.reduce((function(e,t){return e+t}),0))}function Ee(e,t){var r=e.width,i=e.height,n=e.selectFrame,a=e.frameDurations.slice(),s=a.pop();return a.push((0,we.HA)(s+t)),{frameDurations:a,selectFrame:n,width:r,height:i}}var Me=function(){function e(t,r,i){(0,o.Z)(this,e),this._animation=t,this._repeatType=i,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];for(var n=0;r>n;)n+=this.timeToFrame,this.nextFrame();this._animation.selectFrame(this._currentFrame)}return(0,u.Z)(e,[{key:"nextFrame",value:function(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case xe.of.None:this._currentFrame-=this._direction;break;case xe.of.Loop:this._currentFrame=0;break;case xe.of.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case xe.of.None:this._currentFrame-=this._direction;break;case xe.of.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case xe.of.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame],this._animation.selectFrame(this._currentFrame)}}]),e}();function Be(e,t,r){var i,n=t.repeatType;if(null==n&&(n=xe.of.Loop),!0===t.reverseAnimation&&(e=function(e){var t=e.width,r=e.height;return{frameDurations:e.frameDurations.reverse(),selectFrame:function(t){var r=e.frameDurations.length-1-t;e.selectFrame(r)},width:t,height:r}}(e)),null!=t.duration&&(e=function(e,t){var r=e.width,i=e.height,n=e.selectFrame,a=t/ke(e);return{frameDurations:e.frameDurations.map((function(e){return(0,we.HA)(e*a)})),selectFrame:n,width:r,height:i}}(e,(0,we.HA)(1e3*t.duration))),null!=t.repeatDelay){var a=1e3*t.repeatDelay;n===xe.of.Loop?e=Ee(e,(0,we.HA)(a)):n===xe.of.Oscillate&&(e=function(e,t){var r=e.width,i=e.height,n=e.selectFrame,a=e.frameDurations.slice(),s=a.shift();return a.unshift((0,we.HA)(s+t)),{frameDurations:a,selectFrame:n,width:r,height:i}}(Ee(e,(0,we.HA)(a/2)),(0,we.HA)(a/2)))}if(null!=t.startTimeOffset)i=(0,we.HA)(1e3*t.startTimeOffset);else if(null!=t.randomizeStartTime){var s=(0,Te.$)(r),o=null!=t.randomizeStartSeed?t.randomizeStartSeed:82749913,u=(0,Te.f)(s,o);i=(0,we.HA)(u*ke(e))}else i=(0,we.HA)(0);return new Me(e,i,n)}function Re(e,t,r){var i,n=null==t.playAnimation||t.playAnimation,a=Be(e,t,r),s=a.timeToFrame;return function e(){i=n&&setTimeout((function(){a.nextFrame(),s=a.timeToFrame,e()}),s)}(),{remove:function(){n&&clearTimeout(i)}}}var Ze,Ce=function(){function e(t){(0,o.Z)(this,e),this._requestRender=t,this._frameData=null}return(0,u.Z)(e,[{key:"destroy",value:function(){this._playHandle.remove()}},{key:"bindFrame",value:function(e,t,r){e.bindTexture(t,r),(0,v.Wi)(this._frameData)||(t.updateData(0,$.fL,$.fL,this._frameData.width,this._frameData.height,this._frameData),this._frameData=null)}},{key:"_load",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n,a){var s,o,u=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=function(e){u._frameData=e,u._requestRender.requestRender()},e.next=4,this._loadAnimation(t,s,a);case 4:o=e.sent,this.frameCount=o.frameDurations.length,this.width=o.width,this.height=o.height,this._playHandle=Re(o,r,n),e.next=12;break;case 8:if(e.prev=8,e.t0=e.catch(0),(0,W.D_)(e.t0)){e.next=12;break}return e.abrupt("return",new p.Z("invalid-resource","Could not parse animated resource."));case 12:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t,r,i,n){return e.apply(this,arguments)}}()}]),e}(),Fe={exports:{}};Ze=function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,r),n.loaded=!0,n.exports}return r.m=e,r.c=t,r.p="",r(0)}([function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isNotPNG=function(e){return e===a},t.isNotAPNG=function(e){return e===s},t.default=function(e){var t=new Uint8Array(e);if(Array.prototype.some.call(o,(function(e,r){return e!==t[r]})))return a;var r=!1;if(u(t,(function(e){return!(r="acTL"===e)})),!r)return s;var i=[],h=[],f=null,p=null,_=0,m=new n.APNG;if(u(t,(function(e,t,r,a){var s=new DataView(t.buffer);switch(e){case"IHDR":f=t.subarray(r+8,r+8+a),m.width=s.getUint32(r+8),m.height=s.getUint32(r+12);break;case"acTL":m.numPlays=s.getUint32(r+8+4);break;case"fcTL":p&&(m.frames.push(p),_++),(p=new n.Frame).width=s.getUint32(r+8+4),p.height=s.getUint32(r+8+8),p.left=s.getUint32(r+8+12),p.top=s.getUint32(r+8+16);var o=s.getUint16(r+8+20),u=s.getUint16(r+8+22);0===u&&(u=100),p.delay=1e3*o/u,p.delay<=10&&(p.delay=100),m.playTime+=p.delay,p.disposeOp=s.getUint8(r+8+24),p.blendOp=s.getUint8(r+8+25),p.dataParts=[],0===_&&2===p.disposeOp&&(p.disposeOp=1);break;case"fdAT":p&&p.dataParts.push(t.subarray(r+8+4,r+8+a));break;case"IDAT":p&&p.dataParts.push(t.subarray(r+8,r+8+a));break;case"IEND":h.push(l(t,r,12+a));break;default:i.push(l(t,r,12+a))}})),p&&m.frames.push(p),0==m.frames.length)return s;var v=new Blob(i),g=new Blob(h);return m.frames.forEach((function(e){var t=[];t.push(o),f.set(d(e.width),0),f.set(d(e.height),4),t.push(c("IHDR",f)),t.push(v),e.dataParts.forEach((function(e){return t.push(c("IDAT",e))})),t.push(g),e.imageData=new Blob(t,{type:"image/png"}),delete e.dataParts,t=null})),m};var i=function(e){return e&&e.__esModule?e:{default:e}}(r(1)),n=r(2);var a=new Error("Not a PNG"),s=new Error("Not an animated PNG");var o=new Uint8Array([137,80,78,71,13,10,26,10]);function u(e,t){var r=new DataView(e.buffer),i=8,n=void 0,a=void 0,s=void 0;do{a=r.getUint32(i),s=t(n=h(e,i+4,4),e,i,a),i+=12+a}while(!1!==s&&"IEND"!=n&&i<e.length)}function h(e,t,r){var i=Array.prototype.slice.call(e.subarray(t,t+r));return String.fromCharCode.apply(String,i)}function l(e,t,r){var i=new Uint8Array(r);return i.set(e.subarray(t,t+r)),i}var c=function(e,t){var r=e.length+t.length,n=new Uint8Array(r+8),a=new DataView(n.buffer);a.setUint32(0,t.length),n.set(function(e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e),4),n.set(t,8);var s=(0,i.default)(n,4,r);return a.setUint32(r+4,s),n},d=function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=-1,n=t,a=t+(arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length-t);n<a;n++)i=i>>>8^r[255&(i^e[n])];return-1^i};for(var r=new Uint32Array(256),i=0;i<256;i++){for(var n=i,a=0;a<8;a++)n=0!=(1&n)?3988292384^n>>>1:n>>>1;r[i]=n}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Frame=t.APNG=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(e){return e&&e.__esModule?e:{default:e}}(r(3));function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.APNG=function(){function e(){a(this,e),this.width=0,this.height=0,this.numPlays=0,this.playTime=0,this.frames=[]}return i(e,[{key:"createImages",value:function(){return Promise.all(this.frames.map((function(e){return e.createImage()})))}},{key:"getPlayer",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.createImages().then((function(){return new n.default(t,e,r)}))}}]),e}(),t.Frame=function(){function e(){a(this,e),this.left=0,this.top=0,this.width=0,this.height=0,this.delay=0,this.disposeOp=0,this.blendOp=0,this.imageData=null,this.imageElement=null}return i(e,[{key:"createImage",value:function(){var e=this;return this.imageElement?Promise.resolve():new Promise((function(t,r){var i=URL.createObjectURL(e.imageData);e.imageElement=document.createElement("img"),e.imageElement.onload=function(){URL.revokeObjectURL(i),t()},e.imageElement.onerror=function(){URL.revokeObjectURL(i),e.imageElement=null,r(new Error("Image creation error"))},e.imageElement.src=i}))}}]),e}()},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();var n=function(e){function t(e,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.playbackRate=1,n._currentFrameNumber=0,n._ended=!1,n._paused=!0,n._numPlays=0,n._apng=e,n.context=r,n.stop(),i&&n.play(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"renderNextFrame",value:function(){this._currentFrameNumber=(this._currentFrameNumber+1)%this._apng.frames.length,this._currentFrameNumber===this._apng.frames.length-1&&(this._numPlays++,0!==this._apng.numPlays&&this._numPlays>=this._apng.numPlays&&(this._ended=!0,this._paused=!0)),this._prevFrame&&1==this._prevFrame.disposeOp?this.context.clearRect(this._prevFrame.left,this._prevFrame.top,this._prevFrame.width,this._prevFrame.height):this._prevFrame&&2==this._prevFrame.disposeOp&&this.context.putImageData(this._prevFrameData,this._prevFrame.left,this._prevFrame.top);var e=this.currentFrame;this._prevFrame=e,this._prevFrameData=null,2==e.disposeOp&&(this._prevFrameData=this.context.getImageData(e.left,e.top,e.width,e.height)),0==e.blendOp&&this.context.clearRect(e.left,e.top,e.width,e.height),this.context.drawImage(e.imageElement,e.left,e.top),this.emit("frame",this._currentFrameNumber),this._ended&&this.emit("end")}},{key:"play",value:function(){var e=this;this.emit("play"),this._ended&&this.stop(),this._paused=!1;var t=performance.now()+this.currentFrame.delay/this.playbackRate;requestAnimationFrame((function r(i){if(!e._ended&&!e._paused){if(i>=t){for(;i-t>=e._apng.playTime/e.playbackRate;)t+=e._apng.playTime/e.playbackRate,e._numPlays++;do{e.renderNextFrame(),t+=e.currentFrame.delay/e.playbackRate}while(!e._ended&&i>t)}requestAnimationFrame(r)}}))}},{key:"pause",value:function(){this._paused||(this.emit("pause"),this._paused=!0)}},{key:"stop",value:function(){this.emit("stop"),this._numPlays=0,this._ended=!1,this._paused=!0,this._currentFrameNumber=-1,this.context.clearRect(0,0,this._apng.width,this._apng.height),this.renderNextFrame()}},{key:"currentFrameNumber",get:function(){return this._currentFrameNumber}},{key:"currentFrame",get:function(){return this._apng.frames[this._currentFrameNumber]}},{key:"paused",get:function(){return this._paused}},{key:"ended",get:function(){return this._ended}}]),t}(function(e){return e&&e.__esModule?e:{default:e}}(r(4)).default);t.default=n},function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function n(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,r,s,o,u,h;if(this._events||(this._events={}),"error"===e&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(a(r=this._events[e]))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),r.apply(this,o)}else if(n(r))for(o=Array.prototype.slice.call(arguments,1),s=(h=r.slice()).length,u=0;u<s;u++)h[u].apply(this,o);return!0},r.prototype.addListener=function(e,t){var s;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?n(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,n(this._events[e])&&!this._events[e].warned&&(s=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var r=!1;function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var r,a,s,o;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(r=this._events[e]).length,a=-1,r===t||i(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(n(r)){for(o=s;o-- >0;)if(r[o]===t||r[o].listener&&r[o].listener===t){a=o;break}if(a<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}}])},Fe.exports=Ze();var Oe=(0,be.g)(Fe.exports),Se=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){return(0,o.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"_loadAnimation",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Pe(t,r,n));case 1:case"end":return e.stop()}}),e)})));return function(t,r,i){return e.apply(this,arguments)}}()}],[{key:"create",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n,a,s,o){var u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=new r(s),e.prev=1,e.next=4,u._load(t,n,a,o);case 4:e.next=10;break;case 6:if(e.prev=6,e.t0=e.catch(1),(0,W.D_)(e.t0)){e.next=10;break}return e.abrupt("return",new p.Z("invalid-resource","Could not load PNG: ".concat(e.t0.message)));case 10:return e.abrupt("return",u);case 11:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,r,i,n,a){return e.apply(this,arguments)}}()}]),r}(Ce);function Pe(e,t,r){return Ae.apply(this,arguments)}function Ae(){return Ae=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){var a,o,u,h,l,c,d,f,p,_,m,v,g,y;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((a=Oe(t))instanceof Error)){e.next=3;break}throw a;case 3:return e.next=5,a.createImages();case 5:(0,W.k_)(n),o=a.frames,u=a.width,h=a.height,(l=document.createElement("canvas")).width=u,l.height=h,c=l.getContext("2d"),d=[],f=[],p=(0,s.Z)(o);try{for(p.s();!(_=p.n()).done;)m=_.value,f.push((0,we.HA)(m.delay)),v=m.imageElement,0===m.blendOp?c.globalCompositeOperation="copy":c.globalCompositeOperation="source-over",g=2===m.disposeOp&&c.getImageData(m.left,m.top,m.width,m.height),c.drawImage(v,m.left,m.top),y=c.getImageData(0,0,u,h),d.push(y),0===m.disposeOp||(1===m.disposeOp?c.clearRect(m.left,m.top,m.width,m.height):2===m.disposeOp&&c.putImageData(g,m.left,m.top))}catch(i){p.e(i)}finally{p.f()}return e.abrupt("return",{frameDurations:f,selectFrame:function(e){var t=d[e];r(t)},width:u,height:h});case 12:case"end":return e.stop()}}),e)}))),Ae.apply(this,arguments)}var ze=[137,80,78,71,13,10,26,10];function Ue(e){var t=new Uint8Array(e);return!ze.some((function(e,r){return e!==t[r]}))}function Ie(e){if(!Ue(e))return!1;var t,r=new DataView(e),i=new Uint8Array(e),n=8;do{var a=r.getUint32(n);if("acTL"===(t=String.fromCharCode.apply(String,Array.prototype.slice.call(i.subarray(n+4,n+8)))))return!0;n+=12+a}while("IEND"!==t&&n<i.length);return!1}var De=r(91958),Le={},Ne={},Ge={};Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.loop=Ge.conditional=Ge.parse=void 0;Ge.parse=function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i;if(Array.isArray(r))r.forEach((function(r){return e(t,r,i,n)}));else if("function"==typeof r)r(t,i,n,e);else{var a=Object.keys(r)[0];Array.isArray(r[a])?(n[a]={},e(t,r[a],i,n[a])):n[a]=r[a](t,i,n,e)}return i};Ge.conditional=function(e,t){return function(r,i,n,a){t(r,i,n)&&a(r,e,i,n)}};Ge.loop=function(e,t){return function(r,i,n,a){for(var s=[],o=r.pos;t(r,i,n);){var u={};if(a(r,e,i,u),r.pos===o)break;o=r.pos,s.push(u)}return s}};var Ve={};Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.readBits=Ve.readArray=Ve.readUnsigned=Ve.readString=Ve.peekBytes=Ve.readBytes=Ve.peekByte=Ve.readByte=Ve.buildStream=void 0;Ve.buildStream=function(e){return{data:e,pos:0}};var He=function(){return function(e){return e.data[e.pos++]}};Ve.readByte=He;Ve.peekByte=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(t){return t.data[t.pos+e]}};var qe=function(e){return function(t){return t.data.subarray(t.pos,t.pos+=e)}};Ve.readBytes=qe;Ve.peekBytes=function(e){return function(t){return t.data.subarray(t.pos,t.pos+e)}};Ve.readString=function(e){return function(t){return Array.from(qe(e)(t)).map((function(e){return String.fromCharCode(e)})).join("")}};Ve.readUnsigned=function(e){return function(t){var r=qe(2)(t);return e?(r[1]<<8)+r[0]:(r[0]<<8)+r[1]}};Ve.readArray=function(e,t){return function(r,i,n){for(var a="function"==typeof t?t(r,i,n):t,s=qe(e),o=new Array(a),u=0;u<a;u++)o[u]=s(r);return o}};Ve.readBits=function(e){return function(t){for(var r=function(e){return e.data[e.pos++]}(t),i=new Array(8),n=0;n<8;n++)i[7-n]=!!(r&1<<n);return Object.keys(e).reduce((function(t,r){var n=e[r];return n.length?t[r]=function(e,t,r){for(var i=0,n=0;n<r;n++)i+=e[t+n]&&Math.pow(2,r-n-1);return i}(i,n.index,n.length):t[r]=i[n.index],t}),{})}},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=Ge,r=Ve,i={blocks:function(e){for(var t=[],i=e.data.length,n=0,a=(0,r.readByte)()(e);0!==a&&a;a=(0,r.readByte)()(e)){if(e.pos+a>=i){var s=i-e.pos;t.push((0,r.readBytes)(s)(e)),n+=s;break}t.push((0,r.readBytes)(a)(e)),n+=a}for(var o=new Uint8Array(n),u=0,h=0;h<t.length;h++)o.set(t[h],u),u+=t[h].length;return o}},n=(0,t.conditional)({gce:[{codes:(0,r.readBytes)(2)},{byteSize:(0,r.readByte)()},{extras:(0,r.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,r.readUnsigned)(!0)},{transparentColorIndex:(0,r.readByte)()},{terminator:(0,r.readByte)()}]},(function(e){var t=(0,r.peekBytes)(2)(e);return 33===t[0]&&249===t[1]})),a=(0,t.conditional)({image:[{code:(0,r.readByte)()},{descriptor:[{left:(0,r.readUnsigned)(!0)},{top:(0,r.readUnsigned)(!0)},{width:(0,r.readUnsigned)(!0)},{height:(0,r.readUnsigned)(!0)},{lct:(0,r.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,t.conditional)({lct:(0,r.readArray)(3,(function(e,t,r){return Math.pow(2,r.descriptor.lct.size+1)}))},(function(e,t,r){return r.descriptor.lct.exists})),{data:[{minCodeSize:(0,r.readByte)()},i]}]},(function(e){return 44===(0,r.peekByte)()(e)})),s=(0,t.conditional)({text:[{codes:(0,r.readBytes)(2)},{blockSize:(0,r.readByte)()},{preData:function(e,t,i){return(0,r.readBytes)(i.text.blockSize)(e)}},i]},(function(e){var t=(0,r.peekBytes)(2)(e);return 33===t[0]&&1===t[1]})),o=(0,t.conditional)({application:[{codes:(0,r.readBytes)(2)},{blockSize:(0,r.readByte)()},{id:function(e,t,i){return(0,r.readString)(i.blockSize)(e)}},i]},(function(e){var t=(0,r.peekBytes)(2)(e);return 33===t[0]&&255===t[1]})),u=(0,t.conditional)({comment:[{codes:(0,r.readBytes)(2)},i]},(function(e){var t=(0,r.peekBytes)(2)(e);return 33===t[0]&&254===t[1]})),h=[{header:[{signature:(0,r.readString)(3)},{version:(0,r.readString)(3)}]},{lsd:[{width:(0,r.readUnsigned)(!0)},{height:(0,r.readUnsigned)(!0)},{gct:(0,r.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,r.readByte)()},{pixelAspectRatio:(0,r.readByte)()}]},(0,t.conditional)({gct:(0,r.readArray)(3,(function(e,t){return Math.pow(2,t.lsd.gct.size+1)}))},(function(e,t){return t.lsd.gct.exists})),{frames:(0,t.loop)([n,o,u,a,s],(function(e){var t=(0,r.peekByte)()(e);return 33===t||44===t}))}];e.default=h}(Ne);var je={};Object.defineProperty(je,"__esModule",{value:!0}),je.deinterlace=void 0;je.deinterlace=function(e,t){for(var r=new Array(e.length),i=e.length/t,n=function(i,n){var a=e.slice(n*t,(n+1)*t);r.splice.apply(r,[i*t,t].concat(a))},a=[0,4,2,1],s=[8,8,4,2],o=0,u=0;u<4;u++)for(var h=a[u];h<i;h+=s[u])n(h,o),o++;return r};var We={};Object.defineProperty(We,"__esModule",{value:!0}),We.lzw=void 0;We.lzw=function(e,t,r){var i,n,a,s,o,u,h,l,c,d,f,p,_,m,v,g,y=4096,b=r,w=new Array(r),x=new Array(y),T=new Array(y),k=new Array(y+1);for(o=1+(n=1<<(d=e)),i=n+2,h=-1,a=(1<<(s=d+1))-1,l=0;l<n;l++)x[l]=0,T[l]=l;for(f=p=_=m=v=g=0,c=0;c<b;){if(0===m){if(p<s){f+=t[g]<<p,p+=8,g++;continue}if(l=f&a,f>>=s,p-=s,l>i||l==o)break;if(l==n){a=(1<<(s=d+1))-1,i=n+2,h=-1;continue}if(-1==h){k[m++]=T[l],h=l,_=l;continue}for(u=l,l==i&&(k[m++]=_,l=h);l>n;)k[m++]=T[l],l=x[l];_=255&T[l],k[m++]=_,i<y&&(x[i]=h,T[i]=_,0==(++i&a)&&i<y&&(s++,a+=i)),h=u}m--,w[v++]=k[m],c++}for(c=v;c<b;c++)w[c]=0;return w},Object.defineProperty(Le,"__esModule",{value:!0});var Xe=Le.decompressFrames=Le.decompressFrame=et=Le.parseGIF=void 0,Ye=function(e){return e&&e.__esModule?e:{default:e}}(Ne),Qe=Ge,Ke=Ve,$e=je,Je=We;var et=Le.parseGIF=function(e){var t=new Uint8Array(e);return(0,Qe.parse)((0,Ke.buildStream)(t),Ye.default)},tt=function(e,t,r){if(e.image){var i=e.image,n=i.descriptor.width*i.descriptor.height,a=(0,Je.lzw)(i.data.minCodeSize,i.data.blocks,n);i.descriptor.lct.interlaced&&(a=(0,$e.deinterlace)(a,i.descriptor.width));var s={pixels:a,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return i.descriptor.lct&&i.descriptor.lct.exists?s.colorTable=i.lct:s.colorTable=t,e.gce&&(s.delay=10*(e.gce.delay||10),s.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(s.transparentIndex=e.gce.transparentColorIndex)),r&&(s.patch=function(e){for(var t=e.pixels.length,r=new Uint8ClampedArray(4*t),i=0;i<t;i++){var n=4*i,a=e.pixels[i],s=e.colorTable[a]||[0,0,0];r[n]=s[0],r[n+1]=s[1],r[n+2]=s[2],r[n+3]=a!==e.transparentIndex?255:0}return r}(s)),s}console.warn("gif frame does not have associated image.")};Le.decompressFrame=tt;Xe=Le.decompressFrames=function(e,t){return e.frames.filter((function(e){return e.image})).map((function(r){return tt(r,e.gct,t)}))};var rt=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){return(0,o.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"_loadAnimation",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",it(t,r));case 1:case"end":return e.stop()}}),e)})));return function(t,r,i){return e.apply(this,arguments)}}()}],[{key:"create",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n,a,s,o){var u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=new r(s),e.prev=1,e.next=4,u._load(t,n,a,o);case 4:e.next=10;break;case 6:if(e.prev=6,e.t0=e.catch(1),(0,W.D_)(e.t0)){e.next=10;break}return e.abrupt("return",new p.Z("invalid-resource","Could not load GIF: ".concat(e.t0.message)));case 10:return e.abrupt("return",u);case 11:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,r,i,n,a){return e.apply(this,arguments)}}()}]),r}(Ce);function it(e,t,r){return nt.apply(this,arguments)}function nt(){return nt=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){var a,o,u,h,l,c,d,f,p,_,m,v,g,y,b,w;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=et(t),o=Xe(a,!0),u=a.lsd,h=u.width,l=u.height,(c=document.createElement("canvas")).width=h,c.height=l,d=c.getContext("2d"),f=[],p=[],_=(0,s.Z)(o);try{for(_.s();!(m=_.n()).done;)v=m.value,p.push((0,we.HA)(v.delay)),g=new ImageData(v.patch,v.dims.width,v.dims.height),y=(0,De.E0)(g),b=3===v.disposalType&&d.getImageData(v.dims.left,v.dims.top,v.dims.width,v.dims.height),d.drawImage(y,v.dims.left,v.dims.top),w=d.getImageData(0,0,h,l),f.push(w),1===v.disposalType||(2===v.disposalType?d.clearRect(v.dims.left,v.dims.top,v.dims.width,v.dims.height):3===v.disposalType&&d.putImageData(b,v.dims.left,v.dims.top))}catch(i){_.e(i)}finally{_.f()}return e.abrupt("return",{frameDurations:p,selectFrame:function(e){var t=f[e];r(t)},width:h,height:l});case 6:case"end":return e.stop()}}),e)}))),nt.apply(this,arguments)}var at=[71,73,70];function st(e){var t=new Uint8Array(e);return!at.some((function(e,r){return e!==t[r]}))}function ot(e){if(!st(e))return!1;for(var t=new DataView(e),r=t.getUint8(10),i=13+(128&r?3*Math.pow(2,1+(7&r)):0),n=0,a=!1;!a;){switch(t.getUint8(i++)){case 33:if(!s())return!1;break;case 44:o();break;case 59:a=!0;break;default:return!1}if(n>1)return!0}function s(){switch(t.getUint8(i++)){case 249:i++,i+=4,u();break;case 1:n++,i++,i+=12,u();break;case 254:u();break;case 255:i++,i+=8,i+=3,u();break;default:return!1}return!0}function o(){n++,i+=8;var e=t.getUint8(i++);i+=128&e?3*Math.pow(2,1+(7&e)):0,i++,u()}function u(){for(var e;e=t.getUint8(i++);)i+=e}return!1}var ut=r(55940);function ht(e){switch(e.type){case"esriSMS":return"".concat(e.style,".").concat(e.path);case"esriSLS":return"".concat(e.style,".").concat(e.cap);case"esriSFS":return"".concat(e.style);case"esriPFS":case"esriPMS":return e.imageData?"".concat(e.imageData).concat(e.width).concat(e.height):"".concat(e.url).concat(e.width).concat(e.height);default:return"mosaicHash"in e?e.mosaicHash:JSON.stringify(e)}}var lt=r(38164),ct=(0,Q.c)(),dt="arial-unicode-ms-regular",ft=j.Z.getLogger("esri.views.2d.engine.webgl.TextureManager");function pt(e,t){return _t.apply(this,arguments)}function _t(){return _t=(0,a.Z)((0,i.Z)().mark((function e(t,r){var a,s,o,u,h,l,c,d,f,_;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(0,ye.Gr)(t),o=";base64,",!a.includes(o)){e.next=8;break}for(u=a.indexOf(o)+o.length,h=a.substring(u),l=atob(h),c=new Uint8Array(l.length),d=0;d<l.length;d++)c[d]=l.charCodeAt(d);s=c.buffer,e.next=20;break;case 8:return e.prev=8,e.next=11,(0,H.default)(a,(0,n.Z)({responseType:"array-buffer"},r));case 11:f=e.sent,_=f.data,s=_,e.next=20;break;case 16:if(e.prev=16,e.t0=e.catch(8),(0,W.D_)(e.t0)){e.next=20;break}return e.abrupt("return",new p.Z("mapview-invalid-resource","Could not fetch requested resource at ".concat(a)));case 20:return e.abrupt("return",s);case 21:case"end":return e.stop()}}),e,null,[[8,16]])}))),_t.apply(this,arguments)}function mt(e,t){var r=Math.round((0,X.F2)(t)*window.devicePixelRatio),i=r>=128?2:4;return Math.min(e,r*i)}var vt=function(e,t,r){return ft.error(new p.Z(e,t,r))},gt=function(){function e(t,r,i){(0,o.Z)(this,e),this.mosaicType=t,this.page=r,this.sdf=i}return(0,u.Z)(e,null,[{key:"fromMosaic",value:function(t,r){return new e(t,r.page,r.sdf)}}]),e}(),yt=function(){function e(t,r){(0,o.Z)(this,e),this._requestRender=t,this.resourceManager=r,this._invalidFontsMap=new Map,this._sdfConverter=new fe(126),this._bindingInfos=new Array,this._hashToBindingIndex=new Map,this._ongoingRasterizations=new Map,this._imageRequestQueue=new lt.e({concurrency:10,process:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,W.k_)(r),e.prev=1,e.next=4,(0,H.default)(t,{responseType:"image",signal:r});case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),(0,W.D_)(e.t0)){e.next=11;break}throw new p.Z("mapview-invalid-resource","Could not fetch requested resource at ".concat(t),e.t0);case 11:throw e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,r){return e.apply(this,arguments)}}()}),this._spriteMosaic=new ve(2048,2048,500),this._glyphSource=new le("".concat(V.Z.fontsUrl,"/{fontstack}/{range}.pbf")),this._glyphMosaic=new se(1024,1024,this._glyphSource),this._rasterizer=new K.Z(r)}return(0,u.Z)(e,[{key:"dispose",value:function(){this._spriteMosaic.dispose(),this._glyphMosaic.dispose(),this._rasterizer.dispose(),this._sdfConverter.dispose(),this._spriteMosaic=null,this._glyphMosaic=null,this._sdfConverter=null,this._hashToBindingIndex.clear(),this._hashToBindingIndex=null,this._bindingInfos=null,this._ongoingRasterizations.clear(),this._ongoingRasterizations=null,this._imageRequestQueue.clear(),this._imageRequestQueue=null}},{key:"sprites",get:function(){return this._spriteMosaic}},{key:"glyphs",get:function(){return this._glyphMosaic}},{key:"rasterizeItem",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n,a){var s,o,u=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,v.Wi)(t)){e.next=2;break}return e.abrupt("return",(vt("mapview-null-resource","Unable to rasterize null resource"),null));case 2:e.t0=t.type,e.next="text"===e.t0||"esriTS"===e.t0?5:9;break;case 5:return e.next=7,this._rasterizeText(t,n,a);case 7:return s=e.sent,e.abrupt("return",(s.forEach((function(e){return u._setTextureBinding(T.Un.GLYPH,e)})),{glyphMosaicItems:s}));case 9:if(!(0,ye.Ll)(t)){e.next=11;break}return e.abrupt("return",(vt("mapview-invalid-type","MapView does not support symbol type: ".concat(t.type),t),null));case 11:return e.next=13,this._rasterizeSpriteSymbol(t,r,a);case 13:return o=e.sent,e.abrupt("return",((0,ut.ok)(o)&&o&&this._setTextureBinding(T.Un.SPRITE,o),{spriteMosaicItem:o}));case 15:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n){return e.apply(this,arguments)}}()},{key:"bindTextures",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(0!==r.textureBinding){var n=this._bindingInfos[r.textureBinding-1],a=n.page,s=i?C.cw.LINEAR_MIPMAP_LINEAR:C.cw.LINEAR;switch(n.mosaicType){case T.Un.SPRITE:var o=this.sprites.getWidth(a),u=this.sprites.getHeight(a),h=(0,Y.a)(ct,o,u);return this._spriteMosaic.bind(e,s,a,$.D3),t.setUniform1i("u_texture",$.D3),void t.setUniform2fv("u_mosaicSize",h);case T.Un.GLYPH:var l=this.glyphs.width,c=this.glyphs.height,d=(0,Y.a)(ct,l,c);return this._glyphMosaic.bind(e,s,a,$.Al),t.setUniform1i("u_texture",$.Al),void t.setUniform2fv("u_mosaicSize",d);default:ft.error("mapview-texture-manager","Cannot handle unknown type ".concat(n.mosaicType))}}}},{key:"_hashMosaic",value:function(e,t){return 1|e<<1|(t.sdf?1:0)<<2|t.page<<3}},{key:"_setTextureBinding",value:function(e,t){var r=this._hashMosaic(e,t);if(!this._hashToBindingIndex.has(r)){var i=gt.fromMosaic(e,t),n=this._bindingInfos.length+1;this._hashToBindingIndex.set(r,n),this._bindingInfos.push(i)}t.textureBinding=this._hashToBindingIndex.get(r)}},{key:"_rasterizeText",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){var a,s,o,u,h,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"cim"in t?(a=(o=t).fontName,s=o.text):(u=t,a=(0,J.Yc)(u.font),s=u.text),h=this._invalidFontsMap.has(a),l=r||(0,ye.Jq)((0,q.E)(s)[0]),e.prev=2,e.next=5,this._glyphMosaic.getGlyphItems(h?dt:a,l,n);case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",(vt("mapview-invalid-resource","Couldn't find font ".concat(a,". Falling back to Arial Unicode MS Regular")),this._invalidFontsMap.set(a,!0),this._glyphMosaic.getGlyphItems(dt,l,n)));case 11:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_rasterizeSpriteSymbol",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){var a,s,o,u,h,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,ye.Gg)(t)){e.next=2;break}return e.abrupt("return",null);case 2:if(a=ht(t),!this._spriteMosaic.has(a)){e.next=5;break}return e.abrupt("return",this._spriteMosaic.getSpriteItem(a));case 5:if(!((0,ye.sG)(t)||(0,ye.HX)(t)&&!(0,ye.yP)(t))){e.next=7;break}return e.abrupt("return",this._handleAsyncResource(a,t,n));case 7:if(1,!(s=this._rasterizer.rasterizeJSONResource(t,1))){e.next=11;break}return o=s.size,u=s.image,h=s.sdf,l=s.simplePattern,e.abrupt("return",this._addItemToMosaic(a,o,{type:"static",data:u},(0,ye.js)(t),h,l));case 11:return e.abrupt("return",new p.Z("TextureManager","unrecognized or null rasterized image"));case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_handleAsyncResource",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){var a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._ongoingRasterizations.has(t)){e.next=2;break}return e.abrupt("return",this._ongoingRasterizations.get(t));case 2:return a=(0,ye.sG)(r)?this._handleSVG(r,t,n):this._handleImage(r,t,n),this._ongoingRasterizations.set(t,a),e.prev=3,e.next=6,a;case 6:this._ongoingRasterizations.delete(t),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),this._ongoingRasterizations.delete(t);case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_handleSVG",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){var a,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[126,126],e.next=3,this._sdfConverter.draw(t.path,n);case 3:return s=e.sent,e.abrupt("return",this._addItemToMosaic(r,a,{type:"static",data:new Uint32Array(s.buffer)},!1,!0,!0));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_handleGIFOrPNG",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){var a,s,o,u,h,l,c,d,f,_,m,v,g,y,b;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pt(t,n);case 2:if(a=e.sent,!(0,ut.ok)(a)){e.next=37;break}if(s=st(a),o=Ue(a),s||o){e.next=7;break}return e.abrupt("return",new p.Z("mapview-invalid-resource","Image data is neither GIF nor PNG!"));case 7:if(e.prev=7,h=t.animatedSymbolProperties||{},l=t.objectId,!s||!ot(a)){e.next=15;break}return e.next=12,rt.create(a,h,l,this._requestRender,n);case 12:u=e.sent,e.next=20;break;case 15:if(e.t0=o&&Ie(a),!e.t0){e.next=20;break}return e.next=19,Se.create(a,h,l,this._requestRender,n);case 19:u=e.sent;case 20:e.next=26;break;case 22:if(e.prev=22,e.t1=e.catch(7),(0,W.D_)(e.t1)){e.next=26;break}return e.abrupt("return",new p.Z("mapview-invalid-resource","Could not fetch requested resource!"));case 26:if(!u||!(0,ut.ok)(u)){e.next=28;break}return e.abrupt("return",this._addItemToMosaic(r,[u.width,u.height],{type:"animated",data:u},(0,ye.js)(t),!1,!1));case 28:return c=new Blob([a],{type:s?"image/gif":"image/png"}),e.next=31,this._imageFromBlob(c);case 31:if(!((d=e.sent)&&d instanceof HTMLImageElement)){e.next=37;break}return f=d.width,_=d.height,"esriPMS"===t.type&&(f=Math.round(mt(d.width,(0,ye.Ub)(t))),_=Math.round(d.height*(f/d.width))),m="cim"in t?t.cim.colorSubstitutions:void 0,v=this._rasterizer.rasterizeImageResource(f,_,d,m),g=v.size,y=v.sdf,b=v.image,e.abrupt("return",this._addItemToMosaic(r,g,{type:"static",data:b},(0,ye.js)(t),y,!1));case 37:return e.abrupt("return",new p.Z("mapview-invalid-resource","Could not handle resource!"));case 38:case"end":return e.stop()}}),e,this,[[7,22]])})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_handleImage",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,a){var s,o,u,h,l,c,d,f,_,m,g,y,b,w;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,ye.DQ)(t)&&!(0,ye.iw)(t)){e.next=2;break}return e.abrupt("return",this._handleGIFOrPNG(t,r,a));case 2:if(s=(0,ye.Gr)(t),e.prev=3,u=this.resourceManager.getResource(s),!(0,v.pC)(u)){e.next=9;break}o=u,e.next=14;break;case 9:return e.next=11,this._imageRequestQueue.push(s,(0,n.Z)({},a));case 11:h=e.sent,l=h.data,o=l;case 14:if((0,ye.TB)(s)&&("width"in t&&"height"in t?(o.width=(0,X.F2)(t.width),o.height=(0,X.F2)(t.height)):"cim"in t&&(d=t.cim,o.width=(0,X.F2)(null!==(c=d.width)&&void 0!==c?c:d.scaleX*d.size),o.height=(0,X.F2)(d.size))),o.width&&o.height){e.next=17;break}return e.abrupt("return",null);case 17:return f=o.width,_=o.height,"esriPMS"===t.type&&(f=Math.round(mt(o.width,(0,ye.Ub)(t))),_=Math.round(o.height*(f/o.width))),m="cim"in t?t.cim.colorSubstitutions:void 0,g=this._rasterizer.rasterizeImageResource(f,_,o,m),y=g.size,b=g.sdf,w=g.image,e.abrupt("return",this._addItemToMosaic(r,y,{type:"static",data:w},(0,ye.js)(t),b,!1));case 23:if(e.prev=23,e.t0=e.catch(3),(0,W.D_)(e.t0)){e.next=27;break}return e.abrupt("return",new p.Z("mapview-invalid-resource","Could not fetch requested resource at ".concat(s,". ").concat(e.t0.message)));case 27:case"end":return e.stop()}}),e,this,[[3,23]])})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_imageFromBlob",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=window.URL.createObjectURL(t),e.prev=1,e.next=4,this._imageRequestQueue.push(r);case 4:return n=e.sent,a=n.data,e.abrupt("return",(window.URL.revokeObjectURL(r),a));case 9:if(e.prev=9,e.t0=e.catch(1),window.URL.revokeObjectURL(r),(0,W.D_)(e.t0)){e.next=13;break}return e.abrupt("return",new p.Z("mapview-invalid-resource","Could not fetch requested resource at ".concat(r)));case 13:throw e.t0;case 14:case"end":return e.stop()}}),e,this,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_addItemToMosaic",value:function(e,t,r,i,n,a){return this._spriteMosaic.addSpriteItem(e,t,r,i,n,a)}}]),e}(),bt=r(26277),wt=r(22753),xt=r(6394),Tt=r(11186),kt=r(71353),Et=r(25866),Mt={shaders:{vertexShader:(0,B.w)("stencil/stencil.vert"),fragmentShader:(0,B.w)("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])},Bt=(0,xt.f)(-.5,-.5),Rt=function(){function e(){(0,o.Z)(this,e),this._centerNdc=(0,kt.c)(),this._pxToNdc=(0,kt.c)(),this._worldDimensionsPx=(0,kt.c)(),this._mat3=(0,b.c)(),this._initialized=!1}return(0,u.Z)(e,[{key:"dispose",value:function(){this._program=(0,v.O3)(this._program),this._quad=(0,v.O3)(this._quad)}},{key:"render",value:function(e,t){var r=e.context;return!!this._updateGeometry(e,t)&&(this._initialized||this._initialize(r),r.setDepthWriteEnabled(!1),r.setDepthTestEnabled(!1),r.setColorMask(!1,!1,!1,!1),r.setBlendingEnabled(!1),r.setStencilOp(C.xS.KEEP,C.xS.KEEP,C.xS.REPLACE),r.setStencilFunction(C.wb.ALWAYS,1,255),r.setStencilTestEnabled(!0),r.useProgram(this._program),this._program.setUniformMatrix3fv("u_worldExtent",this._mat3),this._quad.draw(),this._quad.unbind(),!0)}},{key:"_initialize",value:function(e){if(!this._initialized){var t=(0,F.H)(e,Mt);t&&(this._program=t,this._quad=new Et.Z(e,[0,0,1,0,0,1,1,1]),this._initialized=!0)}}},{key:"_updateGeometry",value:function(e,t){var r=e.state,i=e.pixelRatio,n=r.size,a=r.rotation,s=Math.round(n[0]*i),o=Math.round(n[1]*i);if(!r.spatialReference.isWrappable)return!1;var u=(0,bt.t)(a),h=Math.abs(Math.cos(u)),l=Math.abs(Math.sin(u)),c=Math.round(s*h+o*l),d=Math.round(r.worldScreenWidth);if(c<=d)return!1;var f=s*l+o*h,p=d*i,_=(t.left-t.right)*i/s,m=(t.bottom-t.top)*i/o;(0,Tt.s)(this._worldDimensionsPx,p,f,1),(0,Tt.s)(this._pxToNdc,2/s,-2/o,1),(0,Tt.s)(this._centerNdc,_,m,1);var v=this._mat3;return(0,wt.h)(v,this._centerNdc),(0,wt.d)(v,v,this._pxToNdc),0!==a&&(0,wt.r)(v,v,u),(0,wt.d)(v,v,this._worldDimensionsPx),(0,wt.c)(v,v,Bt),!0}}]),e}(),Zt=function(){function e(){(0,o.Z)(this,e),this.name=this.constructor.name}return(0,u.Z)(e,[{key:"createOptions",value:function(e,t){return null}}]),e}(),Ct=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.apply(this,arguments)).defines=[],e._desc={vsPath:"fx/integrate",fsPath:"fx/integrate",attributes:new Map([["a_position",0]])},e}return(0,u.Z)(r,[{key:"dispose",value:function(){this._quad&&this._quad.dispose()}},{key:"bind",value:function(){}},{key:"unbind",value:function(){}},{key:"draw",value:function(e,t){if(t.size){var r=e.context,i=e.renderingOptions;this._quad||(this._quad=new Et.Z(r,[0,0,1,0,0,1,1,1]));var n=r.getBoundFramebufferObject(),a=r.getViewport(),s=a.x,o=a.y,u=a.width,h=a.height;t.bindTextures(r);var l=t.getBlock($.xl);if(!(0,v.Wi)(l)){var c=l.getFBO(r),d=l.getFBO(r,1);r.setViewport(0,0,t.size,t.size),this._computeDelta(e,d,i.labelsAnimationTime),this._updateAnimationState(e,d,c),r.bindFramebuffer(n),r.setViewport(s,o,u,h)}}}},{key:"_computeDelta",value:function(e,t,r){var i=e.context,n=e.painter,a=e.displayLevel,s=n.materialManager.getProgram(this._desc,["delta"]);i.bindFramebuffer(t),i.setClearColor(0,0,0,0),i.clear(i.gl.COLOR_BUFFER_BIT),i.useProgram(s),s.setUniform1i("u_maskTexture",$.iJ),s.setUniform1i("u_sourceTexture",$.nM),s.setUniform1f("u_timeDelta",e.deltaTime),s.setUniform1f("u_animationTime",r),s.setUniform1f("u_zoomLevel",Math.round(10*a)),this._quad.draw()}},{key:"_updateAnimationState",value:function(e,t,r){var i=e.context,n=e.painter.materialManager.getProgram(this._desc,["update"]);i.bindTexture(t.colorTexture,1),i.useProgram(n),n.setUniform1i("u_sourceTexture",1),i.bindFramebuffer(r),i.setClearColor(0,0,0,0),i.clear(i.gl.COLOR_BUFFER_BIT),this._quad.draw()}}]),r}(Zt),Ft=function(e){return"#define ".concat(function(e){return e.replace("-","_").toUpperCase()}(e),"\n")};function Ot(e){return{attributes:new Map([["a_pos",0],["a_tex",1]]),shaders:{vertexShader:Ft(e)+(0,B.w)("blend/blend.vert"),fragmentShader:Ft(e)+(0,B.w)("blend/blend.frag")}}}var St=j.Z.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect"),Pt=function(){function e(){(0,o.Z)(this,e),this._size=[0,0]}return(0,u.Z)(e,[{key:"dispose",value:function(e){this._backBufferTexture=(0,v.O3)(this._backBufferTexture),this._quad=(0,v.O3)(this._quad)}},{key:"draw",value:function(e,t,r,i,n){var a=e.context,s=e.drawPhase;if(this._setupShader(a),i&&"normal"!==i&&s!==T.jx.LABEL)this._drawBlended(e,t,r,i,n);else{var o=Ot("normal"),u=a.programCache.acquire(o.shaders.vertexShader,o.shaders.fragmentShader,o.attributes);if(u){a.useProgram(u),t.setSamplingMode(r),a.bindTexture(t,0),u.setUniform1i("u_layerTexture",0),u.setUniform1f("u_opacity",n),a.setBlendingEnabled(!0),a.setBlendFunction(C.zi.ONE,C.zi.ONE_MINUS_SRC_ALPHA);var h=this._quad;h.draw(),h.unbind(),u.dispose()}else St.error(new p.Z("mapview-BlendEffect",'Error creating shader program for blend mode "normal"'))}}},{key:"_drawBlended",value:function(e,t,r,i,n){var a,s,o=e.context,u=e.state,h=e.pixelRatio,l=e.inFadeTransition,c=u.size,d=o.getBoundFramebufferObject();if((0,v.pC)(d)){var f=d.descriptor;a=f.width,s=f.height}else a=Math.round(h*c[0]),s=Math.round(h*c[1]);this._createOrResizeTexture(e,a,s);var _=this._backBufferTexture;d.copyToTexture(0,0,a,s,0,0,_),o.setStencilTestEnabled(!1),o.setStencilWriteMask(0),o.setBlendingEnabled(!0),o.setDepthTestEnabled(!1),o.setDepthWriteEnabled(!1);var m=Ot(i),g=o.programCache.acquire(m.shaders.vertexShader,m.shaders.fragmentShader,m.attributes);if(g){o.useProgram(g),_.setSamplingMode(r),o.bindTexture(_,0),g.setUniform1i("u_backbufferTexture",0),t.setSamplingMode(r),o.bindTexture(t,1),g.setUniform1i("u_layerTexture",1),g.setUniform1f("u_opacity",n),g.setUniform1f("u_inFadeOpacity",l?1:0),o.setBlendFunction(C.zi.ONE,C.zi.ZERO);var y=this._quad;y.draw(),y.unbind(),g.dispose(),o.setBlendFunction(C.zi.ONE,C.zi.ONE_MINUS_SRC_ALPHA)}else St.error(new p.Z("mapview-BlendEffect","Error creating shader program for blend mode ".concat(i)))}},{key:"_setupShader",value:function(e){this._quad||(this._quad=new Et.Z(e,[-1,-1,1,-1,-1,1,1,1]))}},{key:"_createOrResizeTexture",value:function(e,t,r){var i=e.context;null!==this._backBufferTexture&&t===this._size[0]&&r===this._size[1]||(this._backBufferTexture?this._backBufferTexture.resize(t,r):this._backBufferTexture=new re.x(i,{target:C.No.TEXTURE_2D,pixelFormat:C.VI.RGBA,internalFormat:C.VI.RGBA,dataType:C.Br.UNSIGNED_BYTE,wrapMode:C.e8.CLAMP_TO_EDGE,samplingMode:C.cw.LINEAR,flipped:!1,width:t,height:r}),this._size[0]=t,this._size[1]=r)}}]),e}(),At=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var i;return(0,o.Z)(this,r),(i=t.call(this)).name=i.constructor.name,i.defines=[e],i}return(0,u.Z)(r,[{key:"dispose",value:function(){}},{key:"bind",value:function(e){var t=e.context,r=e.painter;this._prev=t.getBoundFramebufferObject();var i=t.getViewport(),n=i.width,a=i.height,s=r.getFbos(n,a).effect0;t.bindFramebuffer(s),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}},{key:"unbind",value:function(){}},{key:"draw",value:function(e,t){var r,i=e.context,n=e.painter,a=n.getPostProcessingEffects(t),o=i.getBoundFramebufferObject(),u=(0,s.Z)(a);try{for(u.s();!(r=u.n()).done;){var h=r.value,l=h.postProcessingEffect,c=h.effect;l.draw(e,o,c)}}catch(d){u.e(d)}finally{u.f()}i.bindFramebuffer(this._prev),i.setStencilTestEnabled(!1),n.blitTexture(i,o.colorTexture,C.cw.NEAREST),i.setStencilTestEnabled(!0)}}]),r}(Zt),zt=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],Ut=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],It=256,Dt=1.3,Lt=.4,Nt=.4,Gt=0,Vt=j.Z.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");var Ht=[0,0,0,0],qt=function(){function e(){(0,o.Z)(this,e),this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:Gt,outlineWidth:Dt,innerHaloWidth:Nt,outerHaloWidth:Lt},this.shadeTexChanged=!0,this.texelData=new Uint8Array(1024),this.minMaxDistance=[0,0]}return(0,u.Z)(e,[{key:"setHighlightOptions",value:function(e){var t=this._convertedHighlightOptions;!function(e,t){t.fillColor[0]=e.color.r/255,t.fillColor[1]=e.color.g/255,t.fillColor[2]=e.color.b/255,t.fillColor[3]=e.color.a,e.haloColor?(t.outlineColor[0]=e.haloColor.r/255,t.outlineColor[1]=e.haloColor.g/255,t.outlineColor[2]=e.haloColor.b/255,t.outlineColor[3]=e.haloColor.a):(t.outlineColor[0]=t.fillColor[0],t.outlineColor[1]=t.fillColor[1],t.outlineColor[2]=t.fillColor[2],t.outlineColor[3]=t.fillColor[3]),t.fillColor[3]*=e.fillOpacity,t.outlineColor[3]*=e.haloOpacity,t.fillColor[0]*=t.fillColor[3],t.fillColor[1]*=t.fillColor[3],t.fillColor[2]*=t.fillColor[3],t.outlineColor[0]*=t.outlineColor[3],t.outlineColor[1]*=t.outlineColor[3],t.outlineColor[2]*=t.outlineColor[3],t.outlineWidth=Dt,t.outerHaloWidth=Lt,t.innerHaloWidth=Nt,t.outlinePosition=Gt}(e,t);var r,i=t.outlinePosition-t.outlineWidth/2-t.outerHaloWidth,n=t.outlinePosition-t.outlineWidth/2,a=t.outlinePosition+t.outlineWidth/2,s=t.outlinePosition+t.outlineWidth/2+t.innerHaloWidth,o=1*Math.sqrt(Math.PI/2),u=Math.abs(i)>o?Math.round(10*(Math.abs(i)-o))/10:0,h=Math.abs(s)>o?Math.round(10*(Math.abs(s)-o))/10:0;u&&!h?Vt.error("The outer rim of the highlight is "+u+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!u&&h?Vt.error("The inner rim of the highlight is "+h+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):u&&h&&Vt.error("The highlight is "+Math.max(u,h)+"px away from the edge of the feature; consider reducing some width values.");var l=[void 0,void 0,void 0,void 0];function c(e,t,r){l[0]=(1-r)*e[0]+r*t[0],l[1]=(1-r)*e[1]+r*t[1],l[2]=(1-r)*e[2]+r*t[2],l[3]=(1-r)*e[3]+r*t[3]}for(var d=this.texelData,f=0;f<It;++f){var p,_,m,v;(r=i+f/255*(s-i))<i?(l[4*f+0]=0,l[4*f+1]=0,l[4*f+2]=0,l[4*f+3]=0):r<n?c(Ht,t.outlineColor,(r-i)/(n-i)):r<a?(p=t.outlineColor,_=(0,pe.Z)(p,4),l[0]=_[0],l[1]=_[1],l[2]=_[2],l[3]=_[3]):r<s?c(t.outlineColor,t.fillColor,(r-a)/(s-a)):(m=t.fillColor,v=(0,pe.Z)(m,4),l[4*f+0]=v[0],l[4*f+1]=v[1],l[4*f+2]=v[2],l[4*f+3]=v[3]),d[4*f+0]=255*l[0],d[4*f+1]=255*l[1],d[4*f+2]=255*l[2],d[4*f+3]=255*l[3]}this.minMaxDistance[0]=i,this.minMaxDistance[1]=s,this.shadeTexChanged=!0}},{key:"applyHighlightOptions",value:function(e,t){this.shadeTex||(this.shadeTex=new re.x(e,{target:C.No.TEXTURE_2D,pixelFormat:C.VI.RGBA,dataType:C.Br.UNSIGNED_BYTE,wrapMode:C.e8.CLAMP_TO_EDGE,width:It,height:1,samplingMode:C.cw.LINEAR})),this.shadeTexChanged&&(this.shadeTex.updateData(0,0,0,It,1,this.texelData),this.shadeTexChanged=!1),e.bindTexture(this.shadeTex,$.Jw),t.setUniform2fv("u_minMaxDistance",this.minMaxDistance)}},{key:"destroy",value:function(){this.shadeTex&&(this.shadeTex.dispose(),this.shadeTex=null)}}]),e}(),jt={shaders:{vertexShader:(0,B.w)("highlight/textured.vert"),fragmentShader:(0,B.w)("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},Wt={shaders:{vertexShader:(0,B.w)("highlight/textured.vert"),fragmentShader:(0,B.w)("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},Xt=r(61109),Yt=function(){function e(){(0,o.Z)(this,e),this._width=void 0,this._height=void 0,this._resources=null}return(0,u.Z)(e,[{key:"dispose",value:function(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}},{key:"preBlur",value:function(e,t){e.bindTexture(t,$.QU),e.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",zt),e.bindVAO(this._resources.quadVAO),e.drawArrays(C.MX.TRIANGLE_STRIP,0,4),e.bindVAO()}},{key:"finalBlur",value:function(e,t){e.bindTexture(t,$.QU),e.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",Ut),e.bindVAO(this._resources.quadVAO),e.drawArrays(C.MX.TRIANGLE_STRIP,0,4),e.bindVAO()}},{key:"renderHighlight",value:function(e,t,r){e.bindTexture(t,$.QU),e.useProgram(this._resources.highlightProgram),r.applyHighlightOptions(e,this._resources.highlightProgram),e.bindVAO(this._resources.quadVAO),e.setBlendingEnabled(!0),e.setBlendFunction(C.zi.ONE,C.zi.ONE_MINUS_SRC_ALPHA),e.drawArrays(C.MX.TRIANGLE_STRIP,0,4),e.bindVAO()}},{key:"_initialize",value:function(e,t,r){this._width=t,this._height=r;var i=Z.f.createVertex(e,C.l1.STATIC_DRAW,new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]).buffer),n=new O.U(e,new Map([["a_position",0],["a_texcoord",1]]),{geometry:[new Xt.G("a_position",2,C.g.BYTE,0,4),new Xt.G("a_texcoord",2,C.g.UNSIGNED_BYTE,2,4)]},{geometry:i}),a=(0,F.H)(e,jt),s=(0,F.H)(e,Wt);e.useProgram(a),a.setUniform1i("u_texture",$.QU),a.setUniform1i("u_shade",$.Jw),a.setUniform1f("u_sigma",1),e.useProgram(s),s.setUniform1i("u_texture",$.QU),s.setUniform1f("u_sigma",1),this._resources={quadGeometry:i,quadVAO:n,highlightProgram:a,blurProgram:s}}},{key:"setup",value:function(e,t,r){this._resources?(this._width=t,this._height=r):this._initialize(e,t,r)}}]),e}(),Qt=r(53634);function Kt(e,t,r){var i=new re.x(e,{target:C.No.TEXTURE_2D,pixelFormat:C.VI.RGBA,dataType:C.Br.UNSIGNED_BYTE,wrapMode:C.e8.CLAMP_TO_EDGE,width:t,height:r,samplingMode:C.cw.LINEAR});return[i,new Qt.X(e,{colorTarget:C.Lm.TEXTURE,depthStencilTarget:C.OU.STENCIL_RENDER_BUFFER},i)]}var $t=function(){function e(){(0,o.Z)(this,e),this._width=void 0,this._height=void 0,this._resources=null}return(0,u.Z)(e,[{key:"dispose",value:function(){this._resources&&(this._resources.sharedBlur1Tex.dispose(),this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Tex.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)}},{key:"_initialize",value:function(e,t,r){this._width=t,this._height=r;var i=Kt(e,t,r),n=(0,pe.Z)(i,2),a=n[0],s=n[1],o=Kt(e,t,r),u=(0,pe.Z)(o,2),h=u[0],l=u[1];this._resources={sharedBlur1Tex:a,sharedBlur1Fbo:s,sharedBlur2Tex:h,sharedBlur2Fbo:l}}},{key:"setup",value:function(e,t,r){!this._resources||this._width===t&&this._height===r||this.dispose(),this._resources||this._initialize(e,t,r)}},{key:"sharedBlur1Tex",get:function(){return this._resources.sharedBlur1Tex}},{key:"sharedBlur1Fbo",get:function(){return this._resources.sharedBlur1Fbo}},{key:"sharedBlur2Tex",get:function(){return this._resources.sharedBlur2Tex}},{key:"sharedBlur2Fbo",get:function(){return this._resources.sharedBlur2Fbo}}]),e}(),Jt=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.apply(this,arguments)).defines=["highlight"],e._hlRenderer=new Yt,e._hlGradient=new qt,e._width=void 0,e._height=void 0,e._hlSurfaces=new $t,e._adjustedWidth=void 0,e._adjustedHeight=void 0,e._blitRenderer=new S,e}return(0,u.Z)(r,[{key:"dispose",value:function(){this._hlSurfaces&&this._hlSurfaces.dispose(),this._hlRenderer&&this._hlRenderer.dispose(),this._hlGradient&&this._hlGradient.destroy(),this._boundFBO=null}},{key:"bind",value:function(e){var t=e.context,r=e.painter,i=t.getViewport(),n=i.width,a=i.height,s=r.getFbos(n,a).effect0;this.setup(e,n,a),t.bindFramebuffer(s),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}},{key:"unbind",value:function(){}},{key:"setup",value:function(e,t,r){var i=e.context;this._width=t,this._height=r;var n=t%4,a=r%4;t+=n<2?-n:4-n,r+=a<2?-a:4-a,this._adjustedWidth=t,this._adjustedHeight=r,this._boundFBO=i.getBoundFramebufferObject();var s=Math.round(1*t),o=Math.round(1*r);this._hlRenderer.setup(i,s,o),this._hlSurfaces.setup(i,s,o)}},{key:"draw",value:function(e){var t=e.context,r=t.getBoundFramebufferObject();t.setViewport(0,0,1*this._adjustedWidth,1*this._adjustedHeight),t.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),t.setStencilTestEnabled(!1),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._blitRenderer.render(t,r.colorTexture,C.cw.NEAREST,1),t.setStencilTestEnabled(!1),t.setBlendingEnabled(!1),t.setColorMask(!1,!1,!1,!0),t.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._hlRenderer.preBlur(t,this._hlSurfaces.sharedBlur1Tex),t.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(t,this._hlSurfaces.sharedBlur2Tex),t.bindFramebuffer(this._boundFBO),t.setBlendingEnabled(!0),t.setColorMask(!0,!0,!0,!0),t.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(t,this._hlSurfaces.sharedBlur1Tex,this._hlGradient),this._boundFBO=null}},{key:"setHighlightOptions",value:function(e){this._hlGradient.setHighlightOptions(e)}}]),r}(Zt),er=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.apply(this,arguments)).name=e.constructor.name,e.defines=["hittest"],e}return(0,u.Z)(r,[{key:"dispose",value:function(){(0,v.pC)(this._fbo)&&this._fbo.dispose()}},{key:"createOptions",value:function(e,t){var r=e.pixelRatio,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$.dn;if(!t.length)return null;var n=t.shift(),a=n.point.x,s=n.point.y;return this._outstanding=n,{type:"hittest",distance:i*r,position:[a,s]}}},{key:"bind",value:function(e){var t=e.context,r=e.attributeView;if(r.size){var i=r.getBlock($.pU);if(!(0,v.Wi)(i)){var n=i.getFBO(t);t.setViewport(0,0,r.size,r.size),t.bindFramebuffer(n),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT)}}}},{key:"unbind",value:function(e){}},{key:"draw",value:function(e){var t=e.context,r=e.attributeView.getBlock($.pU);if(!(0,v.Wi)(this._outstanding)){var i=this._outstanding.resolver;if((0,v.Wi)(r))return i.resolve([]),void(this._outstanding=null);var n=r.getFBO(t),a=new Uint8Array(n.width*n.height*4);n.readPixels(0,0,n.width,n.height,C.VI.RGBA,C.Br.UNSIGNED_BYTE,a);for(var s=[],o=0;o<a.length;o+=4){var u=a[o],h=a[o+3];u&&s.push({id:o/4,directHits:h})}this._outstanding=null,s.sort((function(e,t){return t.directHits===e.directHits?t.id-e.id:t.directHits-e.directHits})),i.resolve(s.map((function(e){return e.id})))}}}]),r}(Zt),tr=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.apply(this,arguments)).name=e.constructor.name,e.defines=["id"],e._lastSize=0,e}return(0,u.Z)(r,[{key:"dispose",value:function(){(0,v.pC)(this._fbo)&&this._fbo.dispose()}},{key:"bind",value:function(e){var t=e.context,r=e.painter,i=t.getViewport(),n=i.width,a=i.height;this._boundFBO=t.getBoundFramebufferObject();var s=r.getFbos(n,a).effect0;t.bindFramebuffer(s),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}},{key:"unbind",value:function(e){e.context.bindFramebuffer(this._boundFBO),this._boundFBO=null}},{key:"draw",value:function(e,t){var r=this,i=e.context,n=e.state,a=e.pixelRatio,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2*$.dn,o=i.getBoundFramebufferObject(),u=n.size[1]*a,h=Math.round(s*a),l=h/2,c=h/2;this._ensureBuffer(h),t.forEach((function(e,i){var n=new Map,s=Math.floor(i.x*a-h/2),d=Math.floor(u-i.y*a-h/2);o.readPixels(s,d,h,h,C.VI.RGBA,C.Br.UNSIGNED_BYTE,r._buf);for(var f=0;f<r._buf32.length;f++){var p=r._buf32[f];if(4294967295!==p&&0!==p){var _=f%h,m=h-Math.floor(f/h),v=(l-_)*(l-_)+(c-m)*(c-m),g=n.has(p)?n.get(p):4294967295;n.set(p,Math.min(v,g))}}var y=Array.from(n).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}));e.resolve(y),t.delete(i)}))}},{key:"_ensureBuffer",value:function(e){this._lastSize!==e&&(this._lastSize=e,this._buf=new Uint8Array(4*e*e),this._buf32=new Uint32Array(this._buf.buffer))}}]),r}(Zt),rr=[1,0],ir=[0,1],nr=[1,.8,.6,.4,.2],ar=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],sr=function(){function e(){(0,o.Z)(this,e),this._intensityFBO=null,this._compositeFBO=null,this._mipsFBOs=new Array(5),this._nMips=5,this._kernelSizeArray=[3,5,7,9,11],this._size=[0,0],this._programDesc={luminosityHighPass:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/luminosityHighPass",attributes:new Map([["a_position",0]])},gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}return(0,u.Z)(e,[{key:"dispose",value:function(){if(this._quad&&(this._quad.dispose(),this._quad=null),this._intensityFBO&&(this._intensityFBO.dispose(),this._intensityFBO=null),this._compositeFBO&&(this._compositeFBO.dispose(),this._compositeFBO=null),this._mipsFBOs){for(var e=0;e<this._nMips;e++)this._mipsFBOs[e]&&(this._mipsFBOs[e].horizontal.dispose(),this._mipsFBOs[e].vertical.dispose());this._mipsFBOs=null}}},{key:"draw",value:function(e,t,r){var i=t.width,n=t.height,a=e.context,s=e.painter.materialManager,o=a.gl,u=this._programDesc,h=r.strength,l=r.radius,c=r.threshold;this._quad||(this._quad=new Et.Z(a,[-1,-1,1,-1,-1,1,1,1])),this._createOrResizeResources(e,i,n),a.setStencilTestEnabled(!1),a.setBlendingEnabled(!0),a.setBlendFunction(C.zi.ONE,C.zi.ONE_MINUS_SRC_ALPHA),a.setStencilWriteMask(0);var d=this._quad;d.bind(),a.bindFramebuffer(this._intensityFBO);var f=s.getProgram(u.luminosityHighPass);a.useProgram(f),a.bindTexture(t.colorTexture,0),f.setUniform1i("u_texture",0),f.setUniform3fv("u_defaultColor",[0,0,0]),f.setUniform1f("u_defaultOpacity",0),f.setUniform1f("u_luminosityThreshold",c),f.setUniform1f("u_smoothWidth",.01);var p=[Math.round(i/2),Math.round(n/2)];a.setViewport(0,0,p[0],p[1]),a.setClearColor(0,0,0,0),a.clear(o.COLOR_BUFFER_BIT),d.draw(),a.setBlendingEnabled(!1);for(var _=this._intensityFBO.colorTexture,m=0;m<this._nMips;m++){var v=s.getProgram(u.gaussianBlur,[{name:"radius",value:this._kernelSizeArray[m]}]);a.useProgram(v),a.bindTexture(_,m+1),v.setUniform1i("u_colorTexture",m+1),v.setUniform2fv("u_texSize",p),v.setUniform2fv("u_direction",rr),a.setViewport(0,0,p[0],p[1]);var g=this._mipsFBOs[m];a.bindFramebuffer(g.horizontal),d.draw(),_=g.horizontal.colorTexture,a.bindFramebuffer(g.vertical),a.bindTexture(_,m+1),v.setUniform2fv("u_direction",ir),d.draw(),_=g.vertical.colorTexture,p[0]=Math.round(p[0]/2),p[1]=Math.round(p[1]/2)}a.setViewport(0,0,i,n);var y=s.getProgram(u.composite,[{name:"nummips",value:5}]);a.bindFramebuffer(this._compositeFBO),a.useProgram(y),y.setUniform1f("u_bloomStrength",h),y.setUniform1f("u_bloomRadius",l),y.setUniform1fv("u_bloomFactors",nr),y.setUniform3fv("u_bloomTintColors",ar),a.bindTexture(this._mipsFBOs[0].vertical.colorTexture,1),y.setUniform1i("u_blurTexture1",1),a.bindTexture(this._mipsFBOs[1].vertical.colorTexture,2),y.setUniform1i("u_blurTexture2",2),a.bindTexture(this._mipsFBOs[2].vertical.colorTexture,3),y.setUniform1i("u_blurTexture3",3),a.bindTexture(this._mipsFBOs[3].vertical.colorTexture,4),y.setUniform1i("u_blurTexture4",4),a.bindTexture(this._mipsFBOs[4].vertical.colorTexture,5),y.setUniform1i("u_blurTexture5",5),d.draw(),a.bindFramebuffer(t),a.setBlendingEnabled(!0);var b=s.getProgram(u.blit);a.useProgram(b),a.bindTexture(this._compositeFBO.colorTexture,6),b.setUniform1i("u_texture",6),a.setBlendFunction(C.zi.ONE,C.zi.ONE),d.draw(),d.unbind(),a.setBlendFunction(C.zi.ONE,C.zi.ONE_MINUS_SRC_ALPHA),a.setStencilTestEnabled(!0)}},{key:"_createOrResizeResources",value:function(e,t,r){var i=e.context;if(!this._compositeFBO||this._size[0]!==t||this._size[1]!==r){this._size[0]=t,this._size[1]=r;var n=[Math.round(t/2),Math.round(r/2)];this._compositeFBO?this._compositeFBO.resize(t,r):this._compositeFBO=new Qt.X(i,{colorTarget:C.Lm.TEXTURE,depthStencilTarget:C.OU.NONE,width:t,height:r}),this._intensityFBO?this._intensityFBO.resize(n[0],n[1]):this._intensityFBO=new Qt.X(i,{colorTarget:C.Lm.TEXTURE,depthStencilTarget:C.OU.NONE,width:n[0],height:n[1]},{target:C.No.TEXTURE_2D,pixelFormat:C.VI.RGBA,internalFormat:C.VI.RGBA,dataType:C.Br.UNSIGNED_BYTE,wrapMode:C.e8.CLAMP_TO_EDGE,samplingMode:C.cw.LINEAR,flipped:!1,width:n[0],height:n[1]});for(var a=0;a<this._nMips;a++)this._mipsFBOs[a]?(this._mipsFBOs[a].horizontal.resize(n[0],n[1]),this._mipsFBOs[a].vertical.resize(n[0],n[1])):this._mipsFBOs[a]={horizontal:new Qt.X(i,{colorTarget:C.Lm.TEXTURE,depthStencilTarget:C.OU.NONE,width:n[0],height:n[1]},{target:C.No.TEXTURE_2D,pixelFormat:C.VI.RGBA,internalFormat:C.VI.RGBA,dataType:C.Br.UNSIGNED_BYTE,wrapMode:C.e8.CLAMP_TO_EDGE,samplingMode:C.cw.LINEAR,flipped:!1,width:n[0],height:n[1]}),vertical:new Qt.X(i,{colorTarget:C.Lm.TEXTURE,depthStencilTarget:C.OU.NONE,width:n[0],height:n[1]},{target:C.No.TEXTURE_2D,pixelFormat:C.VI.RGBA,internalFormat:C.VI.RGBA,dataType:C.Br.UNSIGNED_BYTE,wrapMode:C.e8.CLAMP_TO_EDGE,samplingMode:C.cw.LINEAR,flipped:!1,width:n[0],height:n[1]})},n[0]=Math.round(n[0]/2),n[1]=Math.round(n[1]/2)}}}]),e}(),or=[1,0],ur=[0,1],hr=function(){function e(){(0,o.Z)(this,e),this._blurFBO=null,this._size=[0,0],this._programDesc={gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},radialBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/radial-blur",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}return(0,u.Z)(e,[{key:"dispose",value:function(){this._blurFBO&&(this._blurFBO.dispose(),this._blurFBO=null)}},{key:"draw",value:function(e,t,r){var i=e.context,n=r.type,a=r.radius;if(0!==a){this._createOrResizeResources(e),this._quad||(this._quad=new Et.Z(i,[-1,-1,1,-1,-1,1,1,1]));var s=this._quad;s.bind(),"blur"===n?this._gaussianBlur(e,t,a):this._radialBlur(e,t),s.unbind()}}},{key:"_gaussianBlur",value:function(e,t,r){var i=e.context,n=e.state,a=e.painter,s=e.pixelRatio,o=n.size,u=a.materialManager,h=this._programDesc,l=this._quad,c=[Math.round(s*o[0]),Math.round(s*o[1])],d=this._blurFBO,f=u.getProgram(h.gaussianBlur,[{name:"radius",value:Math.ceil(r)}]);i.useProgram(f),i.setBlendingEnabled(!1),i.bindFramebuffer(d),i.bindTexture(t.colorTexture,4),f.setUniform1i("u_colorTexture",4),f.setUniform2fv("u_texSize",c),f.setUniform2fv("u_direction",or),f.setUniform1f("u_sigma",r),l.draw(),i.bindFramebuffer(t),i.setStencilWriteMask(0),i.setStencilTestEnabled(!1),i.setDepthWriteEnabled(!1),i.setDepthTestEnabled(!1),i.bindTexture(d.colorTexture,5),f.setUniform1i("u_colorTexture",5),f.setUniform2fv("u_direction",ur),l.draw(),i.setBlendingEnabled(!0),i.setBlendFunction(C.zi.ONE,C.zi.ONE_MINUS_SRC_ALPHA),i.setStencilTestEnabled(!0)}},{key:"_radialBlur",value:function(e,t){var r=e.context,i=e.painter.materialManager,n=this._programDesc,a=this._quad,s=this._blurFBO;r.bindFramebuffer(s);var o=i.getProgram(n.radialBlur);r.useProgram(o),r.setBlendingEnabled(!1),r.bindTexture(t.colorTexture,4),o.setUniform1i("u_colorTexture",4),a.draw(),r.bindFramebuffer(t),r.setStencilWriteMask(0),r.setStencilTestEnabled(!1),r.setDepthWriteEnabled(!1),r.setDepthTestEnabled(!1),r.setBlendingEnabled(!0);var u=i.getProgram(n.blit);r.useProgram(u),r.bindTexture(s.colorTexture,5),u.setUniform1i("u_texture",5),r.setBlendFunction(C.zi.ONE,C.zi.ONE_MINUS_SRC_ALPHA),a.draw()}},{key:"_createOrResizeResources",value:function(e){var t=e.context,r=e.state,i=e.pixelRatio,n=r.size,a=Math.round(i*n[0]),s=Math.round(i*n[1]);this._blurFBO&&this._size[0]===a&&this._size[1]===s||(this._size[0]=a,this._size[1]=s,this._blurFBO?this._blurFBO.resize(a,s):this._blurFBO=new Qt.X(t,{colorTarget:C.Lm.TEXTURE,depthStencilTarget:C.OU.NONE,width:a,height:s},{target:C.No.TEXTURE_2D,pixelFormat:C.VI.RGBA,internalFormat:C.VI.RGBA,dataType:C.Br.UNSIGNED_BYTE,wrapMode:C.e8.CLAMP_TO_EDGE,samplingMode:C.cw.LINEAR,flipped:!1,width:a,height:s}))}}]),e}(),lr=function(){function e(){(0,o.Z)(this,e),this._size=[0,0],this._programDesc={vsPath:"post-processing/pp",fsPath:"post-processing/filterEffect",attributes:new Map([["a_position",0]])}}return(0,u.Z)(e,[{key:"dispose",value:function(){this._layerFBOTexture&&(this._layerFBOTexture.dispose(),this._layerFBOTexture=null)}},{key:"draw",value:function(e,t,r){var i=t.width,n=t.height;this._createOrResizeResources(e,i,n);var a=e.context,s=e.painter.materialManager,o=this._programDesc,u=this._quad,h=r.colorMatrix;u.bind();var l=this._layerFBOTexture;a.bindFramebuffer(t),t.copyToTexture(0,0,i,n,0,0,l),a.setBlendingEnabled(!1),a.setStencilTestEnabled(!1);var c=s.getProgram(o);a.useProgram(c),a.bindTexture(l,2),c.setUniformMatrix4fv("u_coefficients",h),c.setUniform1i("u_colorTexture",2),u.draw(),a.setBlendingEnabled(!0),a.setBlendFunction(C.zi.ONE,C.zi.ONE_MINUS_SRC_ALPHA),a.setStencilTestEnabled(!0),u.unbind()}},{key:"_createOrResizeResources",value:function(e,t,r){var i=e.context;this._layerFBOTexture&&this._size[0]===t&&this._size[1]===r||(this._size[0]=t,this._size[1]=r,this._layerFBOTexture?this._layerFBOTexture.resize(t,r):this._layerFBOTexture=new re.x(i,{target:C.No.TEXTURE_2D,pixelFormat:C.VI.RGBA,internalFormat:C.VI.RGBA,dataType:C.Br.UNSIGNED_BYTE,wrapMode:C.e8.CLAMP_TO_EDGE,samplingMode:C.cw.LINEAR,flipped:!1,width:t,height:r}),this._quad||(this._quad=new Et.Z(i,[-1,-1,1,-1,-1,1,1,1])))}}]),e}(),cr=[1,0],dr=[0,1],fr=function(){function e(){(0,o.Z)(this,e),this._horizontalBlurFBO=null,this._verticalBlurFBO=null,this._size=[0,0],this._programDesc={blur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/drop-shadow/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}return(0,u.Z)(e,[{key:"dispose",value:function(){this._layerFBOTexture&&(this._layerFBOTexture.dispose(),this._layerFBOTexture=null),this._horizontalBlurFBO&&(this._horizontalBlurFBO.dispose(),this._horizontalBlurFBO=null),this._verticalBlurFBO&&(this._verticalBlurFBO.dispose(),this._verticalBlurFBO=null)}},{key:"draw",value:function(e,t,r){var i=e.context,n=e.state,a=e.painter.materialManager,s=this._programDesc,o=t.width,u=t.height,h=[Math.round(o/2),Math.round(u/2)],l=r.blurRadius,c=r.offsetX,d=r.offsetY,f=r.color,p=[(0,X.F2)(c/2),(0,X.F2)(d/2)];this._createOrResizeResources(e,o,u,h);var _=this._horizontalBlurFBO,m=this._verticalBlurFBO;i.setStencilWriteMask(0),i.setStencilTestEnabled(!1),i.setDepthWriteEnabled(!1),i.setDepthTestEnabled(!1);var v=this._layerFBOTexture;t.copyToTexture(0,0,o,u,0,0,v),this._quad||(this._quad=new Et.Z(i,[-1,-1,1,-1,-1,1,1,1])),i.setViewport(0,0,h[0],h[1]);var g=this._quad;g.bind(),i.setBlendingEnabled(!1);var y=a.getProgram(s.blur,[{name:"radius",value:Math.ceil(l)}]);i.useProgram(y),i.bindFramebuffer(_),i.bindTexture(t.colorTexture,4),y.setUniform1i("u_colorTexture",4),y.setUniform2fv("u_texSize",h),y.setUniform2fv("u_direction",cr),y.setUniform1f("u_sigma",l),g.draw(),i.bindFramebuffer(m),i.bindTexture(_.colorTexture,5),y.setUniform1i("u_colorTexture",5),y.setUniform2fv("u_direction",dr),g.draw(),i.bindFramebuffer(t),i.setViewport(0,0,o,u);var b=a.getProgram(s.composite);i.useProgram(b),i.bindTexture(m.colorTexture,2),b.setUniform1i("u_blurTexture",2),i.bindTexture(v,3),b.setUniform1i("u_layerFBOTexture",3),b.setUniform4fv("u_shadowColor",[f[3]*(f[0]/255),f[3]*(f[1]/255),f[3]*(f[2]/255),f[3]]),b.setUniformMatrix3fv("u_displayViewMat3",n.displayMat3),b.setUniform2fv("u_shadowOffset",p),g.draw(),i.setBlendingEnabled(!0),i.setStencilTestEnabled(!0),i.setBlendFunction(C.zi.ONE,C.zi.ONE_MINUS_SRC_ALPHA),g.unbind()}},{key:"_createOrResizeResources",value:function(e,t,r,i){var n=e.context;this._horizontalBlurFBO&&this._size[0]===t&&this._size[1]===r||(this._size[0]=t,this._size[1]=r,this._horizontalBlurFBO?this._horizontalBlurFBO.resize(i[0],i[1]):this._horizontalBlurFBO=new Qt.X(n,{colorTarget:C.Lm.TEXTURE,depthStencilTarget:C.OU.NONE,width:i[0],height:i[1]},{target:C.No.TEXTURE_2D,pixelFormat:C.VI.RGBA,internalFormat:C.VI.RGBA,dataType:C.Br.UNSIGNED_BYTE,wrapMode:C.e8.CLAMP_TO_EDGE,samplingMode:C.cw.LINEAR,flipped:!1,width:i[0],height:i[1]}),this._verticalBlurFBO?this._verticalBlurFBO.resize(i[0],i[1]):this._verticalBlurFBO=new Qt.X(n,{colorTarget:C.Lm.TEXTURE,depthStencilTarget:C.OU.NONE,width:i[0],height:i[1]},{target:C.No.TEXTURE_2D,pixelFormat:C.VI.RGBA,internalFormat:C.VI.RGBA,dataType:C.Br.UNSIGNED_BYTE,wrapMode:C.e8.CLAMP_TO_EDGE,samplingMode:C.cw.LINEAR,flipped:!1,width:i[0],height:i[1]}),this._layerFBOTexture?this._layerFBOTexture.resize(t,r):this._layerFBOTexture=new re.x(n,{target:C.No.TEXTURE_2D,pixelFormat:C.VI.RGBA,internalFormat:C.VI.RGBA,dataType:C.Br.UNSIGNED_BYTE,wrapMode:C.e8.CLAMP_TO_EDGE,samplingMode:C.cw.LINEAR,flipped:!1,width:t,height:r}))}}]),e}(),pr=function(){function e(){(0,o.Z)(this,e),this._size=[0,0]}return(0,u.Z)(e,[{key:"dispose",value:function(){this._layerFBOTexture&&(this._layerFBOTexture.dispose(),this._layerFBOTexture=null)}},{key:"draw",value:function(e,t,r){var i=t.width,n=t.height;this._createOrResizeResources(e,i,n);var a=e.context,s=e.painter,o=r.amount,u=a.gl,h=this._layerFBOTexture;a.bindFramebuffer(t),t.copyToTexture(0,0,i,n,0,0,h),a.setBlendingEnabled(!0),a.setStencilTestEnabled(!1),a.setDepthTestEnabled(!1),a.setClearColor(0,0,0,0),a.clear(u.COLOR_BUFFER_BIT),s.blitTexture(a,h,C.cw.NEAREST,o)}},{key:"_createOrResizeResources",value:function(e,t,r){var i=e.context;this._layerFBOTexture&&this._size[0]===t&&this._size[1]===r||(this._size[0]=t,this._size[1]=r,this._layerFBOTexture?this._layerFBOTexture.resize(t,r):this._layerFBOTexture=new re.x(i,{target:C.No.TEXTURE_2D,pixelFormat:C.VI.RGBA,internalFormat:C.VI.RGBA,dataType:C.Br.UNSIGNED_BYTE,wrapMode:C.e8.CLAMP_TO_EDGE,samplingMode:C.cw.NEAREST,flipped:!1,width:t,height:r}))}}]),e}();function _r(e){switch(e){case"bloom":case"blur":case"opacity":case"drop-shadow":return e;default:return"colorize"}}var mr={colorize:function(){return new lr},blur:function(){return new hr},bloom:function(){return new sr},opacity:function(){return new pr},"drop-shadow":function(){return new fr}},vr=function(){function e(){(0,o.Z)(this,e),this._effectMap=new Map}return(0,u.Z)(e,[{key:"dispose",value:function(){this._effectMap.forEach((function(e){return e.dispose()})),this._effectMap.clear()}},{key:"getPostProcessingEffects",value:function(e){if(!e||0===e.length)return[];var t,r=[],i=(0,s.Z)(e);try{for(i.s();!(t=i.n()).done;){var n=t.value,a=_r(n.type),o=this._effectMap.get(a);o||(o=mr[a](),this._effectMap.set(a,o)),r.push({postProcessingEffect:o,effect:n})}}catch(u){i.e(u)}finally{i.f()}return r}}]),e}(),gr=r(63780),yr=function(){function e(t,r){var i;(0,o.Z)(this,e),this.brushes=t,this.name=r.name,this.drawPhase=r.drawPhase||T.jx.MAP,this._targetFn=r.target,this.effects=r.effects||[],this.enableDefaultDraw=null!==(i=r.enableDefaultDraw)&&void 0!==i?i:function(){return!0}}return(0,u.Z)(e,[{key:"render",value:function(e){var t=e.context,r=e.profiler,i=this._targetFn(),n=this.drawPhase&e.drawPhase;if(r.recordPassStart(this.name),n){this.enableDefaultDraw()&&this._doRender(e,i),r.recordPassEnd();var a,o=(0,s.Z)(this.effects);try{for(o.s();!(a=o.n()).done;){var u=a.value;if(u.enable()){var h=u.apply;r.recordPassStart(this.name+"."+h.name),r.recordBrushStart(h.name);var l=u.args&&u.args(),c=t.getViewport(),d=c.x,f=c.y,p=c.width,_=c.height,m=t.getBoundFramebufferObject();h.bind(e,l);var v=h.createOptions(e,l),g=e.passOptions;e.passOptions=v,this._doRender(e,i,h.defines),e.passOptions=g,h.draw(e,l),h.unbind(e,l),t.bindFramebuffer(m),t.setViewport(d,f,p,_),r.recordBrushEnd(),r.recordPassEnd()}}}catch(y){o.e(y)}finally{o.f()}}}},{key:"_doRender",value:function(e,t,r){if(!(0,v.Wi)(t))if((0,gr.zG)(t)){var i,n=(0,s.Z)(t);try{for(n.s();!(i=n.n()).done;){var a=i.value;if(a.visible){var o,u=(0,s.Z)(this.brushes);try{for(u.s();!(o=u.n()).done;){var h=o.value;e.profiler.recordBrushStart(h.name),h.prepareState(e,a,r),h.draw(e,a,r),e.profiler.recordBrushEnd()}}catch(f){u.e(f)}finally{u.f()}}}}catch(f){n.e(f)}finally{n.f()}}else{var l,c=(0,s.Z)(this.brushes);try{for(c.s();!(l=c.n()).done;){var d=l.value;e.profiler.recordBrushStart(d.name),d.prepareState(e,t,r),d.draw(e,t,r),e.profiler.recordBrushEnd()}}catch(f){c.e(f)}finally{c.f()}}}}]),e}(),br=r(15880);var wr=function(){function e(t,r,i){(0,o.Z)(this,e),this.context=t,this._blitRenderer=new S,this._worldExtentClipRenderer=new Rt,this._isClippedToWorldExtent=!1,this._brushCache=new Map,this._vtlMaterialManager=new E.Z,this._blendEffect=new Pt,this._fboPool=[],this.effects={highlight:new Jt,hittest:new er,hittestVTL:new tr,integrate:new Ct,insideEffect:new At("inside"),outsideEffect:new At("outside")},this.materialManager=new G(t),this.textureManager=new yt(r,i),this._effectsManager=new vr}return(0,u.Z)(e,[{key:"vectorTilesMaterialManager",get:function(){return this._vtlMaterialManager}},{key:"getRenderTarget",value:function(){return this._renderTarget}},{key:"setRenderTarget",value:function(e){this._renderTarget=e}},{key:"getFbos",value:function(e,t){if(e!==this._lastWidth||t!==this._lastHeight){if(this._lastWidth=e,this._lastHeight=t,this._fbos){for(var r in this._fbos)this._fbos[r].resize(e,t);return this._fbos}var i={target:C.No.TEXTURE_2D,pixelFormat:C.VI.RGBA,dataType:C.Br.UNSIGNED_BYTE,samplingMode:C.cw.NEAREST,wrapMode:C.e8.CLAMP_TO_EDGE,width:e,height:t},n={colorTarget:C.Lm.TEXTURE,depthStencilTarget:C.OU.DEPTH_STENCIL_RENDER_BUFFER},a=new br.r(this.context,{width:e,height:t,internalFormat:C.Tg.DEPTH_STENCIL});this._stencilBuf=a,this._fbos={output:new Qt.X(this.context,n,i,a),blend:new Qt.X(this.context,n,i,a),effect0:new Qt.X(this.context,n,i,a)}}return this._fbos}},{key:"acquireFbo",value:function(e,t){var r,i=(r=this._fboPool.length>0?this._fboPool.pop():new Qt.X(this.context,{colorTarget:C.Lm.TEXTURE,depthStencilTarget:C.OU.DEPTH_STENCIL_RENDER_BUFFER},{target:C.No.TEXTURE_2D,pixelFormat:C.VI.RGBA,dataType:C.Br.UNSIGNED_BYTE,samplingMode:C.cw.NEAREST,wrapMode:C.e8.CLAMP_TO_EDGE,width:e,height:t},this._stencilBuf)).descriptor;return i.width===e&&i.height===t||r.resize(e,t),r}},{key:"releaseFbo",value:function(e){this._fboPool.push(e)}},{key:"getSharedStencilBuffer",value:function(){return this._stencilBuf}},{key:"beforeRenderLayers",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=e.getViewport(),i=r.width,n=r.height;this._prevFBO=e.getBoundFramebufferObject();var a=this.getFbos(i,n);if(e.bindFramebuffer(a.output),e.setColorMask(!0,!0,!0,!0),(0,v.pC)(t)){var s=t.color,o=s.r,u=s.g,h=s.b,l=s.a;e.setClearColor(l*o/255,l*u/255,l*h/255,l)}else e.setClearColor(0,0,0,0);e.setDepthWriteEnabled(!0),e.setClearDepth(1),e.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT),e.setDepthWriteEnabled(!1)}},{key:"beforeRenderLayer",value:function(e,t,r){var i=e.context,n=e.blendMode,a=e.effects,s=e.requireFBO,o=e.drawPhase;if(s||xr(o,n,a,r))i.bindFramebuffer(this._fbos.blend),i.setColorMask(!0,!0,!0,!0),i.setClearColor(0,0,0,0),i.setDepthWriteEnabled(!0),i.setClearDepth(1),i.clear(i.gl.COLOR_BUFFER_BIT|i.gl.DEPTH_BUFFER_BIT),i.setDepthWriteEnabled(!1);else{var u=this._getOutputFBO();i.bindFramebuffer(u)}i.setDepthWriteEnabled(!1),i.setDepthTestEnabled(!1),i.setStencilTestEnabled(!0),i.setClearStencil(t),i.setStencilWriteMask(255),i.clear(i.gl.STENCIL_BUFFER_BIT)}},{key:"compositeLayer",value:function(e,t){var r=e.context,i=e.blendMode,n=e.effects,a=e.requireFBO,s=e.drawPhase;if(a||xr(s,i,n,t)){(0,v.pC)(n)&&n.length>0&&s===T.jx.MAP&&this._applyEffects(e,n);var o=this._getOutputFBO();r.bindFramebuffer(o),r.setStencilTestEnabled(!1),r.setStencilWriteMask(0),r.setBlendingEnabled(!0),r.setBlendFunctionSeparate(C.zi.ONE,C.zi.ONE_MINUS_SRC_ALPHA,C.zi.ONE,C.zi.ONE_MINUS_SRC_ALPHA),r.setColorMask(!0,!0,!0,!0);var u=(0,v.Wi)(i)||s===T.jx.HIGHLIGHT?"normal":i;this._blendEffect.draw(e,this._fbos.blend.colorTexture,C.cw.NEAREST,u,t)}}},{key:"renderLayers",value:function(e){if(e.bindFramebuffer(this._prevFBO),this._fbos){var t=this._getOutputFBO();e.setDepthTestEnabled(!1),e.setStencilWriteMask(0),this._isClippedToWorldExtent?(e.setStencilTestEnabled(!0),e.setStencilFunction(C.wb.EQUAL,1,255)):e.setStencilTestEnabled(!1),this.blitTexture(e,t.colorTexture,C.cw.NEAREST)}}},{key:"prepareDisplay",value:function(e,t,r){var i=e.context;if(i.bindFramebuffer(this._prevFBO),i.setColorMask(!0,!0,!0,!0),(0,v.pC)(t)){var n=t.color,a=n.r,s=n.g,o=n.b,u=n.a;i.setClearColor(u*a/255,u*s/255,u*o/255,u)}else i.setClearColor(0,0,0,0);i.setStencilWriteMask(255),i.setClearStencil(0),i.clear(i.gl.COLOR_BUFFER_BIT|i.gl.STENCIL_BUFFER_BIT),this._isClippedToWorldExtent=this._worldExtentClipRenderer.render(e,r)}},{key:"dispose",value:function(){if(this.materialManager.dispose(),this.textureManager.dispose(),this._blitRenderer=(0,v.O3)(this._blitRenderer),this._worldExtentClipRenderer=(0,v.O3)(this._worldExtentClipRenderer),this._brushCache&&(this._brushCache.forEach((function(e){return e.dispose()})),this._brushCache.clear(),this._brushCache=null),this._fbos)for(var e in this._fbos)this._fbos[e]&&this._fbos[e].dispose();var t,r=(0,s.Z)(this._fboPool);try{for(r.s();!(t=r.n()).done;){t.value.dispose()}}catch(n){r.e(n)}finally{r.f()}if(this._fboPool.length=0,this.effects)for(var i in this.effects)this.effects[i]&&this.effects[i].dispose();this._effectsManager.dispose(),this._vtlMaterialManager=(0,v.O3)(this._vtlMaterialManager),this._prevFBO=null}},{key:"getBrush",value:function(e,t){var r=function(e,t){switch(e){case T.LW.LINE:return k.U.line;case T.LW.TEXT:return k.U.text;case T.LW.LABEL:return k.U.label;case T.LW.FILL:return t===T.mD.DOT_DENSITY?k.U.dotDensity:k.U.fill;case T.LW.MARKER:switch(t){case T.mD.HEATMAP:return k.U.heatmap;case T.mD.PIE_CHART:return k.U.pieChart;default:return k.U.marker}}}(e,t),i=this._brushCache.get(r);return void 0===i&&(i=new r,this._brushCache.set(r,i)),this._brushCache.get(r)}},{key:"renderObject",value:function(e,t,r,i){var n=k.U[r];if(!n)return null;var a=this._brushCache.get(n);void 0===a&&(a=new n,this._brushCache.set(n,a)),a.prepareState(e,t,i),a.draw(e,t,i)}},{key:"renderObjects",value:function(e,t,r,i){var n=k.U[r];if(!n)return null;var a=this._brushCache.get(n);void 0===a&&(a=new n,this._brushCache.set(n,a)),a.drawMany(e,t,i)}},{key:"registerRenderPass",value:function(e){var t=this,r=e.brushes.map((function(e){return t._brushCache.has(e)||t._brushCache.set(e,new e),t._brushCache.get(e)}));return new yr(r,e)}},{key:"setHighlightOptions",value:function(e){this.effects.highlight.setHighlightOptions(e)}},{key:"blitTexture",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(C.zi.ONE,C.zi.ONE_MINUS_SRC_ALPHA,C.zi.ONE,C.zi.ONE_MINUS_SRC_ALPHA),e.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(e,t,r,i)}},{key:"getPostProcessingEffects",value:function(e){return this._effectsManager.getPostProcessingEffects(e)}},{key:"_getOutputFBO",value:function(){return null!=this._renderTarget?this._renderTarget:this._fbos.output}},{key:"_applyEffects",value:function(e,t){var r,i=e.context,n=this._effectsManager.getPostProcessingEffects(t),a=(0,s.Z)(n);try{for(a.s();!(r=a.n()).done;){var o=r.value,u=o.postProcessingEffect,h=o.effect;i.bindFramebuffer(this._fbos.blend),u.draw(e,this._fbos.blend,h)}}catch(l){a.e(l)}finally{a.f()}}}]),e}();function xr(e,t,r,i){return e!==T.jx.HIGHLIGHT&&(1!==i||(0,v.pC)(t)&&"normal"!==t||(0,v.pC)(r)&&r.length>0)}var Tr=r(43244),kr=r(91505),Er=r(40235),Mr=(0,m.Z)("esri-2d-profiler"),Br=function(){function e(t,r){var i=this;if((0,o.Z)(this,e),this._events=new kr.Z,this._entries=new Map,this._timings=new Tr.Z(10),Mr){this._ext=(0,Er.m)(t.gl,{}),this._debugOutput=r;var n=t.gl;if(this.enableCommandLogging){var a=function(e){if("function"==typeof n[e]){var t=n[e],r=e.includes("draw");n[e]=function(){for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return i._events.emit("command",{container:i._currentContainer,pass:i._currentPass,brush:i._currentBrush,method:e,args:s,isDrawCommand:r}),i._currentSummary&&(i._currentSummary.commands++,r&&i._currentSummary.drawCommands++),t.apply(n,s)}}};for(var s in n)a(s)}}}return(0,u.Z)(e,[{key:"enableCommandLogging",get:function(){return!("object"==typeof Mr&&Mr.disableCommands)}},{key:"recordContainerStart",value:function(e){Mr&&(this._currentContainer=e)}},{key:"recordContainerEnd",value:function(){Mr&&(this._currentContainer=null)}},{key:"recordPassStart",value:function(e){Mr&&(this._currentPass=e,this._initSummary())}},{key:"recordPassEnd",value:function(){Mr&&(this._currentPass=null,this._emitSummary())}},{key:"recordBrushStart",value:function(e){Mr&&(this._currentBrush=e)}},{key:"recordBrushEnd",value:function(){Mr&&(this._currentBrush=null)}},{key:"recordStart",value:function(e){if(Mr&&(0,v.pC)(this._ext)){if(this._entries.has(e)){var t=this._entries.get(e),r=this._ext.resultAvailable(t.query),i=this._ext.disjoint();if(r&&!i){var n=this._ext.getResult(t.query)/1e6,a=0;if((0,v.pC)(this._timings.enqueue(n))){var o,u=this._timings.entries,h=u.length,l=0,c=(0,s.Z)(u);try{for(c.s();!(o=c.n()).done;){l+=o.value}}catch(g){c.e(g)}finally{c.f()}a=l/h}var d=n.toFixed(2),f=a?a.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed("Frame report for ".concat(e,", ").concat(d," ms (").concat(f," last 10 avg)\n").concat(t.commandsLen," Commands (").concat(t.drawCommands," draw)")),console.log("RenderPass breakdown: "),console.table(t.summaries),console.log("Commands: ",t.commands),console.groupEnd()):console.log("Frame report for ".concat(e,", ").concat(d," ms (").concat(f," last 10 avg)")),this._debugOutput.innerHTML="".concat(d," (").concat(f,")")}var p,_=(0,s.Z)(t.handles);try{for(_.s();!(p=_.n()).done;){p.value.remove()}}catch(g){_.e(g)}finally{_.f()}this._entries.delete(e)}var m={name:e,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(m.handles.push(this._events.on("command",(function(e){m.commandsLen++,m.commands.push(e),e.isDrawCommand&&m.drawCommands++}))),m.handles.push(this._events.on("summary",(function(e){m.summaries.push(e)})))),this._ext.beginTimeElapsed(m.query),this._entries.set(e,m)}}},{key:"recordEnd",value:function(e){Mr&&(0,v.pC)(this._ext)&&this._entries.has(e)&&this._ext.endTimeElapsed()}},{key:"_initSummary",value:function(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}},{key:"_emitSummary",value:function(){this.enableCommandLogging&&this._events.emit("summary",this._currentSummary)}}]),e}(),Rr=r(84786),Zr=r(7796),Cr=r(49800),Fr=r(91945),Or=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,i){var n;(0,o.Z)(this,r),(n=t.call(this))._trash=new Set,n._renderRemainingTime=0,n._lastFrameRenderTime=0,n.renderRequested=!1,n.stage=(0,h.Z)(n),n._stationary=!0;var a=i.canvas,s=void 0===a?document.createElement("canvas"):a,u=i.alpha,l=void 0===u||u,c=i.stencil,d=void 0===c||c,f=i.contextOptions,g=void 0===f?{}:f;n._canvas=s;var b=(0,Cr.sj)("2d",s,{alpha:l,antialias:!1,depth:!0,stencil:d});return n.context=new Fr.x((0,v.pC)(b)?b:null,g),n.resourceManager=new w.Z,n.painter=new wr(n.context,(0,h.Z)(n),n.resourceManager),(0,m.Z)("esri-2d-profiler")&&(n._debugOutput=document.createElement("div"),n._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),e.appendChild(n._debugOutput)),n._renderParameters={drawPhase:0,state:n.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null,deltaTime:-1,time:0,inFadeTransition:!1,effects:null,context:n.context,painter:n.painter,timeline:i.timeline||new Rr.T,renderingOptions:i.renderingOptions,requestRender:function(){return n.requestRender()},requireFBO:!1,profiler:new Br(n.context,n._debugOutput),dataUploadCounter:0},n._taskHandle=(0,y.A)({render:function(e){return n.renderFrame(e)}}),n._taskHandle.pause(),n._lostWebGLContextHandle=(0,_.on)(s,"webglcontextlost",(function(){n.emit("webgl-error",{error:new p.Z("webgl-context-lost")})})),s.setAttribute("style","width: 100%; height:100%; display:block;"),e.appendChild(s),n}return(0,u.Z)(r,[{key:"destroy",value:function(){this.removeAllChildren(),this._emptyTrash(),this._taskHandle.remove(),this._taskHandle=null,this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null),this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas),this._debugOutput&&this._debugOutput.parentNode&&this._debugOutput.parentNode.removeChild(this._debugOutput),this.highlightOptions=null,this.resourceManager.destroy(),this.painter.dispose(),this.context.dispose(),this._canvas=null}},{key:"background",get:function(){return this._background},set:function(e){this._background=e,this.requestRender()}},{key:"highlightOptions",get:function(){return this._highlightOptions},set:function(e){var t=this;this._highlightOptionsHandle&&(this._highlightOptionsHandle.remove(),this._highlightOptionsHandle=null),this._highlightOptions=e,this._highlightOptions&&(this._highlightOptionsHandle=(0,g.YP)((function(){var e;return null===(e=t._highlightOptions)||void 0===e?void 0:e.version}),(function(){t.painter.setHighlightOptions(e),t.requestRender()}),g.nn))}},{key:"renderingOptions",get:function(){return this._renderingOptions},set:function(e){this._renderingOptions=e,this.requestRender()}},{key:"state",get:function(){return this._state},set:function(e){this._state=e,this.requestRender()}},{key:"stationary",get:function(){return this._stationary},set:function(e){this._stationary!==e&&(this._stationary=e,this.requestRender())}},{key:"trashDisplayObject",value:function(e){this._trash.add(e),this.requestRender()}},{key:"untrashDisplayObject",value:function(e){return this._trash.delete(e)}},{key:"requestRender",value:function(){this._renderRemainingTime=2e3,this.renderRequested||(this.renderRequested=!0,this.emit("will-render"),this._taskHandle.resume())}},{key:"renderFrame",value:function(e){var t=this._lastFrameRenderTime?e.time-this._lastFrameRenderTime:0;this._renderRemainingTime-=t,this._renderRemainingTime<=0&&this._taskHandle.pause(),this._lastFrameRenderTime=e.time,this.renderRequested=!1,this._renderParameters.state=this._state,this._renderParameters.stationary=this.stationary,this._renderParameters.pixelRatio=window.devicePixelRatio,this._renderParameters.globalOpacity=1,this._renderParameters.time=e.time,this._renderParameters.deltaTime=e.deltaTime,this._renderParameters.effects=null,this.processRender(this._renderParameters),this._emptyTrash(),this.emit("post-render")}},{key:"_createTransforms",value:function(){return{dvs:(0,b.c)()}}},{key:"renderChildren",value:function(e){var t,r=(0,s.Z)(this.children);try{for(r.s();!(t=r.n()).done;){t.value.beforeRender(e)}}catch(a){r.e(a)}finally{r.f()}this._renderChildren(this.children,e);var i,n=(0,s.Z)(this.children);try{for(n.s();!(i=n.n()).done;){i.value.afterRender(e)}}catch(a){n.e(a)}finally{n.f()}}},{key:"_renderChildren",value:function(e,t){var r=this.context;r.resetInfo(),t.profiler.recordStart("drawLayers"),t.dataUploadCounter=0,t.drawPhase=T.jx.MAP,this.painter.beforeRenderLayers(r,this.background);var i,n=(0,s.Z)(e);try{for(n.s();!(i=n.n()).done;){i.value.processRender(t)}}catch(d){n.e(d)}finally{n.f()}this.painter.prepareDisplay(t,this.background,this.state.padding),this.painter.renderLayers(r),t.drawPhase=T.jx.HIGHLIGHT,this.painter.beforeRenderLayers(r);var a,o=(0,s.Z)(e);try{for(o.s();!(a=o.n()).done;){a.value.processRender(t)}}catch(d){o.e(d)}finally{o.f()}if(this.painter.renderLayers(r),this._isLabelDrawPhaseRequired(e)){t.drawPhase=T.jx.LABEL,this.painter.beforeRenderLayers(r);var u,h=(0,s.Z)(e);try{for(h.s();!(u=h.n()).done;){u.value.processRender(t)}}catch(d){h.e(d)}finally{h.f()}this.painter.renderLayers(r)}if((0,m.Z)("esri-tiles-debug")){t.drawPhase=T.jx.DEBUG,this.painter.beforeRenderLayers(r);var l,c=(0,s.Z)(e);try{for(c.s();!(l=c.n()).done;){l.value.processRender(t)}}catch(d){c.e(d)}finally{c.f()}this.painter.renderLayers(r)}t.profiler.recordEnd("drawLayers"),r.logInfo()}},{key:"doRender",value:function(e){var t=this.context,i=e.state,n=e.pixelRatio;this._resizeCanvas(e),t.setViewport(0,0,n*i.size[0],n*i.size[1]),t.setDepthWriteEnabled(!0),t.setStencilWriteMask(255),(0,l.Z)((0,c.Z)(r.prototype),"doRender",this).call(this,e)}},{key:"takeScreenshot",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,a,s,o,u,h,l,c,d,f,p,_,m;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={framebufferWidth:Math.round(this.state.size[0]*t.resolutionScale),framebufferHeight:Math.round(this.state.size[1]*t.resolutionScale)},a=r.framebufferWidth,s=r.framebufferHeight,1,o=this.context,u=this._state.clone(),null!=t.rotation&&(h=u.viewpoint,u.viewpoint.rotation=t.rotation,u.viewpoint=h),l=(0,n.Z)((0,n.Z)({},this._renderParameters),{},{drawPhase:null,globalOpacity:1,stationary:!0,state:u,pixelRatio:1,time:performance.now(),deltaTime:0,blendMode:null,effects:null,inFadeTransition:!1}),c=new Qt.X(o,{colorTarget:C.Lm.TEXTURE,depthStencilTarget:C.OU.DEPTH_STENCIL_RENDER_BUFFER,width:a,height:s}),d=o.getBoundFramebufferObject(),f=o.getViewport(),o.bindFramebuffer(c),o.setViewport(0,0,a,s),this._renderChildren(t.children,l),p=this._readbackScreenshot(c,(0,n.Z)((0,n.Z)({},t.cropArea),{},{y:s-(t.cropArea.y+t.cropArea.height)})),o.bindFramebuffer(d),o.setViewport(f.x,f.y,f.width,f.height),this.requestRender(),e.next=8,p;case 8:return _=e.sent,e.abrupt("return",(1===t.outputScale?m=_:(m=new ImageData(Math.round(_.width*t.outputScale),Math.round(_.height*t.outputScale)),(0,Zr.TT)(_,m,!0)),m));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_readbackScreenshot",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,Zr.r7)(r.width,r.height,document.createElement("canvas")),e.next=3,t.readPixelsAsync(r.x,r.y,r.width,r.height,C.VI.RGBA,C.Br.UNSIGNED_BYTE,new Uint8Array(n.data.buffer));case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_resizeCanvas",value:function(e){var t=this._canvas,r=t.style,i=e.state.size,n=e.pixelRatio,a=i[0],s=i[1],o=Math.round(a*n),u=Math.round(s*n);t.width===o&&t.height===u||(t.width=o,t.height=u),r.width=a+"px",r.height=s+"px"}},{key:"_emptyTrash",value:function(){for(;this._trash.size>0;){var e=Array.from(this._trash);this._trash.clear();for(var t=0,r=e;t<r.length;t++){r[t].processDetach()}}}},{key:"_isLabelDrawPhaseRequired",value:function(e){var t,r=!1,i=(0,s.Z)(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;if(!(n instanceof x.W)){r=r||!1;break}if(n.hasLabels)return!0;r=r||this._isLabelDrawPhaseRequired(n.children)}}catch(a){i.e(a)}finally{i.f()}return r}}]),r}(x.W),Sr=r(27366),Pr=r(85015),Ar=r(41691),zr=r(14916),Ur=r(49861),Ir=(r(25243),r(69912)),Dr=r(93433),Lr=r(16889),Nr=r(44333),Gr=function(){function e(t,r){(0,o.Z)(this,e),this.width=t,this.height=r;var i=Math.ceil(t/1),n=Math.ceil(r/1);this._cols=i,this._rows=n,this._cells=Nr.p.create(i*n)}return(0,u.Z)(e,[{key:"insertMetrics",value:function(e){var t=this._hasCollision(e);return 0===t&&this._markMetrics(e),t}},{key:"getCellId",value:function(e,t){return e+t*this._cols}},{key:"has",value:function(e){return this._cells.has(e)}},{key:"hasRange",value:function(e,t){return this._cells.hasRange(e,t)}},{key:"set",value:function(e){this._cells.set(e)}},{key:"setRange",value:function(e,t){this._cells.setRange(e,t)}},{key:"_hasCollision",value:function(e){var t=e.id,r=0,i=0;e.save();do{var n=e.boundsCount;r+=n;for(var a=0;a<n;a++){var s=e.boundsComputedAnchorX(a),o=e.boundsComputedAnchorY(a),u=e.boundsWidth(a)+2,h=e.boundsHeight(a)+2;switch(this._collide(s,o,u,h)){case 2:return 2;case 1:i++}}}while(e.peekId()===t&&e.next());return e.restore(),r===i?1:0}},{key:"_collide",value:function(e,t,r,i){var n=e-r/2,a=t-i/2,s=n+r,o=a+i;if(s<0||o<0||n>this.width||a>this.height)return 1;for(var u=(0,Lr.uZ)(Math.floor(n/1),0,this._cols),h=(0,Lr.uZ)(Math.floor(a/1),0,this._rows),l=(0,Lr.uZ)(Math.ceil(s/1),0,this._cols),c=(0,Lr.uZ)(Math.ceil(o/1),0,this._rows),d=h;d<=c;d++)for(var f=u;f<=l;f++){var p=this.getCellId(f,d);if(this.has(p))return 2}return 0}},{key:"_mark",value:function(e,t,r,i){for(var n=e-r/2,a=t-i/2,s=n+r,o=a+i,u=(0,Lr.uZ)(Math.floor(n/1),0,this._cols),h=(0,Lr.uZ)(Math.floor(a/1),0,this._rows),l=(0,Lr.uZ)(Math.ceil(s/1),0,this._cols),c=(0,Lr.uZ)(Math.ceil(o/1),0,this._rows),d=h;d<=c;d++)for(var f=u;f<=l;f++){var p=this.getCellId(f,d);this.set(p)}return!1}},{key:"_markMetrics",value:function(e){var t=e.id;do{for(var r=e.boundsCount,i=0;i<r;i++){var n=e.boundsComputedAnchorX(i),a=e.boundsComputedAnchorY(i),s=e.boundsWidth(i)+2,o=e.boundsHeight(i)+2;this._mark(n,a,s,o)}}while(e.peekId()===t&&e.next())}}]),e}(),Vr=r(49229),Hr=r(80724),qr=Math.PI;function jr(e,t){switch(t.transformationType){case Hr.hL.Additive:return function(e,t){return e+(Wr(t.minSize,e)||t.minDataValue)}(e,t);case Hr.hL.Constant:return function(e,t){var r=e.stops,i=r&&r.length&&r[0].size;return null==i&&(i=e.minSize),Wr(i,t)}(t,e);case Hr.hL.ClampedLinear:return function(e,t){var r=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),i=Wr(t.minSize,e),n=Wr(t.maxSize,e);return e<=t.minDataValue?i:e>=t.maxDataValue?n:i+r*(n-i)}(e,t);case Hr.hL.Proportional:return function(e,t){var r=e/t.minDataValue,i=Wr(t.minSize,e),n=Wr(t.maxSize,e),a=null;return a=r*i,(0,Lr.uZ)(a,i,n)}(e,t);case Hr.hL.Stops:return function(e,t){var r=function(e,t){if(!t)return;var r=0,i=t.length-1;return t.some((function(t,n){return e<t?(i=n,!0):(r=n,!1)})),[r,i,(e-t[r])/(t[i]-t[r])]}(e,t.cache.ipData),i=(0,pe.Z)(r,3),n=i[0],a=i[1],s=i[2];if(n===a)return Wr(t.stops[n].size,e);var o=Wr(t.stops[n].size,e);return o+(Wr(t.stops[a].size,e)-o)*s}(e,t);case Hr.hL.RealWorldSize:return function(e,t){var r=Vr.a[t.valueUnit],i=Wr(t.minSize,e),n=Wr(t.maxSize,e),a=t.valueRepresentation,s=null;return s="area"===a?2*Math.sqrt(e/qr)/r:"radius"===a||"distance"===a?2*e/r:e/r,(0,Lr.uZ)(s,i,n)}(e,t);case Hr.hL.Identity:return e;case Hr.hL.Unknown:return null}}function Wr(e,t){return"number"==typeof e?e:jr(t,e)}var Xr=255;function Yr(e,t){var r=[];e.forEachTile((function(e){return r.push(e)})),r.sort((function(e,t){return e.instanceId-t.instanceId})),r.forEach((function(e){(0,v.pC)(e.labelMetrics)&&e.isReady&&t(e,e.labelMetrics.getCursor())}))}function Qr(e){return function(t){return(0,X.F2)(jr(t,e))}}function Kr(e,t){if(function(e){return e.layer&&("feature"===e.layer.type||"csv"===e.layer.type||"geojson"===e.layer.type||"ogc-feature"===e.layer.type||"stream"===e.layer.type||"subtype-group"===e.layer.type||"wfs"===e.layer.type)}(t)){var r="subtype-group"===t.layer.type?t.layer.sublayers.items:[t.layer],i=t.layer.geometryType,n=!function(e){var t,r=(0,s.Z)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,n="featureReduction"in i&&i.featureReduction&&"labelingInfo"in i.featureReduction&&i.featureReduction,a=[].concat((0,Dr.Z)(i.labelingInfo||[]),(0,Dr.Z)((null===n||void 0===n?void 0:n.labelingInfo)||[]));if(i.labelsVisible&&a.length&&a.some((function(e){return"none"===e.deconflictionStrategy})))return!0}}catch(o){r.e(o)}finally{r.f()}return!1}(r),a={};if("subtype-group"!==t.layer.type){var o;if("heatmap"===(null===(o=t.tileRenderer)||void 0===o?void 0:o.type))return;var u=function(e){var t="visualVariables"in e&&e.visualVariables;if(!t)return null;var r,i=(0,s.Z)(t);try{for(i.s();!(r=i.n()).done;){var n=r.value;if("size"===n.type)return Qr(n)}}catch(a){i.e(a)}finally{i.f()}return null}(t.layer.renderer);a[0]=u}var h=t.tileRenderer;if(!(0,v.Wi)(h)){var l=t.layer.visible&&!t.suspended;e.push({tileRenderer:h,vvEvaluators:a,deconflictionEnabled:n,geometryType:i,visible:l})}}}var $r=function(){function e(){(0,o.Z)(this,e)}return(0,u.Z)(e,[{key:"run",value:function(e,t,r){for(var i=[],n=e.length-1;n>=0;n--)Kr(i,e[n]);this._transformMetrics(i,t),this._runCollision(i,t,r)}},{key:"_runCollision",value:function(e,t,r){var i,n=this,a=(0,pe.Z)(t.state.size,2),o=a[0],u=a[1],h=new Gr(o*t.pixelRatio,u*t.pixelRatio),l=(0,s.Z)(e);try{var c=function(){var e=i.value,t=e.tileRenderer,a=e.deconflictionEnabled,s=e.visible,o=t.featuresView.attributeView;a?s?(n._prepare(t),n._collideVisible(h,t,r),n._collideInvisible(h,t)):Yr(t,(function(e,t){for(;t.nextId();)o.setLabelMinZoom(t.id,Xr)})):Yr(t,(function(e,t){for(;t.nextId();)o.setLabelMinZoom(t.id,0)}))};for(l.s();!(i=l.n()).done;)c()}catch(d){l.e(d)}finally{l.f()}}},{key:"_isFiltered",value:function(e,t,r){var i=t.getFilterFlags(e),n=!r.hasFilter||!!(i&$.Zd),a=(0,v.Wi)(r.featureEffect)||r.featureEffect.excludedLabelsVisible||!!(i&$.iV);return!(n&&a)}},{key:"_prepare",value:function(e){var t=this,r=e.featuresView.attributeView,i=new Set;Yr(e,(function(n,a){for(;a.nextId();)i.has(a.id)||(i.add(a.id),t._isFiltered(a.id,r,e.layerView)?r.setLabelMinZoom(a.id,254):0!==r.getLabelMinZoom(a.id)?r.setLabelMinZoom(a.id,Xr):r.setLabelMinZoom(a.id,0))}))}},{key:"_collideVisible",value:function(e,t,r){var i=t.featuresView.attributeView,n=new Set;Yr(t,(function(t,a){for(;a.nextId();)if(!n.has(a.id))if(t.key.level===r){if(0===i.getLabelMinZoom(a.id))switch(e.insertMetrics(a)){case 1:break;case 2:i.setLabelMinZoom(a.id,254),n.add(a.id);break;case 0:i.setLabelMinZoom(a.id,0),n.add(a.id)}}else i.setLabelMinZoom(a.id,254)}))}},{key:"_collideInvisible",value:function(e,t){var r=t.featuresView.attributeView,i=new Set;Yr(t,(function(t,n){for(;n.nextId();)if(!i.has(n.id)&&r.getLabelMinZoom(n.id)===Xr)switch(e.insertMetrics(n)){case 1:break;case 2:r.setLabelMinZoom(n.id,Xr),i.add(n.id);break;case 0:r.setLabelMinZoom(n.id,0),i.add(n.id)}}))}},{key:"_transformMetrics",value:function(e,t){var r,i=(0,s.Z)(e);try{var n=function(){var e=r.value,i=e.tileRenderer,n=e.geometryType,a=e.vvEvaluators;Yr(i,(function(e,r){var s=i.featuresView.attributeView,o=e.transforms.labelMat2d;o[4]=Math.round(o[4]),o[5]=Math.round(o[5]);for(var u=o[4],h=o[5],l="polyline"===n;r.next();){var c=r.boundsCount,d=r.anchorX,f=r.anchorY,p=r.size,_=a[0];if((0,v.pC)(_)){var m=_(s.getVVSize(r.id));p=isNaN(m)||null==m||m===1/0?p:m}for(var g=r.directionX*(p/2),y=r.directionY*(p/2),b=0;b<c;b++){var w=d,x=r.anchorY;if(l){var T=w+r.boundsX(b)+g,k=x+r.boundsY(b)+y;t.state.rotation?(T=o[0]*T+o[2]*k+o[4],k=o[1]*T+o[3]*k+o[5]):(T+=u,k+=h),r.setBoundsComputedAnchorX(b,Math.floor(T)),r.setBoundsComputedAnchorY(b,Math.floor(k))}else{t.state.rotation?(w=o[0]*d+o[2]*f+o[4],x=o[1]*d+o[3]*f+o[5]):(w+=u,x+=h);var E=w+r.boundsX(b)+g,M=x+r.boundsY(b)+y;r.setBoundsComputedAnchorX(b,E),r.setBoundsComputedAnchorY(b,M)}}}}))};for(i.s();!(r=i.n()).done;)n()}catch(a){i.e(a)}finally{i.f()}}}]),e}();j.Z.getLogger("esri.views.2d.layers.labels.LabelManager");var Jr=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var i;return(0,o.Z)(this,r),(i=t.call(this,e))._applyVisibilityPassThrottled=(0,zr.P)(i._applyVisibilityPass,32,(0,h.Z)(i)),i.lastUpdateId=-1,i.updateRequested=!1,i.view=null,i}return(0,u.Z)(r,[{key:"initialize",value:function(){this.collisionEngine=new $r}},{key:"destroy",value:function(){this.collisionEngine=null,this._applyVisibilityPassThrottled.remove(),this._applyVisibilityPassThrottled=null}},{key:"updating",get:function(){return this.updateRequested}},{key:"update",value:function(e){this._applyVisibilityPassThrottled(e)}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"requestUpdate",value:function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}},{key:"processUpdate",value:function(e){this._set("updateParameters",e),this.updateRequested&&(this.updateRequested=!1,this.update(e))}},{key:"_applyVisibilityPass",value:function(e){try{var t=this.view.featuresTilingScheme.getClosestInfoForScale(e.state.scale).level;this.collisionEngine.run(this.view.allLayerViews.items,e,t)}catch(Zt){}}}]),r}((0,Ar.p)(Pr.Z));(0,Sr._)([(0,Ur.Cb)()],Jr.prototype,"updateRequested",void 0),(0,Sr._)([(0,Ur.Cb)({readOnly:!0})],Jr.prototype,"updateParameters",void 0),(0,Sr._)([(0,Ur.Cb)()],Jr.prototype,"updating",null),(0,Sr._)([(0,Ur.Cb)()],Jr.prototype,"view",void 0);var ei=Jr=(0,Sr._)([(0,Ir.j)("esri.views.2d.layers.labels.LabelManager")],Jr),ti=r(77318),ri=r(75391),ii=r(36721),ni=r(7882),ai=r(86226),si=r(91806),oi="esri-zoom-box__container",ui="esri-zoom-box__overlay",hi="esri-zoom-box__overlay-background",li="esri-zoom-box__outline",ci="Shift",di="Ctrl",fi=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var i;return(0,o.Z)(this,r),(i=t.call(this,e))._container=null,i._overlay=null,i._backgroundShape=null,i._boxShape=null,i._box={x:0,y:0,width:0,height:0},i._redraw=i._redraw.bind((0,h.Z)(i)),i}return(0,u.Z)(r,[{key:"destroy",value:function(){this.view=null}},{key:"view",set:function(e){var t=this;this._handles&&this._handles.forEach((function(e){e.remove()})),this._handles=null,this._destroyOverlay(),this._set("view",e),e&&(e.on("drag",[ci],(function(e){return t._handleDrag(e,1)}),si.f.INTERNAL),e.on("drag",[ci,di],(function(e){return t._handleDrag(e,-1)}),si.f.INTERNAL))}},{key:"_start",value:function(){this._createContainer(),this._createOverlay(),this.navigation.begin()}},{key:"_update",value:function(e,t,r,i){this._box.x=e,this._box.y=t,this._box.width=r,this._box.height=i,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}},{key:"_end",value:function(e,t,r,i,n){var a=this.view,s=a.toMap((0,X.vW)(e+.5*r,t+.5*i)),o=Math.max(r/a.width,i/a.height);-1===n&&(o=1/o),this._destroyOverlay(),this.navigation.end(),a.goTo({center:s,scale:a.scale*o})}},{key:"_updateBox",value:function(e,t,r,i){var n=this._boxShape;n.setAttributeNS(null,"x",""+e),n.setAttributeNS(null,"y",""+t),n.setAttributeNS(null,"width",""+r),n.setAttributeNS(null,"height",""+i),n.setAttributeNS(null,"class",li)}},{key:"_updateBackground",value:function(e,t,r,i){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(e,t,r,i,this.view.width,this.view.height))}},{key:"_createContainer",value:function(){var e=document.createElement("div");e.className=oi,this.view.root.appendChild(e),this._container=e}},{key:"_createOverlay",value:function(){var e=this.view.width,t=this.view.height,r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttributeNS(null,"d","M 0 0 L "+e+" 0 L "+e+" "+t+" L 0 "+t+" Z"),r.setAttributeNS(null,"class",hi);var i=document.createElementNS("http://www.w3.org/2000/svg","rect"),n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttributeNS(null,"class",ui),n.appendChild(r),n.appendChild(i),this._container.appendChild(n),this._backgroundShape=r,this._boxShape=i,this._overlay=n}},{key:"_destroyOverlay",value:function(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}},{key:"_toSVGPath",value:function(e,t,r,i,n,a){var s=e+r,o=t+i;return"M 0 0 L "+n+" 0 L "+n+" "+a+" L 0 "+a+" ZM "+e+" "+t+" L "+e+" "+o+" L "+s+" "+o+" L "+s+" "+t+" Z"}},{key:"_handleDrag",value:function(e,t){var r,i,n,a,s=e.x,o=e.y,u=e.origin.x,h=e.origin.y;switch(s>u?(r=u,n=s-u):(r=s,n=u-s),o>h?(i=h,a=o-h):(i=o,a=h-o),e.action){case"start":this._start();break;case"update":this._update(r,i,n,a);break;case"end":this._end(r,i,n,a,t)}e.stopPropagation()}},{key:"_redraw",value:function(){if(this._rafId&&(this._rafId=null,this._overlay)){var e=this._box,t=e.x,r=e.y,i=e.width,n=e.height;this._updateBox(t,r,i,n),this._updateBackground(t,r,i,n),this._rafId=requestAnimationFrame(this._redraw)}}}]),r}(Pr.Z);(0,Sr._)([(0,Ur.Cb)()],fi.prototype,"navigation",void 0),(0,Sr._)([(0,Ur.Cb)()],fi.prototype,"view",null);var pi=fi=(0,Sr._)([(0,Ir.j)("esri.views.2d.navigation.ZoomBox")],fi),_i=(r(59486),r(87022)),mi=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var i;return(0,o.Z)(this,r),(i=t.call(this,e)).animationTime=0,i.momentumEstimator=new _i.G(500,6,.92),i.momentum=null,i.tmpMomentum=(0,kt.c)(),i.momentumFinished=!1,i.viewpoint=new ii.Z({targetGeometry:new ni.Z,scale:0,rotation:0}),(0,g.gx)((function(){return i.momentumFinished}),(function(){return i.navigation.stop()})),i}return(0,u.Z)(r,[{key:"begin",value:function(e,t){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(t),this.previousDrag=t}},{key:"update",value:function(e,t){this.addToEstimator(t);var r=t.center.x,i=t.center.y,n=this.previousDrag;r=n?n.center.x-r:-r,i=n?i-n.center.y:i,e.viewpoint=(0,ai.Rx)(this.viewpoint,e.viewpoint,[r||0,i||0]),this.previousDrag=t}},{key:"end",value:function(e,t){this.addToEstimator(t);var r=e.navigation.momentumEnabled;this.momentum=r?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(e),this.previousDrag=null,this.navigation.end()}},{key:"addToEstimator",value:function(e){var t=e.center.x,r=e.center.y,i=(0,X.s1)(-t,r),n=(0,kt.f)(-t,r,0);this.momentumEstimator.add(i,n,.001*e.timestamp)}},{key:"onAnimationUpdate",value:function(e){var t=this;this.navigation.animationManager.animateContinous(e.viewpoint,(function(r,i){t.momentumFinished=!t.momentum||t.momentum.isFinished(t.animationTime);var n=.001*i;if(!t.momentumFinished){var a=t.momentum.valueDelta(t.animationTime,n);(0,Tt.g)(t.tmpMomentum,t.momentum.direction,a),(0,ai.Rx)(r,r,t.tmpMomentum),e.constraints.constrainByGeometry(r)}t.animationTime+=n}))}},{key:"stopMomentumNavigation",value:function(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}}]),r}(Pr.Z);(0,Sr._)([(0,Ur.Cb)()],mi.prototype,"momentumFinished",void 0),(0,Sr._)([(0,Ur.Cb)()],mi.prototype,"viewpoint",void 0),(0,Sr._)([(0,Ur.Cb)()],mi.prototype,"navigation",void 0);var vi=mi=(0,Sr._)([(0,Ir.j)("esri.views.2d.navigation.actions.Pan")],mi),gi=r(19475),yi=r(62124),bi=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var i;return(0,o.Z)(this,r),(i=t.call(this,e))._animationTime=0,i._momentumFinished=!1,i._rotationMomentumEstimator=new gi.y(.6,.15,.95),i._rotationDirection=1,i._zoomDirection=1,i._zoomMomentumEstimator=new yi.D,i._zoomOnly=null,i.zoomMomentum=null,i.rotateMomentum=null,i.viewpoint=new ii.Z({targetGeometry:new ni.Z,scale:0,rotation:0}),i.own((0,g.gx)((function(){return i._momentumFinished}),(function(){return i.navigation.stop()}))),i}return(0,u.Z)(r,[{key:"begin",value:function(e,t){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=t.angle,this._previousRadius=this._startRadius=t.radius,this._previousCenter=t.center,this._updateTimestamp=null,e.constraints.rotationEnabled&&this.addToRotateEstimator(0,t.timestamp),this.addToZoomEstimator(t,1)}},{key:"update",value:function(e,t){null===this._updateTimestamp&&(this._updateTimestamp=t.timestamp);var r=t.angle,i=t.radius,n=t.center,a=Math.abs(180*(r-this._startAngle)/Math.PI),s=Math.abs(i-this._startRadius),o=this._startRadius/i;if(this._previousRadius){var u=i/this._previousRadius,h=180*(r-this._previousAngle)/Math.PI;this._rotationDirection=h>=0?1:-1,this._zoomDirection=u>=1?1:-1,e.constraints.rotationEnabled?(null===this._zoomOnly&&t.timestamp-this._updateTimestamp>200&&(this._zoomOnly=s-a>0),null===this._zoomOnly||this._zoomOnly?h=0:this.addToRotateEstimator(r-this._startAngle,t.timestamp)):h=0,this.addToZoomEstimator(t,o),this.navigation.setViewpoint([n.x,n.y],1/u,h,[this._previousCenter.x-n.x,n.y-this._previousCenter.y])}this._previousAngle=r,this._previousRadius=i,this._previousCenter=n}},{key:"end",value:function(e){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(e),this.navigation.end()}},{key:"addToRotateEstimator",value:function(e,t){this._rotationMomentumEstimator.add(e,.001*t)}},{key:"addToZoomEstimator",value:function(e,t){this._zoomMomentumEstimator.add(t,.001*e.timestamp)}},{key:"canZoomIn",value:function(e){var t=e.scale,r=e.constraints.effectiveMaxScale;return 0===r||t>r}},{key:"canZoomOut",value:function(e){var t=e.scale,r=e.constraints.effectiveMinScale;return 0===r||t<r}},{key:"onAnimationUpdate",value:function(e){var t=this;this.navigation.animationManager.animateContinous(e.viewpoint,(function(r,i){var n=!t.canZoomIn(e)&&t._zoomDirection>1||!t.canZoomOut(e)&&t._zoomDirection<1,a=!t.rotateMomentum||t.rotateMomentum.isFinished(t._animationTime),s=n||!t.zoomMomentum||t.zoomMomentum.isFinished(t._animationTime),o=.001*i;if(t._momentumFinished=a&&s,!t._momentumFinished){var u=t.rotateMomentum?Math.abs(t.rotateMomentum.valueDelta(t._animationTime,o))*t._rotationDirection*180/Math.PI:0,h=t.zoomMomentum?Math.abs(t.zoomMomentum.valueDelta(t._animationTime,o)):1,l=(0,xt.a)(),c=(0,xt.a)();if(t._previousCenter){(0,Y.a)(l,t._previousCenter.x,t._previousCenter.y),(0,ai.Dq)(c,e.size,e.padding),(0,Y.b)(l,l,c);var d=e.constraints,f=e.scale,p=f*h;h<1&&!d.canZoomInTo(p)?(h=f/d.effectiveMaxScale,t.zoomMomentum=null,t.rotateMomentum=null):h>1&&!d.canZoomOutTo(p)&&(h=f/d.effectiveMinScale,t.zoomMomentum=null,t.rotateMomentum=null),(0,ai.UZ)(r,e.viewpoint,h,u,l,e.size),e.constraints.constrainByGeometry(r)}}t._animationTime+=o}))}},{key:"stopMomentumNavigation",value:function(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}}]),r}(Pr.Z);(0,Sr._)([(0,Ur.Cb)()],bi.prototype,"_momentumFinished",void 0),(0,Sr._)([(0,Ur.Cb)()],bi.prototype,"viewpoint",void 0),(0,Sr._)([(0,Ur.Cb)()],bi.prototype,"navigation",void 0);var wi=bi=(0,Sr._)([(0,Ir.j)("esri.views.2d.navigation.actions.Pinch")],bi),xi=(0,xt.a)(),Ti=(0,xt.a)(),ki=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var i;return(0,o.Z)(this,r),(i=t.call(this,e))._previousCenter=(0,xt.a)(),i.viewpoint=new ii.Z({targetGeometry:new ni.Z,scale:0,rotation:0}),i}return(0,u.Z)(r,[{key:"begin",value:function(e,t){this.navigation.begin(),(0,Y.a)(this._previousCenter,t.center.x,t.center.y)}},{key:"update",value:function(e,t){var r=e.state,i=r.size,n=r.padding;(0,Y.a)(xi,t.center.x,t.center.y),(0,ai.ni)(Ti,i,n),e.viewpoint=(0,ai.$H)(this.viewpoint,e.state.paddedViewState.viewpoint,(0,ai.dI)(Ti,this._previousCenter,xi)),(0,Y.c)(this._previousCenter,xi)}},{key:"end",value:function(){this.navigation.end()}}]),r}(Pr.Z);(0,Sr._)([(0,Ur.Cb)()],ki.prototype,"viewpoint",void 0),(0,Sr._)([(0,Ur.Cb)()],ki.prototype,"navigation",void 0);var Ei=ki=(0,Sr._)([(0,Ir.j)("esri.views.2d.actions.Rotate")],ki),Mi=new ii.Z({targetGeometry:new ni.Z}),Bi=[0,0],Ri=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var i;return(0,o.Z)(this,r),(i=t.call(this,e))._endTimer=null,i.animationManager=null,i}return(0,u.Z)(r,[{key:"initialize",value:function(){this.pan=new vi({navigation:this}),this.rotate=new Ei({navigation:this}),this.pinch=new wi({navigation:this}),this.zoomBox=new pi({view:this.view,navigation:this})}},{key:"destroy",value:function(){this.pan.destroy(),this.rotate.destroy(),this.pinch.destroy(),this.zoomBox.destroy(),this.pan=this.rotate=this.pinch=this.zoomBox=this.animationManager=null}},{key:"begin",value:function(){this._set("interacting",!0)}},{key:"end",value:function(){this._lastEventTimestamp=performance.now(),this._startTimer(250)}},{key:"zoom",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.length>1&&void 0!==n[1]?n[1]:this._getDefaultAnchor(),this.stop(),this.begin(),!this.view.constraints.snapToZoom||!this.view.constraints.effectiveLODs){e.next=3;break}return e.abrupt("return",t<1?this.zoomIn(r):this.zoomOut(r));case 3:this.setViewpoint(r,t,0,[0,0]);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"zoomIn",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.view,n=r.constraints.snapToNextScale(r.scale),e.abrupt("return",this._zoomToScale(n,t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"zoomOut",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.view,n=r.constraints.snapToPreviousScale(r.scale),e.abrupt("return",this._zoomToScale(n,t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setViewpoint",value:function(e,t,r,i){this.begin(),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,e,t,r,i),this.end()}},{key:"setViewpointImmediate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._getDefaultAnchor();this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,i,e,t,r)}},{key:"continousRotateClockwise",value:function(){var e=this.get("view.viewpoint");this.animationManager.animateContinous(e,(function(e){(0,ai.$H)(e,e,-1)}))}},{key:"continousRotateCounterclockwise",value:function(){var e=this.get("view.viewpoint");this.animationManager.animateContinous(e,(function(e){(0,ai.$H)(e,e,1)}))}},{key:"resetRotation",value:function(){this.view.rotation=0}},{key:"continousPanLeft",value:function(){this._continuousPan([-10,0])}},{key:"continousPanRight",value:function(){this._continuousPan([10,0])}},{key:"continousPanUp",value:function(){this._continuousPan([0,10])}},{key:"continousPanDown",value:function(){this._continuousPan([0,-10])}},{key:"stop",value:function(){this.pan.stopMomentumNavigation(),this.animationManager.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}},{key:"_continuousPan",value:function(e){var t=this,r=this.view.viewpoint;this.animationManager.animateContinous(r,(function(r){(0,ai.Rx)(r,r,e),t.view.constraints.constrainByGeometry(r)}))}},{key:"_startTimer",value:function(e){var t=this;return null!==this._endTimer||(this._endTimer=setTimeout((function(){t._endTimer=null;var e=performance.now()-t._lastEventTimestamp;e<250?t._endTimer=t._startTimer(e):t._set("interacting",!1)}),e)),this._endTimer}},{key:"_getDefaultAnchor",value:function(){var e=this.view,t=e.size,r=e.padding,i=r.left,n=r.right,a=r.top,s=r.bottom;return Bi[0]=.5*(t[0]-n+i),Bi[1]=.5*(t[1]-s+a),Bi}},{key:"_zoomToScale",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,s,o,u,h,l,c,d=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=d.length>1&&void 0!==d[1]?d[1]:this._getDefaultAnchor(),n=this.view,a=n.constraints,s=n.scale,o=n.viewpoint,u=n.size,h=n.padding,l=a.canZoomInTo(t),c=a.canZoomOutTo(t),t<s&&!l||t>s&&!c){e.next=4;break}return e.abrupt("return",((0,ai.gG)(Mi,o,t/s,0,r,u,h),a.constrainByGeometry(Mi),n.goTo(Mi,{animate:!0})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_scaleRotateTranslateViewpoint",value:function(e,t,r,i,n){var a=this.view,s=a.size,o=a.padding,u=a.constraints,h=a.scale,l=a.viewpoint,c=h*r,d=u.canZoomInTo(c),f=u.canZoomOutTo(c);return(r<1&&!d||r>1&&!f)&&(r=1),(0,ai.Rx)(l,l,n),(0,ai.gG)(e,l,r,i,t,s,o),u.constrainByGeometry(e)}}]),r}(Pr.Z);(0,Sr._)([(0,Ur.Cb)()],Ri.prototype,"animationManager",void 0),(0,Sr._)([(0,Ur.Cb)({type:Boolean,readOnly:!0})],Ri.prototype,"interacting",void 0),(0,Sr._)([(0,Ur.Cb)()],Ri.prototype,"pan",void 0),(0,Sr._)([(0,Ur.Cb)()],Ri.prototype,"pinch",void 0),(0,Sr._)([(0,Ur.Cb)()],Ri.prototype,"rotate",void 0),(0,Sr._)([(0,Ur.Cb)()],Ri.prototype,"view",void 0),(0,Sr._)([(0,Ur.Cb)()],Ri.prototype,"zoomBox",void 0);var Zi=Ri=(0,Sr._)([(0,Ir.j)("esri.views.2d.navigation.MapViewNavigation")],Ri),Ci=r(100),Fi=r(35995),Oi=r(87422),Si={shaders:{vertexShader:(0,B.w)("magnifier/magnifier.vert"),fragmentShader:(0,B.w)("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};var Pi=r(4583),Ai=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.call(this))._handles=new Ci.Z,e._resourcePixelRatio=1,e.visible=!1,e}return(0,u.Z)(r,[{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this._disposeRenderResources(),this._resourcesTask&&(this._resourcesTask.abort(),this._resourcesTask=null)}},{key:"background",get:function(){return this._background},set:function(e){this._background=e,this.requestRender()}},{key:"magnifier",get:function(){return this._magnifier},set:function(e){var t=this;this._magnifier=e,this._handles.removeAll(),this._handles.add([(0,g.YP)((function(){return e.version}),(function(){t.visible=e.visible&&(0,v.pC)(e.position)&&e.size>0,t.requestRender()}),g.nn),(0,g.YP)((function(){return[e.maskUrl,e.overlayUrl]}),(function(){return t._reloadResources()})),(0,g.YP)((function(){return e.size}),(function(){t._disposeRenderResources(),t.requestRender()}))])}},{key:"_createTransforms",value:function(){return{dvs:(0,b.c)()}}},{key:"doRender",value:function(e){var t,r=e.context;if(this._resourcesTask){if(e.drawPhase===T.jx.MAP&&this._canRender()){this._updateResources(e);var i=this._magnifier;if(!(0,v.Wi)(i.position)){var n=e.pixelRatio,a=i.size*n,s=1/i.factor,o=Math.ceil(s*a);this._readbackTexture.resize(o,o);var u=e.state.size,h=n*u[0],l=n*u[1],c=.5*o,d=.5*o,f=(0,Lr.uZ)(n*i.position.x,c,h-c-1),p=(0,Lr.uZ)(l-n*i.position.y,d,l-d-1);r.setBlendingEnabled(!0);var _=f-c,m=p-d,g=this._readbackTexture;r.bindTexture(g,0),r.gl.copyTexImage2D(g.descriptor.target,0,g.descriptor.pixelFormat,_,m,o,o,0);var y=null===(t=this.background)||void 0===t?void 0:t.color,b=y?[y.a*y.r/255,y.a*y.g/255,y.a*y.b/255,y.a]:[1,1,1,1],w=(f+i.offset.x*n)/h*2-1,x=(p-i.offset.y*n)/l*2-1,k=a/h*2,E=a/l*2,M=this._program;r.bindVAO(this._vertexArrayObject),r.bindTexture(this._overlayTexture,6),r.bindTexture(this._maskTexture,7),r.useProgram(M),M.setUniform4fv("u_background",b),M.setUniform1i("u_readbackTexture",0),M.setUniform1i("u_overlayTexture",6),M.setUniform1i("u_maskTexture",7),M.setUniform4f("u_drawPos",w,x,k,E),M.setUniform1i("u_maskEnabled",i.maskEnabled?1:0),M.setUniform1i("u_overlayEnabled",i.overlayEnabled?1:0),r.setStencilTestEnabled(!1),r.setColorMask(!0,!0,!0,!0),r.drawArrays(C.MX.TRIANGLE_STRIP,0,4),r.bindVAO()}}}else this._reloadResources()}},{key:"_canRender",value:function(){return this.mask&&this.overlay&&null!=this._magnifier}},{key:"_reloadResources",value:function(){var e=this;this._resourcesTask&&this._resourcesTask.abort();var t=(0,v.pC)(this._magnifier)?this._magnifier.maskUrl:null,r=(0,v.pC)(this._magnifier)?this._magnifier.overlayUrl:null;this._resourcesTask=(0,W.vr)(function(){var n=(0,a.Z)((0,i.Z)().mark((function n(a){var s,o,u,h,l,c,d;return(0,i.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return s=(0,v.Wi)(t)||(0,v.Wi)(r)?(0,Pi.e)(a):null,o=(0,v.pC)(t)?(0,H.default)(t,{responseType:"image",signal:a}).then((function(e){return e.data})):s.then((function(e){return e.mask})),u=(0,v.pC)(r)?(0,H.default)(r,{responseType:"image",signal:a}).then((function(e){return e.data})):s.then((function(e){return e.overlay})),i.next=5,Promise.all([o,u]);case 5:h=i.sent,l=(0,pe.Z)(h,2),c=l[0],d=l[1],e.mask=c,e.overlay=d,e._disposeRenderResources(),e.requestRender();case 10:case"end":return i.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}},{key:"_disposeRenderResources",value:function(){this._readbackTexture=(0,v.O3)(this._readbackTexture),this._overlayTexture=(0,v.O3)(this._overlayTexture),this._maskTexture=(0,v.O3)(this._maskTexture),this._vertexArrayObject=(0,v.O3)(this._vertexArrayObject),this._program=(0,v.O3)(this._program)}},{key:"_updateResources",value:function(e){if(e.pixelRatio!==this._resourcePixelRatio&&this._disposeRenderResources(),!this._readbackTexture){var t=e.context;this._resourcePixelRatio=e.pixelRatio;var r=Math.ceil(this._magnifier.size*e.pixelRatio);this._program=function(e){return(0,F.H)(e,Si)}(t);var i=new Uint16Array([0,1,0,0,1,1,1,0]),n=Si.attributes;this._vertexArrayObject=new O.U(t,n,M.cD,{geometry:Z.f.createVertex(t,C.l1.STATIC_DRAW,i)}),this.overlay.width=r,this.overlay.height=r,this._overlayTexture=new re.x(t,{target:C.No.TEXTURE_2D,pixelFormat:C.VI.RGBA,internalFormat:C.VI.RGBA,dataType:C.Br.UNSIGNED_BYTE,wrapMode:C.e8.CLAMP_TO_EDGE,samplingMode:C.cw.NEAREST,flipped:!0,preMultiplyAlpha:!(0,Fi.zd)(this.overlay.src)||!e.context.driverTest.svgAlwaysPremultipliesAlpha},this.overlay),this.mask.width=r,this.mask.height=r,this._maskTexture=new re.x(t,{target:C.No.TEXTURE_2D,pixelFormat:C.VI.ALPHA,internalFormat:C.VI.ALPHA,dataType:C.Br.UNSIGNED_BYTE,wrapMode:C.e8.CLAMP_TO_EDGE,samplingMode:C.cw.NEAREST,flipped:!0},this.mask);var a=1/this._magnifier.factor;this._readbackTexture=new re.x(t,{target:C.No.TEXTURE_2D,pixelFormat:C.VI.RGBA,internalFormat:C.VI.RGBA,dataType:C.Br.UNSIGNED_BYTE,wrapMode:C.e8.CLAMP_TO_EDGE,samplingMode:C.cw.LINEAR,flipped:!1,width:Math.ceil(a*r),height:Math.ceil(a*r)})}}}]),r}(Oi.s)}}]);
//# sourceMappingURL=961.e327219e.chunk.js.map