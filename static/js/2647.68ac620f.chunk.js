"use strict";(self.webpackChunkuums_front_end=self.webpackChunkuums_front_end||[]).push([[2647],{98067:function(e,t,i){i.d(t,{m:function(){return R}});var r=i(74165),s=i(1413),n=i(15861),a=i(15671),o=i(43144),l=i(66978),h=i(35995),u=i(31009),c=i(37762),y=i(12233),f=function(){function e(t,i){(0,a.Z)(this,e),this._width=0,this._height=0,this._free=[],this._width=t,this._height=i,this._free.push(new y.Z(0,0,t,i))}return(0,o.Z)(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"allocate",value:function(e,t){if(e>this._width||t>this._height)return new y.Z;for(var i=null,r=-1,s=0;s<this._free.length;++s){var n=this._free[s];e<=n.width&&t<=n.height&&(null===i||n.y<=i.y&&n.x<=i.x)&&(i=n,r=s)}return null===i?new y.Z:(this._free.splice(r,1),i.width<i.height?(i.width>e&&this._free.push(new y.Z(i.x+e,i.y,i.width-e,t)),i.height>t&&this._free.push(new y.Z(i.x,i.y+t,i.width,i.height-t))):(i.width>e&&this._free.push(new y.Z(i.x+e,i.y,i.width-e,i.height)),i.height>t&&this._free.push(new y.Z(i.x,i.y+t,e,i.height-t))),new y.Z(i.x,i.y,e,t))}},{key:"release",value:function(e){for(var t=0;t<this._free.length;++t){var i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}]),e}(),v=i(8548),d=i(371),_=function(){function e(t,i,r){(0,a.Z)(this,e),this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=i,this._glyphSource=r,this._binPack=new f(t-4,i-4),this._glyphData.push(new Uint8Array(t*i)),this._dirties.push(!0),this._textures.push(void 0)}return(0,o.Z)(e,[{key:"getGlyphItems",value:function(e,t){var i,r=this,s=[],n=this._glyphSource,a=new Set,o=(0,c.Z)(t);try{for(o.s();!(i=o.n()).done;){var l=i.value,h=Math.floor(.00390625*l);a.add(h)}}catch(v){o.e(v)}finally{o.f()}var u=[];return a.forEach((function(t){if(t<=256){var i=e+t;if(r._rangePromises.has(i))u.push(r._rangePromises.get(i));else{var s=n.getRange(e,t).then((function(){r._rangePromises.delete(i)}),(function(){r._rangePromises.delete(i)}));r._rangePromises.set(i,s),u.push(s)}}})),Promise.all(u).then((function(){var i=r._glyphIndex[e];i||(i={},r._glyphIndex[e]=i);var a,o=(0,c.Z)(t);try{for(o.s();!(a=o.n()).done;){var l=a.value,h=i[l];if(h)s[l]={sdf:!0,rect:h.rect,metrics:h.metrics,page:h.page,code:l};else{var u=n.getGlyph(e,l);if(u&&u.metrics){var d=u.metrics,_=void 0;if(0===d.width)_=new y.Z(0,0,0,0);else{var p=d.width+6,g=d.height+6,m=p%4?4-p%4:4,b=g%4?4-g%4:4;1===m&&(m=5),1===b&&(b=5),(_=r._binPack.allocate(p+m,g+b)).isEmpty&&(r._dirties[r._currentPage]||(r._glyphData[r._currentPage]=null),r._currentPage=r._glyphData.length,r._glyphData.push(new Uint8Array(r.width*r.height)),r._dirties.push(!0),r._textures.push(void 0),r._binPack=new f(r.width-4,r.height-4),_=r._binPack.allocate(p+m,g+b));var w=r._glyphData[r._currentPage],x=u.bitmap,S=void 0,k=void 0;if(x)for(var Z=0;Z<g;Z++){S=p*Z,k=r.width*(_.y+Z+1)+_.x;for(var P=0;P<p;P++)w[k+P+1]=x[S+P]}}i[l]={rect:_,metrics:d,tileIDs:null,page:r._currentPage},s[l]={sdf:!0,rect:_,metrics:d,page:r._currentPage,code:l},r._dirties[r._currentPage]=!0}}}}catch(v){o.e(v)}finally{o.f()}return s}))}},{key:"removeGlyphs",value:function(e){for(var t in this._glyphIndex){var i=this._glyphIndex[t];if(i){var r=void 0;for(var s in i)if((r=i[s]).tileIDs.delete(e),0===r.tileIDs.size){for(var n=this._glyphData[r.page],a=r.rect,o=void 0,l=void 0,h=0;h<a.height;h++)for(o=this.width*(a.y+h)+a.x,l=0;l<a.width;l++)n[o+l]=0;delete i[s],this._dirties[r.page]=!0}}}}},{key:"bind",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._textures[i]||(this._textures[i]=new d.x(e,{pixelFormat:v.VI.ALPHA,dataType:v.Br.UNSIGNED_BYTE,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var s=this._textures[i];s.setSamplingMode(t),this._dirties[i]&&s.setData(this._glyphData[i]),e.bindTexture(s,r),this._dirties[i]=!1}},{key:"dispose",value:function(){this._binPack=null;var e,t=(0,c.Z)(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(r){t.e(r)}finally{t.f()}this._textures.length=0}}]),e}(),p=i(76200),g=i(78084),m=function(){function e(t){if((0,a.Z)(this,e),this._metrics=[],this._bitmaps=[],t)for(;t.next();)if(1===t.tag()){for(var i=t.getMessage();i.next();)if(3===i.tag()){for(var r=i.getMessage(),s=void 0,n=void 0,o=void 0,l=void 0,h=void 0,u=void 0,c=void 0;r.next();)switch(r.tag()){case 1:s=r.getUInt32();break;case 2:n=r.getBytes();break;case 3:o=r.getUInt32();break;case 4:l=r.getUInt32();break;case 5:h=r.getSInt32();break;case 6:u=r.getSInt32();break;case 7:c=r.getUInt32();break;default:r.skip()}r.release(),s&&(this._metrics[s]={width:o,height:l,left:h,top:u,advance:c},this._bitmaps[s]=n)}else i.skip();i.release()}else t.skip()}return(0,o.Z)(e,[{key:"getMetrics",value:function(e){return this._metrics[e]}},{key:"getBitmap",value:function(e){return this._bitmaps[e]}}]),e}(),b=function(){function e(){(0,a.Z)(this,e),this._ranges=[]}return(0,o.Z)(e,[{key:"getRange",value:function(e){return this._ranges[e]}},{key:"addRange",value:function(e,t){this._ranges[e]=t}}]),e}(),w=function(){function e(t){(0,a.Z)(this,e),this._glyphInfo={},this._baseURL=t}return(0,o.Z)(e,[{key:"getRange",value:function(e,t){var i=this._getFontStack(e);if(i.getRange(t))return Promise.resolve();var r=256*t,s=r+255;if(this._baseURL){var n=this._baseURL.replace("{fontstack}",e).replace("{range}",r+"-"+s);return(0,p.default)(n,{responseType:"array-buffer"}).then((function(e){i.addRange(t,new m(new g.Z(new Uint8Array(e.data),new DataView(e.data))))})).catch((function(){i.addRange(t,new m)}))}return i.addRange(t,new m),Promise.resolve()}},{key:"getGlyph",value:function(e,t){var i=this._getFontStack(e);if(i){var r=Math.floor(t/256);if(!(r>256)){var s=i.getRange(r);return s?{metrics:s.getMetrics(t),bitmap:s.getBitmap(t)}:void 0}}}},{key:"_getFontStack",value:function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new b),t}}]),e}(),x=i(29439),S=i(78915),k="dasharray-",Z=function(){function e(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,a.Z)(this,e),this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(t<=0||i<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=i,r>0&&(this._maxItemSize=r),this._binPack=new f(t-4,i-4)}return(0,o.Z)(e,[{key:"dispose",value:function(){this._binPack=null,this._mosaicRects={};var e,t=(0,c.Z)(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(r){t.e(r)}finally{t.f()}this._textures.length=0}},{key:"getWidth",value:function(e){return e>=this._size.length?-1:this._size[e][0]}},{key:"getHeight",value:function(e){return e>=this._size.length?-1:this._size[e][1]}},{key:"getPageSize",value:function(e){return e>=this._size.length?null:this._size[e]}},{key:"setSpriteSource",value:function(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new f(this._pageWidth-4,this._pageHeight-4);var t=Math.floor(this._pageWidth),i=Math.floor(this._pageHeight),r=new Uint32Array(t*i);this._mosaicsData[0]=r,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e}},{key:"getSpriteItem",value:function(e){var t,i,r,s,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=this._mosaicRects[e];if(a)return a;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;if(e&&e.startsWith(k)?(t=this._rasterizeDash(e),r=(i=(0,x.Z)(t,2))[0],s=i[1],n=!0):r=this._sprites.getSpriteInfo(e),!r||!r.width||!r.height||r.width<0||r.height<0)return null;var o=r.width,l=r.height,h=this._allocateImage(o,l),u=(0,x.Z)(h,3),c=u[0],y=u[1],f=u[2];return c.width<=0?null:(this._copy(c,r,y,f,n,s),a={rect:c,width:o,height:l,sdf:r.sdf,simplePattern:!1,pixelRatio:r.pixelRatio,page:y},this._mosaicRects[e]=a,a)}},{key:"getSpriteItems",value:function(e){var t,i={},r=(0,c.Z)(e);try{for(r.s();!(t=r.n()).done;){var s=t.value;i[s.name]=this.getSpriteItem(s.name,s.repeat)}}catch(n){r.e(n)}finally{r.f()}return i}},{key:"getMosaicItemPosition",value:function(e,t){var i=this.getSpriteItem(e,t),r=i&&i.rect;if(!r)return null;r.width=i.width,r.height=i.height;var s=i.width,n=i.height;return{tl:[r.x+2,r.y+2],br:[r.x+2+s,r.y+2+n],page:i.page}}},{key:"bind",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._textures[i]||(this._textures[i]=new d.x(e,{pixelFormat:v.VI.RGBA,dataType:v.Br.UNSIGNED_BYTE,wrapMode:v.e8.CLAMP_TO_EDGE,width:this._size[i][0],height:this._size[i][1]},new Uint8Array(this._mosaicsData[i].buffer)));var s=this._textures[i];s.setSamplingMode(t),this._dirties[i]&&s.setData(new Uint8Array(this._mosaicsData[i].buffer)),e.bindTexture(s,r),this._dirties[i]=!1}},{key:"_copy",value:function(t,i,r,s,n,a){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(r>=this._mosaicsData.length)){var o=new Uint32Array(a?a.buffer:this._sprites.image.buffer),l=this._mosaicsData[r];l&&o||console.error("Source or target images are uninitialized!");var h=a?i.width:this._sprites.width;e._copyBits(o,h,i.x,i.y,l,s[0],t.x+2,t.y+2,i.width,i.height,n),this._dirties[r]=!0}}},{key:"_allocateImage",value:function(e,t){e+=2,t+=2;var i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){var r=new y.Z(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[r,this._mosaicsData.length-1,[e,t]]}var s=e%4?4-e%4:4,n=t%4?4-t%4:4;1===s&&(s=5),1===n&&(n=5);var a=this._binPack.allocate(e+s,t+n);return a.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new f(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[a,this._currentPage,[this._pageWidth,this._pageHeight]]}},{key:"_rasterizeDash",value:function(e){var t=e.match(/\[(.*?)\]/);if(!t)return null;var i=t[1].split(",").map(Number),r=e.slice(e.lastIndexOf("-")+1),s=S.fN.rasterizeDash(i,r),n=(0,x.Z)(s,3),a=n[0];return[{x:0,y:0,width:n[1],height:n[2],sdf:!0,pixelRatio:1},new Uint8Array(a.buffer)]}}],[{key:"_copyBits",value:function(e,t,i,r,s,n,a,o,l,h,u){var c=r*t+i,y=o*n+a;if(u){y-=n;for(var f=-1;f<=h;c=((++f+h)%h+r)*t+i,y+=n)for(var v=-1;v<=l;v++)s[y+v]=e[c+(v+l)%l]}else for(var d=0;d<h;d++){for(var _=0;_<l;_++)s[y+_]=e[c+_];c+=t,y+=n}}}]),e}(),P=i(18687),I=i(73828),R=function(){function e(t,i,r){(0,a.Z)(this,e),this._layer=t,this._styleRepository=i,this.devicePixelRatio=r,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null}return(0,o.Z)(e,[{key:"destroy",value:function(){this._connection&&(this._connection.close(),this._connection=null),this._styleRepository=null,this._layer=null,this._spriteMosaic&&(this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic=null)}},{key:"spriteMosaic",get:function(){var e=this;return this._spriteSourcePromise.then((function(){return e._spriteMosaic}))}},{key:"glyphMosaic",get:function(){return this._glyphMosaic}},{key:"start",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t){var i,n=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,t),this._spriteSourcePromise.then((function(e){n._spriteMosaic=new Z(1024,1024,250),n._spriteMosaic.setSpriteSource(e)})),i=new w(this._layer.currentStyleInfo.glyphsUrl?(0,h.fl)(this._layer.currentStyleInfo.glyphsUrl,(0,s.Z)((0,s.Z)({},this._layer.customParameters),{},{token:this._layer.apiKey})):null),this._glyphMosaic=new _(1024,1024,i),this._broadcastPromise=(0,u.bA)("WorkerTileHandler",{client:this,schedule:t.schedule,signal:t.signal}).then((function(e){n._connection=e,n._connection.broadcast("setStyle",n._layer.currentStyleInfo.style,t)}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateStyle",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:return this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",t)),e.abrupt("return",this._broadcastPromise);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setSpriteSource",value:function(e){var t=new Z(1024,1024,250);return t.setSpriteSource(e),this._spriteMosaic=t,this._spriteSourcePromise=Promise.resolve(e),t}},{key:"setStyle",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t,i){var n,a=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:return this._styleRepository=t,this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,null),this._spriteSourcePromise.then((function(e){a._spriteMosaic=new Z(1024,1024,250),a._spriteMosaic.setSpriteSource(e)})),n=new w(this._layer.currentStyleInfo.glyphsUrl?(0,h.fl)(this._layer.currentStyleInfo.glyphsUrl,(0,s.Z)((0,s.Z)({},this._layer.customParameters),{},{token:this._layer.apiKey})):null),e.abrupt("return",(this._glyphMosaic=new _(1024,1024,n),this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",i)),this._broadcastPromise));case 7:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"fetchTileData",value:function(e,t){var i=this;return this._getRefKeys(e,t).then((function(e){var r=i._layer.sourceNameToSource,s=[];for(var n in r)s.push(n);return i._getSourcesData(s,e,t)}))}},{key:"parseTileData",value:function(e,t){var i=this,r=e&&e.data;if(!r)return Promise.resolve(null);var n=r.sourceName2DataAndRefKey,a=r.transferList;return 0===Object.keys(n).length?Promise.resolve(null):this._broadcastPromise.then((function(){return i._connection.invoke("createTileAndParse",{key:e.key.id,sourceName2DataAndRefKey:n,styleLayerUIDs:e.styleLayerUIDs},(0,s.Z)((0,s.Z)({},t),{},{transferList:a}))}))}},{key:"getSprites",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._spriteSourcePromise;case 2:return e.abrupt("return",this._spriteMosaic.getSpriteItems(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getGlyphs",value:function(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)}},{key:"perfReport",value:function(e){var t=e.key,i=e.milliseconds;(0,P.uA)(t,i,"ms")}},{key:"_getTilePayload",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t,i,s){var n,a,o,h,u;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=I.Z.pool.acquire(t.id),a=this._layer.sourceNameToSource[i],o=n.level,h=n.row,u=n.col,I.Z.pool.release(n),e.prev=2,e.next=5,a.requestTile(o,h,u,s);case 5:return e.t0=e.sent,e.t1=i,e.abrupt("return",{protobuff:e.t0,sourceName:e.t1});case 10:if(e.prev=10,e.t2=e.catch(2),!(0,l.D_)(e.t2)){e.next=14;break}throw e.t2;case 14:return e.abrupt("return",{protobuff:null,sourceName:i});case 15:case"end":return e.stop()}}),e,this,[[2,10]])})));return function(t,i,r){return e.apply(this,arguments)}}()},{key:"_getRefKeys",value:function(e,t){var i=this._layer.sourceNameToSource,r=new Array;for(var s in i){var n=i[s].getRefKey(e,t);r.push(n)}return(0,l.as)(r)}},{key:"_getSourcesData",value:function(e,t,i){for(var r=[],s=0;s<t.length;s++)if(null==t[s].value||null==e[s])r.push(null);else{var n=this._getTilePayload(t[s].value,e[s],i);r.push(n)}return(0,l.as)(r).then((function(e){for(var i={},r=[],s=0;s<e.length;s++)if(e[s].value&&e[s].value&&e[s].value.protobuff&&e[s].value.protobuff.byteLength>0){var n=t[s].value.id;i[e[s].value.sourceName]={refKey:n,protobuff:e[s].value.protobuff},r.push(e[s].value.protobuff)}return{sourceName2DataAndRefKey:i,transferList:r}}))}}]),e}()},12463:function(e,t,i){i.d(t,{g:function(){return u}});var r=i(29439),s=i(37762),n=i(15671),a=i(43144),o=i(92026),l=i(46618);function h(e,t){if(e.priority-t.priority)return e.priority-t.priority;var i=e.tile.key,r=t.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}var u=function(){function e(t,i,r,s,a,o){(0,n.Z)(this,e),this._visibleTiles=t,this._symbolRepository=i,this._createCollisionJob=r,this._assignTileSymbolsOpacity=s,this._symbolLayerSorter=a,this._isLayerVisible=o,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}return(0,a.Z)(e,[{key:"running",get:function(){return this._running}},{key:"setScreenSize",value:function(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}},{key:"restart",value:function(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}},{key:"continue",value:function(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){var t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){var i=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-i))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){var r=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-r))))return!1}return this._running=!1,!0}},{key:"_createSelectionJob",value:function(){for(var e=this._symbolRepository.uniqueSymbols,t=0;t<e.length;t++)for(var i=e[t],r=0;r<i.uniqueSymbols.length;r++){var n,a=i.uniqueSymbols[r],o=(0,s.Z)(a.tileSymbols);try{for(o.s();!(n=o.n()).done;){n.value.selectedForRendering=!1}}catch(v){o.e(v)}finally{o.f()}}var l=[],u=0,c=0,y=this._isLayerVisible;var f=this._symbolLayerSorter;return{work:function(t){for(var i,r=performance.now();c<e.length;c++,u=0){var n=e[c],a=n.styleLayerUID;if(y(a)){l[c]=l[c]||{styleLayerUID:a,symbols:[]};for(var o=l[c];u<n.uniqueSymbols.length;u++){if(i=n.uniqueSymbols[u],u%100==99&&performance.now()-r>t)return!1;var f,d=null,_=!1,p=!1,g=(0,s.Z)(i.tileSymbols);try{for(g.s();!(f=g.n()).done;){var m=f.value;if(!p||!_){var b=m.tile;(!d||b.isCoverage||b.neededForCoverage&&!_)&&(d=m,(b.neededForCoverage||b.isCoverage)&&(p=!0),b.isCoverage&&(_=!0))}}}catch(v){g.e(v)}finally{g.f()}if(d.selectedForRendering=!0,p){o.symbols.push(d),i.show=!0;var w,x=(0,s.Z)(i.parts);try{for(x.s();!(w=x.n()).done;){w.value.show=!0}}catch(v){x.e(v)}finally{x.f()}}else i.show=!1}}else l[c]||(l[c]={styleLayerUID:a,symbols:[]})}var S,k=(0,s.Z)(l);try{for(k.s();!(S=k.n()).done;){S.value.symbols.sort(h)}}catch(v){k.e(v)}finally{k.f()}return!0},get sortedSymbols(){return l.sort(f)}}}},{key:"_createOpacityJob",value:function(){var e=this._assignTileSymbolsOpacity,t=this._visibleTiles,i=0;function n(t,i){var a,o=t.symbols,l=(0,s.Z)(o);try{for(l.s();!(a=l.n()).done;){var h=(0,r.Z)(a.value,2);h[0];c(h[1],i)}}catch(f){l.e(f)}finally{l.f()}e(t,i);var u,y=(0,s.Z)(t.childrenTiles);try{for(y.s();!(u=y.n()).done;){n(u.value,i)}}catch(f){y.e(f)}finally{y.f()}}return{work:function(e){for(var r=performance.now();i<t.length;i++){if(performance.now()-r>e)return!1;var s=t[i];(0,o.pC)(s.parentTile)||n(s,performance.now())}return!0}}}}]),e}();function c(e,t){var i,r=(0,s.Z)(e);try{for(r.s();!(i=r.n()).done;){var n,a=i.value.unique,o=(0,s.Z)(a.parts);try{for(o.s();!(n=o.n()).done;){var h=n.value,u=h.targetOpacity>.5?1:-1;h.startOpacity+=u*((t-h.startTime)/l.nN),h.startOpacity=Math.min(Math.max(h.startOpacity,0),1),h.startTime=t,h.targetOpacity=a.show&&h.show?1:0}}catch(c){o.e(c)}finally{o.f()}}}catch(c){r.e(c)}finally{r.f()}}},36210:function(e,t,i){i.d(t,{L:function(){return h}});var r=i(29439),s=i(37762),n=i(15671),a=i(43144),o=i(92026),l=i(50127),h=function(){function e(t,i,r){(0,n.Z)(this,e),this.tileCoordRange=t,this._visibleTiles=i,this._createUnique=r,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}return(0,a.Z)(e,[{key:"uniqueSymbols",get:function(){return(0,o.Wi)(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}},{key:"add",value:function(e,t){this._uniqueSymbolLayerArray=null;var i=this._tiles.get(e.id);i||(i={symbols:new Map},this._tiles.set(e.id,i));var n=new Map;if(t){var a,o=(0,s.Z)(t);try{for(o.s();!(a=o.n()).done;){var h=a.value;i.symbols.has(h)&&(n.set(h,i.symbols.get(h)),i.symbols.delete(h))}}catch(I){o.e(I)}finally{o.f()}}else{var u,c=(0,s.Z)(e.layerData);try{for(c.s();!(u=c.n()).done;){var y=(0,r.Z)(u.value,2),f=y[0];y[1];i.symbols.has(f)&&(n.set(f,i.symbols.get(f)),i.symbols.delete(f))}}catch(I){c.e(I)}finally{c.f()}}this._removeSymbols(n);var v,d=e.symbols,_=new Map,p=(0,s.Z)(d);try{for(p.s();!(v=p.n()).done;){var g=(0,r.Z)(v.value,2),m=g[0],b=g[1],w=b.length;if(w>=32){var x=this.tileCoordRange;do{x/=2,w/=4}while(w>8&&x>64);var S=new l.HX(this.tileCoordRange,this.tileCoordRange,x);_.set(m,{flat:b,index:S}),i.symbols.set(m,{flat:b,index:S});var k,Z=(0,s.Z)(b);try{for(Z.s();!(k=Z.n()).done;){var P=k.value;S.getCell(P.xTile,P.yTile).push(P)}}catch(I){Z.e(I)}finally{Z.f()}}else _.set(m,{flat:b}),i.symbols.set(m,{flat:b})}}catch(I){p.e(I)}finally{p.f()}this._addSymbols(e.key,d)}},{key:"deleteStyleLayers",value:function(e){this._uniqueSymbolLayerArray=null;var t,i=(0,s.Z)(this._tiles);try{for(i.s();!(t=i.n()).done;){var n,a=(0,r.Z)(t.value,2),o=a[0],l=a[1],h=new Map,u=(0,s.Z)(e);try{for(u.s();!(n=u.n()).done;){var c=n.value;l.symbols.has(c)&&(h.set(c,l.symbols.get(c)),l.symbols.delete(c))}}catch(y){u.e(y)}finally{u.f()}this._removeSymbols(h),0===l.symbols.size&&this._tiles.delete(o)}}catch(y){i.e(y)}finally{i.f()}}},{key:"removeTile",value:function(e){this._uniqueSymbolLayerArray=null;var t=this._tiles.get(e.id);if(t){var i,n=new Map,a=(0,s.Z)(e.symbols);try{for(a.s();!(i=a.n()).done;){var o=(0,r.Z)(i.value,2),l=o[0];o[1];t.symbols.has(l)&&(n.set(l,t.symbols.get(l)),t.symbols.delete(l))}}catch(h){a.e(h)}finally{a.f()}this._removeSymbols(n),0===t.symbols.size&&this._tiles.delete(e.id)}}},{key:"_removeSymbols",value:function(e){var t,i=(0,s.Z)(e);try{for(i.s();!(t=i.n()).done;){var n,a=(0,r.Z)(t.value,2),o=a[0],l=a[1].flat,h=(0,s.Z)(l);try{for(h.s();!(n=h.n()).done;){for(var u=n.value,c=u.unique,y=c.tileSymbols,f=y.length-1,v=0;v<f;v++)if(y[v]===u){y[v]=y[f];break}if(y.length=f,0===f){var d=this._uniqueSymbolsReferences.get(o);d.delete(c),0===d.size&&this._uniqueSymbolsReferences.delete(o)}u.unique=null}}catch(_){h.e(_)}finally{h.f()}}}catch(_){i.e(_)}finally{i.f()}}},{key:"_addSymbols",value:function(e,t){if(0!==t.size){var i,n=this._visibleTiles,a=(0,s.Z)(n);try{for(a.s();!(i=a.n()).done;){var l=i.value;l.parentTile||l.key.world!==e.world||l.key.level===e.level&&!l.key.equals(e)||this._matchSymbols(l,e,t)}}catch(m){a.e(m)}finally{a.f()}var h,u=(0,s.Z)(t);try{for(u.s();!(h=u.n()).done;){var c,y=(0,r.Z)(h.value,2),f=y[0],v=y[1],d=(0,s.Z)(v);try{for(d.s();!(c=d.n()).done;){var _=c.value;if((0,o.Wi)(_.unique)){var p=this._createUnique();_.unique=p,p.tileSymbols.push(_);var g=this._uniqueSymbolsReferences.get(f);g||(g=new Set,this._uniqueSymbolsReferences.set(f,g)),g.add(p)}}}catch(m){d.e(m)}finally{d.f()}}}catch(m){u.e(m)}finally{u.f()}}}},{key:"_matchSymbols",value:function(e,t,i){if(e.key.level>t.level){var n=e.key.level-t.level;if(e.key.row>>n!==t.row||e.key.col>>n!==t.col)return}if(t.level>e.key.level){var a=t.level-e.key.level;if(t.row>>a!==e.key.row||t.col>>a!==e.key.col)return}if(t.equals(e.key)){var h,u=(0,s.Z)(e.childrenTiles);try{for(u.s();!(h=u.n()).done;){var c=h.value;this._matchSymbols(c,t,i)}}catch(V){u.e(V)}finally{u.f()}}else{var y,f=new Map,v=(0,s.Z)(i);try{for(v.s();!(y=v.n()).done;){var d,_=(0,r.Z)(y.value,2),p=_[0],g=_[1],m=[],b=(0,s.Z)(g);try{for(b.s();!(d=b.n()).done;){var w=d.value,x=(0,l.co)(this.tileCoordRange,w.xTile,t.level,t.col,e.key.level,e.key.col),S=(0,l.co)(this.tileCoordRange,w.yTile,t.level,t.row,e.key.level,e.key.row);x>=0&&x<this.tileCoordRange&&S>=0&&S<this.tileCoordRange&&m.push({symbol:w,xTransformed:x,yTransformed:S})}}catch(V){b.e(V)}finally{b.f()}var k=[],Z=e.key.level<t.level?1:1<<e.key.level-t.level,P=this._tiles.get(e.id).symbols.get(p);if(P){var I,R=P.flat,T=(0,s.Z)(m);try{for(T.s();!(I=T.n()).done;){var M,A=I.value,C=!1,D=A.xTransformed,L=A.yTransformed;M=(0,o.pC)(P.index)?P.index.getCell(D,L):R;var q,U=A.symbol,z=U.hash,J=(0,s.Z)(M);try{for(J.s();!(q=J.n()).done;){var O=q.value;if(z===O.hash&&Math.abs(D-O.xTile)<=Z&&Math.abs(L-O.yTile)<=Z){var N=O.unique;U.unique=N,N.tileSymbols.push(U),C=!0;break}}}catch(V){J.e(V)}finally{J.f()}C||k.push(U)}}catch(V){T.e(V)}finally{T.f()}}k.length>0&&f.set(p,k)}}catch(V){v.e(V)}finally{v.f()}var E,W=(0,s.Z)(e.childrenTiles);try{for(W.s();!(E=W.n()).done;){var F=E.value;this._matchSymbols(F,t,f)}}catch(V){W.e(V)}finally{W.f()}}}},{key:"_createUniqueSymbolLayerArray",value:function(){var e,t,i=this._uniqueSymbolsReferences,n=new Array(i.size),a=0,o=(0,s.Z)(i);try{for(o.s();!(t=o.n()).done;){var l=(0,r.Z)(t.value,2),h=l[0],u=l[1],c=new Array(u.size);e=0;var y,f=(0,s.Z)(u);try{for(f.s();!(y=f.n()).done;){var v=y.value;c[e++]=v}}catch(d){f.e(d)}finally{f.f()}n[a]={styleLayerUID:h,uniqueSymbols:c},a++}}catch(d){o.e(d)}finally{o.f()}return n}}]),e}()},18687:function(e,t,i){i.d(t,{uA:function(){return o},uF:function(){return a}});var r=i(37762);function s(e,t,i,r,s,n){e.fillStyle=t,e.fillRect(i,r,s,n)}function n(e,t,i,r,s,n){e.strokeStyle=t,e.strokeRect(i,r,s,n)}function a(e,t){for(var i=window.COLLISION_XRAY,a=0;a<t.length;++a){var o=!t[a].unique.show;if(i||!o){var l,h=(0,r.Z)(t[a].colliders);try{for(h.s();!(l=h.n()).done;){var u=l.value;if(u.enabled){var c=!t[a].unique.parts[u.partIndex].show;if(i||!c){var y=u.xScreen,f=u.yScreen,v=u.dxScreen,d=u.dyScreen;e.globalAlpha=o||c?.2:1,s(e,"green",y-1,f-1,3,3),n(e,"red",y+v,f+d,u.width,u.height),s(e,"blue",y+v-1,f+d-1,3,3),e.globalAlpha=1}}}}catch(_){h.e(_)}finally{h.f()}}}}function o(e,t,i){if(window.PERFORMANCE_RECORDING_STORAGE){var r=window.PERFORMANCE_RECORDING_STORAGE;r.perf=r.perf||{};var s=r.perf;s[e]=s[e]||{start:null,time:0,min:void 0,max:void 0,samples:[],unit:i},s[e].time+=t,s[e].samples.push(t),(null==s[e].min||t<s[e].min)&&(s[e].min=t),(null==s[e].max||t>s[e].max)&&(s[e].max=t)}}},42121:function(e,t,i){i.d(t,{f:function(){return y}});var r=i(15671),s=i(43144),n=i(29439),a=i(37762),o=i(23588),l=i(46618),h=i(50127),u=i(21391);function c(e,t,i,r,s,o){var l,h=r.iconRotationAlignment,c=r.textRotationAlignment,y=r.iconTranslate,f=r.iconTranslateAnchor,v=r.textTranslate,d=r.textTranslateAnchor,_=0,p=(0,a.Z)(e.colliders);try{for(p.s();!(l=p.n()).done;){var g=l.value,m=0===g.partIndex?y:v,b=(0,n.Z)(m,2),w=b[0],x=b[1],S=0===g.partIndex?f:d,k=g.minLod<=o&&o<=g.maxLod;_+=k?0:1,g.enabled=k,g.xScreen=g.xTile*s[0]+g.yTile*s[3]+s[6],g.yScreen=g.xTile*s[1]+g.yTile*s[4]+s[7],S===u.fD.MAP?(g.xScreen+=i*w-t*x,g.yScreen+=t*w+i*x):(g.xScreen+=w,g.yScreen+=x),u.aF.VIEWPORT===(0===g.partIndex?h:c)?(g.dxScreen=g.dxPixels,g.dyScreen=g.dyPixels):(g.dxScreen=i*(g.dxPixels+g.width/2)-t*(g.dyPixels+g.height/2)-g.width/2,g.dyScreen=t*(g.dxPixels+g.width/2)+i*(g.dyPixels+g.height/2)-g.height/2)}}catch(Z){p.e(Z)}finally{p.f()}e.colliders.length>0&&_===e.colliders.length&&(e.unique.show=!1)}var y=function(){function e(t,i,s,n,u,c){(0,r.Z)(this,e),this._symbols=t,this._styleRepository=n,this._zoom=u,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new h.HX(i,s,l.PF),this._si=Math.sin(Math.PI*c/180),this._co=Math.cos(Math.PI*c/180);var y,f=(0,a.Z)(t);try{for(f.s();!(y=f.n()).done;){var v,d=y.value,_=(0,a.Z)(d.symbols);try{for(_.s();!(v=_.n()).done;){var p=v.value;this._allNeededMatrices.has(p.tile)||this._allNeededMatrices.set(p.tile,(0,o.a)(p.tile.transforms.tileUnitsToPixels))}}catch(g){_.e(g)}finally{_.f()}}}catch(g){f.e(g)}finally{f.f()}}return(0,s.Z)(e,[{key:"work",value:function(e){var t=this._gridIndex;function i(e){for(var i=e.xScreen+e.dxScreen,r=e.yScreen+e.dyScreen,s=i+e.width,o=r+e.height,l=t.getCellSpan(i,r,s,o),h=(0,n.Z)(l,4),u=h[0],c=h[1],y=h[2],f=h[3],v=c;v<=f;v++)for(var d=u;d<=y;d++){var _,p=t.cells[v][d],g=(0,a.Z)(p);try{for(g.s();!(_=g.n()).done;){var m=_.value,b=m.xScreen+m.dxScreen,w=m.yScreen+m.dyScreen,x=b+m.width,S=w+m.height;if(!(s<b||i>x||o<w||r>S))return!0}}catch(k){g.e(k)}finally{g.f()}}return!1}for(var r=performance.now();this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0)for(var s=this._symbols[this._currentLayerCursor],o=this._getProperties(s.styleLayerUID);this._currentSymbolCursor<s.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-r>e)return!1;var l=s.symbols[this._currentSymbolCursor];if(l.unique.show){c(l,this._si,this._co,o,this._allNeededMatrices.get(l.tile),this._zoom);var h=l.unique;if(h.show){var u,y=o.iconAllowOverlap,f=o.iconIgnorePlacement,v=o.textAllowOverlap,d=o.textIgnorePlacement,_=(0,a.Z)(l.colliders);try{for(_.s();!(u=_.n()).done;){var p=u.value;if(p.enabled){var g=h.parts[p.partIndex];g.show&&!(p.partIndex?v:y)&&i(p)&&(p.hard?h.show=!1:g.show=!1)}}}catch(L){_.e(L)}finally{_.f()}if(h.show){var m,b=(0,a.Z)(l.colliders);try{for(b.s();!(m=b.n()).done;){var w=m.value;if(w.enabled&&(!(w.partIndex?d:f)&&h.parts[w.partIndex].show))for(var x=w.xScreen+w.dxScreen,S=w.yScreen+w.dyScreen,k=x+w.width,Z=S+w.height,P=this._gridIndex.getCellSpan(x,S,k,Z),I=(0,n.Z)(P,4),R=I[0],T=I[1],M=I[2],A=I[3],C=T;C<=A;C++)for(var D=R;D<=M;D++)this._gridIndex.cells[C][D].push(w)}}catch(L){b.e(L)}finally{b.f()}}}}}return!0}},{key:"_getProperties",value:function(e){var t=this._styleProps.get(e);if(t)return t;var i=this._zoom,r=this._styleRepository.getStyleLayerByUID(e),s=r.getLayoutValue("symbol-placement",i)!==u.R.POINT,n=r.getLayoutValue("icon-rotation-alignment",i);n===u.aF.AUTO&&(n=s?u.aF.MAP:u.aF.VIEWPORT);var a=r.getLayoutValue("text-rotation-alignment",i);a===u.aF.AUTO&&(a=s?u.aF.MAP:u.aF.VIEWPORT);var o=r.getPaintValue("icon-translate",i),l=r.getPaintValue("icon-translate-anchor",i),h=r.getPaintValue("text-translate",i),c=r.getPaintValue("text-translate-anchor",i),y={iconAllowOverlap:r.getLayoutValue("icon-allow-overlap",i),iconIgnorePlacement:r.getLayoutValue("icon-ignore-placement",i),textAllowOverlap:r.getLayoutValue("text-allow-overlap",i),textIgnorePlacement:r.getLayoutValue("text-ignore-placement",i),iconRotationAlignment:n,textRotationAlignment:a,iconTranslateAnchor:l,iconTranslate:o,textTranslateAnchor:c,textTranslate:h};return this._styleProps.set(e,y),y}}]),e}()},60652:function(e,t,i){i.d(t,{E:function(){return a},V:function(){return r}});var r,s=i(15671),n=i(43144),a=function(){function e(t,i){(0,s.Z)(this,e),this.x=t,this.y=i}return(0,n.Z)(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"equals",value:function(e,t){return e===this.x&&t===this.y}},{key:"isEqual",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"setCoords",value:function(e,t){this.x=e,this.y=t}},{key:"normalize",value:function(){var e=this.x,t=this.y,i=Math.sqrt(e*e+t*t);this.x/=i,this.y/=i}},{key:"rightPerpendicular",value:function(){var e=this.x;this.x=this.y,this.y=-e}},{key:"move",value:function(e,t){this.x+=e,this.y+=t}},{key:"assign",value:function(e){this.x=e.x,this.y=e.y}},{key:"assignAdd",value:function(e,t){this.x=e.x+t.x,this.y=e.y+t.y}},{key:"assignSub",value:function(e,t){this.x=e.x-t.x,this.y=e.y-t.y}},{key:"rotate",value:function(e,t){var i=this.x,r=this.y;this.x=i*e-r*t,this.y=i*t+r*e}},{key:"scale",value:function(e){this.x*=e,this.y*=e}},{key:"length",value:function(){var e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}}],[{key:"distance",value:function(e,t){var i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}},{key:"add",value:function(t,i){return new e(t.x+i.x,t.y+i.y)}},{key:"sub",value:function(t,i){return new e(t.x-i.x,t.y-i.y)}}]),e}();!function(e){e[e.Unknown=0]="Unknown",e[e.Point=1]="Point",e[e.LineString=2]="LineString",e[e.Polygon=3]="Polygon"}(r||(r={}))}}]);
//# sourceMappingURL=2647.68ac620f.chunk.js.map