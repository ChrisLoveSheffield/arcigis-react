"use strict";(self.webpackChunkuums_front_end=self.webpackChunkuums_front_end||[]).push([[8916],{68916:function(e,t,n){n.r(t),n.d(t,{default:function(){return en}});var i=n(74165),r=n(15861),a=n(37762),o=n(15671),s=n(43144),u=n(60136),l=n(29388),c=n(27366),d=n(85015),h=n(80987),p=n(92026),f=n(94172),v=n(49861),y=(n(63780),n(93169),n(25243)),_=n(69912),g=n(98074),m=n(42537),w=n(51378),k=n(51995),Z=(n(59486),n(11582)),S=n(17768),C=n(89125),b=n(53866),x=n(7882),E=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).type="length",i.startPoint=null,i.endPoint=null,i.axis="horizontal",i.offset=0,i.heading=0,i}return(0,s.Z)(n,[{key:"extent",get:function(){if((0,p.Wi)(this.startPoint))return null;var e=b.Z.fromPoint(this.startPoint);return(0,p.pC)(this.endPoint)&&e.union(b.Z.fromPoint(this.endPoint)),e}}]),n}(Z.j);(0,c._)([(0,v.Cb)({type:["length"]})],E.prototype,"type",void 0),(0,c._)([(0,v.Cb)({type:x.Z})],E.prototype,"startPoint",void 0),(0,c._)([(0,v.Cb)({type:x.Z})],E.prototype,"endPoint",void 0),(0,c._)([(0,v.Cb)({type:["horizontal","vertical","direct"],nonNullable:!0})],E.prototype,"axis",void 0),(0,c._)([(0,v.Cb)({type:Number,nonNullable:!0})],E.prototype,"offset",void 0),(0,c._)([(0,v.Cb)({type:Number,nonNullable:!0}),(0,C.p)((function(e){return S.BV.normalize((0,y.q9)(e),0,!0)}))],E.prototype,"heading",void 0),(0,c._)([(0,v.Cb)({readOnly:!0})],E.prototype,"extent",null);var P,T=E=(0,c._)([(0,_.j)("esri.analysis.LengthDimension")],E),O=n(41691),R=n(100),M=n(66978),V=n(37818),H=n(17842),I={main:new k.Z([255,127,0])},D=(0,s.Z)((function e(){(0,o.Z)(this,e),this.color=I.main,this.opacity=.5,this.radius=5})),L=function(){function e(){(0,o.Z)(this,e),this.fontSize=14}return(0,s.Z)(e,[{key:"height",get:function(){return 1.5*(0,H.F2)(this.fontSize)}},{key:"offset",get:function(){return this.height+20}}]),e}(),z=new((0,s.Z)((function e(){(0,o.Z)(this,e),this.pointManipulators=new D,this.labels=new L}))),G=n(60142),A=n(11186),W=n(71353),F=n(11752),j=n(61120),N=n(90045),q=n(151),U=n(70444),Y=n(95773),X=n(85981),B=n(40885),$=n(62389),Q=n(52168),K=n(70619),J=n(56529),ee=n(4760),te=n(58901),ne=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e))._ray=(0,B.Ue)(),i._externalResources=null,i._handles=new R.Z,i._isWorldDown=!1,i._start=(0,W.c)(),i._end=(0,W.f)(1,0,0),i._width=1,i._color=(0,q.f)(1,0,1,1),i._polygonOffset=!1,i._writeDepthEnabled=!0,i._innerWidth=0,i._innerColor=(0,q.f)(1,1,1,1),i._stipplePattern=null,i._stippleOffColor=null,i._stipplePreferContinuous=!0,i._falloff=0,i._extensionType=P.LINE,i._laserlineStyle=null,i._laserlineEnabled=!1,i._renderOccluded=J.yD.OccludeAndTransparent,i._fadedExtensions=ue,i.applyProps(e),i}return(0,s.Z)(n,[{key:"createExternalResources",value:function(){var e=this,t=new te.U(this.materialParameters);this._handles.add((0,f.YP)((function(){return e.view.state.camera}),(function(){e._updateGeometry()})));var n=new $.W({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:t,laserline:n}}},{key:"destroyExternalResources",value:function(){(0,p.pC)(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}},{key:"forEachExternalMaterial",value:function(e){(0,p.pC)(this._externalResources)&&e(this._externalResources.material)}},{key:"createGeometries",value:function(e){var t=[(0,W.c)(),(0,W.c)()],n=this.extensionType===P.FADED;n&&t.push((0,W.c)(),(0,W.c)());var i=n?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,r=K.Z.createPolylineGeometry(t,null,i);e.addGeometry(r,(0,p.Wg)(this._externalResources).material),this._updateVertices(e)}},{key:"updateVisibility",value:function(e){(0,F.Z)((0,j.Z)(n.prototype),"updateVisibility",this).call(this,e),(0,p.pC)(this._externalResources)&&(this._externalResources.laserline.visible=e)}},{key:"setStartEndFromWorldDownAtLocation",value:function(e){this._isWorldDown=!0,(0,A.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,A.b)(this._end,e,this._end),(0,B.zk)(this._start,this._end,this._ray),this._updateGeometry()}},{key:"start",get:function(){return this._start},set:function(e){this._isWorldDown=!1,(0,A.k)(this._start,e)||((0,A.c)(this._start,e),(0,B.zk)(this._start,this._end,this._ray),this._updateGeometry())}},{key:"end",get:function(){return this._end},set:function(e){this._isWorldDown=!1,(0,A.k)(this._end,e)||((0,A.c)(this._end,e),(0,B.zk)(this._start,this._end,this._ray),this._updateGeometry())}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){(0,N.g)(e,this._color)||((0,N.c)(this._color,e),this._updateMaterial())}},{key:"polygonOffset",get:function(){return this._polygonOffset},set:function(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}},{key:"writeDepthEnabled",get:function(){return this._writeDepthEnabled},set:function(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){(0,N.g)(e,this._innerColor)||((0,N.c)(this._innerColor,e),this._updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=(0,p.pC)(e)!==(0,p.pC)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){((0,p.Wi)(e)||(0,p.Wi)(this._stippleOffColor)||!(0,N.g)(e,this._stippleOffColor))&&(this._stippleOffColor=(0,p.pC)(e)?(0,q.a)(e):null,this._updateMaterial())}},{key:"stipplePreferContinuous",get:function(){return this._stipplePreferContinuous},set:function(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}},{key:"extensionType",get:function(){return this._extensionType},set:function(e){e!==this._extensionType&&(this._extensionType=e,this._updateGeometry())}},{key:"_laserlineAttached",get:function(){return this._laserlineEnabled&&(0,p.pC)(this._laserlineStyle)}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,(0,p.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,(0,p.pC)(e)&&(this._externalResources.laserline.style=e))}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,(0,p.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}},{key:"fadedExtensions",get:function(){return this._fadedExtensions},set:function(e){this._fadedExtensions=(0,p.Pt)(e,ue),this.recreateGeometry()}},{key:"_updateMaterial",value:function(){(0,p.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}},{key:"_updateGeometry",value:function(){(0,p.pC)(this.object)&&this._updateVertices(this.object)}},{key:"_updateVertices",value:function(e){var t=this._extensionType===P.FADED?this._updateLineSegmentFinite(oe):this._updateLineSegmentInfinite(this._extensionType,oe);this._updateVertexAttributes(e,t),(0,p.pC)(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}},{key:"_updateLineSegmentFinite",value:function(e){return(0,X.zk)(this._start,this._end,e)}},{key:"_updateLineSegmentInfinite",value:function(e,t){var n=this.view.state.camera;switch((0,U.iL)(this._ray,ie),e){case P.LINE:ie.c0=-Number.MAX_VALUE;break;case P.RAY:case P.GROUND_RAY:var i=this._ray.origin,r=(0,p.Pt)(this.view.elevationProvider.getElevation(i[0],i[1],i[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),a=this.view.renderCoordsHelper.getAltitude(i);this._isWorldDown&&a<r&&(0,A.o)(ie.ray.direction,ie.ray.direction),this._extensionType===P.GROUND_RAY&&null!=r&&(ie.c1=Math.abs(a-r))}if(!(0,Y.zq)(n.frustum,ie))return(0,X.zk)(this._start,this._end,t);var o=(0,U.Ws)(ie,re),s=(0,U.S$)(ie,ae);return(0,X.zk)(o,s,t)}},{key:"_updateVertexAttributes",value:function(e,t){var n=e.geometries[0].getMutableAttribute(ee.T.POSITION).data;if(this.extensionType===P.FADED){var i=(0,X.KU)(t,-this.fadedExtensions.start,re);n[0]=i[0],n[1]=i[1],n[2]=i[2];var r=(0,X.KU)(t,0,re);n[3]=r[0],n[4]=r[1],n[5]=r[2];var a=(0,X.KU)(t,1,re);n[6]=a[0],n[7]=a[1],n[8]=a[2];var o=(0,X.KU)(t,1+this.fadedExtensions.end,re);n[9]=o[0],n[10]=o[1],n[11]=o[2]}else{var s=(0,X.KU)(t,0,re);n[0]=s[0],n[1]=s[1],n[2]=s[2];var u=(0,X.KU)(t,1,re);n[3]=u[0],n[4]=u[1],n[5]=u[2]}e.geometryVertexAttrsUpdated(e.geometryRecords[0])}}]),n}(Q._),ie=(0,U.Ue)(),re=(0,W.c)(),ae=(0,W.c)(),oe=(0,X.Ue)();!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(P||(P={}));var se=1/3,ue={start:se,end:se},le=n(88396),ce=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e))._handles=new R.Z,i._location=(0,W.c)(),i._direction=(0,W.f)(1,0,0),i._width=1,i._offset=1,i._length=18,i._color=(0,q.f)(1,0,1,1),i._renderOccluded=J.yD.OccludeAndTransparent,i.applyProps(e),i}return(0,s.Z)(n,[{key:"location",get:function(){return this._location},set:function(e){(0,A.k)(this._location,e)||((0,A.c)(this._location,e),this._updateGeometry())}},{key:"direction",get:function(){return this._direction},set:function(e){(0,A.k)(this._direction,e)||((0,A.c)(this._direction,e),this._updateGeometry())}},{key:"setDirectionFromPoints",value:function(e,t){(0,A.n)(this._direction,(0,A.b)(this._direction,t,e)),this._updateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._updateMaterial())}},{key:"offset",get:function(){return this._offset},set:function(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}},{key:"length",get:function(){return this._length},set:function(e){e!==this._length&&(this._length=e,this._updateGeometry())}},{key:"color",get:function(){return this._color},set:function(e){(0,N.g)(e,this._color)||((0,N.c)(this._color,e),this._updateMaterial())}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}},{key:"createExternalResources",value:function(){var e=this,t=new te.U(this.materialParameters);this._handles.add((0,f.YP)((function(){return e.view.state.camera}),(function(){e._updateGeometry()}))),this._externalResources={material:t}}},{key:"destroyExternalResources",value:function(){this._handles.removeAll(),this._externalResources=null}},{key:"createGeometries",value:function(e){var t=K.Z.createPolylineGeometry([(0,W.c)(),(0,W.c)()]),n=K.Z.createPolylineGeometry([(0,W.c)(),(0,W.c)()]),i=(0,p.Wg)(this._externalResources).material;e.addGeometry(t,i),e.addGeometry(n,i),this._updateVertices(e)}},{key:"forEachExternalMaterial",value:function(e){(0,p.pC)(this._externalResources)&&e(this._externalResources.material)}},{key:"_updateMaterial",value:function(){(0,p.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}},{key:"_updateGeometry",value:function(){var e=this.object;(0,p.Wi)(e)||this._updateVertices(e)}},{key:"_updateVertices",value:function(e){var t=this.view.state.camera;t.projectToScreen(this.location,he),(0,A.a)(de,this.location,this.direction),t.projectToScreen(de,pe),(0,le.i)(pe,(0,le.g)(pe,pe,he)),this._updateVertexAttributes(t,e,0,he,pe,1),this._updateVertexAttributes(t,e,1,he,pe,-1)}},{key:"_updateVertexAttributes",value:function(e,t,n,i,r,a){var o=t.geometryRecords[n],s=o.geometry.getMutableAttribute(ee.T.POSITION).data,u=(0,le.f)(fe,(0,le.a)(fe,r[1]*a,r[0]*-a),this.offset+this.width/2),l=(0,le.b)(ve,(0,le.b)(ve,(0,le.b)(ve,i,(0,le.f)(ve,r,this.length/2)),u),u),c=(0,le.b)(ye,l,(0,le.f)(ye,r,-this.length));e.unprojectFromScreen(l,de),s[0]=de[0],s[1]=de[1],s[2]=de[2],e.unprojectFromScreen(c,de),s[3]=de[0],s[4]=de[1],s[5]=de[2],t.geometryVertexAttrsUpdated(o)}}]),n}(Q._),de=(0,W.c)(),he=(0,H.s1)(),pe=(0,H.s1)(),fe=(0,H.s1)(),ve=(0,H.s1)(),ye=(0,H.s1)(),_e=n(13759),ge=n(98917),me=n(76014),we=n(64674),ke=n(38561),Ze=n(11208),Se=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(){return(0,o.Z)(this,n),t.apply(this,arguments)}return(0,s.Z)(n,[{key:"visualizeIntersectionPoint",value:function(e,t){var n=t.coordinateHelper,i=t.view;return(0,m.ed)(new _e.L({view:i,primitive:"circle",geometry:n.vectorToPoint(e.intersectionPoint),elevationInfo:(0,p.Pt)(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:k.Z.toUnitRGBA(me.c.orange),pixelSnappingEnabled:!1}))}},{key:"visualizePoint",value:function(e,t){var n=t.coordinateHelper,i=t.view;return(0,m.ed)(new _e.L({view:i,primitive:"circle",geometry:n.vectorToPoint(e.point),elevationInfo:(0,p.Pt)(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:k.Z.toUnitRGBA(me.c.orange),pixelSnappingEnabled:!1}))}},{key:"visualizeLine",value:function(e,t){var n=t.coordinateHelper,i=t.view;return(0,m.ed)(this._createLineSegmentHintFromMap(e.type,e.lineStart,e.lineEnd,n,(0,p.Pt)(e.elevationInfo,t.elevationInfo),i,e.fadeLeft,e.fadeRight))}},{key:"visualizeParallelSign",value:function(e,t){var n=t.coordinateHelper,i=t.view,r=(0,p.Pt)(e.elevationInfo,t.elevationInfo),a=(0,Ze.$r)(e.lineStart,n,r,t.view),o=(0,Ze.$r)(e.lineEnd,n,r,t.view),s=(0,A.h)(o,a,o,.5),u=new ce({view:i,attached:!1,offset:me.c.parallelLineHintOffset,length:me.c.parallelLineHintLength,width:me.c.parallelLineHintWidth,color:k.Z.toUnitRGBA(me.c.orange),location:s,renderOccluded:J.yD.Opaque});return u.setDirectionFromPoints(a,s),u.attached=!0,(0,m.ed)(u)}},{key:"visualizeRightAngleQuad",value:function(e,t){var n=t.coordinateHelper,i=t.view,r=(0,p.Pt)(e.elevationInfo,t.elevationInfo);return(0,m.ed)(new ge.R({view:i,attached:!0,color:k.Z.toUnitRGBA(me.c.orange),renderOccluded:J.yD.Transparent,outlineRenderOccluded:J.yD.Opaque,outlineColor:k.Z.toUnitRGBA(me.c.orange),outlineSize:me.c.rightAngleHintOutlineSize,size:me.c.rightAngleHintSize,geometry:{previous:(0,Ze.$r)(e.previousVertex,n,r,i),center:(0,Ze.$r)(e.centerVertex,n,r,i),next:(0,Ze.$r)(e.nextVertex,n,r,i)}}))}},{key:"_createLineSegmentHintFromMap",value:function(e,t,n,i,r,a){var o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],u=(0,W.c)(),l=(0,W.c)();return(0,Ze.By)(t,n,i,r,a,u,l),this._createLineSegmentHint(e,a,u,l,o,s)}},{key:"_createLineSegmentHint",value:function(e,t,n,i){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=new ne({view:t,extensionType:P.FADED,start:n,end:i,color:k.Z.toUnitRGBA(me.c.orange),renderOccluded:J.yD.Opaque});switch(e){case we.ze.TARGET:o.width=me.c.lineHintWidthTarget,o.fadedExtensions={start:0,end:me.c.lineHintFadedExtensions};break;case we.ze.REFERENCE_EXTENSION:o.width=me.c.lineHintWidthReference,o.fadedExtensions={start:0,end:0};break;case we.ze.REFERENCE:o.width=me.c.lineHintWidthReference,o.fadedExtensions={start:r?me.c.lineHintFadedExtensions:0,end:a?me.c.lineHintFadedExtensions:0}}return o.attached=!0,o}}]),n}(ke.a),Ce=n(51328),be=n(14813),xe=n(5693),Ee=n(84954),Pe=n(95172),Te=n(1413),Oe=n(70758),Re=n(92536),Me=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).layer=null,i.enabled=!0,i.updating=!1,i.availability=1,i}return(0,s.Z)(n)}(d.Z);(0,c._)([(0,v.Cb)({constructOnly:!0})],Me.prototype,"layer",void 0),(0,c._)([(0,v.Cb)()],Me.prototype,"enabled",void 0),(0,c._)([(0,v.Cb)()],Me.prototype,"updating",void 0),(0,c._)([(0,v.Cb)()],Me.prototype,"availability",void 0);var Ve=Me=(0,c._)([(0,_.j)("esri.views.interactive.snapping.SnappingLayerSource")],Me),He=n(7494),Ie=n(46798),De=n(23470),Le=n(74509),ze=n(95905),Ge=n(36700),Ae=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).availability=0,i._ids=new Set,i.tmpP=(0,W.c)(),i}return(0,s.Z)(n,[{key:"destroy",value:function(){this.workerHandle.destroy(),this.workerHandle=null}},{key:"initialize",value:function(){var e=this;this.workerHandle=new We(this.schedule,{fetchAllEdgeLocations:function(t,n){return e._fetchAllEdgeLocations(t,n)}})}},{key:"fetchCandidates",value:function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n){var r,a,o,s,u=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.coordinateHelper.toXYZ(t.point),this.view.renderCoordsHelper.toRenderCoords(r,t.coordinateHelper.spatialReference,r),a="number"==typeof t.distance?t.distance:t.distance.pixelSize,e.next=5,this.workerHandle.invoke({bounds:(0,De.f)(r[0],r[1],r[2],a),types:t.types},n);case 5:return o=e.sent,s=t.coordinateHelper,e.abrupt("return",(o.candidates.sort((function(e,t){return e.distance-t.distance})),o.candidates.map((function(e){return u._convertCandidate(s,e)}))));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._ids.add(t.id),e.next=3,this.workerHandle.invokeMethod("add",t,n);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._ids.delete(t.id),e.next=3,this.workerHandle.invokeMethod("remove",t,n);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_convertCandidate",value:function(e,t){switch(t.type){case"edge":return new ze.L({coordinateHelper:e,objectId:t.objectId,targetPoint:this._convertRenderCoordinate(e,t.target),edgeStart:this._convertRenderCoordinate(e,t.start),edgeEnd:this._convertRenderCoordinate(e,t.end),elevationInfo:Le.jG});case"vertex":return new Ge.x({coordinateHelper:e,objectId:t.objectId,targetPoint:this._convertRenderCoordinate(e,t.target),elevationInfo:Le.jG})}}},{key:"_convertRenderCoordinate",value:function(e,t){return this.view.renderCoordsHelper.fromRenderCoords(t,this.tmpP,e.spatialReference),e.fromXYZ(this.tmpP)}},{key:"_fetchAllEdgeLocations",value:function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n){var o,s,u,l,c,d=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=[],s=[],u=(0,a.Z)(t.components);try{for(c=function(){var e=l.value,t=e.id,a=e.uid;d._ids.has(t)&&o.push((0,r.Z)((0,i.Z)().mark((function e(){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.fetchEdgeLocations(t,n.signal);case 2:return r=e.sent,e.abrupt("return",(s.push(r.locations.buffer),{id:t,uid:a,objectIds:r.objectIds,locations:r.locations.buffer,origin:r.origin,type:r.type}));case 4:case"end":return e.stop()}}),e)})))())},u.s();!(l=u.n()).done;)c()}catch(h){u.e(h)}finally{u.f()}return e.next=5,Promise.all(o);case 5:return e.t0=e.sent.filter((function(e){var t=e.id;return d._ids.has(t)})),e.t1={components:e.t0},e.t2=s,e.abrupt("return",{result:e.t1,transferList:e.t2});case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(O.r);(0,c._)([(0,v.Cb)({constructOnly:!0})],Ae.prototype,"view",void 0),(0,c._)([(0,v.Cb)({constructOnly:!0})],Ae.prototype,"fetchEdgeLocations",void 0),(0,c._)([(0,v.Cb)({constructOnly:!0})],Ae.prototype,"schedule",void 0),(0,c._)([(0,v.Cb)({readOnly:!0})],Ae.prototype,"availability",void 0),Ae=(0,c._)([(0,_.j)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],Ae);var We=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e,i){return(0,o.Z)(this,n),t.call(this,"SceneLayerSnappingSourceWorker","fetchCandidates",{},e,{strategy:"dedicated",client:i})}return(0,s.Z)(n)}(Ie.q),Fe=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).availability=1,i.abortController=new AbortController,i}return(0,s.Z)(n,[{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"layer",get:function(){return this.layerSource.layer}},{key:"destroy",value:function(){this.abortController=(0,p.IM)(this.abortController)}},{key:"initialize",value:function(){var e=this,t=this.view.resourceController;this.edgeWorker=new He.Z((function(e){return t.schedule(e)})),this.workerHandle=new Ae({view:this.view,schedule:function(e){return t.schedule(e)},fetchEdgeLocations:function(){var t=(0,r.Z)((0,i.Z)().mark((function t(n,r){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(0,p.Wi)(e.tracker)){t.next=2;break}throw new Error("tracker-not-initialized");case 2:return t.abrupt("return",e.tracker.fetchEdgeLocations(n,e.edgeWorker,r));case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}),this.updatingHandles.addPromise(this._setupLayerView()),this.handles.add([(0,m.ed)(this.workerHandle),(0,m.ed)(this.edgeWorker)])}},{key:"fetchCandidates",value:function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.workerHandle.fetchCandidates(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"refresh",value:function(){}},{key:"_setupLayerView",value:function(){var e=(0,r.Z)((0,i.Z)().mark((function e(){var t,n,r=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.view.whenLayerView(this.layer);case 2:if("scene-layer-graphics-3d"!==(t=e.sent).type){e.next=5;break}return e.abrupt("return");case 5:n={add:function(e,t){return r.updatingHandles.addPromise(r.workerHandle.add({id:e,bounds:t},r.abortController.signal))},remove:function(e){return r.updatingHandles.addPromise(r.workerHandle.remove({id:e},r.abortController.signal))}},this.tracker=t.trackSnappingSources(n),this.handles.add(this.tracker);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(O.r);(0,c._)([(0,v.Cb)({constructOnly:!0})],Fe.prototype,"layerSource",void 0),(0,c._)([(0,v.Cb)({constructOnly:!0})],Fe.prototype,"view",void 0),(0,c._)([(0,v.Cb)({readOnly:!0})],Fe.prototype,"updating",null),(0,c._)([(0,v.Cb)({readOnly:!0})],Fe.prototype,"availability",void 0),Fe=(0,c._)([(0,_.j)("esri.views.interactive.snapping.featureSources.SceneLayerSnappingSource")],Fe);var je=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).options=null,i._snappingSources=new h.Z,i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this;this.own([this.view.on("layerview-create",(function(t){var n=t.layerView;return e._createSource(n)})),this.view.on("layerview-destroy",(function(t){var n=t.layerView;return e._removeSource(n)}))]);var t,n=(0,a.Z)(this.view.allLayerViews.items);try{for(n.s();!(t=n.n()).done;){var i=t.value;this._createSource(i)}}catch(r){n.e(r)}finally{n.f()}}},{key:"destroy",value:function(){this.options=null,this._snappingSources.drain((function(e){return e.destroy()}))}},{key:"updating",get:function(){return this._snappingSources.some((function(e){return e.updating}))}},{key:"_types",get:function(){return Re.r.EDGE|Re.r.VERTEX}},{key:"fetchCandidates",value:function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n,r){var a,o,s,u,l,c,d,h,f,v;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.view,o=this.options,s=n.coordinateHelper,u=n.elevationInfo,l=(0,p.pC)(o)?o.distance:1,c=(0,Ze.$r)(t,s,u,a,w.WM.get()),d=l*a.state.camera.computeScreenPixelSizeAt(c),h=this._types,f=this._snappingSources.items.map((function(e){return e.fetchCandidates({point:t,coordinateHelper:s,distance:d,types:h},r)})),e.next=11,Promise.all(f);case 11:return v=e.sent.flat(),e.abrupt("return",((0,we.lQ)(t,v),v));case 13:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"_createSource",value:function(e){if("scene-layer-3d"===e.type){var t=new Fe({layerSource:new Ve({layer:e.layer}),view:this.view});this._snappingSources.push(t)}}},{key:"_removeSource",value:function(e){var t=this._snappingSources.findIndex((function(t){return t.layerSource.layer===e.layer}));-1!==t&&this._snappingSources.removeAt(t).destroy()}}]),n}(d.Z);(0,c._)([(0,v.Cb)({constructOnly:!0})],je.prototype,"view",void 0),(0,c._)([(0,v.Cb)()],je.prototype,"updating",null),(0,c._)([(0,v.Cb)()],je.prototype,"options",void 0),(0,c._)([(0,v.Cb)()],je.prototype,"_snappingSources",void 0),je=(0,c._)([(0,_.j)("esri.views.interactive.snapping.SceneSnappingEngine")],je);var Ne,qe=n(93433),Ue=n(91505),Ye=n(29439),Xe=n(77427),Be=n(95122),$e=n(75691),Qe=n(92605),Ke=n(53397),Je=n(41216),et=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i,r=e.coordinateHelper,a=e.targetPoint,s=e.constraint,u=e.previousVertex,l=e.otherVertex,c=e.otherVertexType,d=e.objectId,h=e.elevationInfo;return(0,o.Z)(this,n),(i=t.call(this,r,a,s,h)).previousVertex=u,i.otherVertex=l,i.otherVertexType=c,i.objectId=d,i}return(0,s.Z)(n,[{key:"hints",get:function(){var e=this.previousVertex,t=this.otherVertexType===Ne.CENTER?this.otherVertex:this.targetPoint,n=this.otherVertexType===Ne.CENTER?this.targetPoint:this.otherVertex,i=this.elevationInfo;return[new Ke.w(we.ze.TARGET,t,n,i),new Ke.w(we.ze.REFERENCE,e,t,i),new Je.y(this.previousVertex,t,n,i)]}}]),n}(Qe.j);!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(Ne||(Ne={}));var tt=function(e){(0,u.Z)(c,e);var t=(0,l.Z)(c);function c(e){var n;return(0,o.Z)(this,c),(n=t.call(this,e)).options=null,n.sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null}},n}return(0,s.Z)(c,[{key:"updating",get:function(){return(0,Xe.oE)(this.snappingSources,(function(e){return e.snappingSource.updating}))||this.updatingHandles.updating}},{key:"snappingSources",get:function(){var e=this._get("snappingSources")||new Map,t=new Map;if((0,p.pC)(this.options)&&(0,p.pC)(this.options.featureSources)){var n,i=(0,a.Z)(this.options.featureSources.items);try{for(i.s();!(n=i.n()).done;){var r=n.value,o=r.layer.uid,s=e.get(o);if(s)e.delete(o),t.set(o,s);else if(r.layer.loaded){var u=this._createSourceInfo(r);(0,p.pC)(u)&&t.set(o,u)}else this.updatingHandles.addPromise(r.layer.load())}}catch(d){i.e(d)}finally{i.f()}}var l,c=(0,a.Z)(e);try{for(c.s();!(l=c.n()).done;){(0,Ye.Z)(l.value,2)[1].destroy()}}catch(d){c.e(d)}finally{c.f()}return t}},{key:"initialize",value:function(){var e=this;this.updatingHandles.add((function(){return e.snappingSources}),(function(){return e.notifyChange("updating")}),f.Z_),(0,p.pC)(this.view)&&this.handles.add([this.view.on("layerview-create",(function(t){return e._updateLayerView(t.layer,t.layerView)})),this.view.on("layerview-destroy",(function(t){return e._updateLayerView(t.layer,null)}))])}},{key:"_updateLayerView",value:function(e,t){var n,i=(0,a.Z)(this.snappingSources);try{for(i.s();!(n=i.n()).done;){var r=(0,Ye.Z)(n.value,2)[1];r.snappingSource.layerSource.layer===e&&(r.layerView=t)}}catch(o){i.e(o)}finally{i.f()}}},{key:"destroy",value:function(){this._set("options",null);var e,t=(0,a.Z)(this.snappingSources);try{for(t.s();!(e=t.n()).done;){(0,Ye.Z)(e.value,2)[1].destroy()}}catch(n){t.e(n)}finally{t.f()}}},{key:"fetchCandidates",value:function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n,r){var o,s,u,l,c,d,h,f=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,p.Wi)(this.options)&&this.options.effectiveFeatureEnabled){e.next=2;break}return e.abrupt("return",[]);case 2:o=[],s=this._computeScreeenSizeDistanceParameters(t,n),u={distance:s,point:t,coordinateHelper:n.coordinateHelper,types:this.types,filter:null},l=(0,a.Z)(this.snappingSources);try{for(d=function(){var e=(0,Ye.Z)(c.value,2)[1],t=e.snappingSource,i=e.layerView;!t.layerSource.enabled||(0,p.pC)(i)&&i.suspended||o.push(t.fetchCandidates(u,r).then((function(e){return e.filter((function(e){return!f._candidateIsExcluded(t,e,n.excludeFeature)}))})))},l.s();!(c=l.n()).done;)d()}catch(i){l.e(i)}finally{l.f()}return e.next=7,(0,M.WW)(o);case 7:return h=e.sent.flat(),e.abrupt("return",(this._addRightAngleCandidates(h,t,s,n),(0,M.k_)(r),(0,we.lQ)(t,h),h));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"_addRightAngleCandidates",value:function(e,t,n,i){for(var r,a,o,s,u,l,c,d,h=(0,p.pC)(i.vertexHandle)?null===(r=i.vertexHandle.rightEdge)||void 0===r||null===(a=r.rightVertex)||void 0===a?void 0:a.pos:(0,p.pC)(i.editGeometryOperations)&&"polygon"===i.editGeometryOperations.data.type?null===(o=(0,p.Wg)(null===(s=i.editGeometryOperations.data.components[0])||void 0===s?void 0:s.getFirstVertex()))||void 0===o?void 0:o.pos:null,f=(0,p.pC)(i.vertexHandle)?null===(u=i.vertexHandle.leftEdge)||void 0===u||null===(l=u.leftVertex)||void 0===l?void 0:l.pos:(0,p.pC)(i.editGeometryOperations)?null===(c=(0,p.Wg)(null===(d=i.editGeometryOperations.data.components[0])||void 0===d?void 0:d.getLastVertex()))||void 0===c?void 0:c.pos:null,v=e.length,y=0;y<v;y++)this._addRightAngleCandidate(e[y],f,t,n,i,e),this._addRightAngleCandidate(e[y],h,t,n,i,e)}},{key:"_addRightAngleCandidate",value:function(e,t,n,i,r,a){if(!(0,p.Wi)(t)&&e instanceof ze.L){var o=e.constraint.closestTo(t),s=(o[0]-n[0])/i.x,u=(o[1]-n[1])/i.y;if(s*s+u*u<=1){var l=r.coordinateHelper;a.push(new et({coordinateHelper:l,targetPoint:o,otherVertex:t,otherVertexType:Ne.NEXT,previousVertex:e.constraint.start,constraint:new Be.yG(l,t,o),objectId:e.objectId,elevationInfo:e.elevationInfo}))}}}},{key:"_computeScreeenSizeDistanceParameters",value:function(e,t){var n=(0,p.pC)(this.options)?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;if((0,p.Wi)(this.view))return{x:n,y:n,pixelSize:n};if("2d"===this.view.type){var i=n*this.view.resolution;return{x:i,y:i,pixelSize:i}}return this._computeScreenSizeDistanceParameters3D(e,n,this.view,t)}},{key:"_computeScreenSizeDistanceParameters3D",value:function(e,t,n,i){var r=i.coordinateHelper,a=i.elevationInfo,o=n.state.camera.computeScreenPixelSizeAt((0,Ze.$r)(e,r,a,n,it)),s=o*n.renderCoordsHelper.unitInMeters/n.mapCoordsHelper.unitInMeters,u=t*s;return{x:u/this._computeScreenMagnitudeOfMapOffset(e,s,0,n,i),y:u/this._computeScreenMagnitudeOfMapOffset(e,0,s,n,i),pixelSize:o}}},{key:"_computeScreenMagnitudeOfMapOffset",value:function(e,t,n,i,r){var a=r.coordinateHelper,o=r.elevationInfo,s=a.clone(e);s[0]+=t,s[1]+=n;var u=(0,Ze.a7)(e,a,o,i),l=(0,Ze.a7)(s,a,o,i),c=l.x-u.x,d=l.y-u.y;return Math.sqrt(c*c+d*d)}},{key:"types",get:function(){return Re.r.EDGE|Re.r.VERTEX}},{key:"_candidateIsExcluded",value:function(e,t,n){if((0,p.Wi)(n))return!1;var i=this._getCandidateObjectId(t);if((0,p.Wi)(i))return!1;var r=e.layerSource.layer;return"graphics"===r.type?n.uid===i:n.sourceLayer===r&&!(!n.attributes||!("objectIdField"in r))&&n.attributes[r.objectIdField]===i}},{key:"_getCandidateObjectId",value:function(e){return e instanceof $e.a?e.objectId:null}},{key:"_createSourceInfo",value:function(e){var t=this,n=this._createFeatureSnappingSourceType(e);if((0,p.Wi)(n))return null;if("loading"in n)return this.updatingHandles.addPromise(n.loading.then((function(){t.destroyed||t.notifyChange("snappingSources")}))),null;var i=(0,p.pC)(this.view)?this.view.allLayerViews.find((function(t){return t.layer===e.layer})):null;return new nt(n.source,i)}},{key:"_createFeatureSnappingSourceType",value:function(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e)}return null}},{key:"_createFeatureSnappingSourceFeatureLayer",value:function(e){switch(e.layer.source.type){case"feature-layer":var t=this._getSourceModule("featureService");return(0,p.pC)(t.module)?{source:new t.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader};case"memory":case"csv":case"geojson":case"wfs":if("mesh"===e.layer.geometryType)return null;var n=this._getSourceModule("featureCollection");return(0,p.pC)(n.module)?{source:new n.module.FeatureCollectionSnappingSource({layerSource:e})}:{loading:n.loader}}return null}},{key:"_createFeatureSnappingSourceGraphicsLayer",value:function(e){var t=this._getSourceModule("graphics");return(0,p.pC)(t.module)?{source:new t.module.GraphicsSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}},{key:"_getSourceModule",value:function(e){var t=this.sourceModules[e];if((0,p.Wi)(t.loader)){var n=this._loadSourceModule(e).then((function(e){t.module=e}));return t.loader=n,{module:t.module,loader:n}}return{module:t.module,loader:t.loader}}},{key:"_loadSourceModule",value:function(e){switch(e){case"featureService":return this.updatingHandles.addPromise(n.e(5532).then(n.bind(n,5532)));case"featureCollection":return this.updatingHandles.addPromise(n.e(2137).then(n.bind(n,26823)));case"graphics":return this.updatingHandles.addPromise(Promise.all([n.e(739),n.e(3518)]).then(n.bind(n,33518)))}return null}}]),c}(O.r);(0,c._)([(0,v.Cb)({constructOnly:!0})],tt.prototype,"spatialReference",void 0),(0,c._)([(0,v.Cb)({constructOnly:!0})],tt.prototype,"view",void 0),(0,c._)([(0,v.Cb)()],tt.prototype,"options",void 0),(0,c._)([(0,v.Cb)({readOnly:!0})],tt.prototype,"updating",null),(0,c._)([(0,v.Cb)({readOnly:!0})],tt.prototype,"snappingSources",null),tt=(0,c._)([(0,_.j)("esri.views.interactive.snapping.FeatureSnappingEngine")],tt);var nt=function(){function e(t,n){(0,o.Z)(this,e),this.snappingSource=t,this.layerView=n,this.handles=new R.Z;var i=this.snappingSource.layerSource.layer;if("refresh"in i){var r=i;this.handles.add(r.on("refresh",(function(){return t.refresh()})))}this.handles.add([(0,f.YP)((function(){return t.updating}),(function(e){return t.layerSource.updating=e}),f.tX),(0,f.YP)((function(){return t.availability}),(function(e){return t.layerSource.availability=e}),f.tX)])}return(0,s.Z)(e,[{key:"destroy",value:function(){this.snappingSource.destroy(),this.handles.destroy()}}]),e}(),it=(0,W.c)(),rt=n(6394),at=function(){function e(t,n){(0,o.Z)(this,e),this.view=t,this.options=n,this.squaredShortLineThreshold=me.c.shortLineThreshold*me.c.shortLineThreshold}return(0,s.Z)(e,[{key:"snap",value:function(e,t){return(0,p.pC)(t.vertexHandle)?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}},{key:"edgeExceedsShortLineThreshold",value:function(e,t){return this.exceedsShortLineThreshold(e.leftVertex.pos,e.rightVertex.pos,t)}},{key:"exceedsShortLineThreshold",value:function(e,t,n){var i=n.elevationInfo,r=n.editGeometryOperations.data.coordinateHelper;return 0===this.squaredShortLineThreshold||(0,we.tp)((0,Ze.a7)(t,r,i,this.view),(0,Ze.a7)(e,r,i,this.view))>this.squaredShortLineThreshold}},{key:"squaredProximityTreshold",value:function(e){return"touch"===e?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}},{key:"squaredMouseProximityTreshold",get:function(){return this.options.distance*this.options.distance}},{key:"squaredTouchProximityThreshold",get:function(){var e=this.options,t=e.distance*e.touchSensitivityMultiplier;return t*t}}]),e}(),ot=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i,r=e.coordinateHelper,a=e.lineStart,s=e.lineEnd,u=e.targetPoint,l=e.elevationInfo;return(0,o.Z)(this,n),(i=t.call(this,r,u,new Be.ku(r,a,s),l)).referenceLineHint=new Ke.w(we.ze.REFERENCE_EXTENSION,a,s,l),i}return(0,s.Z)(n,[{key:"hints",get:function(){return[this.referenceLineHint,new Ke.w(we.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.elevationInfo)]}},{key:"_lineEndClosestToTarget",value:function(){var e=this.constraint.start,t=this.constraint.end;return Math.sign((0,le.h)((0,le.g)(ut,t,e),(0,le.g)(st,this.targetPoint,e)))>0?t:e}}]),n}(Qe.j),st=(0,rt.a)(),ut=(0,rt.a)(),lt=n(94163),ct=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(){return(0,o.Z)(this,n),t.apply(this,arguments)}return(0,s.Z)(n,[{key:"snapNewVertex",value:function(e,t){var n=t.editGeometryOperations.data.components[0],i=n.edges.length,r=[];if(i<1)return r;var a=t.coordinateHelper,o=(0,Ze.a7)(e,a,t.elevationInfo,this.view),s=n.edges[i-1],u=s;do{this.edgeExceedsShortLineThreshold(u,t)&&this._processCandidateProposal(u.leftVertex.pos,u.rightVertex.pos,e,o,t,r),u=u.leftVertex.leftEdge}while(u&&u!==s);return r}},{key:"snapExistingVertex",value:function(e,t){var n=[],i=(0,p.Wg)(t.vertexHandle),r=i.component;if(r.edges.length<2)return n;var a=t.coordinateHelper,o=(0,Ze.a7)(e,a,t.elevationInfo,this.view),s=i.leftEdge,u=i.rightEdge;s&&u&&this.edgeExceedsShortLineThreshold(s,t)&&this.edgeExceedsShortLineThreshold(u,t)&&this._processCandidateProposal(s.leftVertex.pos,u.rightVertex.pos,e,o,t,n);var l=r.edges[0],c=l;do{c!==i.leftEdge&&c!==i.rightEdge&&this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal(c.leftVertex.pos,c.rightVertex.pos,e,o,t,n),c=c.rightVertex.rightEdge}while(c&&c!==l);return n}},{key:"_processCandidateProposal",value:function(e,t,n,i,r,a){var o=(0,lt.k0)((0,rt.a)(),n,e,t),s=r.coordinateHelper,u=r.elevationInfo,l=r.pointer,c=s.fromXYZ(o,s.getZ(n,0));(0,we.tp)(i,(0,Ze.a7)(c,s,u,this.view))<this.squaredProximityTreshold(l)&&a.push(new ot({coordinateHelper:s,lineStart:e,lineEnd:t,targetPoint:c,elevationInfo:u}))}}]),n}(at),dt=n(5916),ht=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i,r=e.coordinateHelper,a=e.referenceLine,s=e.lineStart,u=e.targetPoint,l=e.elevationInfo;(0,o.Z)(this,n);var c=r.clone(s);return(0,le.g)(c,(0,le.b)(c,c,a.rightVertex.pos),a.leftVertex.pos),(i=t.call(this,r,u,new Be.ku(r,s,c),l))._referenceLines=[{edge:a,fadeLeft:!0,fadeRight:!0}],i}return(0,s.Z)(n,[{key:"hints",get:function(){var e=this.elevationInfo;return[new Ke.w(we.ze.TARGET,this.constraint.start,this.targetPoint,e),new dt.L(this.constraint.start,this.targetPoint,e)].concat((0,qe.Z)(this._referenceLines.map((function(t){return new Ke.w(we.ze.REFERENCE,t.edge.leftVertex.pos,t.edge.rightVertex.pos,e,t.fadeLeft,t.fadeRight)}))))}},{key:"addReferenceLine",value:function(e){var t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((function(n){e.rightVertex.rightEdge===n.edge&&(n.fadeLeft=!1,t.fadeRight=!1),e.leftVertex.leftEdge===n.edge&&(n.fadeRight=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}]),n}(Qe.j),pt=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments))._tmpProjection=(0,rt.a)(),e}return(0,s.Z)(n,[{key:"snapNewVertex",value:function(e,t){var n=t.editGeometryOperations.data.components[0],i=n.edges.length,r=n.vertices.length,a=[];if(i<2)return a;var o=(0,Ze.a7)(e,t.coordinateHelper,t.elevationInfo,this.view),s=n.vertices[r-1],u=n.vertices[0],l=n.edges[i-1],c=l;do{this.edgeExceedsShortLineThreshold(c,t)&&(this._checkEdgeForParalleLines(c,s.pos,e,o,t,a),this._checkEdgeForParalleLines(c,u.pos,e,o,t,a)),c=c.leftVertex.leftEdge}while(c&&c!==l);return a}},{key:"snapExistingVertex",value:function(e,t){var n=[],i=(0,p.Wg)(t.vertexHandle),r=i.component;if(r.edges.length<3)return n;var a=(0,Ze.a7)(e,t.coordinateHelper,t.elevationInfo,this.view),o=i.leftEdge,s=i.rightEdge,u=r.vertices[0],l=r.vertices.length,c=r.vertices[l-1],d=r.edges[0],h=d;do{h!==o&&h!==s&&this.edgeExceedsShortLineThreshold(h,t)&&(o&&this._checkEdgeForParalleLines(h,o.leftVertex.pos,e,a,t,n),s&&this._checkEdgeForParalleLines(h,s.rightVertex.pos,e,a,t,n),i===u?this._checkEdgeForParalleLines(h,c.pos,e,a,t,n):i===c&&this._checkEdgeForParalleLines(h,u.pos,e,a,t,n)),h=h.rightVertex.rightEdge}while(h&&h!==d);return n}},{key:"_checkEdgeForParalleLines",value:function(e,t,n,i,r,a){var o=e.leftVertex.pos,s=e.rightVertex.pos;if((0,lt.k0)(this._tmpProjection,t,o,s),!((0,le.s)(this._tmpProjection,t)<me.c.parallelLineThreshold)){(0,lt.k0)(this._tmpProjection,n,o,s,t);var u=r.coordinateHelper,l=r.elevationInfo,c=r.pointer,d=u.fromXYZ(this._tmpProjection,u.getZ(n,0));if((0,we.tp)(i,(0,Ze.a7)(d,u,l,this.view))<this.squaredProximityTreshold(c)){if(this._parallelToPreviousCandidate(e,a))return;a.push(new ht({coordinateHelper:u,referenceLine:e,lineStart:t,targetPoint:d,elevationInfo:l}))}}}},{key:"_parallelToPreviousCandidate",value:function(e,t){var n,i=e.leftVertex.pos,r=e.rightVertex.pos,o=(0,a.Z)(t);try{for(o.s();!(n=o.n()).done;){var s=n.value;if((0,lt.k0)(this._tmpProjection,r,s.constraint.start,s.constraint.end,i),(0,le.s)(this._tmpProjection,r)<me.c.parallelLineThreshold)return s.addReferenceLine(e),!0}}catch(u){o.e(u)}finally{o.f()}return!1}}]),n}(at),ft=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments))._tmp=(0,rt.a)(),e}return(0,s.Z)(n,[{key:"snapNewVertex",value:function(e,t){var n=t.editGeometryOperations.data.components[0],i=n.vertices.length,r=[];if(i<2)return r;var a=(0,Ze.a7)(e,t.coordinateHelper,t.elevationInfo,this.view),o=n.vertices[i-1];this._checkForSnappingCandidate(r,o.leftEdge,o.pos,e,o.leftEdge.leftVertex.pos,o.pos,t,e,a);var s=n.vertices[0];return this._checkForSnappingCandidate(r,s.rightEdge,s.pos,e,s.rightEdge.rightVertex.pos,s.pos,t,e,a),r}},{key:"snapExistingVertex",value:function(e,t){var n=[],i=(0,p.Wg)(t.vertexHandle),r=i.component,a=r.vertices.length;if(a<3)return n;var o=(0,Ze.a7)(e,t.coordinateHelper,t.elevationInfo,this.view),s=i.leftEdge,u=i.rightEdge,l=r.vertices[0],c=r.vertices[a-1];if(!s)return this._checkForSnappingCandidate(n,l.rightEdge.rightVertex.rightEdge,l.rightEdge.rightVertex.pos,e,l.rightEdge.rightVertex.rightEdge.rightVertex.pos,l.rightEdge.rightVertex.pos,t,e,o),n;if(!u)return this._checkForSnappingCandidate(n,c.leftEdge.leftVertex.leftEdge,c.leftEdge.leftVertex.pos,e,c.leftEdge.leftVertex.leftEdge.leftVertex.pos,c.leftEdge.leftVertex.pos,t,e,o),n;if(s&&s.leftVertex.leftEdge){var d=s.leftVertex.leftEdge;this._checkForSnappingCandidate(n,d,s.leftVertex.pos,e,d.leftVertex.pos,s.leftVertex.pos,t,e,o)}if(u&&u.rightVertex.rightEdge){var h=u.rightVertex.rightEdge;this._checkForSnappingCandidate(n,h,u.rightVertex.pos,e,h.rightVertex.pos,u.rightVertex.pos,t,e,o)}return n}},{key:"_checkForSnappingCandidate",value:function(e,t,n,i,r,a,o,s,u){if(this.edgeExceedsShortLineThreshold(t,o)){(0,le.g)(this._tmp,t.rightVertex.pos,t.leftVertex.pos);var l=(0,rt.f)(this._tmp[1],-this._tmp[0]),c=(0,le.h)(l,(0,le.g)(this._tmp,i,n))/(0,le.u)(l),d=o.coordinateHelper,h=o.elevationInfo,p=o.pointer,f=d.fromXYZ((0,le.v)((0,rt.a)(),a,l,c),d.getZ(s,0));(0,we.tp)(u,(0,Ze.a7)(f,d,h,this.view))<this.squaredProximityTreshold(p)&&e.push(new et({coordinateHelper:d,targetPoint:f,constraint:new Be.yG(d,a,(0,le.v)(d.createVector(),a,l,Math.sign(c))),previousVertex:r,otherVertex:a,otherVertexType:Ne.CENTER,elevationInfo:h}))}}}]),n}(at),vt=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i,r=e.coordinateHelper,a=e.targetPoint,s=e.point1,u=e.point2,l=e.elevationInfo;return(0,o.Z)(this,n),(i=t.call(this,r,a,new Be.UL(r,(0,le.l)(yt,s,u,.5),.5*(0,le.j)(s,u)),l)).p1=s,i.p2=u,i}return(0,s.Z)(n,[{key:"hints",get:function(){var e=this.elevationInfo;return[new Ke.w(we.ze.REFERENCE,this.targetPoint,this.p1,e),new Ke.w(we.ze.REFERENCE,this.targetPoint,this.p2,e),new Je.y(this.p1,this.targetPoint,this.p2,e)]}}]),n}(Qe.j),yt=(0,rt.a)(),_t=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(){return(0,o.Z)(this,n),t.apply(this,arguments)}return(0,s.Z)(n,[{key:"snapNewVertex",value:function(e,t){var n=t.editGeometryOperations.data.components[0],i=[],r=n.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||r<2)return i;var a=n.vertices[0],o=n.vertices[r-1];return this._processCandidateProposal(a.pos,o.pos,e,t,i),i}},{key:"snapExistingVertex",value:function(e,t){var n=[],i=(0,p.Wg)(t.vertexHandle),r=i.component;return r.edges.length<2?n:"polyline"!==t.editGeometryOperations.data.type||0!==i.index&&i.index!==r.vertices.length-1?(this._processCandidateProposal(i.leftEdge.leftVertex.pos,i.rightEdge.rightVertex.pos,e,t,n),n):n}},{key:"_processCandidateProposal",value:function(e,t,n,i,r){if(this.exceedsShortLineThreshold(e,t,i)){var a=(0,le.l)((0,rt.a)(),e,t,.5),o=.5*(0,le.j)(e,t),s=(0,lt.xO)((0,rt.a)(),n,a,o),u=i.coordinateHelper,l=i.elevationInfo,c=i.pointer,d=u.fromXYZ(s,u.getZ(n,0)),h=(0,Ze.a7)(n,u,l,this.view);(0,we.tp)(h,(0,Ze.a7)(d,u,l,this.view))<this.squaredProximityTreshold(c)&&r.push(new vt({coordinateHelper:u,targetPoint:d,point1:e,point2:t,elevationInfo:l}))}}}]),n}(at),gt=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).updating=!1,i._snappers=new h.Z,i}return(0,s.Z)(n,[{key:"initialize",value:function(){this._snappers.push(new pt(this.view,this.options),new ct(this.view,this.options),new ft(this.view,this.options),new _t(this.view,this.options))}},{key:"options",set:function(e){this._set("options",e);var t,n=(0,a.Z)(this._snappers);try{for(n.s();!(t=n.n()).done;){t.value.options=e}}catch(i){n.e(i)}finally{n.f()}}},{key:"fetchCandidates",value:function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n){var r,o,s,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.options.effectiveSelfEnabled){e.next=2;break}return e.abrupt("return",[]);case 2:r=[],o=(0,a.Z)(this._snappers.items);try{for(o.s();!(s=o.n()).done;)u=s.value,r.push.apply(r,(0,qe.Z)(u.snap(t,n)))}catch(i){o.e(i)}finally{o.f()}return e.abrupt("return",((0,we.lQ)(t,r),r));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(d.Z);function mt(e,t){return[new gt({view:e,options:t}),new tt({view:e,options:t,spatialReference:e.spatialReference})]}(0,c._)([(0,v.Cb)({readOnly:!0})],gt.prototype,"updating",void 0),(0,c._)([(0,v.Cb)({constructOnly:!0})],gt.prototype,"view",void 0),(0,c._)([(0,v.Cb)()],gt.prototype,"options",null),gt=(0,c._)([(0,_.j)("esri.views.interactive.snapping.SelfSnappingEngine")],gt);var wt=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).enabled=!1,i.enabledToggled=!1,i.selfEnabled=!0,i.featureEnabled=!0,i.featureSources=new h.Z,i.distance=me.c.distance,i.touchSensitivityMultiplier=me.c.touchSensitivityMultiplier,i}return(0,s.Z)(n,[{key:"effectiveEnabled",get:function(){return this.enabledToggled?!this.enabled:this.enabled}},{key:"effectiveSelfEnabled",get:function(){return this.effectiveEnabled&&this.selfEnabled}},{key:"effectiveFeatureEnabled",get:function(){return this.effectiveEnabled&&this.featureEnabled}}]),n}(d.Z);(0,c._)([(0,v.Cb)()],wt.prototype,"enabled",void 0),(0,c._)([(0,v.Cb)()],wt.prototype,"enabledToggled",void 0),(0,c._)([(0,v.Cb)()],wt.prototype,"selfEnabled",void 0),(0,c._)([(0,v.Cb)()],wt.prototype,"featureEnabled",void 0),(0,c._)([(0,v.Cb)({type:h.Z.ofType(Ve)})],wt.prototype,"featureSources",void 0),(0,c._)([(0,v.Cb)()],wt.prototype,"distance",void 0),(0,c._)([(0,v.Cb)()],wt.prototype,"touchSensitivityMultiplier",void 0),(0,c._)([(0,v.Cb)({readOnly:!0})],wt.prototype,"effectiveEnabled",null),(0,c._)([(0,v.Cb)({readOnly:!0})],wt.prototype,"effectiveSelfEnabled",null),(0,c._)([(0,v.Cb)({readOnly:!0})],wt.prototype,"effectiveFeatureEnabled",null);var kt=wt=(0,c._)([(0,_.j)("esri.views.interactive.snapping.SnappingOptions")],wt),Zt=n(90609),St=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e,i,r,a,s){var u;return(0,o.Z)(this,n),(u=t.call(this,e,i,new Be.Bq(e,i,r.constraint,a.constraint),s)).first=r,u.second=a,u}return(0,s.Z)(n,[{key:"hints",get:function(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[].concat((0,qe.Z)(this.first.hints),(0,qe.Z)(this.second.hints),[new Zt.w(this.targetPoint,this.elevationInfo)])}}]),n}(Qe.j),Ct=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).options=new kt,i.snappingEnginesFactory=mt,i._engines=[],i._currentMainCandidate=null,i._currentOtherActiveCandidates=[],i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this;this.handles.add([(0,f.YP)((function(){var t=e.options;return{effectiveFeatureEnabled:t.effectiveFeatureEnabled,effectiveSelfEnabled:t.effectiveSelfEnabled,touchSensitivityMultiplier:t.touchSensitivityMultiplier,distance:t.distance}}),(function(){e.doneSnapping(),e.emit("changed")}),f.Z_),(0,f.YP)((function(){return e.options}),(function(t){var n,i=(0,a.Z)(e._engines);try{for(i.s();!(n=i.n()).done;){n.value.options=t}}catch(r){i.e(r)}finally{i.f()}}),f.Z_),(0,f.YP)((function(){return{viewReady:e.view.ready,viewSpatialReference:e.view.spatialReference,snappingEnginesFactory:e.snappingEnginesFactory}}),(function(t){var n=t.viewReady,i=t.snappingEnginesFactory;return e._recreateEngines(n,i)}),f.tX)])}},{key:"destroy",value:function(){this._destroyEngines()}},{key:"updating",get:function(){return this._engines.some((function(e){return e.updating}))}},{key:"_recreateEngines",value:function(e,t){if(this._destroyEngines(),e){var n=this.view,i=this.options;this._engines=t(n,i)}}},{key:"_destroyEngines",value:function(){var e,t=(0,a.Z)(this._engines);try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(n){t.e(n)}finally{t.f()}this._engines=[]}},{key:"squaredMouseProximityTreshold",get:function(){return this.options.distance*this.options.distance}},{key:"squaredTouchProximityThreshold",get:function(){var e=this.options,t=e.distance*e.touchSensitivityMultiplier;return t*t}},{key:"snap",value:function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n,r){var a,o,s=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.coordinateHelper.pointToVector(t),e.next=3,this._fetchCandidates(a,n,r);case 3:return o=e.sent,e.t0=function(){var e=s._processCandidates(a,o,n),t=e.snappedPoint,i=e.hints;return s._removeVisualization(),(0,p.pC)(n.visualizer)&&s.handles.add(n.visualizer.draw(i,{coordinateHelper:n.coordinateHelper,elevationInfo:n.elevationInfo,view:s.view}),bt),t},e.abrupt("return",{get valid(){return!(0,M.Hc)(r)},apply:e.t0});case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"update",value:function(e,t){this._removeVisualization();var n=e,i=[];if((0,p.pC)(this._currentMainCandidate)){var r=t.coordinateHelper,o=r.pointToVector(e),s=this._currentMainCandidate.constraint.closestTo(o);if((0,we.tp)((0,Ze.a7)(o,r,t.elevationInfo,this.view),(0,Ze.a7)(s,r,t.elevationInfo,this.view))<this._squaredPointProximityThreshold(t.pointer)){n=r.vectorToDehydratedPoint(s),this._currentMainCandidate.targetPoint=s,i.push.apply(i,(0,qe.Z)(this._currentMainCandidate.hints));var u,l=(0,a.Z)(this._currentOtherActiveCandidates);try{for(l.s();!(u=l.n()).done;){var c=u.value;c.targetPoint=s,i.push.apply(i,(0,qe.Z)(c.hints))}}catch(d){l.e(d)}finally{l.f()}}else this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}return(0,p.pC)(t.visualizer)&&this.handles.add(t.visualizer.draw(i,{coordinateHelper:t.coordinateHelper,elevationInfo:t.elevationInfo,view:this.view}),bt),n}},{key:"doneSnapping",value:function(){this._removeVisualization(),this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}},{key:"_removeVisualization",value:function(){this.handles.remove(bt)}},{key:"_fetchCandidates",value:function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this._engines.map((function(e){return e.fetchCandidates(t,n,r)})));case 2:return e.abrupt("return",e.sent.flat());case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"_processCandidates",value:function(e,t,n){if(t.length<1)return this.doneSnapping(),{snappedPoint:n.coordinateHelper.vectorToDehydratedPoint(e),hints:[]};(0,we.lQ)(e,t);var i=this._currentMainCandidate;if((0,p.pC)(i)){var r=this._findOldConstraintInNewCandidates(i,t);if(r>=0){if(!(t[r]instanceof St))return this._intersectWithOtherCandidates(r,t,e,n);if((0,le.s)(e,i.targetPoint)<this._squaredPointProximityThreshold(n.pointer))return this._updateSnappingCandidate(i,t,n)}}return this._intersectWithOtherCandidates(0,t,e,n)}},{key:"_findOldConstraintInNewCandidates",value:function(e,t){return e instanceof St?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}},{key:"_intersectWithOtherCandidates",value:function(e,t,n,i){for(var r=t[e],o=[],s=i.coordinateHelper,u=0;u<t.length;++u)if(u!==e){var l,c=t[u],d=(0,a.Z)(r.constraint.intersect(c.constraint));try{for(d.s();!(l=d.n()).done;){var h=l.value,p=s.fromXYZ(h.intersection,r.targetPoint[2]);o.push([new St(s,p,r,c,c.elevationInfo),(0,we.tp)((0,Ze.a7)(n,i.coordinateHelper,i.elevationInfo,this.view),(0,Ze.a7)(p,i.coordinateHelper,i.elevationInfo,this.view))])}}catch(f){d.e(f)}finally{d.f()}}return o.length>0&&(o.sort((function(e,t){return e[1]-t[1]})),o[0][1]<this._squaredPointProximityThreshold(i.pointer))?this._updateSnappingCandidate(o[0][0],t,i):this._updateSnappingCandidate(r,t,i)}},{key:"_updateSnappingCandidate",value:function(e,t,n){this.doneSnapping(),this._currentMainCandidate=e;var i=this._currentMainCandidate.targetPoint,r=[];r.push.apply(r,(0,qe.Z)(e.hints));var o,s=(0,a.Z)(t);try{for(s.s();!(o=s.n()).done;){var u=o.value;if(e instanceof St){if(u.constraint.objectEqual(e.first.constraint)||u.constraint.objectEqual(e.second.constraint))continue}else if(u.constraint.objectEqual(e.constraint))continue;u.constraint.check(i)&&(u.targetPoint=i,this._currentOtherActiveCandidates.push(u),r.push.apply(r,(0,qe.Z)(u.hints)))}}catch(l){s.e(l)}finally{s.f()}return{snappedPoint:n.coordinateHelper.vectorToDehydratedPoint(i),hints:r}}},{key:"_squaredPointProximityThreshold",value:function(e){return"touch"===e?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}},{key:"_findOldCandidateIndex",value:function(e,t){for(var n=-1,i=0;i<e.length;++i)if(t.constraint.objectEqual(e[i].constraint)){n=i;break}return n}},{key:"test",get:function(){return{visualizationsActive:this.handles.has(bt),engines:this._engines}}}]),n}(Ue.Z.EventedMixin(O.r));(0,c._)([(0,v.Cb)({constructOnly:!0})],Ct.prototype,"view",void 0),(0,c._)([(0,v.Cb)()],Ct.prototype,"options",void 0),(0,c._)([(0,v.Cb)({readOnly:!0})],Ct.prototype,"updating",null),(0,c._)([(0,v.Cb)()],Ct.prototype,"snappingEnginesFactory",void 0),(0,c._)([(0,v.Cb)()],Ct.prototype,"_engines",void 0),(0,c._)([(0,v.Cb)()],Ct.prototype,"squaredMouseProximityTreshold",null),(0,c._)([(0,v.Cb)()],Ct.prototype,"squaredTouchProximityThreshold",null),Ct=(0,c._)([(0,_.j)("esri.views.interactive.snapping.SnappingManager")],Ct);var bt="visualization-handle",xt=new Map;function Et(e){var t;xt.has(e)||xt.set(e,{referenceCount:0,snappingManager:(t=e,new Ct({view:t,snappingEnginesFactory:function(e,n){return[new je({view:t,options:n})]}}))});var n=xt.get(e);n.referenceCount++;var i=(0,m.kB)((function(){return function(e,t){t.referenceCount--,t.referenceCount>0||(0,Oe.Y)((function(){0===t.referenceCount&&(t.snappingManager.destroy(),xt.delete(e))}))}(e,n)}));return(0,Te.Z)({snappingManager:n.snappingManager},i)}var Pt=n(34019),Tt=n(80151),Ot=n(71040),Rt=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).stagedDimension=null,i._dimensionManipulators=new Map,i._dimensionHandles=new R.Z,i._snappingPipeline=new Tt.n,i._snappingManagerResult=Et(e.view),i.own(i._snappingManagerResult),i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this;this._snappingOperation=new Ot.y({view:this.view}),this.own([this._dimensionHandles,(0,f.YP)((function(){return e._snappingOperation.stagedPoint}),(function(t){(0,p.pC)(e.stagedDimension)&&(e.stagedDimension.endPoint=(0,p.yw)(t,(function(e){return(0,V.WG)(e,new x.Z)})))}),f.Z_)])}},{key:"destroy",value:function(){this._snappingOperation=(0,p.SC)(this._snappingOperation)}},{key:"updating",get:function(){return this.updatingHandles.updating||this._snappingManager.updating}},{key:"_snappingManager",get:function(){return this._snappingManagerResult.snappingManager}},{key:"addDimension",value:function(e,t){if(!this._dimensionManipulators.has(e)){var n=this._createPointManipulator(e,{isStart:!0}),i=this._createPointManipulator(e,{isStart:!1}),r={startManipulator:n,endManipulator:i};this._setupDimensionToManipulatorsSync(e,r),this._dimensionManipulators.set(e,r),t.add(n),t.add(i)}}},{key:"removeDimension",value:function(e,t){var n=this._dimensionManipulators.get(e);if(!(0,p.Wi)(n)){this._dimensionHandles.remove(e);var i=n.startManipulator,r=n.endManipulator;this._dimensionManipulators.delete(e),t.remove(i),t.remove(r)}}},{key:"getManipulatorsForDimension",value:function(e){return this._dimensionManipulators.get(e)}},{key:"onDeactivate",value:function(){this._snappingManager.doneSnapping()}},{key:"onUnstagedClick",value:function(e){var t=e.mapPoint,n=e.pointerType,i=this._snappingContext(n),r=(0,V.WG)(this._snappingManager.update(t,i),new x.Z),a=new T({startPoint:r,endPoint:null});return this.stagedDimension=a,this._snappingManager.doneSnapping(),a}},{key:"onStagedClick",value:function(e){var t=e.mapPoint,n=e.pointerType;if(!(0,p.Wi)(this.stagedDimension)){var i=this._snappingContext(n),r=(0,V.WG)(this._snappingManager.update(t,i),new x.Z);this.stagedDimension.endPoint=r,this.stagedDimension=null,this._snappingManager.doneSnapping()}}},{key:"onPointerMove",value:function(e){var t=e.mapPoint,n=e.pointerType,i=this._snappingContext(n);this.updatingHandles.addPromise((0,M.R8)(this._snappingOperation.snap(t,this._snappingManager,i)))}},{key:"_setupDimensionToManipulatorsSync",value:function(e,t){var n=this,i=t.startManipulator,r=t.endManipulator;this._dimensionHandles.add([(0,f.YP)((function(){return{startPoint:e.startPoint,endPoint:e.endPoint,stagedDimension:n.stagedDimension}}),(function(t){var n=t.startPoint,a=t.endPoint,o=t.stagedDimension;(0,p.pC)(n)?(i.available=(0,p.Wi)(o)||o===e,i.location=n):i.available=!1,(0,p.pC)(a)?(r.available=(0,p.Wi)(o),r.location=a):r.available=!1}),f.tX)],e)}},{key:"_createPointManipulator",value:function(e,t){var n=this,i=t.isStart?"startPoint":"endPoint",r=(0,G.aD)(this.view,k.Z.toUnitRGB(z.pointManipulators.color),z.pointManipulators.opacity);r.available=!1,r.radius=z.pointManipulators.radius;var a=(0,xe.Xd)(r,(function(t,r,a,o){var s=(0,Ce.J4)(t);r.next(s).next((0,Ce.gv)(n.view)).next(n._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:n._snappingContext(o),snappingManager:n._snappingManager,cancel:a,updatingHandles:n.updatingHandles}),n._snappingPipeline.next).next((function(t){var n=(0,V.WG)(t.mapEnd,new x.Z);e[i]=n})),a.next(s).next((0,xe.di)(e,[i]))}));return this._dimensionHandles.add(a,e),r}},{key:"_snappingContext",value:function(e){return new Pt.N({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new Pe.c(new Ee.XE("point",(0,be.Y6)(!0,!1,this.view.spatialReference))),visualizer:new Se})}}]),n}(O.r);(0,c._)([(0,v.Cb)({constructOnly:!0,nonNullable:!0})],Rt.prototype,"view",void 0),(0,c._)([(0,v.Cb)({readOnly:!0})],Rt.prototype,"updating",null),(0,c._)([(0,v.Cb)()],Rt.prototype,"stagedDimension",void 0),Rt=(0,c._)([(0,_.j)("esri.views.3d.analysis.Dimensioning.LengthDimensionSubTool")],Rt);var Mt,Vt=n(88153),Ht=n(54463),It=n(86509),Dt=n(72612);!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(Mt||(Mt={}));var Lt=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).preferManipulatorCursor=!0,i.analysisViewData=null,i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this;this._intersector=(0,Vt.Z8)(this.view.state.viewingMode),this._intersector.options.store=Ht.eC.MIN,this._lengthDimensionSubTool=new Rt({view:this.view}),this.own((0,m.ed)(this._lengthDimensionSubTool));var t,n=(0,a.Z)(this.analysis.dimensions.items);try{for(n.s();!(t=n.n()).done;){var i=t.value;this._addDimension(i)}}catch(r){n.e(r)}finally{n.f()}this.own(this.analysis.dimensions.on("change",(function(t){var n,i=(0,a.Z)(t.added);try{for(i.s();!(n=i.n()).done;){var o=n.value;e._addDimension(o)}}catch(r){i.e(r)}finally{i.f()}var s,u=(0,a.Z)(t.removed);try{for(u.s();!(s=u.n()).done;){var l=s.value;e._removeDimension(l)}}catch(r){u.e(r)}finally{u.f()}}))),this.own((0,f.YP)((function(){return e.state}),(function(t){t===Mt.Created&&e.finishToolCreation()}),f.tX))}},{key:"state",get:function(){return this.analysis.dimensions.some((function(e){return"length"===e.type}))?(0,p.pC)(this._activeSubTool)?Mt.Creating:Mt.Created:Mt.Ready}},{key:"updating",get:function(){return this._lengthDimensionSubTool.updating}},{key:"cursor",get:function(){return this.active?"crosshair":null}},{key:"getManipulatorsForDimension",value:function(e){return this._lengthDimensionSubTool.getManipulatorsForDimension(e)}},{key:"onInputEvent",value:function(e){switch(e.type){case"immediate-click":this._clickHandler(e);break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e)}}},{key:"onActivate",value:function(){this._activeSubTool=this._lengthDimensionSubTool}},{key:"onDeactivate",value:function(){(0,p.pC)(this._activeSubTool)&&(this._activeSubTool.onDeactivate(),(0,p.pC)(this._activeSubTool.stagedDimension)&&(this.analysis.dimensions.remove(this._activeSubTool.stagedDimension),this._activeSubTool.stagedDimension=null),this._activeSubTool=null)}},{key:"_clickHandler",value:function(e){if(!(0,p.Wi)(this._activeSubTool)){var t=this._intersectScreen(e);if(!(0,p.Wi)(t)){if((0,p.Wi)(this._activeSubTool.stagedDimension)){var n=this._activeSubTool.onUnstagedClick({mapPoint:t,pointerType:e.pointerType});this.analysis.dimensions.add(n)}else this._activeSubTool.onStagedClick({mapPoint:t,pointerType:e.pointerType});e.stopPropagation()}}}},{key:"_doubleClickHandler",value:function(e){this.view.activeTool=null,e.stopPropagation()}},{key:"_pointerMoveHandler",value:function(e){if(!(0,p.Wi)(this._activeSubTool)&&!this.hasFocusedManipulators){var t=this._intersectScreen(e);(0,p.Wi)(t)||this._activeSubTool.onPointerMove({mapPoint:t,pointerType:e.pointerType})}}},{key:"_intersectScreen",value:function(e){var t=(0,Dt.Sj)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector);var n=this._intersector.results.min,i=w.WM.get();return n.getIntersectionPoint(i)?this.view.renderCoordsHelper.fromRenderCoords(i,this.view.spatialReference):null}},{key:"_addDimension",value:function(e){this._lengthDimensionSubTool.addDimension(e,this.manipulators)}},{key:"_removeDimension",value:function(e){this._lengthDimensionSubTool.removeDimension(e,this.manipulators)}}]),n}(It.f);(0,c._)([(0,v.Cb)({constructOnly:!0})],Lt.prototype,"view",void 0),(0,c._)([(0,v.Cb)({constructOnly:!0})],Lt.prototype,"analysis",void 0),(0,c._)([(0,v.Cb)({readOnly:!0})],Lt.prototype,"state",null),(0,c._)([(0,v.Cb)({readOnly:!0})],Lt.prototype,"updating",null),(0,c._)([(0,v.Cb)({readOnly:!0})],Lt.prototype,"cursor",null),(0,c._)([(0,v.Cb)({readOnly:!0})],Lt.prototype,"preferManipulatorCursor",void 0),(0,c._)([(0,v.Cb)({constructOnly:!0})],Lt.prototype,"analysisViewData",void 0),(0,c._)([(0,v.Cb)()],Lt.prototype,"_activeSubTool",void 0),(0,c._)([(0,v.Cb)()],Lt.prototype,"_lengthDimensionSubTool",void 0),Lt=(0,c._)([(0,_.j)("esri.views.3d.analysis.Dimensioning.DimensioningTool")],Lt);var zt=n(47898),Gt=n(67077),At=n(14320),Wt=n(6291),Ft=n(61201),jt=n(33837),Nt=n(9052),qt=n(86700),Ut=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;(0,o.Z)(this,n),(i=t.call(this,e))._directSegment=new Nt.y$,i._dimensionSegment=new Nt.y$,i._offsetAxis=(0,W.c)(),i._startOffsetSegment=new Nt.y$(i._directSegment.startRenderSpace,i._dimensionSegment.startRenderSpace),i._endOffsetSegment=new Nt.y$(i._directSegment.endRenderSpace,i._dimensionSegment.endRenderSpace),i._labelSegment=new Nt.y$,i._hasValidGeometry=!1;var r={view:e.view,attached:!0,width:1,color:(0,Gt.f)(1,.5,0,1),renderOccluded:J.yD.OccludeAndTransparent},a=(0,Te.Z)((0,Te.Z)({},r),{},{stipplePattern:(0,qt.z5)(5)});return i._dimensionVisualElement=new jt.r(r),i._startOffsetVisualElement=new jt.r(a),i._endOffsetVisualElement=new jt.r(a),i._label=new Ft.Kc({view:e.view,attached:!0,distance:0,fontSize:z.labels.fontSize}),i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this;this.own([(0,m.ed)(this._dimensionVisualElement),(0,m.ed)(this._startOffsetVisualElement),(0,m.ed)(this._endOffsetVisualElement),(0,m.ed)(this._label)]);var t=this.computation,n=this.view,i=t.dimension;this.own([(0,f.YP)((function(){return{startPoint:i.startPoint,endPoint:i.endPoint,offset:i.offset,axis:i.axis,heading:i.heading}}),(function(t){e._updateGeometry(t),e._updateLines(),e._updateLabelGeometry(n.state.camera)}),f.nn),(0,f.YP)((function(){return t.length}),(function(t){return e._updateLabelContent(t)}),f.nn),(0,f.YP)((function(){return n.state.camera}),(function(t){return e._updateLabelGeometry(t)}),f.nn)])}},{key:"testInfo",get:function(){return{dimensionVisualElement:this._dimensionVisualElement,label:this._label}}},{key:"_updateGeometry",value:function(e){var t=e.startPoint,n=e.endPoint,i=e.offset,r=e.axis,a=this.view.renderCoordsHelper,o=this._directSegment;if(!(0,p.Wi)(t)&&!(0,p.Wi)(n)&&a.toRenderCoords(t,o.startRenderSpace)&&a.toRenderCoords(n,o.endRenderSpace)){var s=o.startRenderSpace,u=o.endRenderSpace,l=o.eval(.5,w.WM.get()),c=a.worldUpAtPosition(l,w.WM.get()),d=a.worldBasisAtPosition(l,At.R.X,w.WM.get()),h=this._offsetAxis;!function(e,t,n,i,r,a){switch(r){case"horizontal":return(0,A.c)(e,i);case"vertical":return(0,A.e)(t,i)<(0,A.e)(n,i)?(0,A.v)(e,n,t):(0,A.v)(e,t,n),(0,A.f)(e,e,i),(0,A.z)(e,W.Z)?(0,A.c)(e,a):((0,A.f)(e,e,i),(0,A.n)(e,e),e);case"direct":(0,A.e)(t,a)>(0,A.e)(n,a)?(0,A.v)(e,n,t):(0,A.v)(e,t,n),(0,A.f)(e,e,i),(0,A.z)(e,W.Z)?(0,A.c)(e,a):(0,A.n)(e,e)}}(h,s,u,c,r,d);var f=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=(0,A.e)(t,n),a=(0,A.e)(e,n),o=Math.abs(r-a)+i;return r>a?[o,i]:[i,o]}(s,u,h,i/a.unitInMeters),v=(0,Ye.Z)(f,2),y=v[0],_=v[1],g=this._dimensionSegment;(0,A.C)(g.startRenderSpace,o.startRenderSpace,h,y),(0,A.C)(g.endRenderSpace,o.endRenderSpace,h,_),this._hasValidGeometry=!0}else this._hasValidGeometry=!1}},{key:"_updateLines",value:function(){if(!this._hasValidGeometry)return this._dimensionVisualElement.visible=!1,this._startOffsetVisualElement.visible=!1,void(this._endOffsetVisualElement.visible=!1);this._dimensionVisualElement.setGeometryFromSegment(this._dimensionSegment),this._startOffsetVisualElement.setGeometryFromSegment(this._startOffsetSegment),this._endOffsetVisualElement.setGeometryFromSegment(this._endOffsetSegment),this._dimensionVisualElement.visible=!0,this._startOffsetVisualElement.visible=!0,this._endOffsetVisualElement.visible=!0}},{key:"_updateLabelContent",value:function(e){if((0,p.Wi)(e)||!this._hasValidGeometry)return this._label.text="",void(this._label.visible=!1);var t=(0,zt.nn)(e,"meters").value;this._label.text="".concat((0,Wt.uf)(t,{minimumFractionDigits:2,maximumFractionDigits:2})," m"),this._label.visible=!0}},{key:"_updateLabelGeometry",value:function(e){if(this._hasValidGeometry){var t=this.computation.dimension.offset,n=e.computeRenderPixelSizeAt(this._dimensionSegment.eval(.5,w.WM.get())),i=(Math.sign(t)>=0?1:-1)*z.labels.offset*n;(function(e,t,n,i){(0,A.C)(e.startRenderSpace,t.startRenderSpace,n,i),(0,A.C)(e.endRenderSpace,t.endRenderSpace,n,i)})(this._labelSegment,this._dimensionSegment,this._offsetAxis,i),this._label.geometry={type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1}}else this._label.visible=!1}}]),n}(d.Z);(0,c._)([(0,v.Cb)({constructOnly:!0,nonNullable:!0})],Ut.prototype,"computation",void 0),(0,c._)([(0,v.Cb)({constructOnly:!0,nonNullable:!0})],Ut.prototype,"view",void 0),Ut=(0,c._)([(0,_.j)("esri.views.3d.analysis.Dimensioning.LengthDimensionVisualization")],Ut);var Yt=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e))._dimensionVisualizations=new Map,i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e,t=this,n=(0,a.Z)(this.computations);try{for(n.s();!(e=n.n()).done;){var i=e.value;this._addComputation(i)}}catch(r){n.e(r)}finally{n.f()}this.own(this.computations.on("change",(function(e){var n,i=e.added,o=e.removed,s=(0,a.Z)(o);try{for(s.s();!(n=s.n()).done;){var u=n.value;t._removeComputation(u)}}catch(r){s.e(r)}finally{s.f()}var l,c=(0,a.Z)(i);try{for(c.s();!(l=c.n()).done;){var d=l.value;t._addComputation(d)}}catch(r){c.e(r)}finally{c.f()}})))}},{key:"destroy",value:function(){this._dimensionVisualizations.forEach((function(e){e.destroy()})),this._dimensionVisualizations.clear()}},{key:"testInfo",get:function(){return{visualizations:Array.from(this._dimensionVisualizations.values())}}},{key:"_addComputation",value:function(e){this._dimensionVisualizations.has(e)||this._dimensionVisualizations.set(e,new Ut({computation:e,view:this.view}))}},{key:"_removeComputation",value:function(e){var t=this._dimensionVisualizations.get(e);(0,p.Wi)(t)||(t.destroy(),this._dimensionVisualizations.delete(e))}}]),n}(d.Z);(0,c._)([(0,v.Cb)({constructOnly:!0,nonNullable:!0})],Yt.prototype,"view",void 0),(0,c._)([(0,v.Cb)({constructOnly:!0,nonNullable:!0})],Yt.prototype,"computations",void 0),Yt=(0,c._)([(0,_.j)("esri.views.3d.analysis.Dimensioning.DimensioningVisualization")],Yt);var Xt=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).dimension=null,i}return(0,s.Z)(n)}(d.Z);(0,c._)([(0,v.Cb)({constructOnly:!0,nonNullable:!0})],Xt.prototype,"dimension",void 0);var Bt=Xt=(0,c._)([(0,_.j)("esri.views.3d.analysis.LengthDimensionResult")],Xt),$t=n(4914),Qt=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){return(0,o.Z)(this,n),t.call(this,e)}return(0,s.Z)(n,[{key:"initialize",value:function(){this._set("result",new Bt({dimension:this.dimension}))}},{key:"length",get:function(){var e=this.dimension,t=e.startPoint,n=e.endPoint,i=e.axis;if((0,p.Wi)(t)||(0,p.Wi)(n))return null;var r=(0,$t.Uy)(t,n);return(0,p.Wi)(r)?null:r[i]}}]),n}(d.Z);(0,c._)([(0,v.Cb)({constructOnly:!0,nonNullable:!0})],Qt.prototype,"dimension",void 0),(0,c._)([(0,v.Cb)({constructOnly:!0,nonNullable:!0})],Qt.prototype,"result",void 0),(0,c._)([(0,v.Cb)()],Qt.prototype,"length",null),Qt=(0,c._)([(0,_.j)("esri.views.3d.analysis.LengthDimensionComputation")],Qt);var Kt=n(70209),Jt=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).type="dimensioning-view-3d",i.tool=null,i._computations=new h.Z,i._dimensionsToResults=new Map,i._placementTask=null,i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this;this.own([(0,Kt.Lp)(this,Lt),(0,f.on)((function(){return e.analysis.dimensions}),"change",(function(t){var n,i=t.added,r=t.removed,o=(0,a.Z)(r);try{for(o.s();!(n=o.n()).done;){var s=n.value;e._removeDimension(s)}}catch(d){o.e(d)}finally{o.f()}var u,l=(0,a.Z)(i);try{for(l.s();!(u=l.n()).done;){var c=u.value;e._addDimension(c)}}catch(d){l.e(d)}finally{l.f()}}),{onListenerAdd:function(t){var n,i=(0,a.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;e._addDimension(r)}}catch(o){i.e(o)}finally{i.f()}},onListenerRemove:function(t){var n,i=(0,a.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;e._removeDimension(r)}}catch(o){i.e(o)}finally{i.f()}}})]),this._analysisVisualization=new Yt({view:this.view,computations:this._computations})}},{key:"destroy",value:function(){this._placementTask=(0,p.IM)(this._placementTask),this._analysisVisualization=(0,p.SC)(this._analysisVisualization),this._computations.drain((function(e){return e.destroy()})),(0,Kt.Yq)(this)}},{key:"results",get:function(){var e=this;return this.analysis.dimensions.map((function(t){return e._dimensionsToResults.get(t)}))}},{key:"testInfo",get:function(){return{visualization:this._analysisVisualization}}},{key:"createLengthDimensions",value:function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this._placementTask=(0,p.IM)(this._placementTask),this._placementTask=(0,Kt.P9)(this,Lt,t),this._placementTask.promise));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_addDimension",value:function(e){var t=this._dimensionsToResults;if(!t.has(e)){var n=this._computations,i=new Qt({dimension:e});n.add(i),t.set(e,i.result)}}},{key:"_removeDimension",value:function(e){var t=this._computations,n=this._dimensionsToResults,i=t.findIndex((function(t){return t.dimension===e})),r=t.removeAt(i);n.delete(e),(0,p.SC)(r)}}]),n}((0,g.p)(d.Z));(0,c._)([(0,v.Cb)({readOnly:!0})],Jt.prototype,"type",void 0),(0,c._)([(0,v.Cb)({constructOnly:!0,nonNullable:!0})],Jt.prototype,"analysis",void 0),(0,c._)([(0,v.Cb)()],Jt.prototype,"tool",void 0),(0,c._)([(0,v.Cb)({readOnly:!0})],Jt.prototype,"results",null),(0,c._)([(0,v.Cb)()],Jt.prototype,"_analysisVisualization",void 0),(0,c._)([(0,v.Cb)()],Jt.prototype,"_computations",void 0),(0,c._)([(0,v.Cb)()],Jt.prototype,"_dimensionsToResults",void 0),(0,c._)([(0,v.Cb)()],Jt.prototype,"_placementTask",void 0);var en=Jt=(0,c._)([(0,_.j)("esri.views.3d.analysis.DimensioningAnalysisView3D")],Jt)},51328:function(e,t,n){n.d(t,{J4:function(){return _},_N:function(){return v},gv:function(){return g}});var i,r=n(1413),a=n(92026),o=n(17842),s=(n(11186),n(71353)),u=(n(79803),n(55652)),l=n(40885),c=(n(40927),n(51378)),d=(n(74509),n(81703)),h=n(88153),p=n(54463),f=n(76783);n(5693);function v(e,t){return y(e,(function(){return t}))}function y(e,t){var n=(0,s.c)(),i=(0,s.c)(),l=!1;return function(s){var h=t(s);if("start"===s.action){var p=(0,o.md)(s.screenStart,(0,o.c$)(c.qW.get())),f=(0,d.u4)(e.state.camera,p,m);(0,a.pC)(f)&&(l=(0,u.BR)(h,f,n))}if(!l)return null;var v=(0,o.md)(s.screenEnd,(0,o.c$)(c.qW.get())),y=(0,d.u4)(e.state.camera,v,m);return(0,a.Wi)(y)?null:(0,u.BR)(h,y,i)?(0,r.Z)((0,r.Z)({},s),{},{renderStart:n,renderEnd:i,plane:h,ray:y}):null}}function _(e){var t=null;return function(n){switch(n.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":(0,a.pC)(t)&&(t.remove(),t=null)}return n}}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=(0,h.Z8)(e.state.viewingMode);n.options.selectionMode=!0,n.options.store=p.eC.MIN,n.options.hud=!1;var u,l=(0,o.s1)(),c={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},d=(0,s.c)(),v=(0,a.Pt)(t,e.spatialReference),y=function(t){e.map.ground&&e.map.ground.opacity<1?c.exclude.add(f.cy):c.exclude.delete(f.cy),e.sceneIntersectionHelper.intersectIntersectorScreen((0,o.md)(t,l),n,c);var r,a=n.results.min;if(a.getIntersectionPoint(d))r=a.intersector===p.q7.TERRAIN?i.GROUND:i.OTHER;else{if(!n.results.ground.getIntersectionPoint(d))return null;r=i.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(d,v),surfaceType:r}};return function(e){if("start"===e.action){var t=y(e.screenStart);u=(0,a.pC)(t)?t.location:null}if((0,a.Wi)(u))return null;var n=y(e.screenEnd);return(0,a.pC)(n)&&(0,a.pC)(n.location)?(0,r.Z)((0,r.Z)({},e),{},{mapStart:u,mapEnd:n.location,surfaceType:n.surfaceType}):null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(i||(i={}));(0,s.c)(),(0,s.c)();var m=(0,l.Ue)()},98917:function(e,t,n){n.d(t,{R:function(){return b}});var i=n(93433),r=n(15671),a=n(43144),o=n(60136),s=n(29388),u=n(100),l=n(92026),c=n(94172),d=n(14226),h=n(81949),p=n(11186),f=n(71353),v=n(90045),y=n(151),_=n(51378),g=n(52168),m=n(81782),w=n(70619),k=n(56529),Z=n(4760),S=n(66832),C=n(58901),b=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e))._handles=new u.Z,i._quadMaterial=null,i._outlineMaterial=null,i._maxSize=0,i._position=(0,f.c)(),i._up=(0,f.c)(),i._right=(0,f.c)(),i._renderOccluded=k.yD.OccludeAndTransparent,i._color=(0,y.f)(1,0,0,1),i._outlineColor=(0,y.f)(0,0,0,1),i._outlineSize=0,i._size=32,i._outlineRenderOccluded=k.yD.Opaque,i.applyProps(e),i}return(0,a.Z)(n,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}},{key:"color",get:function(){return this._color},set:function(e){(0,v.c)(this._color,e),this._updateQuadMaterial()}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){(0,v.c)(this._outlineColor,e),this._updateOutlineMaterial()}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){var t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this._updateTransform())}},{key:"outlineRenderOccluded",get:function(){return this._outlineRenderOccluded},set:function(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}},{key:"geometry",set:function(e){var t=e.previous,n=e.center,i=e.next;this._maxSize=Math.min((0,p.i)(n,t),(0,p.i)(n,i))/3,(0,p.n)(this._up,(0,p.b)(this._up,t,n)),(0,p.n)(this._right,(0,p.b)(this._right,i,n)),(0,p.c)(this._position,n),this.recreateGeometry()}},{key:"createExternalResources",value:function(){var e=this;this._quadMaterial=new S.E(this.quadMaterialParameters),this._outlineMaterial=new C.U(this.outlineMaterialParameters),this._handles.add((0,c.YP)((function(){return e.view.state.camera}),(function(){return e._updateTransform()})))}},{key:"destroyExternalResources",value:function(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}},{key:"forEachExternalMaterial",value:function(e){e(this._quadMaterial),e(this._outlineMaterial)}},{key:"createGeometries",value:function(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}},{key:"_createQuadGeometry",value:function(e){var t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}},{key:"_createOutlineGeometry",value:function(e){if(0!==this._outlineSize){var t=(0,p.a)(_.WM.get(),this._up,this._right),n=w.Z.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(n,this._outlineMaterial)}}},{key:"_updateTransform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object,t=this.view.state.camera,n=this._size*t.computeScreenPixelSizeAt(this._position),i=Math.min(this._maxSize,n);(0,d.f)(x,this._position),(0,d.h)(x,x,[i,i,i]),(0,l.pC)(e)&&(e.transformation=x)}},{key:"_quadGeometryData",value:function(e,t){var n=(0,p.a)(_.WM.get(),e,t);return new m.Z([[Z.T.POSITION,{size:3,data:[0,0,0].concat((0,i.Z)(t),(0,i.Z)(e),(0,i.Z)(n)),exclusive:!0}]],[[Z.T.POSITION,new Uint16Array([0,1,2,1,2,3])]])}},{key:"quadMaterialParameters",get:function(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}},{key:"_updateQuadMaterial",value:function(){this._quadMaterial&&this._quadMaterial.setParameters(this.quadMaterialParameters)}},{key:"outlineMaterialParameters",get:function(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}},{key:"_updateOutlineMaterial",value:function(){this._outlineMaterial&&this._outlineMaterial.setParameters(this.outlineMaterialParameters)}}]),n}(g._),x=(0,h.c)()},95122:function(e,t,n){n.d(t,{Bq:function(){return w},Hk:function(){return y},UL:function(){return k},ku:function(){return m},yG:function(){return g}});var i=n(11752),r=n(61120),a=n(93433),o=n(60136),s=n(29388),u=n(43144),l=n(15671),c=n(88396),d=n(6394),h=n(76014),p=n(64674),f=n(94163),v=(0,u.Z)((function e(t){(0,l.Z)(this,e),this.coordinateHelper=t})),y=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,i){var r;return(0,l.Z)(this,n),(r=t.call(this,e)).point=i,r}return(0,u.Z)(n,[{key:"objectEqual",value:function(e){return e instanceof n&&(0,p.Xv)(this.point,e.point)}},{key:"check",value:function(e){return(0,c.s)(e,this.point)<h.c.pointThreshold}},{key:"closestTo",value:function(){return this.coordinateHelper.clone(this.point)}},{key:"intersect",value:function(e){var t=this,n=[];return e instanceof _?n.push.apply(n,(0,a.Z)((0,f.pk)({start:e.start,end:e.end,type:e instanceof m?f.SP.LINE:f.SP.RAY},this.point))):e instanceof k&&n.push.apply(n,(0,a.Z)((0,f.l0)(e.center,e.radius,this.point))),n.map((function(n){return new w(t.coordinateHelper,n,t,e)}))}}]),n}(v),_=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,i,r){var a;return(0,l.Z)(this,n),(a=t.call(this,e)).start=i,a.end=r,a}return(0,u.Z)(n,[{key:"objectEqual",value:function(e){return e instanceof n&&(0,p.Xv)(this.start,e.start)&&(0,p.Xv)(this.end,e.end)}},{key:"intersect",value:function(e){var t=this,i=[];return e instanceof y?i.push.apply(i,(0,a.Z)((0,f.pk)({start:this.start,end:this.end,type:this instanceof m?f.SP.LINE:f.SP.RAY},e.point))):e instanceof n?i.push.apply(i,(0,a.Z)((0,f.dU)({start:this.start,end:this.end,type:this instanceof m?f.SP.LINE:f.SP.RAY},{start:e.start,end:e.end,type:e instanceof m?f.SP.LINE:f.SP.RAY}))):e instanceof k&&i.push.apply(i,(0,a.Z)((0,f.UG)({start:this.start,end:this.end,type:this instanceof m?f.SP.LINE:f.SP.RAY},e.center,e.radius))),i.map((function(n){return new w(t.coordinateHelper,n,t,e)}))}}]),n}(v),g=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,i,r){var a;return(0,l.Z)(this,n),(a=t.call(this,e,i,r)).dir=(0,d.a)(),a.p=(0,d.a)(),a}return(0,u.Z)(n,[{key:"objectEqual",value:function(e){return e instanceof n&&(0,i.Z)((0,r.Z)(n.prototype),"objectEqual",this).call(this,e)}},{key:"check",value:function(e){return(0,c.g)(this.dir,this.end,this.start),(0,c.g)(this.p,e,this.start),(0,c.h)(this.dir,this.p)>=0&&(0,f.Oy)(e,this.start,this.end)<h.c.pointOnLineThreshold}},{key:"closestTo",value:function(e){var t=this.coordinateHelper.clone(e);return(0,f.aW)(t,e,this.start,this.end),t}}]),n}(_),m=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,i,r){return(0,l.Z)(this,n),t.call(this,e,i,r)}return(0,u.Z)(n,[{key:"objectEqual",value:function(e){return e instanceof n&&(0,i.Z)((0,r.Z)(n.prototype),"objectEqual",this).call(this,e)}},{key:"check",value:function(e){return(0,f.Oy)(e,this.start,this.end)<h.c.pointOnLineThreshold}},{key:"closestTo",value:function(e){var t=this.coordinateHelper.clone(e);return(0,f.k0)(t,e,this.start,this.end),t}}]),n}(_),w=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,i,r,a){var o;return(0,l.Z)(this,n),(o=t.call(this,e)).intersection=i,o.first=r,o.second=a,o}return(0,u.Z)(n,[{key:"objectEqual",value:function(e){return e instanceof n&&this.first.objectEqual(e.first)&&this.second.objectEqual(e.second)}},{key:"check",value:function(){return!1}},{key:"closestTo",value:function(e){var t=this.coordinateHelper.clone(e);return(0,c.c)(t,this.intersection),t}},{key:"intersect",value:function(){return[]}}]),n}(v),k=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,i,r){var a;return(0,l.Z)(this,n),(a=t.call(this,e)).center=i,a.radius=r,a}return(0,u.Z)(n,[{key:"objectEqual",value:function(e){return e instanceof n&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}},{key:"check",value:function(){return!1}},{key:"closestTo",value:function(e){var t=this.coordinateHelper.clone(e);return(0,f.xO)(t,e,this.center,this.radius),t}},{key:"intersect",value:function(e){var t=this,n=[];return e instanceof _?n.push.apply(n,(0,a.Z)((0,f.UG)({start:e.start,end:e.end,type:e instanceof m?f.SP.LINE:f.SP.RAY},this.center,this.radius))):e instanceof y&&n.push.apply(n,(0,a.Z)((0,f.l0)(this.center,this.radius,e.point))),n.map((function(n){return new w(t.coordinateHelper,n,t,e)}))}}]),n}(v)},95905:function(e,t,n){n.d(t,{L:function(){return h}});var i=n(1413),r=n(15671),a=n(43144),o=n(60136),s=n(29388),u=n(95122),l=n(64674),c=n(75691),d=n(53397),h=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){return(0,r.Z)(this,n),t.call(this,(0,i.Z)((0,i.Z)({},e),{},{constraint:new u.ku(e.coordinateHelper,e.edgeStart,e.edgeEnd)}))}return(0,a.Z)(n,[{key:"hints",get:function(){return[new d.w(l.ze.REFERENCE,this.constraint.start,this.constraint.end,this.elevationInfo)]}}]),n}(c.a)},75691:function(e,t,n){n.d(t,{a:function(){return s}});var i=n(43144),r=n(15671),a=n(60136),o=n(29388),s=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i,a=e.coordinateHelper,o=e.targetPoint,s=e.objectId,u=e.constraint,l=e.elevationInfo;return(0,r.Z)(this,n),(i=t.call(this,a,o,u,l)).objectId=s,i}return(0,i.Z)(n)}(n(92605).j)},92605:function(e,t,n){n.d(t,{j:function(){return a}});var i=n(43144),r=n(15671),a=(0,i.Z)((function e(t,n,i,a){(0,r.Z)(this,e),this.coordinateHelper=t,this.targetPoint=n,this.constraint=i,this.elevationInfo=a}))},36700:function(e,t,n){n.d(t,{x:function(){return d}});var i=n(1413),r=n(15671),a=n(43144),o=n(60136),s=n(29388),u=n(95122),l=n(75691),c=n(61309),d=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){return(0,r.Z)(this,n),t.call(this,(0,i.Z)((0,i.Z)({},e),{},{constraint:new u.Hk(e.coordinateHelper,e.targetPoint)}))}return(0,a.Z)(n,[{key:"hints",get:function(){return[new c.n(this.targetPoint,this.elevationInfo)]}}]),n}(l.a)}}]);
//# sourceMappingURL=8916.eb3c9f2d.chunk.js.map