"use strict";(self.webpackChunkuums_front_end=self.webpackChunkuums_front_end||[]).push([[3952],{53952:function(e,t,r){r.d(t,{Z:function(){return H}});var i=r(1413),n=r(37762),u=r(74165),o=r(15861),a=r(15671),s=r(43144),l=r(11752),c=r(61120),y=r(60136),d=r(29388),h=r(27366),p=r(10064),f=r(92026),v=r(94172),m=r(49861),g=(r(63780),r(93169),r(25243),r(69912)),b=r(37818),Z=r(5845),C=r(43682),_=r(42069),F=r(32080),k=r(85015),w=r(66978),x=r(65618),q=r(5192),O=r(52639),M=r(46798),R=r(78952),S=r(83040),V=function(){function e(t){(0,a.Z)(this,e),this._schedule=t,this._handle=new D(t)}return(0,s.Z)(e,[{key:"destroy",value:function(){this._handle.destroy()}},{key:"invoke",value:function(e,t){var r=this;return e.buffer&&0!==e.buffer.byteLength?(e.options.sourceSpatialReference&&e.options.sourceSpatialReference instanceof R.Z&&(e.options=(0,i.Z)((0,i.Z)({},e.options),{},{sourceSpatialReference:e.options.sourceSpatialReference.toJSON()})),this._handle.invoke(e,t).then((function(e){return r._schedule((function(){if(e.spatialReference=R.Z.fromJSON(e.spatialReference),e.fields)for(var t=0;t<e.fields.length;t++)e.fields[t]=S.Z.fromJSON(e.fields[t]);var r,i=e.spatialReference,u=(0,n.Z)(e.features);try{for(u.s();!(r=u.n()).done;){var o=r.value;o.uid=O.Z.generateUID(),(0,f.pC)(o.geometry)&&(o.geometry.spatialReference=i)}}catch(a){u.e(a)}finally{u.f()}return e}))}))):Promise.resolve(null)}}]),e}(),D=function(e){(0,y.Z)(r,e);var t=(0,d.Z)(r);function r(e){return(0,a.Z)(this,r),t.call(this,"PBFDecoderWorker","_parseFeatureQuery",{_parseFeatureQuery:function(e){return[e.buffer]}},e)}return(0,s.Z)(r)}(M.q),T=function(e){(0,y.Z)(r,e);var t=(0,d.Z)(r);function r(e){return(0,a.Z)(this,r),t.call(this,e)}return(0,s.Z)(r,[{key:"queryFeaturesDehydrated",get:function(){var e=this,t=this.layer.capabilities,r=t&&t.query;if(r&&r.supportsFormatPBF){var i,n;(0,f.Wi)(this._decoder)&&(this._decoder=new V(this.schedule));var u={sourceSpatialReference:null!==(i=null===(n=this.layer.spatialReference)||void 0===n?void 0:n.toJSON())&&void 0!==i?i:null,applyTransform:!0,maxStringAttributeLength:1024};return function(t,r){return(0,q.runQuery)(e.layer.parsedUrl,t,"pbf",e._createRequestOptions(r)).then((function(t){return(0,w.k_)(r),(0,f.pC)(e._decoder)?e._decoder.invoke({buffer:t.data,options:u},r.signal):Promise.reject((0,w.zE)())}))}}return function(t,r){return(0,q.executeQuery)(e.layer.parsedUrl,t,e.layer.spatialReference,e._createRequestOptions(r)).then((function(e){return(0,x.PA)(e.data)}))}}},{key:"queryFeatureCount",value:function(e,t){return this.layer.queryFeatureCount(e,t)}},{key:"destroy",value:function(){this._decoder=(0,f.SC)(this._decoder)}},{key:"_createRequestOptions",value:function(e){return(0,i.Z)((0,i.Z)({},e),{},{query:(0,i.Z)((0,i.Z)({},this.layer.customParameters),{},{token:this.layer.apiKey},null===e||void 0===e?void 0:e.query)})}}]),r}(k.Z);(0,h._)([(0,m.Cb)({constructOnly:!0})],T.prototype,"layer",void 0),(0,h._)([(0,m.Cb)({constructOnly:!0})],T.prototype,"schedule",void 0),(0,h._)([(0,m.Cb)({readOnly:!0})],T.prototype,"queryFeaturesDehydrated",null),T=(0,h._)([(0,g.j)("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],T);var P=function(e){(0,y.Z)(r,e);var t=(0,d.Z)(r);function r(e){return(0,a.Z)(this,r),t.call(this,e)}return(0,s.Z)(r,[{key:"queryFeaturesDehydrated",value:function(e,t){return this.layer.queryFeatures(e,t)}},{key:"queryFeatureCount",value:function(e,t){return this.layer.queryFeatureCount(e,t)}}]),r}(k.Z);(0,h._)([(0,m.Cb)({constructOnly:!0})],P.prototype,"layer",void 0),(0,h._)([(0,m.Cb)({readOnly:!0})],P.prototype,"queryFeaturesDehydrated",null),P=(0,h._)([(0,g.j)("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D")],P);var N=function(e){(0,y.Z)(r,e);var t=(0,d.Z)(r);function r(e){return(0,a.Z)(this,r),t.call(this,e)}return(0,s.Z)(r,[{key:"queryFeaturesDehydrated",value:function(e,t){return this.layer.queryFeatures(e,t)}}]),r}(k.Z);(0,h._)([(0,m.Cb)({constructOnly:!0})],N.prototype,"layer",void 0),N=(0,h._)([(0,g.j)("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],N);var Q=function(e){(0,y.Z)(r,e);var t=(0,d.Z)(r);function r(e){return(0,a.Z)(this,r),t.call(this,e)}return(0,s.Z)(r,[{key:"queryFeaturesDehydrated",value:function(e,t){var r=this;return this.source.queryFeaturesJSON(e,t).then(x.PA,(function(i){if(i&&"query-features-json:unsupported"===i.name)return r.layer.queryFeatures(e,t);throw i}))}},{key:"queryFeatureCount",value:function(e,t){return this.layer.queryFeatureCount(e,t)}}]),r}(k.Z);(0,h._)([(0,m.Cb)({constructOnly:!0})],Q.prototype,"layer",void 0),(0,h._)([(0,m.Cb)({constructOnly:!0})],Q.prototype,"source",void 0),Q=(0,h._)([(0,g.j)("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],Q);var j=function(){function e(t){(0,a.Z)(this,e),this._memoryCache=null,this._capabilities=null;var r=t.layerView.layer;this.layerView=t.layerView,this.objectIdField=r.objectIdField,this.globalIdField="globalIdField"in r?r.globalIdField:null,this.returnZ=t.returnZ,this.returnM=t.returnM;var i=this.layerView.view.resourceController;this.query=function(e,t){return"feature"===e.type&&"feature-layer"===e.source.type?(0,f.pC)(e.infoFor3D)?new P({layer:e}):new T({layer:e,schedule:t}):"feature"===e.type&&"memory"===e.source.type||"csv"===e.type||"geojson"===e.type||"wfs"===e.type?new Q({layer:e,source:e.source}):"ogc-feature"===e.type?new N({layer:e}):null}(r,(function(e){return i.schedule(e)})),i&&this.memoryCacheEnabled&&(this._memoryCache=i.memoryController.newCache(r.uid))}return(0,s.Z)(e,[{key:"memoryCacheEnabled",get:function(){switch(this.layerView.layer.source.type){case"feature-layer":case"ogc-feature":return!0;case"csv":case"geojson":case"memory":case"wfs":return!1}}},{key:"destroy",value:function(){this._memoryCache=(0,f.SC)(this._memoryCache),this.query.destroy()}},{key:"createQuery",value:function(){var e=this.layerView.layer.createQuery();return e.outFields=this.layerView.availableFields,e.returnZ=this.returnZ,e.returnM=this.returnM,e.outSpatialReference=this.tilingScheme.spatialReference,e}},{key:"memoryCache",get:function(){return this._memoryCache}},{key:"viewingMode",get:function(){return this.layerView.view.state.viewingMode}},{key:"tilingScheme",get:function(){return this.layerView.view.featureTiles.tilingScheme}},{key:"scheduler",get:function(){var e=this.layerView.view.resourceController;return e?e.scheduler:null}},{key:"geometryType",get:function(){return this.layerView.layer.geometryType}},{key:"fullExtent",get:function(){return this.layerView.layer.fullExtent}},{key:"tileMaxRecordCount",get:function(){return this.layerView.layer.capabilities.query.tileMaxRecordCount}},{key:"maxRecordCount",get:function(){return this.layerView.layer.capabilities.query.maxRecordCount}},{key:"capabilities",get:function(){return(0,f.pC)(this._capabilities)||(this._capabilities=(0,F.A)(this.layerView.layer)),this._capabilities}},{key:"logFetchError",value:function(e,t){e.error("#fetchTile()",this.layerView.layer,t&&t.message?t.message:t)}}]),e}(),E=r(5198),A=r(58890),I=r(68401),L=r(74937),U=r(67581),Y=function(e){(0,y.Z)(r,e);var t=(0,d.Z)(r);function r(e){var i;return(0,a.Z)(this,r),(i=t.call(this,e))._controllerTotal=0,i._processorTotal=0,i.suspendResumeExtentMode="data",i}return(0,s.Z)(r,[{key:"initialize",value:function(){var e=this;this.updatingHandles.add((function(){return e.view.floors}),(function(){return(0,f.pC)(e.processor.filterVisibility)&&e.processor.filterVisibility.filterChanged()})),this.handles.add((0,v.YP)((function(){return e._updatingRequiredFieldsPromise}),(function(t){return e.updatingHandles.addPromise(t)}),v.tX))}},{key:"destroy",value:function(){this.updatingHandles.removeAll(),this.handles.removeAll(),this.fetcherContext=(0,f.SC)(this.fetcherContext)}},{key:"maximumNumberOfFeatures",get:function(){var e,t;return null!==(e=null===(t=this.controller)||void 0===t?void 0:t.maximumNumberOfFeatures)&&void 0!==e?e:this._get("maximumNumberOfFeatures")},set:function(e){this._set("maximumNumberOfFeatures",e),this.controller&&(this.controller.maximumNumberOfFeatures=e)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!!this.controller&&!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded)}},{key:"updatingProgressValue",get:function(){var e,t,r=0;if(null!==(e=this.controller)&&void 0!==e&&e.updating){var i=this.controller.updatingRemaining,n=Math.max(this.controller.updatingTotal,this._controllerTotal);n>0&&(r=(n-i)/n,this._controllerTotal=n)}var u=0;if(null!==(t=this.processor)&&void 0!==t&&t.updating){var o=this.processor.updatingRemaining,a=Math.max(o,this._processorTotal);a>0&&(u=(a-o)/a,this._processorTotal=a)}return.5*(r+u)}},{key:"updatePolicy",get:function(){if(!this.controller)return I.jq.ASYNC;switch(this.controller.mode){case"snapshot":var e=B[this.layer.geometryType];return null==e||this.controller.serviceDataCount>e?I.jq.ASYNC:I.jq.SYNC;case"tiles":return I.jq.ASYNC}}},{key:"hasZ",get:function(){var e=this.layer,t=e.capabilities&&e.capabilities.data;return!(!t||!t.supportsZ)&&("returnZ"in e&&null!=e.returnZ?e.returnZ:t.supportsZ)}},{key:"hasM",get:function(){var e=this.layer,t=e.capabilities&&e.capabilities.data;return!(!t||!t.supportsM)&&"returnM"in e&&null!=e.returnM&&e.returnM}},{key:"setVisibility",value:function(e,t){var r;null===(r=this.processor)||void 0===r||r.setObjectIdVisibility(e,t)}},{key:"createQuery",value:function(){return(0,l.Z)((0,c.Z)(r.prototype),"createQuery",this).call(this)}},{key:"queryFeatures",value:function(e,t){var i=this,n=function(){return(0,l.Z)((0,c.Z)(r.prototype),"queryFeatures",i).call(i,e,t)};return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(e),n):n()}},{key:"beforeSetController",value:function(e){e.maximumNumberOfFeatures=this.maximumNumberOfFeatures}},{key:"createController",value:function(){var e=this;this.fetcherContext=new j({layerView:this,returnZ:this.hasZ,returnM:this.hasM});var t=new Z.g({layerView:this,context:this.fetcherContext,graphics:new E.g,extent:this.clippingExtent});return this.updatingHandles.add((function(){return t.serviceDataExtent}),(function(t){e.processor&&(e.processor.dataExtent=t)}),v.nn),this.handles.add((0,v.YP)((function(){return e.suspended}),(function(e){e?t.suspend():t.resume()}),v.tX)),this.updatingHandles.add((function(){var t;return null===(t=e.processor)||void 0===t?void 0:t.displayFeatureLimit}),(function(e){return t.displayFeatureLimit=e}),v.nn),this.handles.add((0,v.gx)((function(){return!e.updating}),(function(){e._controllerTotal=0,e._processorTotal=0}))),t}},{key:"doRefresh",value:function(){var e=(0,o.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&!this.suspended&&this.controller&&this.controller.refetch(),(0,f.pC)(this.processor.filterVisibility)&&(this.processor.filterVisibility.dirty=!0);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUsedMemory",value:function(){var e,t,r,i;return(null!==(e=null===(t=this.processor)||void 0===t?void 0:t.usedMemory)&&void 0!==e?e:0)+(null!==(r=null===(i=this.controller)||void 0===i?void 0:i.memoryForUnusedFeatures)&&void 0!==r?r:0)}},{key:"getUnloadedMemory",value:function(){var e,t,r,i,n;return(null!==(e=null===(t=this.processor)||void 0===t?void 0:t.unprocessedMemoryEstimate)&&void 0!==e?e:0)+(null!==(r=(null===(i=this.controller)||void 0===i?void 0:i.expectedFeatureDiff)*(null===(n=this.processor)||void 0===n?void 0:n.usedMemoryPerFeature))&&void 0!==r?r:0)}},{key:"ignoresMemoryFactor",value:function(){var e;return null===(e=this.controller)||void 0===e?void 0:e.hasMaximumNumberOfFeaturesOverride}},{key:"_queryFeaturesMesh",value:function(){var e=(0,o.Z)((0,u.Z)().mark((function e(t,r){var i,o,a,s,l,c,y,d;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._validateQueryFeaturesMesh(t);case 2:return e.next=4,r();case 4:if(i=e.sent,!(t&&t.outStatistics||(0,f.Wi)(this.graphics3DProcessor))){e.next=7;break}return e.abrupt("return",i);case 7:o=this.layer.objectIdField,a=this.graphics3DProcessor.graphics3DGraphicsByObjectID,s=[],l=(0,n.Z)(i.features);try{for(l.s();!(c=l.n()).done;)(y=c.value).geometry?(d=a.get(y.attributes[o]))&&(y.geometry=(0,b.kB)(d.graphic.geometry),s.push(y)):s.push(y)}catch(u){l.e(u)}finally{l.f()}return e.abrupt("return",(i.features=s,i));case 11:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_validateQueryFeaturesMesh",value:function(){var e=(0,o.Z)((0,u.Z)().mark((function e(t){var r,i,n,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:for(r=function(e){throw new p.Z("feature-layer-view:unsupported-query","Queries on Mesh feature collection layers do not support '".concat(e,"'"))},i=0,n=["quantizationParameters","geometryPrecision","maxAllowableOffset"];i<n.length;i++)null!=t[o=n[i]]&&r(o);"returnM"in t&&t.returnM&&r("returnM"),"returnCentroid"in t&&t.returnCentroid&&r("returnCentroid"),(0,f.pC)(t.outSpatialReference)&&!t.outSpatialReference.equals(this.view.spatialReference)&&r("outSpatialReference");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"performanceInfo",get:function(){var e,t,r,n,u,o=null===(e=this.controller)||void 0===e?void 0:e.displayFeatureLimit,a=(0,f.pC)(o)&&o.averageSymbolComplexity,s=(0,f.pC)(a)?"f:".concat(a.primitivesPerFeature,",v:").concat(a.primitivesPerCoordinate):"n/a",l=(0,i.Z)((0,i.Z)({},this._getResourceInfo()),{},{storedFeatures:0,totalVertices:0,partial:this.maximumNumberOfFeaturesExceeded,mode:null!==(t=null===(r=this.controller)||void 0===r?void 0:r.mode)&&void 0!==t?t:"n/a",symbolComplexity:s,nodes:null!==(n=null===(u=this.controller)||void 0===u?void 0:u.tileDescriptors.length)&&void 0!==n?n:0});if(this.controller&&l.displayedNumberOfFeatures){var c=this.controller.debug;l.storedFeatures=c.storedFeatures,l.totalVertices=c.totalVertices}return l}},{key:"test",get:function(){var e;return{updatePolicy:this.updatePolicy,controller:this.controller,loadedGraphics:null===(e=this.controller)||void 0===e?void 0:e.graphics}}}]),r}((0,r(13107).Z)((0,C.R)((0,L.Z)((0,_.A)(U.Z)))));(0,h._)([(0,m.Cb)()],Y.prototype,"layer",void 0),(0,h._)([(0,m.Cb)()],Y.prototype,"controller",void 0),(0,h._)([(0,m.Cb)()],Y.prototype,"_controllerTotal",void 0),(0,h._)([(0,m.Cb)()],Y.prototype,"_processorTotal",void 0),(0,h._)([(0,m.Cb)()],Y.prototype,"maximumNumberOfFeatures",null),(0,h._)([(0,m.Cb)()],Y.prototype,"maximumNumberOfFeaturesExceeded",null),(0,h._)([(0,m.Cb)(A.q)],Y.prototype,"updatingProgress",void 0),(0,h._)([(0,m.Cb)({readOnly:!0})],Y.prototype,"updatingProgressValue",null),(0,h._)([(0,m.Cb)({readOnly:!0})],Y.prototype,"updatePolicy",null),(0,h._)([(0,m.Cb)({readOnly:!0})],Y.prototype,"hasZ",null),(0,h._)([(0,m.Cb)({readOnly:!0})],Y.prototype,"hasM",null),(0,h._)([(0,m.Cb)()],Y.prototype,"suspendResumeExtentMode",void 0),Y=(0,h._)([(0,g.j)("esri.views.3d.layers.FeatureLayerViewBase3D")],Y);var B={point:5e3,polygon:500,polyline:1e3},H=Y}}]);
//# sourceMappingURL=3952.b03b9c16.chunk.js.map