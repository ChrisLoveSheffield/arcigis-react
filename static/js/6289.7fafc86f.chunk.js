"use strict";(self.webpackChunkuums_front_end=self.webpackChunkuums_front_end||[]).push([[6289],{76289:function(e,t,r){r.d(t,{Z:function(){return ne}});var n=r(1413),a=r(93433),i=r(74165),o=r(15861),u=r(15671),s=r(43144),l=r(11752),p=r(61120),c=r(60136),f=r(29388),y=r(27366),d=r(10064),m=r(93169),v=r(92026),h=r(66978),b=r(49861),x=(r(63780),r(25243)),w=r(69912),g=r(53866),Z=r(82582),_=r(45948),k=r(44041),C=r(87072),I=r(96669),P=r(37762),E=r(76200),N=r(50689),j=r(23084),F=r(76672),O=r(77981),S=r(58132),R=function(e){return e.spatialReference.wkid||JSON.stringify(e.spatialReference)};function V(e,t){var r=e.toJSON(),n=r.dpi,a=r.gdbVersion,i=r.geometry,o=r.geometryPrecision,u=r.height,s=r.layerOption,l=r.mapExtent,p=r.maxAllowableOffset,c=r.returnFieldName,f=r.returnGeometry,y=r.returnUnformattedValues,d=r.returnZ,m=r.spatialReference,h=r.timeExtent,b=r.tolerance,x=r.width,w=A(e),g=w.dynamicLayers,Z=w.layerDefs,_=w.layerIds,k=t&&(0,v.pC)(t.geometry)?t.geometry:null,C={geometryPrecision:o,maxAllowableOffset:p,returnFieldName:c,returnGeometry:f,returnUnformattedValues:y,returnZ:d,tolerance:b},I=k&&k.toJSON()||i;if(C.imageDisplay="".concat(x,",").concat(u,",").concat(n),a&&(C.gdbVersion=a),I&&(delete I.spatialReference,C.geometry=JSON.stringify(I),C.geometryType=(0,O.Ji)(I)),m?C.sr=m.wkid||JSON.stringify(m):I&&I.spatialReference?C.sr=R(I):l&&l.spatialReference&&(C.sr=R(l)),C.time=h?[h.start,h.end].join(","):null,l){var P=l.xmin,E=l.ymin,N=l.xmax,j=l.ymax;C.mapExtent="".concat(P,",").concat(E,",").concat(N,",").concat(j)}return Z&&(C.layerDefs=Z),g&&!Z&&(C.dynamicLayers=g),C.layers="popup"===s?"visible":s,_&&!g&&(C.layers+=":".concat(_.join(","))),C}function A(e){var t,r,n=e.mapExtent,a=e.floors,i=e.width,o=e.sublayers,u=e.layerIds,s=e.layerOption,l=e.gdbVersion,p=null===o||void 0===o||null===(t=o.find((function(e){return null!=e.layer})))||void 0===t||null===(r=t.layer)||void 0===r?void 0:r.serviceSublayers,c="popup"===s,f={},y=(0,Z.yZ)({extent:n,width:i,spatialReference:null===n||void 0===n?void 0:n.spatialReference}),d=[];if(null!==o&&void 0!==o&&o.forEach((function e(t){var r=0===y,n=0===t.minScale||y<=t.minScale,a=0===t.maxScale||y>=t.maxScale;if(t.visible&&(r||n&&a))if(t.sublayers)t.sublayers.forEach(e);else{if(!1===(null===u||void 0===u?void 0:u.includes(t.id))||c&&(!t.popupTemplate||!t.popupEnabled))return;d.unshift(t)}})),o&&!d.length)f.layerIds=[];else{var m=(0,S.FN)(d,p,l),h=d.map((function(e){var t=(0,C.f)(a,e);return e.toExportImageJSON(t)}));if(m)f.dynamicLayers=JSON.stringify(h);else{if(o){var b=d.map((function(e){return e.id}));u&&(b=b.filter((function(e){return u.includes(e)}))),f.layerIds=b}else(null===u||void 0===u?void 0:u.length)&&(f.layerIds=u);var x=function(e,t){var r=!(null===e||void 0===e||!e.length),n=t.filter((function(e){return null!=e.definitionExpression||r&&null!=e.floorInfo}));return n.length?n.map((function(t){var r=(0,C.f)(e,t),n=(0,F._)(r,t.definitionExpression);return{id:t.id,definitionExpression:n}})):null}(a,d);if((0,v.pC)(x)&&x.length){var w,g={},_=(0,P.Z)(x);try{for(_.s();!(w=_.n()).done;){var k=w.value;k.definitionExpression&&(g[k.id]=k.definitionExpression)}}catch(I){_.e(I)}finally{_.f()}Object.keys(g).length&&(f.layerDefs=JSON.stringify(g))}}}return f}var J,T=r(59486),U=r(62044),G=r(46784),M=r(78952),q=J=function(e){(0,c.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,u.Z)(this,r),(n=t.call(this,e)).dpi=96,n.floors=null,n.gdbVersion=null,n.geometry=null,n.geometryPrecision=null,n.height=400,n.layerIds=null,n.layerOption="top",n.mapExtent=null,n.maxAllowableOffset=null,n.returnFieldName=!0,n.returnGeometry=!1,n.returnM=!1,n.returnUnformattedValues=!0,n.returnZ=!1,n.spatialReference=null,n.sublayers=null,n.timeExtent=null,n.tolerance=null,n.width=400,n}return(0,s.Z)(r,null,[{key:"from",value:function(e){return(0,x.TJ)(J,e)}}]),r}(G.wq);(0,y._)([(0,b.Cb)({type:Number,json:{write:!0}})],q.prototype,"dpi",void 0),(0,y._)([(0,b.Cb)()],q.prototype,"floors",void 0),(0,y._)([(0,b.Cb)({type:String,json:{write:!0}})],q.prototype,"gdbVersion",void 0),(0,y._)([(0,b.Cb)({types:T.qM,json:{read:O.im,write:!0}})],q.prototype,"geometry",void 0),(0,y._)([(0,b.Cb)({type:Number,json:{write:!0}})],q.prototype,"geometryPrecision",void 0),(0,y._)([(0,b.Cb)({type:Number,json:{write:!0}})],q.prototype,"height",void 0),(0,y._)([(0,b.Cb)({type:[Number],json:{write:!0}})],q.prototype,"layerIds",void 0),(0,y._)([(0,b.Cb)({type:["top","visible","all","popup"],json:{write:!0}})],q.prototype,"layerOption",void 0),(0,y._)([(0,b.Cb)({type:g.Z,json:{write:!0}})],q.prototype,"mapExtent",void 0),(0,y._)([(0,b.Cb)({type:Number,json:{write:!0}})],q.prototype,"maxAllowableOffset",void 0),(0,y._)([(0,b.Cb)({type:Boolean,json:{write:!0}})],q.prototype,"returnFieldName",void 0),(0,y._)([(0,b.Cb)({type:Boolean,json:{write:!0}})],q.prototype,"returnGeometry",void 0),(0,y._)([(0,b.Cb)({type:Boolean,json:{write:!0}})],q.prototype,"returnM",void 0),(0,y._)([(0,b.Cb)({type:Boolean,json:{write:!0}})],q.prototype,"returnUnformattedValues",void 0),(0,y._)([(0,b.Cb)({type:Boolean,json:{write:!0}})],q.prototype,"returnZ",void 0),(0,y._)([(0,b.Cb)({type:M.Z,json:{write:!0}})],q.prototype,"spatialReference",void 0),(0,y._)([(0,b.Cb)()],q.prototype,"sublayers",void 0),(0,y._)([(0,b.Cb)({type:U.Z,json:{write:!0}})],q.prototype,"timeExtent",void 0),(0,y._)([(0,b.Cb)({type:Number,json:{write:!0}})],q.prototype,"tolerance",void 0),(0,y._)([(0,b.Cb)({type:Number,json:{write:!0}})],q.prototype,"width",void 0);var Q=q=J=(0,y._)([(0,w.j)("esri.rest.support.IdentifyParameters")],q),L=r(52639),B=r(38511),D=r(31201),W=r(27823),z=function(e){(0,c.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,u.Z)(this,r),(n=t.call(this,e)).displayFieldName=null,n.feature=null,n.layerId=null,n.layerName=null,n}return(0,s.Z)(r,[{key:"readFeature",value:function(e,t){return L.Z.fromJSON({attributes:(0,n.Z)({},t.attributes),geometry:(0,n.Z)({},t.geometry)})}},{key:"writeFeature",value:function(e,t){if(e){var r=e.attributes,a=e.geometry;r&&(t.attributes=(0,n.Z)({},r)),(0,v.pC)(a)&&(t.geometry=a.toJSON(),t.geometryType=W.P$.toJSON(a.type))}}}]),r}(G.wq);(0,y._)([(0,b.Cb)({type:String,json:{write:!0}})],z.prototype,"displayFieldName",void 0),(0,y._)([(0,b.Cb)({type:L.Z})],z.prototype,"feature",void 0),(0,y._)([(0,B.r)("feature",["attributes","geometry"])],z.prototype,"readFeature",null),(0,y._)([(0,D.c)("feature")],z.prototype,"writeFeature",null),(0,y._)([(0,b.Cb)({type:Number,json:{write:!0}})],z.prototype,"layerId",void 0),(0,y._)([(0,b.Cb)({type:String,json:{write:!0}})],z.prototype,"layerName",void 0);var H=z=(0,y._)([(0,w.j)("esri.rest.support.IdentifyResult")],z);function X(e,t,r){return $.apply(this,arguments)}function $(){return $=(0,o.Z)((0,i.Z)().mark((function e(t,r,a){var o,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(r=Y(r)).geometry?[r.geometry]:[],u=(0,j.en)(t),e.abrupt("return",(u.path+="/identify",(0,N.aX)(o).then((function(e){var t=V(r,{geometry:e&&e[0]}),i=(0,j.cv)((0,n.Z)((0,n.Z)({},u.query),{},{f:"json"},t)),o=(0,j.lA)(i,a);return(0,E.default)(u.path,o).then(K).then((function(e){return ee(e,r.sublayers)}))}))));case 2:case"end":return e.stop()}}),e)}))),$.apply(this,arguments)}function K(e){var t=e.data;t.results=t.results||[];var r={results:[]};return r.results=t.results.map((function(e){return H.fromJSON(e)})),r}function Y(e){return Q.from(e)}function ee(e,t){if(null===t||void 0===t||!t.length)return e;var r=new Map;t.forEach((function e(t){r.set(t.id,t),t.sublayers&&t.sublayers.forEach(e)}));var n,a=(0,P.Z)(e.results);try{for(a.s();!(n=a.n()).done;){var i=n.value;i.feature.sourceLayer=r.get(i.layerId)}}catch(o){a.e(o)}finally{a.f()}return e}var te=r(819),re=r(24405),ne=function(e){var t=function(e){(0,c.Z)(r,e);var t=(0,f.Z)(r);function r(){return(0,u.Z)(this,r),t.apply(this,arguments)}return(0,s.Z)(r,[{key:"initialize",value:function(){this.exportImageParameters=new k.R({layer:this.layer})}},{key:"destroy",value:function(){this.exportImageParameters.destroy(),this.exportImageParameters=null}},{key:"exportImageVersion",get:function(){var e;return null!==(e=this.exportImageParameters)&&void 0!==e&&e.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}},{key:"fetchPopupFeatures",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,r){var n,a,o,u,s,l,p,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p=this.layer,t){e.next=3;break}throw new d.Z("mapimagelayer:fetchPopupFeatures","Nothing to fetch without area",{layer:p});case 3:if(c=null===(n=null===(a=this.layer.capabilities)||void 0===a||null===(o=a.operations)||void 0===o?void 0:o.supportsQuery)||void 0===n||n,(null===(u=null===(s=this.layer.capabilities)||void 0===s||null===(l=s.operations)||void 0===l?void 0:l.supportsIdentify)||void 0===u||u)&&this.layer.version>=10.5||c){e.next=6;break}throw new d.Z("mapimagelayer:fetchPopupFeatures-not-supported","query operation is disabled for this service",{layer:p});case 6:return e.abrupt("return",c?this._fetchPopupFeaturesUsingQueries(t,r):this._fetchPopupFeaturesUsingIdentify(t,r));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){var e;return!!(0,l.Z)((0,p.Z)(r.prototype),"canResume",this).call(this)&&!(null!==(e=this.timeExtent)&&void 0!==e&&e.isEmpty)}},{key:"_fetchPopupFeaturesUsingIdentify",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,r){var n,a,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._createIdentifyParameters(t,r);case 2:if(n=e.sent,!(0,v.Wi)(n)){e.next=5;break}return e.abrupt("return",[]);case 5:return e.next=7,X(this.layer.parsedUrl,n);case 7:return a=e.sent,o=a.results,e.abrupt("return",o.map((function(e){return e.feature})));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createIdentifyParameters",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,r){var n,a,u,s,l,p,c,f,y,d,h,b,x,w,_=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=this.view,s=u.floors,l=u.spatialReference,p=u.scale,c=(0,v.pC)(r)?r.event:null,e.next=7,this._collectPopupProviders(this.layer.sublayers,p,r);case 7:if((f=e.sent).length){e.next=10;break}return e.abrupt("return",null);case 10:return e.next=12,Promise.all(f.map((function(e){return e.sublayer.load().catch((function(){}))})));case 12:if(y=Math.min((0,m.Z)("mapimagelayer-popup-identify-max-tolerance"),this.layer.allSublayers.reduce((function(e,t){return t.renderer?(0,I.k)({renderer:t.renderer,event:c}):e}),2)),d=this.createFetchPopupFeaturesQueryGeometry(t,y),h=(0,Z.dp)(p,l),b=Math.round(d.width/h),x=new g.Z({xmin:d.center.x-h*b,ymin:d.center.y-h*b,xmax:d.center.x+h*b,ymax:d.center.y+h*b,spatialReference:d.spatialReference}),e.t0=!1===(null===(n=this.layer.capabilities)||void 0===n||null===(a=n.operations)||void 0===a?void 0:a.supportsQuery),e.t0){e.next=22;break}return e.next=21,new Promise((function(e){var t=!1;Promise.all(f.map(function(){var r=(0,o.Z)((0,i.Z)().mark((function r(n){var a,o;return(0,i.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(a=n.popupTemplate)){r.next=9;break}return r.next=4,_._loadArcadeModules(a);case 4:if(o=r.sent,!t){r.next=7;break}return r.abrupt("return");case 7:(null===o||void 0===o?void 0:o.arcadeUtils.hasGeometryOperations(a))&&(t=!0,e(!0));case 9:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())).finally((function(){return e(!1)}))}));case 21:e.t0=e.sent;case 22:return w=e.t0,e.abrupt("return",new Q({floors:s,gdbVersion:this.layer.gdbVersion,geometry:t,height:b,layerOption:"popup",mapExtent:x,maxAllowableOffset:w?0:h,returnGeometry:!0,spatialReference:l,sublayers:this.layer.sublayers,timeExtent:this.timeExtent,tolerance:y,width:b}));case 24:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_fetchPopupFeaturesUsingQueries",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,r){var n,u,s,l=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._collectPopupProviders(this.layer.sublayers,this.view.scale,r);case 2:return n=e.sent,u=(0,v.pC)(r)?r.event:null,s=n.map(function(){var e=(0,o.Z)((0,i.Z)().mark((function e(r){var n,a,o,s,p,c,f,y,d,m;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.sublayer,a=r.popupTemplate,e.next=3,n.load().catch((function(){}));case 3:return o=n.createQuery(),s=(0,I.k)({renderer:n.renderer,event:u}),p=l.createFetchPopupFeaturesQueryGeometry(t,s),o.geometry=p,e.next=7,(0,re.e)(n,a);case 7:if(o.outFields=e.sent,!("floors"in l.view)){e.next=11;break}y=null===(c=l.view)||void 0===c||null===(f=c.floors)||void 0===f?void 0:f.clone(),d=(0,C.f)(y,n),(0,v.pC)(d)&&(o.where=o.where?"(".concat(o.where,") AND (").concat(d,")"):d);case 11:return e.next=13,l._loadArcadeModules(a);case 13:return(m=e.sent)&&m.arcadeUtils.hasGeometryOperations(a)||(o.maxAllowableOffset=p.width/s),e.next=17,n.queryFeatures(o);case 17:return e.abrupt("return",e.sent.features);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=7,(0,h.as)(s);case 7:return e.abrupt("return",e.sent.reduce((function(e,t){return t.value?[].concat((0,a.Z)(e),(0,a.Z)(t.value)):e}),[]).filter((function(e){return null!=e})));case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_collectPopupProviders",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,r,a){var u,s,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=[],s=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){var o,l,p;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=0===t.minScale||r<=t.minScale,l=0===t.maxScale||r>=t.maxScale,t.visible&&o&&l&&(t.sublayers?t.sublayers.forEach(s):t.popupEnabled&&(p=(0,re.V)(t,(0,n.Z)((0,n.Z)({},a),{},{defaultPopupTemplateEnabled:!1})),(0,v.pC)(p)&&u.unshift({sublayer:t,popupTemplate:p})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=t.toArray().reverse().map(s),e.next=3,Promise.all(l);case 3:return e.abrupt("return",u);case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_loadArcadeModules",value:function(e){var t;if(null!==(t=e.expressionInfos)&&void 0!==t&&t.length||Array.isArray(e.content)&&e.content.some((function(e){return"expression"===e.type})))return(0,te.LC)()}}]),r}(e);return(0,y._)([(0,b.Cb)()],t.prototype,"exportImageParameters",void 0),(0,y._)([(0,b.Cb)({readOnly:!0})],t.prototype,"exportImageVersion",null),(0,y._)([(0,b.Cb)()],t.prototype,"layer",void 0),(0,y._)([(0,b.Cb)()],t.prototype,"suspended",void 0),(0,y._)([(0,b.Cb)(_.qG)],t.prototype,"timeExtent",void 0),t=(0,y._)([(0,w.j)("esri.views.layers.MapImageLayerView")],t)}},24405:function(e,t,r){r.d(t,{V:function(){return p},e:function(){return s}});var n=r(74165),a=r(93433),i=r(15861),o=r(92026),u=r(80031);function s(e){return l.apply(this,arguments)}function l(){return l=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i,s,l,p,c,f,y,d,m=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=m.length>1&&void 0!==m[1]?m[1]:t.popupTemplate,!(0,o.Wi)(r)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,r.getRequiredFields(t.fieldsIndex);case 5:if(i=e.sent,s=r.lastEditInfoEnabled,l=t.objectIdField,p=t.typeIdField,c=t.globalIdField,f=t.relationships,!i.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!s){e.next=19;break}return e.next=16,(0,u.CH)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return y=e.t0,d=(0,u.Q0)(t.fieldsIndex,[].concat((0,a.Z)(i),(0,a.Z)(y))),e.abrupt("return",(p&&d.push(p),d&&l&&t.fieldsIndex.has(l)&&!d.includes(l)&&d.push(l),d&&c&&t.fieldsIndex.has(c)&&!d.includes(c)&&d.push(c),f&&f.forEach((function(e){var r=e.keyField;d&&r&&t.fieldsIndex.has(r)&&!d.includes(r)&&d.push(r)})),d));case 23:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}function p(e,t){return e.popupTemplate?e.popupTemplate:(0,o.pC)(t)&&t.defaultPopupTemplateEnabled&&(0,o.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=6289.7fafc86f.chunk.js.map