"use strict";(self.webpackChunkuums_front_end=self.webpackChunkuums_front_end||[]).push([[7199],{35862:function(e,t,r){r.r(t),r.d(t,{default:function(){return $}});var i=r(37762),n=r(74165),a=r(93433),o=r(15861),s=r(15671),u=r(43144),d=r(11752),l=r(61120),c=r(60136),h=r(29388),p=r(27366),f=r(52639),v=r(63780),y=r(32718),g=r(92026),_=r(94172),b=r(49861),m=(r(93169),r(25243),r(69912)),x=r(11186),E=r(71353),C=r(79803),k=r(65156),w=r(34066),I=r(93501),D=r(65618),S=r(37818),F=r(54748),Z=r(18661),O=r(21149),A=function(e){(0,c.Z)(r,e);var t=(0,h.Z)(r);function r(e){return(0,s.Z)(this,r),t.call(this,"SceneLayerWorker","dracoDecompressPointCloudData",{dracoDecompressPointCloudData:function(e){return[e.geometryBuffer]}},e,{hasInitialize:!0})}return(0,u.Z)(r)}(r(46798).q),N=r(42069),T=r(12173),V=r(82607),M=r(46169),G=r(2296),L=r(44011),q=r(1247),H=r(48252),R=r(23224),j=r(6777),P=r(94463),Q=r(76836),U=r(89414),B=r(58890),W=r(68401),z=r(17006),K=r(93463),J=y.Z.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D"),Y=(0,H.v)(),X=function(e){(0,c.Z)(p,e);var t=(0,h.Z)(p);function p(){var e;return(0,s.Z)(this,p),(e=t.apply(this,arguments)).type="scene-layer-graphics-3d",e._nodesAddedToStage=new Map,e._queryEngine=null,e._memCache=null,e._interactiveEditingSessions=new Map,e.loadedGraphics=new Q.f,e.holeFilling="always",e.progressiveLoadFactor=1,e.supportsHeightUnitConversion=!0,e._coordinatesOutsideExtentErrors=0,e._maxCoordinatesOutsideExtentErrors=20,e}return(0,u.Z)(p,[{key:"initialize",value:function(){var e,t,i=this,n=this.layer;this.addResolvingPromise(n.indexInfo),this._attributeOverrides=new G.l(this.layer,null===(e=this.view.resourceController)||void 0===e?void 0:e.memoryController),(0,L.OJ)(n,this.view.spatialReference,this.view.viewingMode),this.fieldsHelper=new j.K({layerView:this}),this.updatingHandles.add((function(){return n.rangeInfos}),(function(e){return i._rangeInfosChanged(e)}),_.nn),this.updatingHandles.add((function(){return n.renderer}),(function(e,t){return i._rendererChange(e,t)})),this.updatingHandles.add((function(){return[i.parsedDefinitionExpression,i.excludeObjectIdsSorted]}),(function(){return i._filterChange()})),this.updatingHandles.add((function(){return i.view.floors}),(function(){return(0,g.pC)(i.processor.filterVisibility)&&i.processor.filterVisibility.filterChanged()})),this.handles.add((0,_.YP)((function(){return P.Z.I3S_TREE_SHOW_TILES}),(function(e){if(e&&!i._treeDebugger){var t=i._controller.crsIndex;r.e(322).then(r.bind(r,80322)).then((function(e){var r=e.I3STreeDebugger;!i._treeDebugger&&P.Z.I3S_TREE_SHOW_TILES&&(i._treeDebugger=new r({lv:i,view:i.view,nodeSR:t}))}))}else e||!i._treeDebugger||P.Z.I3S_TREE_SHOW_TILES||(i._treeDebugger.destroy(),i._treeDebugger=null)}),_.nn)),this._set("processor",new T.Z({owner:this,preferredUpdatePolicy:W.jq.ASYNC,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,dataExtent:n.fullExtent,updateClippingExtent:function(e){return i._updateClippingExtent(e)}})),null!==(t=this.processor.elevationAlignment)&&void 0!==t&&t.events.on("invalidate-elevation",(function(e){return i._invalidateElevation(e)})),this.supportsHeightUnitConversion&&(this._verticalScale=(0,I.k)("point",n.spatialReference,this.view.spatialReference)),this.addResolvingPromise(this.processor.setup()),this._memCache=this.view.resourceController.memoryController.newCache(n.uid),this._controller=new F.Z({layerView:this,scaleVisibilityEnabled:!1}),(0,L.X5)(this.layer.geometryDefinitions)&&(this._worker=new A((function(e){return i.view.resourceController.schedule(e)}))),this.handles.add(this.layer.on("apply-edits",(function(e){return i.updatingHandles.addPromise(e.result)}))),this.handles.add(this.layer.on("edits",(function(e){return i._handleEdits(e)}))),this.when((function(){i._queryEngine=new V.q({layerView:i,priority:K.T8.FEATURE_QUERY_ENGINE}),i.updatingHandles.add((function(){return i.maximumNumberOfFeatures}),(function(e){return i._controller.featureTarget=e}),_.nn),i.updatingHandles.add((function(){return i.suspended}),(function(e){e&&i._removeAllNodeData()}))}))}},{key:"destroy",value:function(){this._treeDebugger=(0,g.SC)(this._treeDebugger),this._attributeOverrides=(0,g.SC)(this._attributeOverrides),this._set("processor",(0,g.SC)(this.processor)),this._controller=(0,g.SC)(this._controller),this._queryEngine=(0,g.SC)(this._queryEngine),this._worker=(0,g.SC)(this._worker),this._memCache=(0,g.SC)(this._memCache),this._nodesAddedToStage.clear(),this.fieldsHelper=(0,g.SC)(this.fieldsHelper)}},{key:"requiredFields",get:function(){var e,t;return null!==(e=null===(t=this.fieldsHelper)||void 0===t?void 0:t.requiredFields)&&void 0!==e?e:[]}},{key:"maximumNumberOfFeatures",get:function(){var e,t,r,i=null===(e=this.processor)||void 0===e||null===(t=e.graphicsCore)||void 0===t?void 0:t.displayFeatureLimit;return null!==(r=null===i||void 0===i?void 0:i.maximumNumberOfFeatures)&&void 0!==r?r:0},set:function(e){null!=e?(this._override("maximumNumberOfFeatures",e),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){var e;return!this.suspended&&!(null===(e=this._controller)||void 0===e||!e.useMaximumNumberOfFeatures)&&!this._controller.leavesReached}},{key:"excludeObjectIdsSorted",get:function(){var e=this.layer.excludeObjectIds;return e.length?e.toArray().sort((function(e,t){return e-t})):null}},{key:"lodFactor",get:function(){return"Labels"===this.layer.semantic?1:this.view.qualitySettings.sceneService.point.lodFactor}},{key:"hasM",get:function(){return!1}},{key:"hasZ",get:function(){return!0}},{key:"whenGraphicAttributes",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r){var i=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,L.bf)(this.layer,t,this._getObjectIdField(),r,(function(){return(0,a.Z)(i._nodesAddedToStage.values())})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getHit",value:function(e){if(!this.loadedGraphics)return null;var t=(0,S.mW)(this.loadedGraphics.find((function(t){return t.uid===e})),this.layer),r=this._getObjectIdField();return t&&t.attributes&&t.attributes[r]?(t.layer=this.layer,t.sourceLayer=this.layer,{type:"graphic",graphic:t,layer:t.layer}):null}},{key:"whenGraphicBounds",value:function(e,t){return this.processor.whenGraphicBounds(e,t)}},{key:"computeAttachmentOrigin",value:function(e,t){return this.processor.computeAttachmentOrigin(e,t)}},{key:"canResume",value:function(){return(0,d.Z)((0,l.Z)(p.prototype),"canResume",this).call(this)&&(!this._controller||this._controller.rootNodeVisible)}},{key:"isUpdating",value:function(){var e,t,r;return!!(null!==(e=this._controller)&&void 0!==e&&e.updating||null!==(t=this.processor)&&void 0!==t&&t.updating||null!==(r=this.fieldsHelper)&&void 0!==r&&r.updating||this.layerFilterUpdating)}},{key:"highlight",value:function(e){return this.processor.highlight(e,this.layer.objectIdField)}},{key:"updatePolicy",get:function(){return this.processor.graphicsCore.effectiveUpdatePolicy}},{key:"createInteractiveEditSession",value:function(e){return(0,M.s)(this.attributeEditingContext,e)}},{key:"_extractBinaryPointData",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r){var i,a=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={geometryBuffer:t.geometryBuffer},e.abrupt("return",((0,g.Wi)(this._worker)&&(this._worker=new A((function(e){return a.view.resourceController.schedule(e)}))),this._worker.invoke(i,r).then((function(e){if((0,g.pC)(e))return{positionData:e.positions,featureIds:e.featureIds};throw new Error("Failed to decompress Draco point data")}))));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_checkExtent",value:function(e,t){e&&!(0,w.Qg)(e,t)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&J.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&J.error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++)}},{key:"addNode",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r,a){var o,s,u,d,l,c,h;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(te(r)||ee(r)){e.next=2;break}throw new Error;case 2:if(!this._nodesAddedToStage.has(t.index)){e.next=4;break}return e.abrupt("return",void J.error("I3S node "+t.id+" already added"));case 4:if(o=(0,g.pC)(this.layer.fullExtent)?ie(this.layer.fullExtent.clone(),.5):null,s=this._controller.crsVertex,u=[],d={graphics:null,featureIds:null,attributeInfo:r.attributeDataInfo,node:t},!te(r)){e.next=10;break}return e.next=8,this._addNodeBinaryPointData(t,d,r,o,u,a);case 8:e.next=11;break;case 10:ee(r)&&this._addNodeLegacyPointData(t,d,r,o,u);case 11:return e.next=13,this._attributeOverrides.apply(d.featureIds,r.attributeDataInfo,a);case 13:if(t.numFeatures=d.graphics.length,this._updateNodeMemory(t),re(d),u.length>0&&(this._computeObb(t,u,s),this._controller.updateVisibility(t.index)),!this._controller.isGeometryVisible(t)){e.next=22;break}if((0,g.pC)(this._verticalScale)){l=(0,i.Z)(d.graphics);try{for(l.s();!(c=l.n()).done;)h=c.value,this._verticalScale(h.geometry)}catch(n){l.e(n)}finally{l.f()}}this._nodesAddedToStage.set(t.index,d),this.loadedGraphics.addMany(d.graphics),this._controller.updateLoadStatus(t.index,!0),this._filterNode(d),this._treeDebugger&&this._treeDebugger.update(),e.next=23;break;case 22:this._cacheNodeData(d);case 23:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_computeObb",value:function(e,t,r){var i=this._controller.crsIndex,n=i.isGeographic?this.view.renderSpatialReference:i;(0,C.CM)(t,r,0,t,n,0,t.length/3);var a={data:t,size:3};e.serviceObb=(0,U.Qb)(a),i.isGeographic&&(0,C.SH)(e.serviceObb.center,n,e.serviceObb.center,i)}},{key:"isNodeLoaded",value:function(e){return this._nodesAddedToStage.has(e)}},{key:"isNodeReloading",value:function(){return!1}},{key:"updateNodeState",value:function(){}},{key:"_addNodeBinaryPointData",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r,i,a,o,s){var u,d,l,c,h,p,v,y,_,b,m,k,w,I,S,F,Z,O,A;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._extractBinaryPointData(i,s);case 2:if(null!=(u=e.sent)){e.next=5;break}throw new Error;case 5:for(d=this._getObjectIdField(),l=this._controller.crsVertex,c=this.view.spatialReference,h=this.processor.graphicsCore,p=u.positionData,v=u.featureIds,3,y=p.length/3,_=new Array,b=0;b<y;b++)m=(0,g.pC)(t.serviceObb)?t.serviceObb.center:[0,0,0],k=3*b,w=(0,E.f)(p[k+0],p[k+1],p[k+2]),(0,x.a)(w,w,m),t.serviceObb||o.push(w[0],w[1],w[2]),(0,g.pC)(a)&&this._checkExtent(a,w),I=v[b],S={},null!=I&&(S[d]=I),F=null==I?f.Z.generateUID():I,(0,C.CM)(w,l,0,ae,c,0,1),Z=(0,D.Tx)(ae[0],ae[1],ae[2],c),O=this.loadedGraphics.get(F),(0,g.pC)(O)?(O.level<t.level&&(oe.property="geometry",oe.graphic=O,oe.oldValue=(0,g.Wg)(O.geometry),oe.newValue=Z,O.geometry=Z,h.graphicUpdateHandler(oe)),_.push(O)):(A=f.Z.generateUID(),_.push({objectId:F,uid:A,geometry:Z,attributes:S,visible:!0,level:t.level}));r.graphics=_,r.featureIds=Array.from(v);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a,o){return e.apply(this,arguments)}}()},{key:"_addNodeLegacyPointData",value:function(e,t,r,n,a){var o,s=this._getObjectIdField(),u=this._controller.crsVertex,d=this.view.spatialReference,l=[0,0,0],c=new Array,h=new Array,p=(0,i.Z)(r.pointData);try{for(p.s();!(o=p.n()).done;){var v=o.value,y=v.featureDataPosition,_=y.length,b=v.geometries&&v.geometries[0]||ne[_],m=v.featureIds[0];if("points"===b.params.type){(0,g.pC)(n)&&this._checkExtent(n,y);var x={};null!=m&&(x[s]=m);var E=null==m?f.Z.generateUID():m,k=void 0;"Embedded"===b.type&&(k=b.params.vertexAttributes.position);for(var w=0;w<k.length;w+=_){for(var I=0;I<_;I++)l[I]=y[I]+k[w+I];var S=3===_;e.serviceObb||a.push(l[0],l[1],S?l[2]:0),(0,C.CM)(l,u,0,ae,d,0,1);var F=(0,D.Tx)(ae[0],ae[1],S?ae[2]:void 0,d),Z=this.loadedGraphics.get(E);(0,g.pC)(Z)?h.push(Z):h.push({objectId:E,uid:f.Z.generateUID(),geometry:F,attributes:x,visible:!0})}c.push(m)}}}catch(O){p.e(O)}finally{p.f()}t.graphics=h,t.featureIds=c}},{key:"_updateNodeMemory",value:function(e){e.memory=4096+((0,g.pC)(e.numFeatures)?e.numFeatures*this.processor.graphicsCore.usedMemoryPerGraphic:0)}},{key:"_cacheNodeData",value:function(e){var t=e.graphics.reduce((function(e,t){return(0,D.Xw)(t)+e}),512+8*e.featureIds.length+1024);this._memCache.put(this._getMemCacheKey(e.node),e,t)}},{key:"_getMemCacheKey",value:function(e){return"".concat(e.index)}},{key:"_removeAllNodeData",value:function(){var e=this;this._nodesAddedToStage.forEach((function(t,r){if(t){var i=t.node;e._updateNodeMemory(i),e._cacheNodeData(t)}e._controller.updateLoadStatus(r,!1)})),this._nodesAddedToStage.clear(),this._treeDebugger&&this._treeDebugger.update(),this.loadedGraphics.clear()}},{key:"removeNode",value:function(e){var t=this._removeNodeStageData(e);t&&(this._updateNodeMemory(t.node),this._cacheNodeData(t))}},{key:"_removeNodeStageData",value:function(e){var t=this._nodesAddedToStage.get(e);return t?(this._controller.updateLoadStatus(e,!1),this.loadedGraphics.removeMany(t.graphics),this._nodesAddedToStage.delete(e),this._treeDebugger&&this._treeDebugger.update(),t):null}},{key:"loadCachedNodeData",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._memCache.pop(this._getMemCacheKey(t)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addCachedNodeData",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r,i,a){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._nodesAddedToStage.has(t.index)){e.next=4;break}J.error("I3S node "+t.id+" already added"),e.next=12;break;case 4:return this.loadedGraphics.addMany(r.graphics),this._nodesAddedToStage.set(t.index,r),this._controller.updateLoadStatus(t.index,!0),this._updateNodeMemory(t),e.next=10,this.updateAttributes(t.index,i,a);case 10:this._filterNode(r),this._treeDebugger&&this._treeDebugger.update();case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n){return e.apply(this,arguments)}}()},{key:"getLoadedNodeIds",value:function(){var e=[];return this._nodesAddedToStage.forEach((function(t){return e.push(t.node.id)})),e.sort()}},{key:"getVisibleNodes",value:function(){var e=new Array;return this._nodesAddedToStage.forEach((function(t){return e.push(t.node)})),e}},{key:"getLoadedNodeIndices",value:function(e){this._nodesAddedToStage.forEach((function(t,r){return e.push(r)}))}},{key:"getLoadedAttributes",value:function(e){var t=this._nodesAddedToStage.get(e);if(t&&(0,g.pC)(t.attributeInfo))return t.attributeInfo.loadedAttributes}},{key:"getAttributeData",value:function(e){var t=this._nodesAddedToStage.get(e);if(t&&(0,g.pC)(t.attributeInfo))return t.attributeInfo.attributeData}},{key:"_setAttributeData",value:function(e,t){var r=this._nodesAddedToStage.get(e);r&&!(0,g.Wi)(r.attributeInfo)&&(r.attributeInfo.attributeData=t,this._attributeValuesChanged(r))}},{key:"updateAttributes",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r,i){var a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this._nodesAddedToStage.get(t),e.t0=a,!e.t0){e.next=7;break}return e.next=5,this._attributeOverrides.apply(a.featureIds,r,i);case 5:a.attributeInfo=r,this._attributeValuesChanged(a);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_attributeValuesChanged",value:function(e){if(re(e),this._filterNode(e),this.processor.graphicsCore.labelsEnabled){var t=e.graphics.map((function(e){return e.uid}));this.processor.graphicsCore.updateLabelingInfo(t)}}},{key:"_updateClippingExtent",value:function(e){return this._controller&&this._controller.updateClippingArea(e),!1}},{key:"_getObjectIdField",value:function(){return this.layer.objectIdField||"OBJECTID"}},{key:"_rendererChange",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r){var i,a,o,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.layer.fieldsIndex,a=new Set,!t){e.next=7;break}return e.next=4,t.collectRequiredFields(a,i);case 4:o=Array.from(a).sort(),e.next=8;break;case 7:o=[];case 8:if(a.clear(),!r){e.next=15;break}return e.next=12,r.collectRequiredFields(a,i);case 12:s=Array.from(a).sort(),e.next=16;break;case 15:s=[];case 16:o.length===s.length&&o.every((function(e,t){return o[t]===s[t]}))||this._reloadAllNodes();case 17:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_rangeInfosChanged",value:function(e){null!=e&&e.length>0&&J.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}},{key:"_filterChange",value:function(){var e=this;this._nodesAddedToStage.forEach((function(t){return e._filterNode(t)}))}},{key:"_reloadAllNodes",value:function(){this._removeAllNodeData(),this._controller&&this._controller.restartNodeLoading()}},{key:"_filterNode",value:function(e){var t,r=this.parsedDefinitionExpression,n=this.excludeObjectIdsSorted,a=this._getObjectIdField(),o=(0,i.Z)(e.graphics);try{for(o.s();!(t=o.n()).done;){var s=t.value,u=s.visible,d=!r||this._evaluateClause(r,s),l=(0,g.Wi)(n)||(0,v.$A)(n,s.attributes[a])<0;s.visible=d&&l,u!==s.visible&&(oe.graphic=s,oe.property="visible",oe.oldValue=u,oe.newValue=s.visible,this.processor.graphicsCore.graphicUpdateHandler(oe))}}catch(c){o.e(c)}finally{o.f()}}},{key:"_invalidateElevation",value:function(e){var t=this._controller.crsIndex;(0,C.dH)(e.extent,e.spatialReference,se,t),this._controller.updateElevationChanged(se,t)}},{key:"createQuery",value:function(){var e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return(0,g.pC)(this.filter)?this.filter.createQuery(e):new O.Z(e)}},{key:"queryFeatures",value:function(e,t){return this._queryEngine.executeQuery(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"queryObjectIds",value:function(e,t){return this._queryEngine.executeQueryForIds(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"queryFeatureCount",value:function(e,t){return this._queryEngine.executeQueryForCount(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"queryExtent",value:function(e,t){return this._queryEngine.executeQueryForExtent(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"_ensureQuery",value:function(e){return this._addDefinitionExpressionToQuery((0,g.Wi)(e)?this.createQuery():O.Z.from(e))}},{key:"getUsedMemory",value:function(){var e,t,r;return null!==(e=null===(t=this.processor)||void 0===t||null===(r=t.graphicsCore)||void 0===r?void 0:r.usedMemory)&&void 0!==e?e:0}},{key:"getUnloadedMemory",value:function(){var e,t,r,i,n;return.8*((null!==(e=null===(t=this._controller)||void 0===t?void 0:t.unloadedMemoryEstimate)&&void 0!==e?e:0)+(null!==(r=null===(i=this.processor)||void 0===i||null===(n=i.graphicsCore)||void 0===n?void 0:n.unprocessedMemoryEstimate)&&void 0!==r?r:0))}},{key:"ignoresMemoryFactor",value:function(){return this._controller&&this._controller.fixedFeatureTarget}},{key:"_handleEdits",value:function(e){(0,M.Z)(this.attributeEditingContext,e)}},{key:"attributeEditingContext",get:function(){var e=this,t=this._getObjectIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:t,forEachNode:function(t){return e._nodesAddedToStage.forEach((function(e){return t(e.node,e.featureIds)}))},attributeStorageInfo:this.i3slayer.attributeStorageInfo,attributeOverrides:this._attributeOverrides,getAttributeData:function(t){return e.getAttributeData(t)},setAttributeData:function(r,i,n){e._setAttributeData(r,i);var a=e._nodesAddedToStage.get(r);if((0,g.pC)(n)){var o=e.loadedGraphics.get(n.attributes[t]);(0,g.pC)(o)&&e.processor.graphicsCore.recreateGraphics([o])}else(0,g.pC)(a)&&e.processor.graphicsCore.recreateGraphics(a.graphics)},clearMemCache:function(){}}}},{key:"performanceInfo",get:function(){var e={displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:this.maximumNumberOfFeatures,totalNumberOfFeatures:-1,nodes:this._nodesAddedToStage.size,core:this.processor.graphicsCore.performanceInfo};return this._controller&&this._controller.updateStats(e),e}},{key:"test",get:function(){return{controller:this._controller,numNodes:this._nodesAddedToStage.size,loadedGraphics:this.loadedGraphics}}}]),p}((0,q.l)((0,R.i)((0,N.A)(z.Z))));(0,p._)([(0,b.Cb)()],X.prototype,"processor",void 0),(0,p._)([(0,b.Cb)({type:Z.Z})],X.prototype,"filter",void 0),(0,p._)([(0,b.Cb)()],X.prototype,"loadedGraphics",void 0),(0,p._)([(0,b.Cb)({aliasOf:"layer"})],X.prototype,"i3slayer",void 0),(0,p._)([(0,b.Cb)()],X.prototype,"_controller",void 0),(0,p._)([(0,b.Cb)()],X.prototype,"updating",void 0),(0,p._)([(0,b.Cb)()],X.prototype,"suspended",void 0),(0,p._)([(0,b.Cb)()],X.prototype,"holeFilling",void 0),(0,p._)([(0,b.Cb)(B.q)],X.prototype,"updatingProgress",void 0),(0,p._)([(0,b.Cb)({aliasOf:"_controller.updatingProgress"})],X.prototype,"updatingProgressValue",void 0),(0,p._)([(0,b.Cb)(Y.requiredFields)],X.prototype,"requiredFields",null),(0,p._)([(0,b.Cb)(Y.availableFields)],X.prototype,"availableFields",void 0),(0,p._)([(0,b.Cb)()],X.prototype,"fieldsHelper",void 0),(0,p._)([(0,b.Cb)({type:Number})],X.prototype,"maximumNumberOfFeatures",null),(0,p._)([(0,b.Cb)({readOnly:!0})],X.prototype,"maximumNumberOfFeaturesExceeded",null),(0,p._)([(0,b.Cb)()],X.prototype,"excludeObjectIdsSorted",null),(0,p._)([(0,b.Cb)({readOnly:!0})],X.prototype,"lodFactor",null),(0,p._)([(0,b.Cb)({readOnly:!0})],X.prototype,"hasM",null),(0,p._)([(0,b.Cb)({readOnly:!0})],X.prototype,"hasZ",null);var $=X=(0,p._)([(0,m.j)("esri.views.3d.layers.SceneLayerGraphicsView3D")],X);function ee(e){return"pointData"in e}function te(e){return"geometryBuffer"in e&&null!==e.geometryBuffer}function re(e){for(var t=e.attributeInfo,r=0;r<e.graphics.length;r++){var n=e.graphics[r];if(n.attributes||(n.attributes={}),(0,g.pC)(t)&&(0,g.pC)(t.loadedAttributes)){var a,o=(0,i.Z)(t.loadedAttributes);try{for(o.s();!(a=o.n()).done;){var s=a.value.name;t.attributeData[s]&&(n.attributes[s]=(0,L.Jx)(t.attributeData[s],r))}}catch(u){o.e(u)}finally{o.f()}}}}function ie(e,t){return e.xmin-=t,e.ymin-=t,e.xmax+=t,e.ymax+=t,e.hasZ&&(e.zmin-=t,e.zmax+=t),e.hasM&&(e.mmin-=t,e.mmax+=t),e}var ne={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},ae=(0,E.c)(),oe={graphic:null,property:null,oldValue:null,newValue:null},se=(0,k.Ue)()},1247:function(e,t,r){r.d(t,{l:function(){return f}});var i=r(15671),n=r(43144),a=r(60136),o=r(29388),s=r(27366),u=r(32718),d=r(49861),l=(r(63780),r(93169),r(25243),r(69912)),c=r(48562),h=r(44011),p=u.Z.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView"),f=function(e){var t=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,i.Z)(this,r),(e=t.apply(this,arguments))._definitionExpressionErrors=0,e._maxDefinitionExpressionErrors=20,e.logError=function(t){e._definitionExpressionErrors<e._maxDefinitionExpressionErrors&&p.error("Error while evaluating definitionExpression: "+t),e._definitionExpressionErrors++,e._definitionExpressionErrors===e._maxDefinitionExpressionErrors&&p.error("Further errors are ignored")},e}return(0,n.Z)(r,[{key:"parsedDefinitionExpression",get:function(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;try{var e=c.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!e.isStandardized)return p.error("definitionExpression is using non standard function"),null;var t=[],r=e.fieldNames;return(0,h.e8)(r,this.i3slayer.fields,{missingFields:t}),t.length>0?(p.error("definitionExpression references unknown fields: ".concat(t.join(", "))),null):(this._definitionExpressionErrors=0,e)}catch(i){return p.error("Failed to parse definitionExpression: "+i),null}}},{key:"definitionExpressionFields",get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null}},{key:"_evaluateClause",value:function(e,t){try{return e.testFeature(t)}catch(r){return this.logError(r),!1}}},{key:"_addDefinitionExpressionToQuery",value:function(e){if(!this.parsedDefinitionExpression)return e;var t=this.i3slayer.definitionExpression,r=e.clone();return r.where?r.where="(".concat(t,") AND (").concat(r.where,")"):r.where=t,r}}]),r}(e);return(0,s._)([(0,d.Cb)()],t.prototype,"i3slayer",void 0),(0,s._)([(0,d.Cb)({readOnly:!0})],t.prototype,"parsedDefinitionExpression",null),(0,s._)([(0,d.Cb)({readOnly:!0})],t.prototype,"definitionExpressionFields",null),t=(0,s._)([(0,l.j)("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],t),t}},24405:function(e,t,r){r.d(t,{V:function(){return l},e:function(){return u}});var i=r(74165),n=r(93433),a=r(15861),o=r(92026),s=r(80031);function u(e){return d.apply(this,arguments)}function d(){return d=(0,a.Z)((0,i.Z)().mark((function e(t){var r,a,u,d,l,c,h,p,f,v=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=v.length>1&&void 0!==v[1]?v[1]:t.popupTemplate,!(0,o.Wi)(r)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,r.getRequiredFields(t.fieldsIndex);case 5:if(a=e.sent,u=r.lastEditInfoEnabled,d=t.objectIdField,l=t.typeIdField,c=t.globalIdField,h=t.relationships,!a.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!u){e.next=19;break}return e.next=16,(0,s.CH)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return p=e.t0,f=(0,s.Q0)(t.fieldsIndex,[].concat((0,n.Z)(a),(0,n.Z)(p))),e.abrupt("return",(l&&f.push(l),f&&d&&t.fieldsIndex.has(d)&&!f.includes(d)&&f.push(d),f&&c&&t.fieldsIndex.has(c)&&!f.includes(c)&&f.push(c),h&&h.forEach((function(e){var r=e.keyField;f&&r&&t.fieldsIndex.has(r)&&!f.includes(r)&&f.push(r)})),f));case 23:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}function l(e,t){return e.popupTemplate?e.popupTemplate:(0,o.pC)(t)&&t.defaultPopupTemplateEnabled&&(0,o.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=7199.fc73a11d.chunk.js.map