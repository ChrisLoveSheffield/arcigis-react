"use strict";(self.webpackChunkuums_front_end=self.webpackChunkuums_front_end||[]).push([[8495],{74937:function(e,t,r){r.d(t,{Z:function(){return P}});var n=r(37762),i=r(74165),a=r(15861),u=r(93433),s=r(15671),l=r(43144),o=r(11752),f=r(61120),c=r(60136),p=r(29388),d=r(27366),h=r(44927),y=r(10064),v=r(32718),m=r(92026),b=r(66978),x=r(94172),F=r(49861),g=(r(63780),r(93169),r(25243),r(69912)),k=r(45948),w=r(83444),Z=r(18661),E=r(80031),_=r(87072),C=r(21149),I=r(819),R=r(24405),q=v.Z.getLogger("esri.views.layers.FeatureLayerView"),P=function(e){var t=function(e){(0,c.Z)(r,e);var t=(0,p.Z)(r);function r(){var e;(0,s.Z)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i)))._updatingRequiredFieldsPromise=null,e.filter=null,e.timeExtent=null,e.layer=null,e.requiredFields=[],e.view=null,e}return(0,l.Z)(r,[{key:"initialize",value:function(){var e=this;this.handles.add([(0,x.YP)((function(){var t,r=e.layer;return[null===r||void 0===r||null===(t=r.elevationInfo)||void 0===t?void 0:t.featureExpressionInfo,null===r||void 0===r?void 0:r.displayField,null===r||void 0===r?void 0:r.timeInfo,r&&"renderer"in r&&r.renderer,r&&"labelingInfo"in r&&r.labelingInfo,r&&"floorInfo"in r&&r.floorInfo,e.filter,e.featureEffect,e.timeExtent]}),(function(){return e._handleRequiredFieldsChange()}),x.tX),(0,x.on)((function(){var t;return null===(t=e.view)||void 0===t?void 0:t.floors}),"change",(function(){return e._handleRequiredFieldsChange()})),(0,x.on)((function(){var t=e.layer;return t&&"sublayers"in t&&t.sublayers}),"change",(function(){return e._handleRequiredFieldsChange()}))])}},{key:"availableFields",get:function(){var e=this.layer,t=this.layer.fieldsIndex,r=this.requiredFields;return"outFields"in e&&e.outFields?(0,E.Q0)(t,[].concat((0,u.Z)((0,E.Lk)(t,e.outFields)),(0,u.Z)(r))):(0,E.Q0)(t,r)}},{key:"effect",get:function(){return(0,h.Mr)(q,"effect",{replacement:"featureEffect",version:"4.22"}),this.featureEffect},set:function(e){(0,h.Mr)(q,"effect",{replacement:"featureEffect",version:"4.22"}),this.featureEffect=e}},{key:"featureEffect",get:function(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null},set:function(e){void 0!==e?this._override("featureEffect",e):this._clearOverride("featureEffect")}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(e){q.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}},{key:"highlight",value:function(e){throw new Error("missing implementation")}},{key:"createQuery",value:function(){var e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=(0,m.pC)(this.filter)?this.filter.createQuery(e):new C.Z(e);if("feature"===this.layer.type){var r=(0,_.c)(this);(0,m.pC)(r)&&(t.where=t.where?"(".concat(t.where,") AND (").concat(r,")"):r)}return(0,m.pC)(this.timeExtent)&&(t.timeExtent=(0,m.pC)(t.timeExtent)?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}},{key:"queryFeatures",value:function(e,t){throw new Error("missing implementation")}},{key:"queryObjectIds",value:function(e,t){throw new Error("missing implementation")}},{key:"queryFeatureCount",value:function(e,t){throw new Error("missing implementation")}},{key:"queryExtent",value:function(e,t){throw new Error("missing implementation")}},{key:"fetchPopupFeatures",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.validateFetchPopupFeatures(r))){e.next=3;break}throw n;case 3:return e.abrupt("return",this.fetchClientPopupFeatures(r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_loadArcadeModules",value:function(e){if(e.get("expressionInfos.length")||Array.isArray(e.content)&&e.content.some((function(e){return"expression"===e.type})))return(0,I.LC)()}},{key:"_handleRequiredFieldsChange",value:function(){var e=this,t=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",t),t.then((function(){e._updatingRequiredFieldsPromise===t&&e._set("_updatingRequiredFieldsPromise",null)}))}},{key:"_updateRequiredFields",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,a,u,s,l,o,f,c,p,d,h,y,v,x;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.layer&&this.view){e.next=2;break}return e.abrupt("return");case 2:return t="3d"===this.view.type,r=this.layer,a=this.layer,u=a.fieldsIndex,s=a.objectIdField,l="renderer"in r&&r.renderer,o="orderBy"in r&&r.orderBy,f=r.featureReduction,c=new Set,e.next=13,(0,b.as)([l?l.collectRequiredFields(c,u):null,(0,E.Mu)(c,r),t?(0,E.vl)(c,r):null,(0,m.pC)(this.filter)?(0,E.Ll)(c,r,this.filter):null,(0,m.pC)(this.featureEffect)?(0,E.Ll)(c,r,this.featureEffect.filter):null,f?(0,E.ZV)(c,r,f):null,o?(0,E.Qj)(c,r,o):null]);case 13:if(p=e.sent,r.timeInfo&&this.timeExtent&&(0,E.gd)(c,r.fieldsIndex,[r.timeInfo.startField,r.timeInfo.endField]),"feature"===r.type&&r.floorInfo&&(0,E.gd)(c,r.fieldsIndex,[r.floorInfo.floorField]),"subtype-group"!==r.type){e.next=19;break}return(0,E.AB)(c,u,r.subtypeField),d=r.sublayers.map((function(e){var t;return Promise.all([null===(t=e.renderer)||void 0===t?void 0:t.collectRequiredFields(c,u),(0,E.Mu)(c,e)])})),e.next=19,(0,b.as)(d);case 19:h=(0,n.Z)(p);try{for(h.s();!(y=h.n()).done;)(v=y.value).error&&q.error(v.error)}catch(i){h.e(i)}finally{h.f()}(0,E.AB)(c,u,s),t&&"displayField"in r&&r.displayField&&(0,E.AB)(c,u,r.displayField),x=Array.from(c).sort(),this._set("requiredFields",x);case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"validateFetchPopupFeatures",value:function(e){if((0,m.Wi)(e))return null;var t,r=(0,n.Z)(e.clientGraphics);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=i.layer;if("popupEnabled"in a&&!a.popupEnabled)return new y.Z("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:a});if(i.isAggregate){if(!(a.featureReduction&&"popupTemplate"in a.featureReduction&&a.featureReduction.popupEnabled&&a.featureReduction.popupTemplate))return new y.Z("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:a})}else if("popupTemplate"in a&&!(0,R.V)(a,e))return new y.Z("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:a})}}catch(u){r.e(u)}finally{r.f()}}},{key:"fetchClientPopupFeatures",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,a,u,s,l,o,f,c,p,d,h,y,v,b;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=(0,m.pC)(t)?t.clientGraphics:null)&&0!==r.length){e.next=3;break}return e.abrupt("return",[]);case 3:return a=new Array(r.length),u=new Map,e.next=7,this.createPopupQuery(t);case 7:s=e.sent,l=0;case 9:if(!(l<r.length)){e.next=27;break}if(!(o=r[l]).isAggregate){e.next=14;break}return a[l]=o,e.abrupt("continue",24);case 14:if("popupEnabled"in(f=o.layer)){e.next=17;break}return e.abrupt("continue",24);case 17:if(c=(0,E.Lk)(this.layer.fieldsIndex,s.outFields),p=(0,R.V)(f,t),!(0,m.Wi)(p)){e.next=20;break}return e.abrupt("continue",24);case 20:return e.next=22,this._loadArcadeModules(p);case 22:(d=e.sent)&&d.arcadeUtils.hasGeometryOperations(p)||!(0,E.R9)(c,o)?u.set(o.getObjectId(),l):a[l]=o;case 24:l++,e.next=9;break;case 27:if("stream"!==this.layer.type&&0!==u.size){e.next=29;break}return e.abrupt("return",a.filter(Boolean));case 29:return s.objectIds=Array.from(u.keys()),e.prev=30,e.next=33,this.layer.queryFeatures(s);case 33:h=e.sent,y=(0,n.Z)(h.features);try{for(y.s();!(v=y.n()).done;)b=v.value,a[u.get(b.getObjectId())]=b}catch(i){y.e(i)}finally{y.f()}e.next=40;break;case 38:e.prev=38,e.t0=e.catch(30);case 40:return e.abrupt("return",a.filter(Boolean));case 41:case"end":return e.stop()}}),e,this,[[30,38]])})));return function(t){return e.apply(this,arguments)}}()},{key:"createPopupQuery",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,a,u,s,l,o,f,c,p,d,h,y,v,b,x;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this.layer.createQuery(),a=new Set,u=!1,s=(0,m.pC)(t)&&t.clientGraphics?t.clientGraphics.map((function(e){return e.layer})):[this.layer],l=(0,n.Z)(s),e.prev=4,l.s();case 6:if((o=l.n()).done){e.next=25;break}if("popupEnabled"in(f=o.value)){e.next=10;break}return e.abrupt("continue",23);case 10:if(c=(0,R.V)(f,t),!(0,m.Wi)(c)){e.next=13;break}return e.abrupt("continue",23);case 13:return e.next=15,this._loadArcadeModules(c);case 15:return p=e.sent,d=p&&p.arcadeUtils.hasGeometryOperations(c),u=!("point"!==this.layer.geometryType&&!d),e.next=20,(0,R.e)(this.layer,c);case 20:h=e.sent,y=(0,n.Z)(h);try{for(y.s();!(v=y.n()).done;)b=v.value,a.add(b)}catch(i){y.e(i)}finally{y.f()}case 23:e.next=6;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(4),l.e(e.t0);case 30:return e.prev=30,l.f(),e.finish(30);case 33:return r.returnGeometry=u,r.returnZ=u,r.returnM=u,r.outFields=Array.from(a),r.outSpatialReference=this.view.spatialReference,"feature"===this.layer.type&&(x=(0,_.c)(this),(0,m.pC)(x)&&(r.where=r.where?"(".concat(r.where,") AND (").concat(x,")"):x)),e.abrupt("return",r);case 35:case"end":return e.stop()}}),e,this,[[4,27,30,33]])})));return function(t){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){return!!(0,o.Z)((0,f.Z)(r.prototype),"canResume",this).call(this)&&(!(0,m.pC)(this.timeExtent)||!this.timeExtent.isEmpty)}}]),r}(e);return(0,d._)([(0,F.Cb)()],t.prototype,"_updatingRequiredFieldsPromise",void 0),(0,d._)([(0,F.Cb)({readOnly:!0})],t.prototype,"availableFields",null),(0,d._)([(0,F.Cb)()],t.prototype,"effect",null),(0,d._)([(0,F.Cb)({type:w.Z})],t.prototype,"featureEffect",null),(0,d._)([(0,F.Cb)({type:Z.Z})],t.prototype,"filter",void 0),(0,d._)([(0,F.Cb)(k.qG)],t.prototype,"timeExtent",void 0),(0,d._)([(0,F.Cb)()],t.prototype,"layer",void 0),(0,d._)([(0,F.Cb)({type:Number})],t.prototype,"maximumNumberOfFeatures",null),(0,d._)([(0,F.Cb)({readOnly:!0,type:Boolean})],t.prototype,"maximumNumberOfFeaturesExceeded",null),(0,d._)([(0,F.Cb)({readOnly:!0})],t.prototype,"requiredFields",void 0),(0,d._)([(0,F.Cb)()],t.prototype,"suspended",void 0),(0,d._)([(0,F.Cb)()],t.prototype,"view",void 0),t=(0,d._)([(0,g.j)("esri.views.layers.FeatureLayerView")],t),t}},13107:function(e,t,r){r.d(t,{Z:function(){return d}});var n=r(15671),i=r(43144),a=r(60136),u=r(29388),s=r(27366),l=r(32718),o=r(66978),f=r(94172),c=r(49861),p=(r(63780),r(93169),r(25243),r(69912)),d=function(e){var t=function(e){(0,a.Z)(r,e);var t=(0,u.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"initialize",value:function(){var e=this;this.handles.add((0,f.on)((function(){return e.layer}),"refresh",(function(t){e.doRefresh(t.dataChanged).catch((function(t){(0,o.D_)(t)||l.Z.getLogger(e.declaredClass).error(t)}))})),"RefreshableLayerView")}}]),r}(e);return(0,s._)([(0,c.Cb)()],t.prototype,"layer",void 0),t=(0,s._)([(0,p.j)("esri.layers.mixins.RefreshableLayerView")],t)}},24405:function(e,t,r){r.d(t,{V:function(){return f},e:function(){return l}});var n=r(74165),i=r(93433),a=r(15861),u=r(92026),s=r(80031);function l(e){return o.apply(this,arguments)}function o(){return o=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a,l,o,f,c,p,d,h,y=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=y.length>1&&void 0!==y[1]?y[1]:t.popupTemplate,!(0,u.Wi)(r)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,r.getRequiredFields(t.fieldsIndex);case 5:if(a=e.sent,l=r.lastEditInfoEnabled,o=t.objectIdField,f=t.typeIdField,c=t.globalIdField,p=t.relationships,!a.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!l){e.next=19;break}return e.next=16,(0,s.CH)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return d=e.t0,h=(0,s.Q0)(t.fieldsIndex,[].concat((0,i.Z)(a),(0,i.Z)(d))),e.abrupt("return",(f&&h.push(f),h&&o&&t.fieldsIndex.has(o)&&!h.includes(o)&&h.push(o),h&&c&&t.fieldsIndex.has(c)&&!h.includes(c)&&h.push(c),p&&p.forEach((function(e){var r=e.keyField;h&&r&&t.fieldsIndex.has(r)&&!h.includes(r)&&h.push(r)})),h));case 23:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}function f(e,t){return e.popupTemplate?e.popupTemplate:(0,u.pC)(t)&&t.defaultPopupTemplateEnabled&&(0,u.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=8495.1edc6db4.chunk.js.map