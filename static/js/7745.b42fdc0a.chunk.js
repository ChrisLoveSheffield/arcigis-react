"use strict";(self.webpackChunkuums_front_end=self.webpackChunkuums_front_end||[]).push([[7745],{47745:function(e,t,r){r.r(t),r.d(t,{default:function(){return P}});var i=r(37762),n=r(15671),l=r(43144),u=r(11752),s=r(61120),a=r(60136),o=r(29388),d=r(27366),c=r(52639),y=r(32718),f=r(92026),h=r(94172),v=r(49861),p=(r(63780),r(93169),r(25243),r(69912)),g=r(48562),_=r(18661),F=r(87072),C=r(21149),b=r(8444),w=r(42757),I=r(42069),E=r(46169),k=r(31730),S=r(71039),x=r(95964),q=r(43812),A=r(51246),O=r(73552),m=r(44011),Q=r(1247),Z=r(48252),j=r(23224),D=r(6777),L=r(58890),R=r(17006),N=r(93463),U=y.Z.getLogger("esri.views.3d.layers.SceneLayerView3D"),H=(0,Z.v)(),G=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments)).type="scene-layer-3d",e.lodFactor=1,e.progressiveLoadFactor=1,e._elevationContext="scene",e._isIntegratedMesh=!1,e._supportsLabeling=!0,e._interactiveEditingSessions=new Map,e._queryEngine=null,e}return(0,l.Z)(r,[{key:"filter",get:function(){return this._get("filter")},set:function(e){this._set("filter",S.z.checkSupport(e)?e:null)}},{key:"viewFilter",get:function(){var e=this,t=this.filter;if((0,f.Wi)(t)&&(0,f.Wi)(this.layerFilter))return null;var r=this._get("viewFilter");return(0,f.Wi)(r)?new S.z({layerFilter:this.layerFilter,viewFilter:t,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:function(t){return e._loadAsyncModule(t)},applyFilters:function(){return e._applyFilters(!0)},addSqlFilter:function(t,r){return e.addSqlFilter(t,r,e.logError)}}):(r.viewFilter=this.filter,r.layerFilter=this.layerFilter,this.notifyChange("viewFilter"),r)}},{key:"requiredFields",get:function(){var e,t;return null!==(e=null===(t=this.fieldsHelper)||void 0===t?void 0:t.requiredFields)&&void 0!==e?e:[]}},{key:"floorFilterClause",get:function(){var e=(0,F.c)(this);return(0,f.pC)(e)?g.WhereClause.create(e,this.layer.fieldsIndex):null}},{key:"excludeObjectIdsSorted",get:function(){var e=this.layer.excludeObjectIds;return e.length?e.toArray().sort((function(e,t){return e-t})):null}},{key:"lodCrossfadeinDuration",get:function(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.qualitySettings.sceneService["3dObject"].lodCrossfadeinDuration)&&void 0!==e?e:0}},{key:"lodCrossfadeoutDuration",get:function(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.qualitySettings.sceneService["3dObject"].lodCrossfadeoutDuration)&&void 0!==e?e:0}},{key:"lodCrossfadeUncoveredDuration",get:function(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.qualitySettings.sceneService["3dObject"].lodCrossfadeUncoveredDuration)&&void 0!==e?e:0}},{key:"initialize",value:function(){var e=this;this.fieldsHelper=new D.K({layerView:this}),this.updatingHandles.add((function(){return e.layer.rangeInfos}),(function(t){return e._rangeInfosChanged(t)}),h.nn),this.updatingHandles.add((function(){return e.layer.renderer}),(function(t){return e.updatingHandles.addPromise(e._rendererChange(t))}),h.nn),this.updatingHandles.add((function(){return[e.parsedDefinitionExpression,e.filter,e.layer.filter,e.floorFilterClause,e.excludeObjectIdsSorted,(0,f.yw)(e.viewFilter,(function(e){return[e.parsedWhereClause,e.parsedGeometry,e.sortedObjectIds]}))]}),(function(){return e._filterChange()})),this.updatingHandles.add((function(){return[e.filter,(0,f.yw)(e.viewFilter,(function(e){return e.parsedGeometry}))]}),(function(){return e._geometryFilterChange()})),this.handles.add(this.layer.on("apply-edits",(function(t){return e.updatingHandles.addPromise(t.result)}))),this.handles.add(this.layer.on("edits",(function(t){return e._handleEdits(t)})))}},{key:"destroy",value:function(){this.fieldsHelper=(0,f.SC)(this.fieldsHelper)}},{key:"_rangeInfosChanged",value:function(e){null!=e&&e.length>0&&U.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}},{key:"createQuery",value:function(){var e={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return(0,f.pC)(this.filter)?this.filter.createQuery(e):new C.Z(e)}},{key:"queryExtent",value:function(e,t){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"queryFeatureCount",value:function(e,t){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"queryFeatures",value:function(e,t){var r=this;return this._ensureQueryEngine().executeQuery(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal).then((function(e){if(null===e||void 0===e||!e.features)return e;var t,n=r.layer,l=(0,i.Z)(e.features);try{for(l.s();!(t=l.n()).done;){var u=t.value;u.layer=n,u.sourceLayer=n}}catch(s){l.e(s)}finally{l.f()}return e}))}},{key:"queryObjectIds",value:function(e,t){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"_ensureQueryEngine",value:function(){return this._queryEngine||(this._queryEngine=this._createQueryEngine()),this._queryEngine}},{key:"_createQueryEngine",value:function(){var e=this,t=(0,k.gz)(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new q.u({layerView:this,priority:N.T8.FEATURE_QUERY_ENGINE,spatialIndex:new O.I({featureAdapter:new A.u({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo,getFeatureExtent:t}),toArray:function(){var t=new Array;return e._forAllFeatures((function(e,r,i){return t.push({id:e,index:r,meta:i}),w.K.CONTINUE}),null,w.u.ALL_IN_CLIPPING_AREA),t},forAllFeatures:function(t,r){return e._forAllFeatures((function(e,r,i){return t({id:e,index:r,meta:i})}),r,w.u.ALL_IN_CLIPPING_AREA)},getFeatureExtent:t,sourceSpatialReference:(0,m.tp)(this.layer),viewSpatialReference:this.view.spatialReference})})}},{key:"highlight",value:function(e){var t=this._highlights;if(e instanceof C.Z){var i=t.acquireSet(),n=i.set,l=i.handle;return this.queryObjectIds(e).then((function(e){return t.setFeatureIds(n,e)})),l}return(0,u.Z)((0,s.Z)(r.prototype),"highlight",this).call(this,e)}},{key:"createInteractiveEditSession",value:function(e){return(0,E.s)(this.attributeEditingContext,e)}},{key:"_createLayerGraphic",value:function(e){var t=new c.Z(null,null,e);return t.layer=this.layer,t.sourceLayer=this.layer,t}},{key:"canResume",value:function(){return(0,u.Z)((0,s.Z)(r.prototype),"canResume",this).call(this)&&(!this._controller||this._controller.rootNodeVisible)}},{key:"getFilters",value:function(){var e=(0,u.Z)((0,s.Z)(r.prototype),"getFilters",this).call(this),t=this.excludeObjectIdsSorted;return(0,f.pC)(t)&&e.push((function(e){return(0,m.Yb)(t,!1,e)})),this.floorFilterClause&&this.addSqlFilter(e,this.floorFilterClause,this.logError),this.addSqlFilter(e,this.parsedDefinitionExpression,this.logError),(0,f.pC)(this.viewFilter)&&this.viewFilter.addFilters(e,this.view,this._controller.crsIndex,this._collection),e}},{key:"isUpdating",value:function(){return(0,u.Z)((0,s.Z)(r.prototype),"isUpdating",this).call(this)||this.layerFilterUpdating}},{key:"_ensureQuery",value:function(e){return this._addDefinitionExpressionToQuery((0,f.Wi)(e)?this.createQuery():C.Z.from(e))}},{key:"attributeEditingContext",get:function(){var e=this;return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),forEachNode:function(t){return e._forAllNodes((function(e){return(0,f.pC)(e)?t(e.node,e.featureIds):null}))},attributeStorageInfo:this.i3slayer.attributeStorageInfo,attributeOverrides:this.attributeOverrides,getAttributeData:function(t){return e.getAttributeData(t)},setAttributeData:function(t,r){return e.setAttributeData(t,r)},clearMemCache:function(){return e.clearMemCache()}}}},{key:"_handleEdits",value:function(e){(0,E.Z)(this.attributeEditingContext,e)}},{key:"hasGeometryFilter",get:function(){var e=this.viewFilter;return(0,f.pC)(e)&&(0,f.pC)(e.parsedGeometry)}},{key:"computeNodeFiltering",value:function(e){var t=this.viewFilter;return(0,f.Wi)(t)||t.isMBSGeometryVisible(e,this.view.spatialReference,this._controller.crsIndex)?x.U_.Unmodified:x.U_.Culled}}]),r}((0,b.N)((0,Q.l)((0,j.i)((0,I.A)(R.Z)))));(0,d._)([(0,v.Cb)({aliasOf:"layer"})],G.prototype,"i3slayer",void 0),(0,d._)([(0,v.Cb)(L.q)],G.prototype,"updatingProgress",void 0),(0,d._)([(0,v.Cb)({type:_.Z})],G.prototype,"filter",null),(0,d._)([(0,v.Cb)({readOnly:!0})],G.prototype,"viewFilter",null),(0,d._)([(0,v.Cb)(H.requiredFields)],G.prototype,"requiredFields",null),(0,d._)([(0,v.Cb)(H.availableFields)],G.prototype,"availableFields",void 0),(0,d._)([(0,v.Cb)()],G.prototype,"fieldsHelper",void 0),(0,d._)([(0,v.Cb)()],G.prototype,"floorFilterClause",null),(0,d._)([(0,v.Cb)()],G.prototype,"excludeObjectIdsSorted",null),(0,d._)([(0,v.Cb)({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],G.prototype,"lodFactor",void 0),(0,d._)([(0,v.Cb)({readOnly:!0,aliasOf:"_controller.updatingProgress"})],G.prototype,"updatingProgressValue",void 0);var P=G=(0,d._)([(0,p.j)("esri.views.3d.layers.SceneLayerView3D")],G)}}]);
//# sourceMappingURL=7745.b42fdc0a.chunk.js.map